import{G as be,$ as ye,H as Ce,R as Oe,U as xe}from"./IIIFContentHandler-JCX6SYFT.f723564c.mjs";import{a3 as ie,a5 as k,a4 as Se,al as ee,ae as M,am as q,a7 as D,ad as T,af as Le,an as W,ao as he,ap as Ae,aj as z,ah as Y,ai as we,aq as ue,ar as Re}from"./entry.6e61bf97.mjs";var Pe=Se((e,l)=>{(function(f,_){typeof e=="object"&&typeof l=="object"?l.exports=_():typeof define=="function"&&define.amd?define("IIIFMetadataComponent",[],_):typeof e=="object"?e.IIIFMetadataComponent=_():f.IIIFMetadataComponent=_()})(typeof self<"u"?self:e,function(){return function(f){var _={};function I(E){if(_[E])return _[E].exports;var d=_[E]={i:E,l:!1,exports:{}};return f[E].call(d.exports,d,d.exports,I),d.l=!0,d.exports}return I.m=f,I.c=_,I.d=function(E,d,m){I.o(E,d)||Object.defineProperty(E,d,{enumerable:!0,get:m})},I.r=function(E){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},I.t=function(E,d){if(1&d&&(E=I(E)),8&d||4&d&&typeof E=="object"&&E&&E.__esModule)return E;var m=Object.create(null);if(I.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:E}),2&d&&typeof E!="string")for(var o in E)I.d(m,o,function(g){return E[g]}.bind(null,o));return m},I.n=function(E){var d=E&&E.__esModule?function(){return E.default}:function(){return E};return I.d(d,"a",d),d},I.o=function(E,d){return Object.prototype.hasOwnProperty.call(E,d)},I.p="",I(I.s=0)}([function(f,_,I){f.exports=I(1)},function(f,_,I){var E,d=this&&this.__extends||(E=function(a,i){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}E(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(_,"__esModule",{value:!0});var m,o=I(2),g=I(3),p=I(4);(function(a){a.LINES="lines",a.CHARS="chars"})(m=_.LimitType||(_.LimitType={}));var r=function(a){function i(t){var n=a.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return d(i,a),i.prototype._init=function(){return a.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},i.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:m.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(t){return t},showAllLanguages:!1}},i.prototype._getManifestGroup=function(){return this._metadataGroups.filter(function(t){return t.resource.isManifest()})[0]},i.prototype._getCanvasGroups=function(){return this._metadataGroups.filter(function(t){return t.resource.isCanvas()})},i.prototype.set=function(t){var n=this;if(this._data=Object.assign(this._data,t),this._data&&this._data.helper){var s,h={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(h),this._data.manifestDisplayOrder&&((s=this._getManifestGroup()).items=this._sortItems(s.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach(function(C,S){C.items=n._sortItems(C.items,n._readCSV(n._data.canvasDisplayOrder))}),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((s=this._getManifestGroup()).items=this._exclude(s.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach(function(C,S){C.items=n._exclude(C.items,n._readCSV(n._data.canvasExclude))}),this._data.limitToRange){var v=[];this._metadataGroups.forEach(function(C,S){C.resource.isRange()&&v.push(C)}),v.length&&(this._metadataGroups=v)}this._render()}},i.prototype._sortItems=function(t,n){var s=this,h=[],v=t.slice(0);return n.forEach(function(C,S){var w=v.filter(function(x){return s._normalise(x.getLabel())===C})[0];if(w){h.push(w);var L=v.indexOf(w);L>-1&&v.splice(L,1)}}),v.forEach(function(C,S){h.push(C)}),h},i.prototype._sortGroups=function(t,n){var s=[],h=t.slice(0);return n.forEach(function(v,C){var S=h.filter(function(L){return L.resource.getIIIFResourceType().toLowerCase()==v.toLowerCase()})[0];if(S){s.push(S);var w=h.indexOf(S);w>-1&&h.splice(w,1)}}),s},i.prototype._label=function(t,n){t.forEach(function(s,h){s.label=n[h]})},i.prototype._exclude=function(t,n){var s=this;return n.forEach(function(h,v){var C=t.filter(function(w){return s._normalise(w.getLabel())===h})[0];if(C){var S=t.indexOf(C);S>-1&&t.splice(S,1)}}),t},i.prototype._normalise=function(t){return t?t.toLowerCase().replace(/ /g,""):null},i.prototype._render=function(){var t=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach(function(n,s){var h=t._buildMetadataGroup(n);t._$metadataGroups.append(h);var v=h.find(".value");t._data.limit&&t._data.content&&(t._data.limitType===m.LINES?v.toggleExpandTextByLines(t._data.limit,t._data.content.less,t._data.content.more,function(){}):t._data.limitType===m.CHARS&&v.ellipsisHtmlFixed(t._data.limit,function(){}))})):this._$noData.show()},i.prototype._buildMetadataGroup=function(t){var n=this._$metadataGroupTemplate.clone(),s=n.find(">.header");if(this._data.content){if(t.resource.isManifest()&&this._data.content.manifestHeader)(v=this._sanitize(this._data.content.manifestHeader))&&s.html(v);else if(t.resource.isSequence()&&this._data.content.sequenceHeader)(v=this._sanitize(this._data.content.sequenceHeader))&&s.html(v);else if(t.resource.isRange()&&this._data.content.rangeHeader)(v=this._sanitize(this._data.content.rangeHeader))&&s.html(v);else if(t.resource.isCanvas()&&(t.label||this._data.content.canvasHeader)){var h=t.label||this._data.content.canvasHeader;s.html(this._sanitize(h))}else if(t.resource.isAnnotation()&&this._data.content.imageHeader){var v;(v=this._sanitize(this._data.content.imageHeader))&&s.html(v)}}s.text()||s.hide();for(var C=n.find(".items"),S=0;S<t.items.length;S++){var w=t.items[S],L=this._buildMetadataItem(w);C.append(L)}return n},i.prototype._buildMetadataItem=function(t){var n,s=this._$metadataItemTemplate.clone(),h=s.find(".label"),v=s.find(".values"),C=t.getLabel(),S=C,w=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&S&&t.isRootLevel)switch(S.toLowerCase()){case"attribution":S=this._data.content.attribution;break;case"description":S=this._data.content.description;break;case"license":S=this._data.content.license;break;case"logo":S=this._data.content.logo}if(S=this._sanitize(S),h.html(S),this._addReadingDirection(h,this._getLabelLocale(t)),s.addClass(p.Strings.toCssClass(S)),C&&C.toLowerCase()==="license"&&w.exec(t.value[0].value)!==null)n=this._buildMetadataItemURIValue(t.value[0].value),v.append(n);else if(this._data.showAllLanguages&&t.value&&t.value.length>1)for(var L=0;L<t.value.length;L++){var x=t.value[L];n=this._buildMetadataItemValue(x.value,x.locale),v.append(n)}else{var y=this._getValueLocale(t),c=!1;for(L=0;L<t.value.length;L++){var x=t.value[L];y.toLowerCase()===x.locale.toLowerCase()&&(c=!0,n=this._buildMetadataItemValue(x.value,x.locale),v.append(n))}c||(x=t.value[0])&&(n=this._buildMetadataItemValue(x.value,x.locale),v.append(n))}this._data.copyToClipboardEnabled&&p.Clipboard.supportsCopy()&&h.text()&&this._addCopyButton(s,h,v);var b=this;return s.on("click","a.iiif-viewer-link",function(O){O.preventDefault();var A=$(O.target),R=A.attr("data-uv-navigate")||A.prop("href");b.fire(u.IIIF_VIEWER_LINK_CLICKED,R)}),s.on("click","[data-uv-navigate]",function(O){O.preventDefault();var A=$(O.target).attr("data-uv-navigate")||null;A&&b.fire(u.IIIF_VIEWER_LINK_CLICKED,A)}),s},i.prototype._getLabelLocale=function(t){if(!this._data||!this._data.helper)return"";var n=this._data.helper.options.locale;if(t.label.length){var s=t.label[0].locale;if(s.toLowerCase()!==n.toLowerCase())return s}return n},i.prototype._getValueLocale=function(t){return this._data&&this._data.helper?this._data.helper.options.locale:""},i.prototype._buildMetadataItemValue=function(t,n){t=(t=this._sanitize(t)).replace(`
`,"<br>");var s=this._$metadataItemValueTemplate.clone();return s.html(t),s.find("a").each(function(){var h=$(this);h.hasClass("iiif-viewer-link")||h.prop("target","_blank")}),n&&this._addReadingDirection(s,n),s},i.prototype._buildMetadataItemURIValue=function(t){t=this._sanitize(t);var n=this._$metadataItemURIValueTemplate.clone();return n.prop("href",t),n.text(t),n},i.prototype._addReadingDirection=function(t,n){n=o.Utils.getInexactLocale(n),this._readCSV(this._data.rtlLanguageCodes).filter(function(s){return s===n}).length>0&&(t.prop("dir","rtl"),t.addClass("rtl"))},i.prototype._addCopyButton=function(t,n,s){var h=this._$copyTextTemplate.clone(),v=h.children();n.append(h),p.Device.isTouch()?h.show():(t.on("mouseenter",function(){h.show()}),t.on("mouseleave",function(){h.hide()}),h.on("mouseleave",function(){v.hide()}));var C=this,S=s.text();h.on("click",function(w){C._copyItemValues(h,S)})},i.prototype._copyItemValues=function(t,n){p.Clipboard.copy(n);var s=t.find(".copiedText");s.show(),setTimeout(function(){s.hide()},this._data.copiedMessageDuration)},i.prototype._readCSV=function(t,n){n===void 0&&(n=!0);var s=[];if(t&&(s=t.split(","),n))for(var h=0;h<s.length;h++)s[h]=this._normalise(s[h]);return s},i.prototype._sanitize=function(t){return this._data.sanitizer?this._data.sanitizer(t):null},i.prototype._resize=function(){},i}(g.BaseComponent);_.MetadataComponent=r;var u=function(){function a(){}return a.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",a}();_.Events=u},function(f,_,I){f.exports=function(E){var d={};function m(o){if(d[o])return d[o].exports;var g=d[o]={i:o,l:!1,exports:{}};return E[o].call(g.exports,g,g.exports,m),g.l=!0,g.exports}return m.m=E,m.c=d,m.d=function(o,g,p){m.o(o,g)||Object.defineProperty(o,g,{enumerable:!0,get:p})},m.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},m.t=function(o,g){if(1&g&&(o=m(o)),8&g||4&g&&typeof o=="object"&&o&&o.__esModule)return o;var p=Object.create(null);if(m.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:o}),2&g&&typeof o!="string")for(var r in o)m.d(p,r,function(u){return o[u]}.bind(null,r));return p},m.n=function(o){var g=o&&o.__esModule?function(){return o.default}:function(){return o};return m.d(g,"a",g),g},m.o=function(o,g){return Object.prototype.hasOwnProperty.call(o,g)},m.p="",m(m.s=4)}([function(E,d,m){function o(g){for(var p in g)d.hasOwnProperty(p)||(d[p]=g[p])}Object.defineProperty(d,"__esModule",{value:!0}),o(m(6)),o(m(7)),o(m(8)),o(m(9)),o(m(10)),o(m(11)),o(m(12)),o(m(13)),o(m(14)),o(m(15)),o(m(16)),o(m(17)),o(m(18)),o(m(19)),o(m(20)),o(m(21)),o(m(22)),o(m(23)),o(m(24)),o(m(25)),o(m(26)),o(m(27)),o(m(28)),o(m(29)),o(m(30)),o(m(31)),o(m(32)),o(m(2))},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),function(o){o.BOOKMARKING="oa:bookmarking",o.CLASSIFYING="oa:classifying",o.COMMENTING="oa:commenting",o.DESCRIBING="oa:describing",o.EDITING="oa:editing",o.HIGHLIGHTING="oa:highlighting",o.IDENTIFYING="oa:identifying",o.LINKING="oa:linking",o.MODERATING="oa:moderating",o.PAINTING="sc:painting",o.QUESTIONING="oa:questioning",o.REPLYING="oa:replying",o.TAGGING="oa:tagging",o.TRANSCRIBING="oad:transcribing"}(d.AnnotationMotivation||(d.AnnotationMotivation={})),function(o){o.AUTO_ADVANCE="auto-advance",o.CONTINUOUS="continuous",o.FACING_PAGES="facing-pages",o.HIDDEN="hidden",o.INDIVIDUALS="individuals",o.MULTI_PART="multi-part",o.NO_NAV="no-nav",o.NON_PAGED="non-paged",o.PAGED="paged",o.REPEAT="repeat",o.SEQUENCE="sequence",o.THUMBNAIL_NAV="thumbnail-nav",o.TOGETHER="together",o.UNORDERED="unordered"}(d.Behavior||(d.Behavior={})),function(o){o.CANVAS="canvas",o.CHOICE="choice",o.CONTENT_AS_TEXT="contentastext",o.DOCUMENT="document",o.IMAGE="image",o.MOVING_IMAGE="movingimage",o.PDF="pdf",o.PHYSICAL_OBJECT="physicalobject",o.SOUND="sound",o.TEXTUALBODY="textualbody",o.VIDEO="video"}(d.ExternalResourceType||(d.ExternalResourceType={})),function(o){o.ANNOTATION="annotation",o.CANVAS="canvas",o.COLLECTION="collection",o.MANIFEST="manifest",o.RANGE="range",o.SEQUENCE="sequence"}(d.IIIFResourceType||(d.IIIFResourceType={})),function(o){o.AUDIO_MP4="audio/mp4",o.CORTO="application/corto",o.DRACO="application/draco",o.GLTF="model/gltf+json",o.JPG="image/jpeg",o.M3U8="application/vnd.apple.mpegurl",o.MP3="audio/mp3",o.MPEG_DASH="application/dash+xml",o.OBJ="text/plain",o.PDF="application/pdf",o.PLY="application/ply",o.THREEJS="application/vnd.threejs+json",o.VIDEO_MP4="video/mp4",o.WEBM="video/webm"}(d.MediaType||(d.MediaType={})),function(o){o.DOC="application/msword",o.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",o.PDF="application/pdf"}(d.RenderingFormat||(d.RenderingFormat={})),function(o){o.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",o.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",o.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",o.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",o.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",o.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",o.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",o.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",o.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",o.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",o.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",o.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",o.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",o.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",o.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",o.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",o.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",o.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",o.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",o.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",o.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",o.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",o.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",o.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",o.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",o.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",o.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",o.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",o.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",o.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",o.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",o.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",o.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",o.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",o.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",o.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",o.SEARCH_0="http://iiif.io/api/search/0/search",o.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",o.SEARCH_1="http://iiif.io/api/search/1/search",o.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",o.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",o.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",o.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",o.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",o.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",o.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(d.ServiceProfile||(d.ServiceProfile={})),function(o){o.BOTTOM_TO_TOP="bottom-to-top",o.LEFT_TO_RIGHT="left-to-right",o.RIGHT_TO_LEFT="right-to-left",o.TOP_TO_BOTTOM="top-to-bottom"}(d.ViewingDirection||(d.ViewingDirection={})),function(o){o.CONTINUOUS="continuous",o.INDIVIDUALS="individuals",o.NON_PAGED="non-paged",o.PAGED="paged",o.TOP="top"}(d.ViewingHint||(d.ViewingHint={}))},function(E,d,m){var o=this&&this.__awaiter||function(i,t,n,s){return new(n||(n=Promise))(function(h,v){function C(L){try{w(s.next(L))}catch(x){v(x)}}function S(L){try{w(s.throw(L))}catch(x){v(x)}}function w(L){var x;L.done?h(L.value):(x=L.value,x instanceof n?x:new n(function(y){y(x)})).then(C,S)}w((s=s.apply(i,t||[])).next())})},g=this&&this.__generator||function(i,t){var n,s,h,v,C={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return v={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function S(w){return function(L){return function(x){if(n)throw new TypeError("Generator is already executing.");for(;C;)try{if(n=1,s&&(h=2&x[0]?s.return:x[0]?s.throw||((h=s.return)&&h.call(s),0):s.next)&&!(h=h.call(s,x[1])).done)return h;switch(s=0,h&&(x=[2&x[0],h.value]),x[0]){case 0:case 1:h=x;break;case 4:return C.label++,{value:x[1],done:!1};case 5:C.label++,s=x[1],x=[0];continue;case 7:x=C.ops.pop(),C.trys.pop();continue;default:if(!(h=(h=C.trys).length>0&&h[h.length-1])&&(x[0]===6||x[0]===2)){C=0;continue}if(x[0]===3&&(!h||x[1]>h[0]&&x[1]<h[3])){C.label=x[1];break}if(x[0]===6&&C.label<h[1]){C.label=h[1],h=x;break}if(h&&C.label<h[2]){C.label=h[2],C.ops.push(x);break}h[2]&&C.ops.pop(),C.trys.pop();continue}x=t.call(i,C)}catch(y){x=[6,y],s=0}finally{n=h=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([w,L])}}};Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=m(1),u=m(33);m(34);var a=function(){function i(){}return i.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},i.getImageQuality=function(t){return t===r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_1_LEVEL_1||t===r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===r.ServiceProfile.IMAGE_1_LEVEL_2||t===r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},i.getInexactLocale=function(t){return t.indexOf("-")!==-1?t.substr(0,t.indexOf("-")):t},i.getLocalisedValue=function(t,n){if(!Array.isArray(t))return t;for(var s=0;s<t.length;s++){var h=t[s];if(n===h["@language"])return h["@value"]}var v=n.substr(0,n.indexOf("-"));for(s=0;s<t.length;s++){var C=t[s];if(C["@language"]===v)return C["@value"]}return null},i.generateTreeNodeIds=function(t,n){var s;n===void 0&&(n=0),s=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=s;for(var h=0;h<t.nodes.length;h++){var v=t.nodes[h];i.generateTreeNodeIds(v,h)}},i.normaliseType=function(t){return(t=t.toLowerCase()).indexOf(":")!==-1?t.split(":")[1]:t},i.normaliseUrl=function(t){return(t=t.substr(t.indexOf("://"))).indexOf("#")!==-1&&(t=t.split("#")[0]),t},i.normalisedUrlsMatch=function(t,n){return i.normaliseUrl(t)===i.normaliseUrl(n)},i.isImageProfile=function(t){return!!(i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},i.isLevel0ImageProfile=function(t){return!!(i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_LEVEL_0)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},i.isLevel1ImageProfile=function(t){return!!(i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_LEVEL_1)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},i.isLevel2ImageProfile=function(t){return!!(i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_LEVEL_2)||i.normalisedUrlsMatch(t,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},i.parseManifest=function(t,n){return p.Deserialiser.parse(t,n)},i.checkStatus=function(t){if(t.ok)return t;var n=new Error(t.statusText);return n.response=t,Promise.reject(n)},i.loadManifest=function(t){return new Promise(function(n){fetch(t).then(i.checkStatus).then(function(s){return s.json()}).then(function(s){n(s)})})},i.loadExternalResourcesAuth1=function(t,n,s,h,v,C,S,w){return new Promise(function(L,x){var y=t.map(function(c){return i.loadExternalResourceAuth1(c,n,s,h,v,C,S,w)});Promise.all(y).then(function(){L(t)}).catch(function(c){x(c)})})},i.loadExternalResourceAuth1=function(t,n,s,h,v,C,S,w){return o(this,void 0,void 0,function(){var L;return g(this,function(x){switch(x.label){case 0:return[4,h(t)];case 1:return(L=x.sent())?[4,t.getData(L)]:[3,6];case 2:return x.sent(),t.status!==u.OK?[3,3]:[2,t];case 3:return[4,i.doAuthChain(t,n,s,v,C,S,w)];case 4:x.sent(),x.label=5;case 5:if(t.status===u.OK||t.status===u.MOVED_TEMPORARILY)return[2,t];throw i.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return x.sent(),t.status!==u.MOVED_TEMPORARILY&&t.status!==u.UNAUTHORIZED?[3,9]:[4,i.doAuthChain(t,n,s,v,C,S,w)];case 8:x.sent(),x.label=9;case 9:if(t.status===u.OK||t.status===u.MOVED_TEMPORARILY)return[2,t];throw i.createAuthorizationFailedError()}})})},i.doAuthChain=function(t,n,s,h,v,C,S){return o(this,void 0,void 0,function(){var w,L,x,y,c,b,O,A;return g(this,function(R){switch(R.label){case 0:return t.isAccessControlled()?((w=t.externalService)&&(w.options=t.options),(L=t.kioskService)&&(L.options=t.options),(x=t.clickThroughService)&&(x.options=t.options),(y=t.loginService)&&(y.options=t.options),t.isResponseHandled||t.status!==u.MOVED_TEMPORARILY?[3,2]:[4,C(t)]):[2,t];case 1:return R.sent(),[2,t];case 2:return c=null,b=null,(c=w)?(b=c,[4,i.attemptResourceWithToken(t,s,c)]):[3,4];case 3:return R.sent(),[2,t];case 4:return(c=L)?(b=c,(O=n(c))?[4,h(O)]:[3,7]):[3,7];case 5:return R.sent(),[4,i.attemptResourceWithToken(t,s,c)];case 6:return R.sent(),[2,t];case 7:return(c=x)?(b=c,[4,v(t,c)]):[3,11];case 8:return(A=R.sent())?[4,h(A)]:[3,11];case 9:return R.sent(),[4,i.attemptResourceWithToken(t,s,c)];case 10:return R.sent(),[2,t];case 11:return(c=y)?(b=c,[4,v(t,c)]):[3,15];case 12:return(A=R.sent())?[4,h(A)]:[3,15];case 13:return R.sent(),[4,i.attemptResourceWithToken(t,s,c)];case 14:return R.sent(),[2,t];case 15:return b&&S(t,b),[2]}})})},i.attemptResourceWithToken=function(t,n,s){return o(this,void 0,void 0,function(){var h,v;return g(this,function(C){switch(C.label){case 0:return(h=s.getService(r.ServiceProfile.AUTH_1_TOKEN))?[4,n(t,h)]:[3,3];case 1:return(v=C.sent())&&v.accessToken?[4,t.getData(v)]:[3,3];case 2:return C.sent(),[2,t];case 3:return[2]}})})},i.loadExternalResourcesAuth09=function(t,n,s,h,v,C,S,w,L,x){return new Promise(function(y,c){var b=t.map(function(O){return i.loadExternalResourceAuth09(O,n,s,h,v,C,S,w,L,x)});Promise.all(b).then(function(){y(t)}).catch(function(O){c(O)})})},i.loadExternalResourceAuth09=function(t,n,s,h,v,C,S,w,L,x){return new Promise(function(y,c){x&&x.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(y(s(t)),y(h(t))):v(t).then(function(){C(t,!0).then(function(b){t.getData(b).then(function(){y(L(t))}).catch(function(O){c(i.createInternalServerError(O))})}).catch(function(b){c(i.createInternalServerError(b))})}).catch(function(b){c(i.createInternalServerError(b))}):y(t)}).catch(function(b){c(i.createInternalServerError(b))}):w(t,n).then(function(b){b?t.getData(b).then(function(){t.status===u.OK?y(L(t)):i.authorize(t,n,s,h,v,C,S,w).then(function(){y(L(t))}).catch(function(O){c(i.createAuthorizationFailedError())})}).catch(function(O){c(i.createAuthorizationFailedError())}):i.authorize(t,n,s,h,v,C,S,w).then(function(){y(L(t))}).catch(function(O){c(i.createAuthorizationFailedError())})}).catch(function(b){c(i.createAuthorizationFailedError())})})},i.createError=function(t,n){var s=new Error;return s.message=n,s.name=String(t),s},i.createAuthorizationFailedError=function(){return i.createError(p.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},i.createRestrictedError=function(){return i.createError(p.StatusCode.RESTRICTED,"Restricted")},i.createInternalServerError=function(t){return i.createError(p.StatusCode.INTERNAL_SERVER_ERROR,t)},i.authorize=function(t,n,s,h,v,C,S,w){return new Promise(function(L,x){t.getData().then(function(){t.isAccessControlled()?w(t,n).then(function(y){y?t.getData(y).then(function(){t.status===u.OK?L(t):i.showAuthInteraction(t,n,s,h,v,C,S,L,x)}).catch(function(c){x(i.createInternalServerError(c))}):C(t,!1).then(function(c){c?S(t,c,n).then(function(){t.getData(c).then(function(){t.status===u.OK?L(t):i.showAuthInteraction(t,n,s,h,v,C,S,L,x)}).catch(function(b){x(i.createInternalServerError(b))})}).catch(function(b){x(i.createInternalServerError(b))}):i.showAuthInteraction(t,n,s,h,v,C,S,L,x)})}).catch(function(y){x(i.createInternalServerError(y))}):L(t)})})},i.showAuthInteraction=function(t,n,s,h,v,C,S,w,L){t.status!==u.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?s(t).then(function(){C(t,!0).then(function(x){S(t,x,n).then(function(){t.getData(x).then(function(){w(t)}).catch(function(y){L(i.createInternalServerError(y))})}).catch(function(y){L(i.createInternalServerError(y))})}).catch(function(x){L(i.createInternalServerError(x))})}):v(t).then(function(){C(t,!0).then(function(x){S(t,x,n).then(function(){t.getData(x).then(function(){w(t)}).catch(function(y){L(i.createInternalServerError(y))})}).catch(function(y){L(i.createInternalServerError(y))})}).catch(function(x){L(i.createInternalServerError(x))})}):w(t)},i.getService=function(t,n){for(var s=this.getServices(t),h=0;h<s.length;h++){var v=s[h];if(v.getProfile()===n)return v}return null},i.getResourceById=function(t,n){return i.traverseAndFind(t.__jsonld,"@id",n)},i.traverseAndFind=function(t,n,s){if(t.hasOwnProperty(n)&&t[n]===s)return t;for(var h=0;h<Object.keys(t).length;h++)if(typeof t[Object.keys(t)[h]]=="object"){var v=i.traverseAndFind(t[Object.keys(t)[h]],n,s);if(v!=null)return v}},i.getServices=function(t){var n,s=[];if(!(n=t.__jsonld?t.__jsonld.service:t.service))return s;Array.isArray(n)||(n=[n]);for(var h=0;h<n.length;h++){var v=n[h];if(typeof v=="string"){var C=this.getResourceById(t.options.resource,v);C&&s.push(new p.Service(C.__jsonld||C,t.options))}else s.push(new p.Service(v,t.options))}return s},i.getTemporalComponent=function(t){var n=/t=([^&]+)/g.exec(t),s=null;return n&&n[1]&&(s=n[1].split(",")),s},i}();d.Utils=a},function(E,d,m){m.r(d),d.default=function(o,g){return g=g||{},new Promise(function(p,r){var u=new XMLHttpRequest,a=[],i=[],t={},n=function(){return{ok:(u.status/100|0)==2,statusText:u.statusText,status:u.status,url:u.responseURL,text:function(){return Promise.resolve(u.responseText)},json:function(){return Promise.resolve(JSON.parse(u.responseText))},blob:function(){return Promise.resolve(new Blob([u.response]))},clone:n,headers:{keys:function(){return a},entries:function(){return i},get:function(h){return t[h.toLowerCase()]},has:function(h){return h.toLowerCase()in t}}}};for(var s in u.open(g.method||"get",o,!0),u.onload=function(){u.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(h,v,C){a.push(v=v.toLowerCase()),i.push([v,C]),t[v]=t[v]?t[v]+","+C:C}),p(n())},u.onerror=r,u.withCredentials=g.credentials=="include",g.headers)u.setRequestHeader(s,g.headers[s]);u.send(g.body||null)})}},function(E,d,m){E.exports=m(5)},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),function(g){for(var p in g)d.hasOwnProperty(p)||(d[p]=g[p])}(m(0));var o=m(2);d.loadManifest=function(g){return o.Utils.loadManifest(g)},d.parseManifest=function(g,p){return o.Utils.parseManifest(g,p)}},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0});var o=function(){function g(p){this.__jsonld=p,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return g.prototype.getProperty=function(p){var r=null;return this.__jsonld&&((r=this.__jsonld[p])||(r=this.__jsonld["@"+p])),r},g}();d.JSONLDResource=o},function(E,d,m){var o,g=this&&this.__extends||(o=function(a,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}o(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=m(1),u=function(a){function i(t,n){var s=a.call(this,t)||this;return s.options=n,s}return g(i,a),i.prototype.getIIIFResourceType=function(){return p.Utils.normaliseType(this.getProperty("type"))},i.prototype.getLabel=function(){var t=this.getProperty("label");return t?p.LanguageMap.parse(t,this.options.locale):[]},i.prototype.getDefaultLabel=function(){return p.LanguageMap.getValue(this.getLabel())},i.prototype.getMetadata=function(){var t=this.getProperty("metadata"),n=[];if(!t)return n;for(var s=0;s<t.length;s++){var h=t[s],v=new p.LabelValuePair(this.options.locale);v.parse(h),n.push(v)}return n},i.prototype.getRendering=function(t){for(var n=this.getRenderings(),s=0;s<n.length;s++){var h=n[s];if(h.getFormat()===t)return h}return null},i.prototype.getRenderings=function(){var t,n=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){var h=t[s];n.push(new p.Rendering(h,this.options))}return n},i.prototype.getService=function(t){return p.Utils.getService(this,t)},i.prototype.getServices=function(){return p.Utils.getServices(this)},i.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new p.Thumbnail(t,this.options):null},i.prototype.isAnnotation=function(){return this.getIIIFResourceType()===r.IIIFResourceType.ANNOTATION},i.prototype.isCanvas=function(){return this.getIIIFResourceType()===r.IIIFResourceType.CANVAS},i.prototype.isCollection=function(){return this.getIIIFResourceType()===r.IIIFResourceType.COLLECTION},i.prototype.isManifest=function(){return this.getIIIFResourceType()===r.IIIFResourceType.MANIFEST},i.prototype.isRange=function(){return this.getIIIFResourceType()===r.IIIFResourceType.RANGE},i.prototype.isSequence=function(){return this.getIIIFResourceType()===r.IIIFResourceType.SEQUENCE},i}(p.JSONLDResource);d.ManifestResource=u},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(i,t){return u.call(this,i,t)||this}return g(a,u),a.prototype.getFormat=function(){var i=this.getProperty("format");return i?i.toLowerCase():null},a.prototype.getResources=function(){var i=[];if(!this.__jsonld.resources)return i;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],s=new p.Annotation(n,this.options);i.push(s)}return i},a.prototype.getType=function(){var i=this.getProperty("type");return i?p.Utils.normaliseType(i):null},a.prototype.getWidth=function(){return this.getProperty("width")},a.prototype.getHeight=function(){return this.getProperty("height")},a.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},a.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},a}(p.ManifestResource);d.Resource=r},function(E,d,m){var o,g=this&&this.__extends||(o=function(a,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}o(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=m(1),u=function(a){function i(t,n){var s=a.call(this,t,n)||this;s.index=-1,s.isLoaded=!1;var h={defaultLabel:"-",locale:"en-GB",resource:s,pessimisticAccessControl:!1};return s.options=Object.assign(h,n),s}return g(i,a),i.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?p.LanguageMap.parse(t,this.options.locale):[]},i.prototype.getDescription=function(){var t=this.getProperty("description");return t?p.LanguageMap.parse(t,this.options.locale):[]},i.prototype.getIIIFResourceType=function(){return p.Utils.normaliseType(this.getProperty("type"))},i.prototype.getLogo=function(){var t=this.getProperty("logo");return t?typeof t=="string"?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},i.prototype.getLicense=function(){return p.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},i.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},i.prototype.getRelated=function(){return this.getProperty("related")},i.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},i.prototype.getTrackingLabel=function(){var t=this.getService(r.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},i.prototype.getDefaultTree=function(){return this.defaultTree=new p.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},i.prototype.getRequiredStatement=function(){var t=null,n=this.getProperty("requiredStatement");if(n)(t=new p.LabelValuePair(this.options.locale)).parse(n);else{var s=this.getAttribution();s&&((t=new p.LabelValuePair(this.options.locale)).value=s)}return t},i.prototype.isCollection=function(){return this.getIIIFResourceType()===r.IIIFResourceType.COLLECTION},i.prototype.isManifest=function(){return this.getIIIFResourceType()===r.IIIFResourceType.MANIFEST},i.prototype.load=function(){var t=this;return new Promise(function(n){if(t.isLoaded)n(t);else{var s=t.options;s.navDate=t.getNavDate();var h=t.__jsonld.id;h||(h=t.__jsonld["@id"]),p.Utils.loadManifest(h).then(function(v){t.parentLabel=p.LanguageMap.getValue(t.getLabel(),s.locale);var C=p.Deserialiser.parse(v,s);(t=Object.assign(t,C)).index=s.index,n(t)})}})},i}(p.ManifestResource);d.IIIFResource=u},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(i,t){return u.call(this,i,t)||this}return g(a,u),a.prototype.getBody=function(){var i=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((v=t[n]).items)for(var s=0;s<v.items.length;s++){var h=v.items[s];i.push(new p.AnnotationBody(h,this.options))}else i.push(new p.AnnotationBody(v,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var v=t.items[n];i.push(new p.AnnotationBody(v,this.options))}else i.push(new p.AnnotationBody(t,this.options));return i},a.prototype.getMotivation=function(){return this.getProperty("motivation")||null},a.prototype.getOn=function(){return this.getProperty("on")},a.prototype.getTarget=function(){return this.getProperty("target")},a.prototype.getResource=function(){return new p.Resource(this.getProperty("resource"),this.options)},a}(p.ManifestResource);d.Annotation=r},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(i,t){return u.call(this,i,t)||this}return g(a,u),a.prototype.getFormat=function(){var i=this.getProperty("format");return i?p.Utils.getMediaType(i):null},a.prototype.getType=function(){return this.getProperty("type")?p.Utils.normaliseType(this.getProperty("type")):null},a.prototype.getWidth=function(){return this.getProperty("width")},a.prototype.getHeight=function(){return this.getProperty("height")},a}(p.ManifestResource);d.AnnotationBody=r},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(i,t,n){var s=u.call(this,t)||this;return s.label=i,s.options=n,s}return g(a,u),a.prototype.getIIIFResourceType=function(){return p.Utils.normaliseType(this.getProperty("type"))},a.prototype.getLabel=function(){return this.label},a.prototype.getResources=function(){var i=this;return this.getProperty("resources").map(function(t){return new p.Annotation(t,i.options)})},a.prototype.load=function(){var i=this;return new Promise(function(t,n){if(i.isLoaded)t(i);else{var s=i.__jsonld.id;s||(s=i.__jsonld["@id"]),p.Utils.loadManifest(s).then(function(h){i.__jsonld=h,i.context=i.getProperty("context"),i.id=i.getProperty("id"),i.isLoaded=!0,t(i)}).catch(n)}})},a}(p.JSONLDResource);d.AnnotationList=r},function(E,d,m){var o,g=this&&this.__extends||(o=function(r,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var t in i)i.hasOwnProperty(t)&&(a[t]=i[t])})(r,u)},function(r,u){function a(){this.constructor=r}o(r,u),r.prototype=u===null?Object.create(u):(a.prototype=u.prototype,new a)});Object.defineProperty(d,"__esModule",{value:!0});var p=function(r){function u(a,i){return r.call(this,a,i)||this}return g(u,r),u.prototype.getItems=function(){return this.getProperty("items")},u}(m(0).ManifestResource);d.AnnotationPage=p},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(i,t){return u.call(this,i,t)||this}return g(a,u),a.prototype.getCanonicalImageUri=function(i){var t,n=null,s="default",h=i;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],h||(h=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(s="native");else{var v=this.getImages();if(v&&v.length){var C=v[0].getResource(),S=C.getServices();if(h||(h=C.getWidth()),S.length){var w=S[0];n=w.id,s=p.Utils.getImageQuality(w.getProfile())}else if(h===C.getWidth())return C.id}if(!n){var L=this.getProperty("thumbnail");if(L){if(typeof L=="string")return L;if(L["@id"])return L["@id"];if(L.length)return L[0].id}}}return t=h+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,s+".jpg"].join("/")},a.prototype.getMaxDimensions=function(){var i,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(i=this.externalResource.data.profile,Array.isArray(i)&&(i=i.filter(function(n){return n.maxWidth})[0])&&(t=new p.Size(i.maxWidth,i.maxHeight?i.maxHeight:i.maxWidth))),t},a.prototype.getContent=function(){var i=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return i;var n=null;if(t.length&&(n=new p.AnnotationPage(t[0],this.options)),!n)return i;for(var s=n.getItems(),h=0;h<s.length;h++){var v=s[h],C=new p.Annotation(v,this.options);i.push(C)}return i},a.prototype.getDuration=function(){return this.getProperty("duration")},a.prototype.getImages=function(){var i=[];if(!this.__jsonld.images)return i;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],s=new p.Annotation(n,this.options);i.push(s)}return i},a.prototype.getIndex=function(){return this.getProperty("index")},a.prototype.getOtherContent=function(){var i=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(n){return n&&typeof(s=n["@type"])=="string"&&s.toLowerCase()==s.toLowerCase();var s}).map(function(n,s){return new p.AnnotationList(n.label||"Annotation list "+s,n,i.options)}).map(function(n){return n.load()});return Promise.all(t)},a.prototype.getWidth=function(){return this.getProperty("width")},a.prototype.getHeight=function(){return this.getProperty("height")},a}(p.Resource);d.Canvas=r},function(E,d,m){var o,g=this&&this.__extends||(o=function(a,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}o(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(1),r=m(0),u=function(a){function i(t,n){var s=a.call(this,t,n)||this;return s.items=[],s._collections=null,s._manifests=null,t.__collection=s,s}return g(i,a),i.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(t){return t.isCollection()})},i.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(t){return t.isManifest()})},i.prototype.getCollectionByIndex=function(t){for(var n,s=this.getCollections(),h=0;h<s.length;h++){var v=s[h];v.index===t&&(n=v)}if(n)return n.options.index=t,n.load();throw new Error("Collection index not found")},i.prototype.getManifestByIndex=function(t){for(var n,s=this.getManifests(),h=0;h<s.length;h++){var v=s[h];v.index===t&&(n=v)}if(n)return n.options.index=t,n.load();throw new Error("Manifest index not found")},i.prototype.getTotalCollections=function(){return this.getCollections().length},i.prototype.getTotalManifests=function(){return this.getManifests().length},i.prototype.getTotalItems=function(){return this.items.length},i.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):p.ViewingDirection.LEFT_TO_RIGHT},i.prototype.getDefaultTree=function(){return a.prototype.getDefaultTree.call(this),this.defaultTree.data.type=r.Utils.normaliseType(r.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),r.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},i.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var n=0;n<t.getManifests().length;n++){var s=t.getManifests()[n],h=s.getDefaultTree();h.label=s.parentLabel||r.LanguageMap.getValue(s.getLabel(),this.options.locale)||"manifest "+(n+1),h.navDate=s.getNavDate(),h.data.id=s.id,h.data.type=r.Utils.normaliseType(r.TreeNodeType.MANIFEST),t.defaultTree.addNode(h)}},i.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var n=0;n<t.getCollections().length;n++){var s=t.getCollections()[n],h=s.getDefaultTree();h.label=s.parentLabel||r.LanguageMap.getValue(s.getLabel(),this.options.locale)||"collection "+(n+1),h.navDate=s.getNavDate(),h.data.id=s.id,h.data.type=r.Utils.normaliseType(r.TreeNodeType.COLLECTION),t.defaultTree.addNode(h)}},i}(r.IIIFResource);d.Collection=u},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0});var o=function(){function g(p,r){this.start=p,this.end=r}return g.prototype.getLength=function(){return this.end-this.start},g}();d.Duration=o},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0});var o=m(0),g=function(){function p(r){this.defaultLocale=r}return p.prototype.parse=function(r){this.resource=r,this.label=o.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=o.LanguageMap.parse(this.resource.value,this.defaultLocale)},p.prototype.getLabel=function(){return this.label?o.LanguageMap.getValue(this.label,this.defaultLocale):null},p.prototype.setLabel=function(r){var u=this;if(this.label&&this.label.length){var a=this.label.filter(function(i){return i.locale===u.defaultLocale||i.locale===o.Utils.getInexactLocale(u.defaultLocale)})[0];a&&(a.value=r)}},p.prototype.getValue=function(){if(this.value){var r=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(r=this.label[0].locale),o.LanguageMap.getValue(this.value,r)}return null},p.prototype.setValue=function(r){var u=this;if(this.value&&this.value.length){var a=this.value.filter(function(i){return i.locale===u.defaultLocale||i.locale===o.Utils.getInexactLocale(u.defaultLocale)})[0];a&&(a.value=r)}},p}();d.LabelValuePair=g},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),d.Language=function(o,g){Array.isArray(o)?o.length===1?this.value=o[0]:this.value=o.join("<br/>"):this.value=o,this.locale=g}},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(){return u!==null&&u.apply(this,arguments)||this}return g(a,u),a.parse=function(i,t){var n,s=[];if(!i)return s;if(Array.isArray(i))for(var h=0;h<i.length;h++){var v=i[h];n=typeof v=="string"?new p.Language(v,t):new p.Language(v["@value"],v["@language"]||t),s.push(n)}else{if(typeof i=="string")return n=new p.Language(i,t),s.push(n),s;i["@value"]?(n=new p.Language(i["@value"],i["@language"]||t),s.push(n)):Object.keys(i).forEach(function(C){if(!i[C].length)throw new Error("language must have a value");n=new p.Language(i[C],C),s.push(n)})}return s},a.getValue=function(i,t){if(i.length){if(t){var n=i.filter(function(s){return s.locale===t||p.Utils.getInexactLocale(s.locale)===p.Utils.getInexactLocale(t)})[0];if(n)return n.value}return i[0].value}return null},a}(Array);d.LanguageMap=r},function(E,d,m){var o,g=this&&this.__extends||(o=function(a,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}o(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(1),r=m(0),u=function(a){function i(t,n){var s=a.call(this,t,n)||this;if(s.index=0,s._allRanges=null,s.items=[],s._topRanges=[],s.__jsonld.structures&&s.__jsonld.structures.length)for(var h=s._getTopRanges(),v=0;v<h.length;v++){var C=h[v];s._parseRanges(C,String(v))}return s}return g(i,a),i.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new r.Canvas(t,this.options)),t},i.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},i.prototype.getDefaultTree=function(){if(a.prototype.getDefaultTree.call(this),this.defaultTree.data.type=r.Utils.normaliseType(r.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),r.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},i.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var s=this.__jsonld.structures[n];s.viewingHint===p.ViewingHint.TOP&&t.push(s)}if(!t.length){var h={};h.ranges=this.__jsonld.structures,t.push(h)}}return t},i.prototype.getTopRanges=function(){return this._topRanges},i.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var s=this.__jsonld.structures[n];if(s["@id"]===t||s.id===t)return s}return null},i.prototype._parseRanges=function(t,n,s){var h,v=null;if(typeof t=="string"&&(v=t,t=this._getRangeById(v)),t){(h=new r.Range(t,this.options)).parentRange=s,h.path=n,s?s.items.push(h):this._topRanges.push(h);var C=t.items||t.members;if(C)for(var S=0;S<C.length;S++){var w=C[S];if(w["@type"]&&w["@type"].toLowerCase()==="sc:range"||w.type&&w.type.toLowerCase()==="range")this._parseRanges(w,n+"/"+S,h);else if(w["@type"]&&w["@type"].toLowerCase()==="sc:canvas"||w.type&&w.type.toLowerCase()==="canvas"){h.canvases||(h.canvases=[]);var L=w.id||w["@id"];h.canvases.push(L)}}else if(t.ranges)for(S=0;S<t.ranges.length;S++)this._parseRanges(t.ranges[S],n+"/"+S,h)}else console.warn("Range:",v,"does not exist")},i.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),n=function(v){var C=t[v];C.id&&s._allRanges.push(C);var S=function(L,x){L.add(x);var y=x.getRanges();return y.length?y.reduce(S,L):L},w=Array.from(C.getRanges().reduce(S,new Set));s._allRanges=s._allRanges.concat(w)},s=this,h=0;h<t.length;h++)n(h);return this._allRanges},i.prototype.getRangeById=function(t){for(var n=this.getAllRanges(),s=0;s<n.length;s++){var h=n[s];if(h.id===t)return h}return null},i.prototype.getRangeByPath=function(t){for(var n=this.getAllRanges(),s=0;s<n.length;s++){var h=n[s];if(h.path===t)return h}return null},i.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var n=0;n<t.length;n++){var s=t[n],h=new r.Sequence(s,this.options);this.items.push(h)}else this.__jsonld.items&&(h=new r.Sequence(this.__jsonld.items,this.options),this.items.push(h));return this.items},i.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},i.prototype.getTotalSequences=function(){return this.getSequences().length},i.prototype.getManifestType=function(){var t=this.getService(p.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):r.ManifestType.EMPTY},i.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},i.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===p.ViewingHint.PAGED;var n=this.getBehavior();return!!n&&n===p.Behavior.PAGED},i.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},i.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},i}(r.IIIFResource);d.Manifest=u},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),function(o){o.EMPTY="",o.MANUSCRIPT="manuscript",o.MONOGRAPH="monograph"}(d.ManifestType||(d.ManifestType={}))},function(E,d,m){var o,g=this&&this.__extends||(o=function(a,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}o(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=m(1),u=function(a){function i(t,n){var s=a.call(this,t,n)||this;return s._ranges=null,s.canvases=null,s.items=[],s}return g(i,a),i.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},i.prototype.getDuration=function(){var t,n;if(this.canvases&&this.canvases.length)for(var s=0;s<this.canvases.length;s++){var h=this.canvases[s],v=p.Utils.getTemporalComponent(h);v&&v.length>1&&(s===0&&(t=Number(v[0])),s===this.canvases.length-1&&(n=Number(v[1])))}else{var C=this.getRanges();for(s=0;s<C.length;s++){var S=C[s].getDuration();S&&(s===0&&(t=S.start),s===C.length-1&&(n=S.end))}}if(t!==void 0&&n!==void 0)return new p.Duration(t,n)},i.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(t){return t.isRange()})},i.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},i.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},i.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},i.prototype.getTree=function(t){t.data=this,this.treeNode=t;var n=this.getRanges();if(n&&n.length)for(var s=0;s<n.length;s++){var h=n[s],v=new p.TreeNode;t.addNode(v),this._parseTreeNode(v,h)}return p.Utils.generateTreeNodeIds(t),t},i.prototype.spansTime=function(t){var n=this.getDuration();return!!(n&&t>=n.start&&t<=n.end)},i.prototype._parseTreeNode=function(t,n){t.label=p.LanguageMap.getValue(n.getLabel(),this.options.locale),t.data=n,t.data.type=p.Utils.normaliseType(p.TreeNodeType.RANGE),n.treeNode=t;var s=n.getRanges();if(s&&s.length)for(var h=0;h<s.length;h++){var v=s[h];if(v.getBehavior()!==r.Behavior.NO_NAV){var C=new p.TreeNode;t.addNode(C),this._parseTreeNode(C,v)}}},i}(p.ManifestResource);d.Range=u},function(E,d,m){var o,g=this&&this.__extends||(o=function(r,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var t in i)i.hasOwnProperty(t)&&(a[t]=i[t])})(r,u)},function(r,u){function a(){this.constructor=r}o(r,u),r.prototype=u===null?Object.create(u):(a.prototype=u.prototype,new a)});Object.defineProperty(d,"__esModule",{value:!0});var p=function(r){function u(a,i){return r.call(this,a,i)||this}return g(u,r),u.prototype.getFormat=function(){return this.getProperty("format")},u}(m(0).ManifestResource);d.Rendering=p},function(E,d,m){var o,g=this&&this.__extends||(o=function(a,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])})(a,i)},function(a,i){function t(){this.constructor=a}o(a,i),a.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(1),r=m(0),u=function(a){function i(t,n){var s=a.call(this,t,n)||this;return s.items=[],s._thumbnails=null,s}return g(i,a),i.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var n=0;n<t.length;n++){var s=t[n];(h=new r.Canvas(s,this.options)).index=n,this.items.push(h)}else if(this.__jsonld)for(n=0;n<this.__jsonld.length;n++){var h;s=this.__jsonld[n],(h=new r.Canvas(s,this.options)).index=n,this.items.push(h)}return this.items},i.prototype.getCanvasById=function(t){for(var n=0;n<this.getTotalCanvases();n++){var s=this.getCanvasByIndex(n),h=r.Utils.normaliseUrl(s.id);if(r.Utils.normaliseUrl(t)===h)return s}return null},i.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},i.prototype.getCanvasIndexById=function(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n;return null},i.prototype.getCanvasIndexByLabel=function(t,n){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),n&&(t+="r"));for(var s,h,v,C=/(\d*)\D+(\d*)/,S=0;S<this.getTotalCanvases();S++){var w=this.getCanvasByIndex(S);if(r.LanguageMap.getValue(w.getLabel(),this.options.locale)===t||(s=C.exec(t))&&(h=s[1],(v=s[2])&&new RegExp("^"+h+"\\D+"+v+"$").test(w.getLabel().toString())))return S}return-1},i.prototype.getLastCanvasLabel=function(t){for(var n=this.getTotalCanvases()-1;n>=0;n--){var s=this.getCanvasByIndex(n),h=r.LanguageMap.getValue(s.getLabel(),this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(h))return h}else if(h)return h}return this.options.defaultLabel},i.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},i.prototype.getNextPageIndex=function(t,n){var s;if(n){var h=this.getPagedIndices(t),v=this.getViewingDirection();s=v&&v===p.ViewingDirection.RIGHT_TO_LEFT?h[0]+1:h[h.length-1]+1}else s=t+1;return s>this.getLastPageIndex()?-1:s},i.prototype.getPagedIndices=function(t,n){var s=[];if(n){s=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var h=this.getViewingDirection();h&&h===p.ViewingDirection.RIGHT_TO_LEFT&&(s=s.reverse())}else s.push(t);return s},i.prototype.getPrevPageIndex=function(t,n){var s;if(n){var h=this.getPagedIndices(t),v=this.getViewingDirection();s=v&&v===p.ViewingDirection.RIGHT_TO_LEFT?h[h.length-1]-1:h[0]-1}else s=t-1;return s},i.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n}return 0},i.prototype.getThumbs=function(t,n){for(var s=[],h=this.getTotalCanvases(),v=0;v<h;v++){var C=this.getCanvasByIndex(v),S=new r.Thumb(t,C);s.push(S)}return s},i.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),n=0;n<t.length;n++){var s=t[n].getThumbnail();s&&this._thumbnails.push(s)}return this._thumbnails},i.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},i.prototype.getTotalCanvases=function(){return this.getCanvases().length},i.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},i.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},i.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},i.prototype.isFirstCanvas=function(t){return t===0},i.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},i.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},i.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===p.ViewingHint.PAGED},i.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},i}(r.ManifestResource);d.Sequence=u},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0});var o=m(0),g=function(){function p(){}return p.parse=function(r,u){return typeof r=="string"&&(r=JSON.parse(r)),this.parseJson(r,u)},p.parseJson=function(r,u){var a;if(u&&u.navDate&&!isNaN(u.navDate.getTime())&&(r.navDate=u.navDate.toString()),r["@type"])switch(r["@type"]){case"sc:Collection":a=this.parseCollection(r,u);break;case"sc:Manifest":a=this.parseManifest(r,u);break;default:return null}else switch(r.type){case"Collection":a=this.parseCollection(r,u);break;case"Manifest":a=this.parseManifest(r,u);break;default:return null}return a.isLoaded=!0,a},p.parseCollection=function(r,u){var a=new o.Collection(r,u);return u?(a.index=u.index||0,u.resource&&(a.parentCollection=u.resource.parentCollection)):a.index=0,this.parseCollections(a,u),this.parseManifests(a,u),this.parseItems(a,u),a},p.parseCollections=function(r,u){var a;if(r.__jsonld.collections?a=r.__jsonld.collections:r.__jsonld.items&&(a=r.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="collection"})),a)for(var i=0;i<a.length;i++){u&&(u.index=i);var t=this.parseCollection(a[i],u);t.index=i,t.parentCollection=r,r.items.push(t)}},p.parseManifest=function(r,u){return new o.Manifest(r,u)},p.parseManifests=function(r,u){var a;if(r.__jsonld.manifests?a=r.__jsonld.manifests:r.__jsonld.items&&(a=r.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="manifest"})),a)for(var i=0;i<a.length;i++){var t=this.parseManifest(a[i],u);t.index=i,t.parentCollection=r,r.items.push(t)}},p.parseItem=function(r,u){if(r["@type"]){if(r["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(r,u);if(r["@type"].toLowerCase()==="sc:collection")return this.parseCollection(r,u)}else if(r.type){if(r.type.toLowerCase()==="manifest")return this.parseManifest(r,u);if(r.type.toLowerCase()==="collection")return this.parseCollection(r,u)}return null},p.parseItems=function(r,u){var a=r.__jsonld.members||r.__jsonld.items;if(a)for(var i=function(h){u&&(u.index=h);var v=t.parseItem(a[h],u);return v?r.items.filter(function(C){return C.id===v.id})[0]?"continue":(v.index=h,v.parentCollection=r,void r.items.push(v)):{value:void 0}},t=this,n=0;n<a.length;n++){var s=i(n);if(typeof s=="object")return s.value}},p}();d.Deserialiser=g},function(E,d,m){var o,g=this&&this.__extends||(o=function(u,a){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})(u,a)},function(u,a){function i(){this.constructor=u}o(u,a),u.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var p=m(0),r=function(u){function a(i,t){return u.call(this,i,t)||this}return g(a,u),a.prototype.getProfile=function(){var i=this.getProperty("profile");return i||(i=this.getProperty("dcterms:conformsTo")),Array.isArray(i)?i[0]:i},a.prototype.getConfirmLabel=function(){return p.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},a.prototype.getDescription=function(){return p.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},a.prototype.getFailureDescription=function(){return p.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},a.prototype.getFailureHeader=function(){return p.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},a.prototype.getHeader=function(){return p.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},a.prototype.getServiceLabel=function(){return p.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},a.prototype.getInfoUri=function(){var i=this.id;return i.endsWith("/")||(i+="/"),i+"info.json"},a}(p.ManifestResource);d.Service=r},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),d.Size=function(o,g){this.width=o,this.height=g}},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),function(o){o[o.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",o[o.FORBIDDEN=2]="FORBIDDEN",o[o.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",o[o.RESTRICTED=4]="RESTRICTED"}(d.StatusCode||(d.StatusCode={}))},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0});var o=m(0);d.Thumb=function(g,p){this.data=p,this.index=p.index,this.width=g;var r=p.getHeight()/p.getWidth();this.height=r?Math.floor(this.width*r):g,this.uri=p.getCanonicalImageUri(g),this.label=o.LanguageMap.getValue(p.getLabel())}},function(E,d,m){var o,g=this&&this.__extends||(o=function(r,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var t in i)i.hasOwnProperty(t)&&(a[t]=i[t])})(r,u)},function(r,u){function a(){this.constructor=r}o(r,u),r.prototype=u===null?Object.create(u):(a.prototype=u.prototype,new a)});Object.defineProperty(d,"__esModule",{value:!0});var p=function(r){function u(a,i){return r.call(this,a,i)||this}return g(u,r),u}(m(0).Resource);d.Thumbnail=p},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0});var o=m(0),g=function(){function p(r,u){this.label=r,this.data=u||{},this.nodes=[]}return p.prototype.addNode=function(r){this.nodes.push(r),r.parentNode=this},p.prototype.isCollection=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.COLLECTION)},p.prototype.isManifest=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.MANIFEST)},p.prototype.isRange=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.RANGE)},p}();d.TreeNode=g},function(E,d,m){Object.defineProperty(d,"__esModule",{value:!0}),function(o){o.COLLECTION="collection",o.MANIFEST="manifest",o.RANGE="range"}(d.TreeNodeType||(d.TreeNodeType={}))},function(E,d,m){E.exports=function(o){var g={};function p(r){if(g[r])return g[r].exports;var u=g[r]={i:r,l:!1,exports:{}};return o[r].call(u.exports,u,u.exports,p),u.l=!0,u.exports}return p.m=o,p.c=g,p.d=function(r,u,a){p.o(r,u)||Object.defineProperty(r,u,{enumerable:!0,get:a})},p.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},p.t=function(r,u){if(1&u&&(r=p(r)),8&u||4&u&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(p.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&u&&typeof r!="string")for(var i in r)p.d(a,i,function(t){return r[t]}.bind(null,i));return a},p.n=function(r){var u=r&&r.__esModule?function(){return r.default}:function(){return r};return p.d(u,"a",u),u},p.o=function(r,u){return Object.prototype.hasOwnProperty.call(r,u)},p.p="",p(p.s=0)}([function(o,g,p){o.exports=p(1)},function(o,g,p){Object.defineProperty(g,"__esModule",{value:!0}),g.CONTINUE=100,g.SWITCHING_PROTOCOLS=101,g.PROCESSING=102,g.OK=200,g.CREATED=201,g.ACCEPTED=202,g.NON_AUTHORITATIVE_INFORMATION=203,g.NO_CONTENT=204,g.RESET_CONTENT=205,g.PARTIAL_CONTENT=206,g.MULTI_STATUS=207,g.MULTIPLE_CHOICES=300,g.MOVED_PERMANENTLY=301,g.MOVED_TEMPORARILY=302,g.SEE_OTHER=303,g.NOT_MODIFIED=304,g.USE_PROXY=305,g.TEMPORARY_REDIRECT=307,g.BAD_REQUEST=400,g.UNAUTHORIZED=401,g.PAYMENT_REQUIRED=402,g.FORBIDDEN=403,g.NOT_FOUND=404,g.METHOD_NOT_ALLOWED=405,g.NOT_ACCEPTABLE=406,g.PROXY_AUTHENTICATION_REQUIRED=407,g.REQUEST_TIME_OUT=408,g.CONFLICT=409,g.GONE=410,g.LENGTH_REQUIRED=411,g.PRECONDITION_FAILED=412,g.REQUEST_ENTITY_TOO_LARGE=413,g.REQUEST_URI_TOO_LARGE=414,g.UNSUPPORTED_MEDIA_TYPE=415,g.REQUESTED_RANGE_NOT_SATISFIABLE=416,g.EXPECTATION_FAILED=417,g.IM_A_TEAPOT=418,g.UNPROCESSABLE_ENTITY=422,g.LOCKED=423,g.FAILED_DEPENDENCY=424,g.UNORDERED_COLLECTION=425,g.UPGRADE_REQUIRED=426,g.PRECONDITION_REQUIRED=428,g.TOO_MANY_REQUESTS=429,g.REQUEST_HEADER_FIELDS_TOO_LARGE=431,g.INTERNAL_SERVER_ERROR=500,g.NOT_IMPLEMENTED=501,g.BAD_GATEWAY=502,g.SERVICE_UNAVAILABLE=503,g.GATEWAY_TIME_OUT=504,g.HTTP_VERSION_NOT_SUPPORTED=505,g.VARIANT_ALSO_NEGOTIATES=506,g.INSUFFICIENT_STORAGE=507,g.BANDWIDTH_LIMIT_EXCEEDED=509,g.NOT_EXTENDED=510,g.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(E,d,m){E.exports=window.fetch||(window.fetch=m(3).default||m(3))}])},function(f,_,I){I.r(_),I.d(_,"BaseComponent",function(){return E});var E=function(){function d(m){this.options=m,this.options.data=Object.assign({},this.data(),m.data)}return d.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},d.prototype.data=function(){return{}},d.prototype.on=function(m,o,g){var p=this._e||(this._e={});(p[m]||(p[m]=[])).push({fn:o,ctx:g})},d.prototype.fire=function(m){for(var o=[],g=1;g<arguments.length;g++)o[g-1]=arguments[g];for(var p=[].slice.call(arguments,1),r=((this._e||(this._e={}))[m]||[]).slice(),u=0,a=r.length;u<a;u++)r[u].fn.apply(r[u].ctx,p)},d.prototype._resize=function(){},d.prototype.set=function(m){},d}()},function(f,_,I){I.r(_),I.d(_,"Async",function(){return d}),I.d(_,"Bools",function(){return m}),I.d(_,"Clipboard",function(){return o}),I.d(_,"Colors",function(){return g}),I.d(_,"Dates",function(){return p}),I.d(_,"Device",function(){return r}),I.d(_,"Documents",function(){return u}),I.d(_,"Events",function(){return a}),I.d(_,"Files",function(){return i}),I.d(_,"Keyboard",function(){return t}),I.d(_,"Maths",function(){return n}),I.d(_,"Size",function(){return s}),I.d(_,"Dimensions",function(){return h}),I.d(_,"Numbers",function(){return v}),I.d(_,"Objects",function(){return C}),I.d(_,"Storage",function(){return S}),I.d(_,"StorageItem",function(){return w}),I.d(_,"StorageType",function(){return E}),I.d(_,"Strings",function(){return L}),I.d(_,"Urls",function(){return x});var E,d=function(){function y(){}return y.waitFor=function(c,b,O,A,R,N){A||(A=200),R||(R=100),N||(N=0),(N+=1)>R?O&&O():c()?b():setTimeout(function(){y.waitFor(c,b,O,A,R,N)},A)},y}(),m=function(){function y(){}return y.getBool=function(c,b){return c!=null?c:b},y}(),o=function(){function y(){}return y.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},y.copy=function(c){c=y.convertBrToNewLine(c);var b=document.createElement("textarea");b.value=c,y.hideButKeepEnabled(b),document.body.appendChild(b),b.focus(),b.select(),document.execCommand("copy"),document.body.removeChild(b)},y.hideButKeepEnabled=function(c){c.style.position="fixed",c.style.top="0",c.style.left="0",c.style.width="2em",c.style.height="2em",c.style.padding="0",c.style.border="none",c.style.outline="none",c.style.boxShadow="none",c.style.background="transparent"},y.convertBrToNewLine=function(c){return c=c.replace(/<br\s*[\/]?>/gi,`
`)},y}(),g=function(){function y(){}return y.float32ColorToARGB=function(c){return[(4278190080&c)>>>24,(16711680&c)>>>16,(65280&c)>>>8,255&c]},y._componentToHex=function(c){var b=c.toString(16);return b.length==1?"0"+b:b},y.rgbToHexString=function(c){return y.coalesce(c),"#"+y._componentToHex(c[0])+y._componentToHex(c[1])+y._componentToHex(c[2])},y.argbToHexString=function(c){return"#"+y._componentToHex(c[0])+y._componentToHex(c[1])+y._componentToHex(c[2])+y._componentToHex(c[3])},y.coalesce=function(c){for(var b=1;b<c.length;b++)c[b]===void 0&&(c[b]=c[b-1])},y}(),p=function(){function y(){}return y.getTimeStamp=function(){return new Date().getTime()},y}(),r=function(){function y(){}return y.getPixelRatio=function(c){return(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1)},y.isTouch=function(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints>0},y}(),u=function(){function y(){}return y.isInIFrame=function(){try{return window.self!==window.top}catch{return!0}},y.supportsFullscreen=function(){var c=document.documentElement;return(c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen||c.msRequestFullscreen)!==void 0},y.isHidden=function(){return!!y.getHiddenProp()},y.getHiddenProp=function(){var c=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<c.length;b++)if(c[b]+"Hidden"in document)return c[b]+"Hidden";return null},y}(),a=function(){function y(){}return y.debounce=function(c,b){return b=b||100,function(){if(!c.debouncing){var O=Array.prototype.slice.apply(arguments);c.lastReturnVal=c.apply(window,O),c.debouncing=!0}return clearTimeout(c.debounceTimeout),c.debounceTimeout=setTimeout(function(){c.debouncing=!1},b),c.lastReturnVal}},y}(),i=function(){function y(){}return y.simplifyMimeType=function(c){switch(c){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var b=c.split("/");return b[b.length-1]}},y}(),t=function(){function y(){}return y.getCharCode=function(c){return typeof c.which=="number"?c.which:c.keyCode},y}(),n=function(){function y(){}return y.normalise=function(c,b,O){return(c-b)/(O-b)},y.median=function(c){c.sort(function(O,A){return O-A});var b=Math.floor(c.length/2);return c.length%2?c[b]:(c[b-1]+c[b])/2},y.clamp=function(c,b,O){return Math.min(Math.max(c,b),O)},y}(),s=function(y,c){this.width=y,this.height=c},h=function(){function y(){}return y.fitRect=function(c,b,O,A){var R,N=0,le=0;return b/c<A/O?(N=c*(R=O/c),le=b*R):(N=c*(R=A/b),le=b*R),new s(Math.floor(N),Math.floor(le))},y.hitRect=function(c,b,O,A,R,N){return R>c&&R<c+O&&N>b&&N<b+A},y}(),v=function(){function y(){}return y.numericalInput=function(c){return c.keyCode==46||c.keyCode==8||c.keyCode==9||c.keyCode==27||c.keyCode==65&&c.ctrlKey===!0||c.keyCode>=35&&c.keyCode<=39||!(c.shiftKey||(c.keyCode<48||c.keyCode>57)&&(c.keyCode<96||c.keyCode>105))||(c.preventDefault(),!1)},y}(),C=function(){function y(){}return y.toPlainObject=function(c){c=Object(c);var b={};for(var O in c)b[O]=c[O];return b},y}(),S=function(){function y(){}return y.clear=function(c){switch(c===void 0&&(c=E.MEMORY),c){case E.MEMORY:this._memoryStorage={};break;case E.SESSION:sessionStorage.clear();break;case E.LOCAL:localStorage.clear()}},y.clearExpired=function(c){c===void 0&&(c=E.MEMORY);for(var b=this.getItems(c),O=0;O<b.length;O++){var A=b[O];this._isExpired(A)&&this.remove(A.key)}},y.get=function(c,b){b===void 0&&(b=E.MEMORY);var O=null;switch(b){case E.MEMORY:O=this._memoryStorage[c];break;case E.SESSION:O=sessionStorage.getItem(c);break;case E.LOCAL:O=localStorage.getItem(c)}if(!O)return null;var A=null;try{A=JSON.parse(O)}catch{return null}return A?this._isExpired(A)?null:(A.key=c,A):null},y._isExpired=function(c){return!(new Date().getTime()<c.expiresAt)},y.getItems=function(c){c===void 0&&(c=E.MEMORY);var b=[];switch(c){case E.MEMORY:for(var O=Object.keys(this._memoryStorage),A=0;A<O.length;A++)(N=this.get(O[A],E.MEMORY))&&b.push(N);break;case E.SESSION:for(A=0;A<sessionStorage.length;A++)(R=sessionStorage.key(A))&&(N=this.get(R,E.SESSION))&&b.push(N);break;case E.LOCAL:for(A=0;A<localStorage.length;A++){var R,N;(R=localStorage.key(A))&&(N=this.get(R,E.LOCAL))&&b.push(N)}}return b},y.remove=function(c,b){switch(b===void 0&&(b=E.MEMORY),b){case E.MEMORY:delete this._memoryStorage[c];break;case E.SESSION:sessionStorage.removeItem(c);break;case E.LOCAL:localStorage.removeItem(c)}},y.set=function(c,b,O,A){A===void 0&&(A=E.MEMORY);var R=1e3*O,N=new w;switch(N.value=b,N.expiresAt=new Date().getTime()+R,A){case E.MEMORY:this._memoryStorage[c]=JSON.stringify(N);break;case E.SESSION:sessionStorage.setItem(c,JSON.stringify(N));break;case E.LOCAL:localStorage.setItem(c,JSON.stringify(N))}return N},y._memoryStorage={},y}(),w=function(){};(function(y){y.MEMORY="memory",y.SESSION="session",y.LOCAL="local"})(E||(E={}));var L=function(){function y(){}return y.ellipsis=function(c,b){if(c.length<=b)return c;var O=c.substr(0,b),A=O.lastIndexOf(" ");return A!=-1&&(O=O.substr(0,Math.min(O.length,A))),O+"&hellip;"},y.htmlDecode=function(c){var b=document.createElement("div");return b.innerHTML=c,b.firstChild.nodeValue},y.format=function(c){for(var b=[],O=1;O<arguments.length;O++)b[O-1]=arguments[O];for(var A=0;A<b.length;A++){var R=new RegExp("\\{"+A+"\\}","gm");c=c.replace(R,b[A])}return c},y.isAlphanumeric=function(c){return/^[a-zA-Z0-9]*$/.test(c)},y.toCssClass=function(c){return c.replace(/[^a-z0-9]/g,function(b){var O=b.charCodeAt(0);return O==32?"-":O>=65&&O<=90?"_"+b.toLowerCase():"__"+("000"+O.toString(16)).slice(-4)})},y.toFileName=function(c){return c.replace(/[^a-z0-9]/gi,"_").toLowerCase()},y.utf8_to_b64=function(c){return window.btoa(unescape(encodeURIComponent(c)))},y}(),x=function(){function y(){}return y.getHashParameter=function(c,b){return b||(b=window.document),b&&b.location?this.getHashParameterFromString(c,b.location.hash):null},y.getHashParameterFromString=function(c,b){var O=new RegExp("#.*[?&]"+c+"=([^&]+)(&|$)").exec(b);return O?decodeURIComponent(O[1].replace(/\+/g," ")):null},y.setHashParameter=function(c,b,O){if(O||(O=window.document),O&&O.location){var A="#?"+this.updateURIKeyValuePair(O.location.hash.replace("#?",""),c,b),R=O.URL;R.indexOf("#")!=-1&&(R=R.substr(0,R.indexOf("#"))),O.location.replace(R+A)}},y.getQuerystringParameter=function(c,b){return b||(b=window),this.getQuerystringParameterFromString(c,b.location.search)},y.getQuerystringParameterFromString=function(c,b){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var O=new RegExp("[\\?&]"+c+"=([^&#]*)").exec(b);return O?decodeURIComponent(O[1].replace(/\+/g," ")):null},y.setQuerystringParameter=function(c,b,O){if(O||(O=window.document),O&&O.location){var A=this.updateURIKeyValuePair(O.location.hash.replace("#?",""),c,b);window.location.search=A}},y.updateURIKeyValuePair=function(c,b,O){b=encodeURIComponent(b),O=encodeURIComponent(O);var A=c.split("&");A[0]==""&&A.shift();for(var R,N=A.length;N--;)if((R=A[N].split("="))[0]==b){R[1]=O,A[N]=R.join("=");break}return N<0&&(A[A.length]=[b,O].join("=")),A.join("&")},y.getUrlParts=function(c){var b=document.createElement("a");return b.href=c,b},y.convertToRelativeUrl=function(c){var b=this.getUrlParts(c),O=b.pathname+b.searchWithin;return O.startsWith("/")||(O="/"+O),O},y}()}])})}),Ie=class{constructor(e,l){this.informationType=e,this.param=l}},te;(function(e){e[e.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",e[e.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"})(te||(te={}));var Te=class{};Te.FORBIDDEN="forbiddenResourceMessage";var se=ie(be()),J=ie(ye()),Me=k(),B=class{static loadExternalResources(e,l){return new Promise(f=>{se.Utils.loadExternalResourcesAuth09(e,l,B.clickThrough,B.restricted,B.login,B.getAccessToken,B.storeAccessToken,B.getStoredAccessToken,B.handleExternalResourceResponse).then(_=>{f(_)}).catch(_=>{switch(_.name){case se.StatusCode.AUTHORIZATION_FAILED.toString():B.publish(T.LOGIN_FAILED);break;case se.StatusCode.FORBIDDEN.toString():B.publish(T.FORBIDDEN);break;case se.StatusCode.RESTRICTED.toString():break;default:B.publish(T.SHOW_MESSAGE,[_.message||_])}})})}static clickThrough(e){return new Promise(l=>{B.publish(T.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:e,acceptCallback:()=>{if(e.clickThroughService){let f=window.open(e.clickThroughService.id),_=window.setInterval(()=>{f&&f.closed&&(window.clearInterval(_),B.publish(T.CLICKTHROUGH),l())},500)}}}])})}static restricted(e){return new Promise((l,f)=>{B.publish(T.SHOW_RESTRICTED_DIALOGUE,[{resource:e,acceptCallback:()=>{B.publish(D.LOAD_FAILED),f(e)}}])})}static login(e){return new Promise(l=>{let f={};e.status===J.FORBIDDEN&&(f.warningMessage=Te.FORBIDDEN,f.showCancelButton=!0),B.publish(T.SHOW_LOGIN_DIALOGUE,[{resource:e,loginCallback:()=>{if(e.loginService){let _=window.open(e.loginService.id+"?t="+new Date().getTime()),I=window.setInterval(function(){_&&_.closed&&(window.clearInterval(I),B.publish(T.LOGIN),l())},500)}},logoutCallback:()=>{if(e.logoutService){let _=window.open(e.logoutService.id+"?t="+new Date().getTime()),I=window.setInterval(function(){_&&_.closed&&(window.clearInterval(I),B.publish(T.LOGOUT),l())},500)}},options:f}])})}static getAccessToken(e,l){return new Promise((f,_)=>{if(e.tokenService){let I=e.tokenService.id,E=I+"|"+new Date().getTime(),d=o=>{window.removeEventListener("message",d);let g=o.data;g.error?_(l?g.errorDescription:void 0):f(g)};window.addEventListener("message",d,!1);let m=I+"?messageId="+E;Me("#commsFrame").prop("src",m)}else _("Token service not found")})}static storeAccessToken(e,l,f){return new Promise((_,I)=>{e.tokenService?(W.set(e.tokenService.id,l,l.expiresIn,f),_()):I("Token service not found")})}static getStoredAccessToken(e,l){return new Promise((f,_)=>{let I=[],E=null;if(e.tokenService&&(E=W.get(e.tokenService.id,l)),E)I.push(E);else{let m=q.getUrlParts(e.dataUri).hostname,o=W.getItems(l);for(let g=0;g<o.length;g++)E=o[g],E.key.includes(m)&&I.push(E)}I=I.sort((m,o)=>m.expiresAt-o.expiresAt);let d;I.length&&(d=I[I.length-1].value,f(d))})}static handleExternalResourceResponse(e){return new Promise((l,f)=>{if(e.isResponseHandled=!0,e.status===J.OK)l(e);else if(e.status===J.MOVED_TEMPORARILY)l(e),B.publish(T.RESOURCE_DEGRADED,[e]);else if(e.error.status===J.UNAUTHORIZED||e.error.status===J.INTERNAL_SERVER_ERROR)f(e.error.statusText);else if(e.error.status===J.FORBIDDEN){let _=new Error;_.message="Forbidden",_.name=se.StatusCode.FORBIDDEN.toString(),f(_)}else f(e.error.statusText)})}static handleDegraded(e){let l=new Ie(te.DEGRADED_RESOURCE,e);B.publish(T.SHOW_INFORMATION,[l])}},re=ie(be()),Ne=ie(ye()),De=k(),P=class{static loadExternalResources(e,l,f){return new Promise(_=>{P.storageStrategy=l,e=e.map(I=>(I.authAPIVersion=1,I.options=f,I)),re.Utils.loadExternalResourcesAuth1(e,P.openContentProviderInteraction,P.openTokenService,P.getStoredAccessToken,P.userInteractedWithContentProvider,P.getContentProviderInteraction,P.handleMovedTemporarily,P.showOutOfOptionsMessages).then(I=>{_(I)}).catch(I=>{switch(I.name){case re.StatusCode.AUTHORIZATION_FAILED.toString():P.publish(T.LOGIN_FAILED);break;case re.StatusCode.FORBIDDEN.toString():P.publish(T.FORBIDDEN);break;case re.StatusCode.RESTRICTED.toString():break;default:P.publish(T.SHOW_MESSAGE,[I.message||I])}})})}static getCookieServiceUrl(e){return e.id+"?origin="+P.getOrigin()}static openContentProviderInteraction(e){let l=P.getCookieServiceUrl(e);return window.open(l)}static getOrigin(e){let l=window.location;return e&&(l=document.createElement("a"),l.href=e),l.protocol+"//"+l.hostname+(l.port?":"+l.port:"")}static userInteractedWithContentProvider(e){return new Promise(l=>{let f=window.setInterval(()=>{e.closed&&(window.clearInterval(f),l(!0))},500)})}static handleMovedTemporarily(e){return new Promise(l=>{P.showDegradedMessage(e),e.isResponseHandled=!0,l()})}static showDegradedMessage(e){let l=new Ie(te.DEGRADED_RESOURCE,e);P.publish(T.SHOW_INFORMATION,[l])}static storeAccessToken(e,l){return new Promise((f,_)=>{e.tokenService?(W.set(e.tokenService.id,l,l.expiresIn,P.storageStrategy),f()):_("Token service not found")})}static getStoredAccessToken(e){return new Promise((l,f)=>{let _=[],I=null;if(e.tokenService&&(I=W.get(e.tokenService.id,P.storageStrategy)),I)_.push(I);else{let d=q.getUrlParts(e.dataUri).hostname,m=W.getItems(P.storageStrategy);for(let o=0;o<m.length;o++)I=m[o],I.key.includes(d)&&_.push(I)}_=_.sort((d,m)=>d.expiresAt-m.expiresAt);let E=null;_.length&&(E=_[_.length-1].value),l(E)})}static getContentProviderInteraction(e,l){return new Promise(f=>{e.isResponseHandled&&!e.authHoldingPage?(P.showDegradedMessage(e),f(null)):e.authHoldingPage?(e.authHoldingPage.location.href=P.getCookieServiceUrl(l),f(e.authHoldingPage)):P.publish(T.SHOW_AUTH_DIALOGUE,[{service:l,closeCallback:()=>{f(null)},confirmCallback:()=>{let _=P.openContentProviderInteraction(l);f(_)},cancelCallback:()=>{f(null)}}])})}static openTokenService(e,l){return new Promise((f,_)=>{let I=P.getOrigin(l.id),E=new Date().getTime();P.messages[E]={resolve:f,reject:_,serviceOrigin:I,resource:e},window.addEventListener("message",P.receiveToken,!1);let d=l.id+"?messageId="+E+"&origin="+P.getOrigin();De("#commsFrame").prop("src",d);let m=5e3;setTimeout(()=>{P.messages[E]&&(P.messages[E].reject("Message unhandled after "+m+"ms, rejecting"),delete P.messages[E])},m)})}static receiveToken(e){if(e.data.hasOwnProperty("messageId")){let l=P.messages[e.data.messageId];l&&e.origin==l.serviceOrigin&&P.storeAccessToken(l.resource,e.data).then(()=>{l.resolve(e.data),delete P.messages[e.data.messageId]})}}static showOutOfOptionsMessages(e,l){if(e.status==Ne.MOVED_TEMPORARILY)return;let f="";l.getFailureHeader()&&(f+="<p>"+l.getFailureHeader()+"</p>"),l.getFailureDescription()&&(f+=l.getFailureDescription()),P.publish(T.SHOW_MESSAGE,[Y(f)])}},ce=P;ce.messages={};var He=class{constructor(e,l,f){this.isResized=!1,this.$element=e,this.fitToParentWidth=l||!1,this.fitToParentHeight=f||!1,this.create()}create(){var e;(e=this.extensionHost)==null||e.subscribe(D.RESIZE,()=>{this.resize()})}whenResized(e){Re.waitFor(()=>this.isResized,e)}onAccessibleClick(e,l,f=!0){f&&e.on("click",_=>{l(_)}),e.on("keyup",_=>{_.keyCode===32&&l(_)})}resize(){let e=this.$element.parent();this.fitToParentWidth&&this.$element.width(e.width()),this.fitToParentHeight&&this.$element.height(e.height()),this.isResized=!0}},Be=k(),ne=class extends He{constructor(e,l,f){super(e,l,f)}create(){this.extensionHost=this.$element.closest(".uv-iiif-extension-host").data("component"),super.create(),this.extension=this.extensionHost.extension,this.config={},this.config.content={},this.config.options={};var e=this;e.modules&&e.modules.length&&(e.modules=e.modules.reverse(),e.modules.forEach(l=>{e.config=Be.extend(!0,e.config,e.extension.data.config.modules[l])})),this.content=this.config.content,this.options=this.config.options}init(){}setConfig(e){this.modules||(this.modules=[]),this.modules.push(e)}resize(){super.resize()}},X=k(),Z=class extends ne{constructor(e){super(e,!1,!1),this.allowClose=!0,this.isActive=!1,this.isUnopened=!0}create(){this.setConfig("dialogue"),super.create(),this.extensionHost.subscribe(T.CLOSE_ACTIVE_DIALOGUE,()=>{this.isActive&&this.allowClose&&this.close()}),this.extensionHost.subscribe(T.ESCAPE,()=>{this.isActive&&this.allowClose&&this.close()}),this.$top=X('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=X('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=X('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=X('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=X('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=X('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",e=>{e.preventDefault(),this.close()}),this.returnFunc=this.close}enableClose(){this.allowClose=!0,this.$closeButton.show()}disableClose(){this.allowClose=!1,this.$closeButton.hide()}setDockedPosition(){let e=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),l=0,f=0,_=0;if(this.$triggerButton){let I=4,E=2,d=this.$triggerButton.offset().top,m=this.extension.$element.offset().top,o=this.$element.outerHeight(!0);e=d-m-o+I;let g=this.$triggerButton.offset().left,p=this.extension.$element.offset().left,r=g-p;_=we.normalise(r,0,this.extension.width()),l=Math.floor(this.extension.width()*_-this.$element.width()*_)+E,f=Math.floor(this.$element.width()*_)}this.$bottom.css("backgroundPosition",f+"px 0px"),this.$element.css({top:e,left:l})}open(e){this.$element.attr("aria-hidden","false"),this.$element.show(),e?(this.$triggerButton=X(e),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout(()=>{let l=this.$element.find(".default");if(l.length)l.focus();else{let f=this.$element.find("input:visible").first();f.length?f.focus():this.$closeButton.focus()}},1),this.extensionHost.publish(T.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()}afterFirstOpen(){}close(){!this.isActive||(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.extensionHost.publish(this.closeCommand),this.extensionHost.publish(T.HIDE_OVERLAY))}resize(){super.resize(),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})}},de=k(),ke=class extends Z{constructor(e){super(e)}create(){this.setConfig("authDialogue"),super.create(),this.openCommand=T.SHOW_AUTH_DIALOGUE,this.closeCommand=T.HIDE_AUTH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.closeCallback=e.closeCallback,this.confirmCallback=e.confirmCallback,this.cancelCallback=e.cancelCallback,this.service=e.service,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=de('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",e=>{e.preventDefault(),this.confirmCallback&&this.confirmCallback(),this.close()}),this.$cancelButton.on("click",e=>{e.preventDefault(),this.cancelCallback&&this.cancelCallback(),this.close()})}open(){super.open();let e=this.service.getHeader(),l=this.service.getDescription(),f=this.service.getConfirmLabel();e&&this.$title.text(Y(e)),l&&(this.$message.html(Y(l)),this.$message.targetBlank(),this.$message.find("a").on("click",function(){let _=de(this).attr("href");this.extensionHost.publish(T.EXTERNAL_LINK_CLICKED,_)})),f&&this.$confirmButton.text(Y(f)),this.resize()}resize(){super.resize()}_buttonsToAdd(){var e='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(e+='<button class="close btn btn-default"></button>'),e}},pe=k(),Fe=class extends Z{constructor(e){super(e)}create(){this.setConfig("clickThroughDialogue"),super.create(),this.openCommand=T.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=T.HIDE_CLICKTHROUGH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.acceptCallback=e.acceptCallback,this.resource=e.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=pe('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",e=>{e.preventDefault(),this.close(),this.extensionHost.publish(T.ACCEPT_TERMS),this.acceptCallback&&this.acceptCallback()})}open(){super.open(),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",function(){var e=pe(this).attr("href");this.extensionHost.publish(T.EXTERNAL_LINK_CLICKED,e)}),this.resize()}resize(){super.resize()}},ge=k(),Ue=class extends Z{constructor(e){super(e)}create(){this.setConfig("loginDialogue"),super.create(),this.openCommand=T.SHOW_LOGIN_DIALOGUE,this.closeCommand=T.HIDE_LOGIN_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.loginCallback=e.loginCallback,this.logoutCallback=e.logoutCallback,this.options=e.options,this.resource=e.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=ge('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",e=>{e.preventDefault(),this.close(),this.loginCallback&&this.loginCallback()}),this.$logoutButton.on("click",e=>{e.preventDefault(),this.close(),this.logoutCallback&&this.logoutCallback()}),this.$cancelButton.on("click",e=>{e.preventDefault(),this.close()}),this.updateLogoutButton()}open(){super.open();let e="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),e=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(e='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+e+"</span>"),this.updateLogoutButton(),this.$message.html(e),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var l=ge(this).attr("href");this.extensionHost.publish(T.EXTERNAL_LINK_CLICKED,l)}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()}updateLogoutButton(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()}resize(){super.resize()}},fe=k(),Ge=class extends Z{constructor(e){super(e)}create(){this.setConfig("restrictedDialogue"),super.create(),this.openCommand=T.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=T.HIDE_RESTRICTED_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.acceptCallback=e.acceptCallback,this.options=e.options,this.resource=e.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=fe('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",e=>{e.preventDefault(),this.close()})}open(){super.open(),this.isAccepted=!1;let e="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),e=this.resource.restrictedService.getProperty("description")),this.$message.html(e),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var l=fe(this).attr("href");this.extensionHost.publish(T.EXTERNAL_LINK_CLICKED,l)}),this.resize()}close(){super.close(),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())}resize(){super.resize()}},me=k(),Ve=class extends Z{constructor(e){super(e)}create(){this.setConfig("genericDialogue"),super.create(),this.openCommand=T.SHOW_GENERIC_DIALOGUE,this.closeCommand=T.HIDE_GENERIC_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.acceptCallback=e.acceptCallback,this.showMessage(e)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$message=me("<p></p>"),this.$content.append(this.$message),this.$acceptButton=me(`
          <button class="btn btn-primary accept default">
            ${this.content.ok}
          </button>
        `),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed(()=>{this.accept()}),this.returnFunc=()=>{this.isActive&&this.accept()},this.$element.hide()}accept(){this.extensionHost.publish(T.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()}showMessage(e){this.$message.html(e.message),e.buttonText?this.$acceptButton.text(e.buttonText):this.$acceptButton.text(this.content.ok),e.allowClose===!1&&this.disableClose(),this.open()}resize(){super.resize()}},G=k(),je=class extends ne{constructor(e){super(e,!0,!0)}create(){super.create(),this.extensionHost.subscribe(T.SHOW_OVERLAY,()=>{this.$overlays.show()}),this.extensionHost.subscribe(T.HIDE_OVERLAY,()=>{this.$overlays.hide()}),this.$element.append('<a class="sr-only" href="#download-btn">'+this.extension.data.config.content.skipToDownload+"</a>"),this.$headerPanel=G('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=G('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=G('<div class="centerPanel"></div>'),this.$centerPanel.append('<h2 class="sr-only">'+this.extension.data.config.content.mediaViewer+"</h2>"),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=G('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=G('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=G('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=G('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=G('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$overlays.hide(),this.$genericDialogue=G('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",e=>{G(e.target).hasClass("overlays")&&(e.preventDefault(),this.extensionHost.publish(T.CLOSE_ACTIVE_DIALOGUE))}),new Ve(this.$genericDialogue)}resize(){super.resize(),setTimeout(()=>{this.$overlays.width(this.extension.width()),this.$overlays.height(this.extension.height())},1);let e=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(z(this.$headerPanel)?this.$headerPanel.height():0)-(z(this.$footerPanel)?this.$footerPanel.height():0)-(z(this.$mobileFooterPanel)?this.$mobileFooterPanel.height():0);this.$mainPanel.height(e)}},ze=ie(Ce()),F;(function(e){e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.PauseBreak=19]="PauseBreak",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.Spacebar=32]="Spacebar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.PrintScrn=44]="PrintScrn",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.a=65]="a",e[e.b=66]="b",e[e.c=67]="c",e[e.d=68]="d",e[e.e=69]="e",e[e.f=70]="f",e[e.g=71]="g",e[e.h=72]="h",e[e.i=73]="i",e[e.j=74]="j",e[e.k=75]="k",e[e.l=76]="l",e[e.m=77]="m",e[e.n=78]="n",e[e.o=79]="o",e[e.p=80]="p",e[e.q=81]="q",e[e.r=82]="r",e[e.s=83]="s",e[e.t=84]="t",e[e.u=85]="u",e[e.v=86]="v",e[e.w=87]="w",e[e.x=88]="x",e[e.y=89]="y",e[e.z=90]="z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.NumpadPlus=107]="NumpadPlus",e[e.NumpadMinus=109]="NumpadMinus",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.Semicolon=186]="Semicolon",e[e.Equals=187]="Equals",e[e.Comma=188]="Comma",e[e.LessThan=188]="LessThan",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.GreaterThan=190]="GreaterThan",e[e.ForwardSlash=191]="ForwardSlash",e[e.QuestionMark=191]="QuestionMark",e[e.GraveAccent=192]="GraveAccent",e[e.Tilde=192]="Tilde",e[e.OpenCurlyBracket=219]="OpenCurlyBracket",e[e.OpenSquareBracket=219]="OpenSquareBracket",e[e.BackSlash=220]="BackSlash",e[e.VerticalPipe=220]="VerticalPipe",e[e.CloseCurlyBracket=221]="CloseCurlyBracket",e[e.CloseSquareBracket=221]="CloseSquareBracket",e[e.Quote=222]="Quote",e[e.CommandFF=224]="CommandFF"})(F||(F={}));var _e;(function(e){e[e.Backspace=8]="Backspace",e[e.Enter=13]="Enter",e[e.Spacebar=32]="Spacebar",e[e.Hash=35]="Hash",e[e.GraveAccent=39]="GraveAccent",e[e.DoubleQuote=34]="DoubleQuote",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Minus=45]="Minus",e[e.Period=46]="Period",e[e.ForwardSlash=47]="ForwardSlash",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.Colon=58]="Colon",e[e.Semicolon=59]="Semicolon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.At=64]="At",e[e.OpenSquareBracket=91]="OpenSquareBracket",e[e.BackSlash=92]="BackSlash",e[e.CloseSquareBracket=93]="CloseSquareBracket",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.OpenCurlyBracket=123]="OpenCurlyBracket",e[e.VerticalPipe=124]="VerticalPipe",e[e.CloseCurlyBracket=125]="CloseCurlyBracket",e[e.Tilde=126]="Tilde"})(_e||(_e={}));var V=k(),Je=class{constructor(){this.annotations=[],this.isCreated=!1,this.isLoggedIn=!1,this.metrics=[],this.shifted=!1,this.tabbing=!1,this.locales={}}create(){let e=this;if(this.browserDetect=new We,this.browserDetect.init(),B.publish=this.extensionHost.publish.bind(this.extensionHost),ce.publish=this.extensionHost.publish.bind(this.extensionHost),this.$element=V(this.extensionHost.options.target),this.$element.data("component",this.extensionHost),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv-iiif-extension-host"),this.$element.addClass("loading"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.isRightPanelEnabled()&&this.$element.addClass("right-panel-enabled"),this.isLeftPanelEnabled()&&this.$element.addClass("left-panel-enabled"),this.isFooterPanelEnabled()&&this.$element.addClass("footer-panel-enabled"),this.$element.addClass(this.type.name),this.$element.addClass("browser-"+this.browserDetect.browser),this.$element.addClass("browser-version-"+this.browserDetect.version),this.$element.prop("tabindex",-1),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),ee.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.isFullScreen()&&this.$element.addClass("fullscreen"),this.$element.on("mousemove",l=>{this.mouseX=l.pageX,this.mouseY=l.pageY}),!this.data.isReload){let l=ee.getHiddenProp();if(l){let f=l.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(f,()=>{ee.isHidden()||this.resize()})}M.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",f=>{f.preventDefault();let _=f.originalEvent.dataTransfer.getData("URL"),I=q.getUrlParts(_),E=q.getQuerystringParameterFromString("manifest",I.search);if(E||(E=q.getQuerystringParameterFromString("collection",I.search)),E){this.fire(D.DROP,E);let d={};d.iiifManifestId=E,this.reload(d)}}),this.$element.on("dragover",f=>{f.preventDefault()}),this.$element.on("keyup keydown",f=>{this.shifted=f.shiftKey,this.tabbing=f.keyCode===F.Tab}),this.$element.on("keydown",f=>{let _=null,I=!0;!f.ctrlKey&&!f.altKey&&!f.shiftKey&&(f.keyCode===F.Enter&&(_=T.RETURN,I=!1),f.keyCode===F.Escape&&(_=T.ESCAPE),f.keyCode===F.PageUp&&(_=T.PAGE_UP),f.keyCode===F.PageDown&&(_=T.PAGE_DOWN),f.keyCode===F.End&&(_=T.END),f.keyCode===F.Home&&(_=T.HOME),(f.keyCode===F.NumpadPlus||f.keyCode===171||f.keyCode===F.Equals)&&(_=T.PLUS,I=!1),(f.keyCode===F.NumpadMinus||f.keyCode===173||f.keyCode===F.Dash)&&(_=T.MINUS,I=!1),e.useArrowKeysToNavigate()&&(f.keyCode===F.LeftArrow&&(_=T.LEFT_ARROW),f.keyCode===F.UpArrow&&(_=T.UP_ARROW),f.keyCode===F.RightArrow&&(_=T.RIGHT_ARROW),f.keyCode===F.DownArrow&&(_=T.DOWN_ARROW))),_&&(I&&f.preventDefault(),this.extensionHost.publish(_))})}this.extensionHost.subscribe(D.EXIT_FULLSCREEN,()=>{this.isOverlayActive()&&this.extensionHost.publish(T.ESCAPE),this.extensionHost.publish(T.ESCAPE),this.extensionHost.publish(D.RESIZE)}),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.extensionHost.subscribeAll((l,f)=>{[D.LOAD,D.DROP,D.TOGGLE_FULLSCREEN,D.EXTERNAL_RESOURCE_OPENED,D.RELOAD].includes(l)||this.fire(l,f)}),this.extensionHost.subscribe(D.EXTERNAL_RESOURCE_OPENED,()=>{this.fire(D.EXTERNAL_RESOURCE_OPENED)}),this.extensionHost.subscribe(T.LOGIN_FAILED,()=>{this.showMessage(this.data.config.content.authorisationFailedMessage)}),this.extensionHost.subscribe(T.LOGIN,()=>{this.isLoggedIn=!0}),this.extensionHost.subscribe(T.LOGOUT,()=>{this.isLoggedIn=!1}),this.extensionHost.subscribe(T.BOOKMARK,()=>{this.bookmark()}),this.extensionHost.subscribe(T.CANVAS_INDEX_CHANGE,l=>{this.data.canvasIndex=l,this.lastCanvasIndex=this.helper.canvasIndex,this.helper.canvasIndex=l}),this.extensionHost.subscribe(T.CLOSE_LEFT_PANEL,()=>{this.resize()}),this.extensionHost.subscribe(T.CLOSE_RIGHT_PANEL,()=>{this.resize()}),this.extensionHost.subscribe(T.COLLECTION_INDEX_CHANGE,l=>{this.data.collectionIndex=l}),this.extensionHost.subscribe(D.CREATED,()=>{this.isCreated=!0}),this.extensionHost.subscribe(T.ESCAPE,()=>{this.isFullScreen()&&!this.isOverlayActive()&&this.extensionHost.publish(D.TOGGLE_FULLSCREEN)}),this.extensionHost.subscribe(D.LOAD,()=>{setTimeout(()=>{this.extensionHost.publish(D.RESIZE),this.fire(D.LOAD,this.helper.getCurrentCanvas().id),this.$element.removeClass("loading")},100)}),this.extensionHost.subscribe(T.FEEDBACK,()=>{this.feedback()}),this.extensionHost.subscribe(T.FORBIDDEN,()=>{this.extensionHost.publish(T.OPEN_EXTERNAL_RESOURCE)}),this.extensionHost.subscribe(D.LOAD_FAILED,()=>{!e.lastCanvasIndex==null&&e.lastCanvasIndex!==e.helper.canvasIndex&&this.extensionHost.publish(T.CANVAS_INDEX_CHANGE,e.lastCanvasIndex)}),this.extensionHost.subscribe(T.MANIFEST_INDEX_CHANGE,l=>{this.data.manifestIndex=l}),this.extensionHost.subscribe(T.OPEN,()=>{let l=Le.format(this.data.config.options.openTemplate,this.helper.manifestUri);window.open(l)}),this.extensionHost.subscribe(T.OPEN_LEFT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(T.OPEN_RIGHT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(T.RANGE_CHANGE,l=>{l?(this.data.rangeId=l.id,this.helper.rangeId=l.id):(this.data.rangeId=void 0,this.helper.rangeId=void 0)}),this.extensionHost.subscribe(T.RESOURCE_DEGRADED,l=>{B.handleDegraded(l)}),this.extensionHost.subscribe(T.SHOW_MESSAGE,l=>{this.showMessage(l)}),this.extensionHost.subscribe(T.SHOW_TERMS_OF_USE,()=>{let l=this.helper.getLicense();if(!l){let f=this.helper.getRequiredStatement();f&&f.value&&(l=f.value)}l&&this.showMessage(l)}),this.extensionHost.subscribe(D.TOGGLE_FULLSCREEN,()=>{let l=this.data.config.options.overrideFullScreen;this.extensionHost.isFullScreen=!this.extensionHost.isFullScreen,l||(V("#top").focus(),this.extensionHost.isFullScreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")),this.fire(D.TOGGLE_FULLSCREEN,{isFullScreen:this.extensionHost.isFullScreen,overrideFullScreen:l})}),this.shell=new je(this.$element),this.createModules(),this.extensionHost.publish(D.RESIZE),setTimeout(()=>{this.render(),this.extensionHost.publish(D.CREATED),this._setDefaultFocus()},1)}async loadConfig(e){let l=this.locales[e];if(!l)throw new Error("Unable to load config");return typeof l=="object"?l=JSON.parse(JSON.stringify(l)):typeof l=="function"&&(l=await l(),l=JSON.parse(JSON.stringify(l))),l}createModules(){this.$authDialogue=V('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new ke(this.$authDialogue),this.$clickThroughDialogue=V('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new Fe(this.$clickThroughDialogue),this.$restrictedDialogue=V('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new Ge(this.$restrictedDialogue),this.$loginDialogue=V('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new Ue(this.$loginDialogue)}_setDefaultFocus(){setTimeout(()=>{this.data.config.options.allowStealFocus&&V("[tabindex=0]").focus()},1)}width(){return this.$element.width()}height(){return this.$element.height()}exitFullScreen(){this.extensionHost.publish(D.EXIT_FULLSCREEN)}fire(e,...l){this.data.debug&&console.log(e,arguments[1]),this.extensionHost.fire(e,arguments[1])}redirect(e){this.fire(T.REDIRECT,e)}refresh(){this.fire(T.REFRESH,null)}render(){if((!this.isCreated||this.data.collectionIndex!==this.helper.collectionIndex)&&this.extensionHost.publish(T.COLLECTION_INDEX_CHANGE,this.data.collectionIndex),(!this.isCreated||this.data.manifestIndex!==this.helper.manifestIndex)&&this.data.iiifManifestId!==void 0&&this.extensionHost.publish(T.MANIFEST_INDEX_CHANGE,this.data.manifestIndex),(!this.isCreated||this.data.canvasIndex!==this.helper.canvasIndex)&&(this.data.canvasIndex===void 0&&(this.data.canvasIndex=0),this.data.canvasId&&(this.data.canvasIndex=this.helper.canvasIndex),this.extensionHost.publish(T.CANVAS_INDEX_CHANGE,this.data.canvasIndex)),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){let e=this.helper.getRangeById(this.data.rangeId);e?this.extensionHost.publish(T.RANGE_CHANGE,e):console.warn("range id not found:",this.data.rangeId)}}_initLocales(){let e=this.data.config.localisation.locales.slice(0),l=this.data.locales,f=[];l?(l.forEach(_=>{let I=e.filter(d=>d.name===_.name);if(I.length){var E=I[0];_.label&&(E.label=_.label),E.added=!0,f.push(E)}}),M.getBool(this.data.config.options.limitLocales,!1)||e.forEach(_=>{_.added||f.push(_),delete _.added}),this.data.locales=f):console.warn("No locales configured")}_parseMetrics(){let e=this.data.config.options.metrics;if(e)for(let l=0;l<e.length;l++){let f=e[l];this.metrics.push(f)}}_updateMetric(){setTimeout(()=>{for(let l=this.metrics.length-1;l>=0;l--){let f=this.metrics[l];if(window.innerWidth>=f.minWidth){if(this.metric!==f.type){this.metric=f.type;for(var e=0;e<this.metrics.length;e++)this.$element.removeClass(this.metrics[e].type);this.$element.addClass(f.type),this.extensionHost.publish(T.METRIC_CHANGE)}break}}},1)}resize(){this._updateMetric(),this.extensionHost.publish(D.RESIZE)}reload(e){this.extensionHost.publish(D.RELOAD,e)}isSeeAlsoEnabled(){return this.data.config.options.seeAlsoEnabled!==!1}getShareUrl(){if(this.data.embedded){if(this.helper.hasRelatedPage()){var e=this.helper.getRelated();return e&&e.length&&(e=e[0]),e["@id"]}}else return ee.isInIFrame()?parent.document.location.href:document.location.href;return null}getIIIFShareUrl(e=!1){let l;return e&&(this.helper.manifest?l=this.helper.manifest.id:l=this.helper.manifestUri),`${l}?manifest=${l}`}getDomain(){return q.getUrlParts(this.helper.manifestUri).host}getAppUri(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/uv.html"}getSettings(){if(M.getBool(this.data.config.options.saveUserSettings,!1)){let e=W.get("uv.settings",he.LOCAL);if(e)return V.extend(this.data.config.options,e.value)}return this.data.config.options}updateSettings(e){if(M.getBool(this.data.config.options.saveUserSettings,!1)){let l=W.get("uv.settings",he.LOCAL);l&&(e=V.extend(l.value,e)),W.set("uv.settings",e,31536e4,he.LOCAL)}this.data.config.options=V.extend(this.data.config.options,e)}getLocale(){return this.helper.options.locale}getSharePreview(){let e=this.helper.getLabel(),l=this.helper.getCurrentCanvas(),f=l.getProperty("thumbnail");return(!f||typeof f!="string")&&(f=l.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:e,image:f}}getPagedIndices(e=this.helper.canvasIndex){return[e]}getCurrentCanvases(){let e=this.getPagedIndices(this.helper.canvasIndex),l=[];for(let f=0;f<e.length;f++){let _=e[f],I=this.helper.getCanvasByIndex(_);I&&l.push(I)}return l}getCanvasLabels(e){let l=this.getPagedIndices(),f="";if(l.length===1)f=e;else for(let _=1;_<=l.length;_++)f.length&&(f+=","),f+=e+" "+_;return f}getCurrentCanvasRange(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())}getExternalResources(e){let l=this.getPagedIndices(),f=[];l.forEach(I=>{let E=this.helper.getCanvasByIndex(I),d;if(E.externalResource?d=E.externalResource:d=new Oe(E,{authApiVersion:this.data.config.options.authAPIVersion}),e){let m=e.find(o=>o.dataUri===d.dataUri);m?f.push(m):f.push(d)}else f.push(d)});let _=this.data.config.options.tokenStorage;return this.data.config.options.authAPIVersion===1?new Promise(I=>{let E={locale:this.helper.options.locale};ce.loadExternalResources(f,_,E).then(d=>{this.resources=d.map(m=>this._prepareResourceData(m)),I(this.resources)})}):new Promise(I=>{B.loadExternalResources(f,_).then(E=>{this.resources=E.map(d=>this._prepareResourceData(d)),I(this.resources)})})}_prepareResourceData(e){return e.data.hasServiceDescriptor=e.hasServiceDescriptor(),e.hasServiceDescriptor()||(e.data.id=e.dataUri,e.data.width=e.width,e.data.height=e.height),e.data.index=e.index,Ae.toPlainObject(e.data)}getMediaFormats(e){let l=e.getContent();return l&&l.length?l[0].getBody():[{id:e.id,type:e.getType(),getFormat:function(){return""}}]}viewCanvas(e){if(this.helper.isCanvasIndexOutOfRange(e)){this.showMessage(this.data.config.content.canvasIndexOutOfRange);return}this.extensionHost.publish(T.OPEN_EXTERNAL_RESOURCE)}showMessage(e,l,f,_){this.closeActiveDialogue(),this.extensionHost.publish(T.SHOW_GENERIC_DIALOGUE,{message:e,acceptCallback:l,buttonText:f,allowClose:_})}closeActiveDialogue(){this.extensionHost.publish(T.CLOSE_ACTIVE_DIALOGUE)}isOverlayActive(){return z(this.shell.$overlays)}isDesktopMetric(){return this.metric==="lg"||this.metric==="xl"}isMobileMetric(){return this.metric==="sm"||this.metric==="md"}viewManifest(e){let l={};l.iiifManifestId=this.helper.manifestUri,l.collectionIndex=this.helper.getCollectionIndex(e),l.manifestIndex=e.index,l.canvasIndex=0,this.reload(l)}viewCollection(e){let l={};l.iiifManifestId=e.parentCollection?e.parentCollection.id:this.helper.manifestUri,l.collectionIndex=e.index,l.manifestIndex=0,l.canvasIndex=0,this.reload(l)}isFullScreen(){return this.extensionHost.isFullScreen}isHeaderPanelEnabled(){return M.getBool(this.data.config.options.headerPanelEnabled,!0)}isLeftPanelEnabled(){if(M.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){let e=this.helper.getViewingHint();if(!e||e&&e!==ze.ViewingHint.CONTINUOUS)return!0}}return!1}isRightPanelEnabled(){return M.getBool(this.data.config.options.rightPanelEnabled,!0)}isFooterPanelEnabled(){return M.getBool(this.data.config.options.footerPanelEnabled,!0)}isMobile(){let e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}useArrowKeysToNavigate(){return M.getBool(this.data.config.options.useArrowKeysToNavigate,!0)}bookmark(){}feedback(){this.fire(T.FEEDBACK,this.data)}getAlternateLocale(){let e=null;return this.data.locales&&this.data.locales.length>1&&(e=this.data.locales[1]),e}getSerializedLocales(){return this.data.locales?this.serializeLocales(this.data.locales):null}serializeLocales(e){let l="";for(let f=0;f<e.length;f++){let _=e[f];f>0&&(l+=","),l+=_.name,_.label&&(l+=":"+_.label)}return l}changeLocale(e){let l={};if(this.data.locales){l.locales=this.data.locales.slice(0);let f=l.locales.findIndex(I=>I.name===e),_=0;l.locales.splice(_,0,l.locales.splice(f,1)[0]),this.reload(l)}}dispose(){var e;(e=this.store)==null||e.destroy()}},We=class{constructor(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]}init(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown",this.browser=="Explorer"&&this.version=="7"&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())}searchString(e){for(var l=0;l<e.length;l++){var f=e[l].string;if(this.versionSearchString=e[l].subString,f.indexOf(e[l].subString)!=-1)return e[l].identity}}searchVersion(e){var l=e.indexOf(this.versionSearchString);if(l!=-1)return parseFloat(e.substring(l+this.versionSearchString.length+1))}searchVersionIE(){var e=navigator.userAgent.toString().toLowerCase(),l=/(trident)(?:.*rv:([\w.]+))?/.exec(e)||/(msie) ([\w.]+)/.exec(e)||["",null,-1],f="unknown";return l!==null&&l.length===3&&l[2]&&(f=l[2].split(".")[0]),f}},U=k(),et=class extends ne{constructor(e){super(e)}create(){this.setConfig("footerPanel"),super.create(),this.extensionHost.subscribe(D.TOGGLE_FULLSCREEN,()=>{this.updateFullScreenButton(),this.extensionHost.isFullScreen||setTimeout(()=>{this.resize()},1001)}),this.extensionHost.subscribe(T.METRIC_CHANGE,()=>{this.updateMinimisedButtons(),this.updateMoreInfoButton()}),this.extensionHost.subscribe(T.SETTINGS_CHANGE,()=>{this.updateDownloadButton()}),this.$options=U('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=U(`
          <button class="feedback btn imageBtn" title="${this.content.feedback}">
            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>
            <span class="sr-only">${this.content.feedback}</span>
          </button>
        `),this.$options.prepend(this.$feedbackButton),this.$openButton=U(`
          <button class="open btn imageBtn" title="${this.content.open}">
            <i class="uv-icon-open" aria-hidden="true"></i>
            <span class="sr-only">${this.content.open}</span>
          </button>
        `),this.$options.prepend(this.$openButton),this.$bookmarkButton=U(`
          <button class="bookmark btn imageBtn" title="${this.content.bookmark}">
            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>
            <span class="sr-only">${this.content.bookmark}</span>
          </button>
        `),this.$options.prepend(this.$bookmarkButton),this.$shareButton=U(`
          <button class="share btn imageBtn" title="${this.content.share}">
            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>
            <span class="sr-only">${this.content.share}</span>
          </button>
        `),this.$options.append(this.$shareButton),this.$embedButton=U(`
          <button class="embed btn imageBtn" title="${this.content.embed}">
            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>
            <span class="sr-only">${this.content.embed}</span>
          </button>
        `),this.$options.append(this.$embedButton),this.$downloadButton=U(`
          <button class="download btn imageBtn" title="${this.content.download}" id="download-btn">
            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>
            <span class="sr-only">${this.content.download}</span>
          </button>
        `),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=U(`
          <button class="moreInfo btn imageBtn" title="${this.content.moreInfo}">
            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>
            <span class="sr-only">${this.content.moreInfo}</span>
          </button>
        `),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=U(`
          <button class="fullScreen btn imageBtn" title="${this.content.fullScreen}">
            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>
            <span class="sr-only">${this.content.fullScreen}</span>
          </button>
        `),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed(()=>{this.extensionHost.publish(T.OPEN)}),this.$feedbackButton.onPressed(()=>{this.extensionHost.publish(T.FEEDBACK)}),this.$bookmarkButton.onPressed(()=>{this.extensionHost.publish(T.BOOKMARK)}),this.$shareButton.onPressed(()=>{this.extensionHost.publish(T.SHOW_SHARE_DIALOGUE,this.$shareButton)}),this.$embedButton.onPressed(()=>{this.extensionHost.publish(T.SHOW_EMBED_DIALOGUE,this.$embedButton)}),this.$downloadButton.onPressed(()=>{this.extensionHost.publish(T.SHOW_DOWNLOAD_DIALOGUE,this.$downloadButton)}),this.$moreInfoButton.onPressed(()=>{this.extensionHost.publish(T.SHOW_MOREINFO_DIALOGUE,this.$moreInfoButton)}),this.onAccessibleClick(this.$fullScreenBtn,e=>{e.preventDefault(),this.extensionHost.publish(D.TOGGLE_FULLSCREEN)},!0),M.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()}updateMinimisedButtons(){if(M.getBool(this.options.minimiseButtons,!1)){this.$options.addClass("minimiseButtons");return}this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons")}updateMoreInfoButton(){}updateOpenButton(){M.getBool(this.options.openEnabled,!1)&&ee.isInIFrame()?this.$openButton.show():this.$openButton.hide()}updateFullScreenButton(){if(!M.getBool(this.options.fullscreenEnabled,!0)||!ee.supportsFullscreen()){this.$fullScreenBtn.hide();return}this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),U(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),U(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen))}updateEmbedButton(){this.extension.helper.isUIEnabled("embed")&&M.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()}updateShareButton(){this.extension.helper.isUIEnabled("share")&&M.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()}updateDownloadButton(){M.getBool(this.options.downloadEnabled,!0)?this.$downloadButton.show():this.$downloadButton.hide()}updateFeedbackButton(){M.getBool(this.options.feedbackEnabled,!1)?this.$feedbackButton.show():this.$feedbackButton.hide()}updateBookmarkButton(){M.getBool(this.options.bookmarkEnabled,!1)?this.$bookmarkButton.show():this.$bookmarkButton.hide()}resize(){super.resize()}},ve=class{constructor(e,l){this.message=e,this.actions=l}},Ke=class{constructor(){}},qe=class{constructor(e){this.extension=e}Get(e){switch(e.informationType){case te.AUTH_CORS_ERROR:return new ve(this.extension.data.config.content.authCORSError,[]);case te.DEGRADED_RESOURCE:let l=[],f=new Ke,_=e.param.loginService.getConfirmLabel();_||(_=this.extension.data.config.content.fallbackDegradedLabel),f.label=_;let I=e.param;f.action=()=>{I.authHoldingPage=window.open("","_blank"),this.extension.extensionHost.publish(T.HIDE_INFORMATION),this.extension.extensionHost.publish(T.OPEN_EXTERNAL_RESOURCE,[[I]])},l.push(f);let E=e.param.loginService.getServiceLabel();return E||(E=this.extension.data.config.content.fallbackDegradedMessage),new ve(E,l)}}},Q=k(),tt=class extends ne{constructor(e){super(e,!1,!1)}create(){this.setConfig("headerPanel"),super.create(),this.extensionHost.subscribe(T.SHOW_INFORMATION,e=>{this.showInformation(e)}),this.extensionHost.subscribe(T.HIDE_INFORMATION,()=>{this.hideInformation()}),this.$options=Q('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=Q('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=Q('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=Q('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=Q(`
          <button class="btn imageBtn settings" tabindex="0" title="${this.content.settings}">
            <i class="uv-icon-settings" aria-hidden="true"></i>
          </button>
        `),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=Q('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",e=>{e.preventDefault(),this.extensionHost.publish(T.HIDE_INFORMATION)}),this.$localeToggleButton.on("click",()=>{this.extension.changeLocale(String(this.$localeToggleButton.data("locale")))}),this.$settingsButton.onPressed(()=>{this.extensionHost.publish(T.SHOW_SETTINGS_DIALOGUE,this.$settingsButton)}),M.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()}updateLocaleToggle(){if(!this.localeToggleIsVisible()){this.$localeToggleButton.hide();return}let e=this.extension.getAlternateLocale(),l=e.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",e.name),this.$localeToggleButton.attr("title",e.label),this.$localeToggleButton.text(l)}updateSettingsButton(){M.getBool(this.options.settingsButtonEnabled,!0)?this.$settingsButton.show():this.$settingsButton.hide()}localeToggleIsVisible(){let e=this.extension.data.locales;return e?e.length>1&&M.getBool(this.options.localeToggleEnabled,!1):!1}showInformation(e){let l=new qe(this.extension);this.information=l.Get(e);var f=this.$informationBox.find(".message");f.html(this.information.message).find("a").attr("target","_top");var _=this.$informationBox.find(".actions");_.empty();for(let I=0;I<this.information.actions.length;I++){let E=this.information.actions[I],d=Q('<a href="#" class="btn btn-default">'+E.label+"</a>");d.on("click",E.action),_.append(d)}this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()}hideInformation(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()}getSettings(){return this.extension.getSettings()}updateSettings(e){this.extension.updateSettings(e),this.extensionHost.publish(T.UPDATE_SETTINGS,e)}resize(){super.resize();let e=this.$element.width()/2,l=this.$centerOptions.outerWidth(),f=e-l/2;if(this.$centerOptions.css({left:f}),z(this.$informationBox)){let _=this.$informationBox.find(".actions"),I=this.$informationBox.find(".message");I.width(Math.floor(this.$element.width())-Math.ceil(I.horizontalMargins())-Math.ceil(_.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),this.information&&I.text(this.information.message)}this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()}},K=k(),$e=class extends ne{constructor(e){super(e,!1,!0),this.isExpanded=!1,this.isFullyExpanded=!1,this.isUnopened=!0,this.autoToggled=!1,this.expandFullEnabled=!0,this.reducedAnimation=!1}create(){super.create(),this.$top=K('<div class="top"></div>'),this.$element.append(this.$top),this.$title=K('<h2 class="title"></h2>'),this.$top.append(this.$title),this.$expandFullButton=K('<a class="expandFullButton" tabindex="0"></a>'),this.$top.append(this.$expandFullButton),M.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=K('<div role="button" class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=K('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=K('<a role="button" class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=K('<a class="title"></a>'),this.$closed.append(this.$closedTitle),this.$main=K('<div class="main"></div>'),this.$element.append(this.$main),this.onAccessibleClick(this.$expandButton,()=>{this.toggle()}),this.$expandFullButton.on("click",()=>{this.expandFull()}),this.$closedTitle.on("click",()=>{this.toggle()}),this.$title.on("click",()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.onAccessibleClick(this.$collapseButton,()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.$top.hide(),this.$main.hide(),this.extensionHost.subscribe(T.SETTINGS_CHANGE,e=>{this.reducedAnimation=e.reducedAnimation||!1})}init(){super.init()}setTitle(e){this.$title.text(e),this.$closedTitle.text(e)}toggle(e){e?this.autoToggled=!0:this.autoToggled=!1,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.reducedAnimation?(this.$element.css("width",this.getTargetWidth()),this.$element.css("left",this.getTargetLeft()),this.toggled()):this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,()=>{this.toggled()})}toggled(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1}expandFull(){this.isExpanded||this.toggled();var e=this.getFullTargetWidth(),l=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:e,left:l},this.options.panelAnimationDuration,()=>{this.expandFullFinish()})}collapseFull(){var e=this.getTargetWidth(),l=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:e,left:l},this.options.panelAnimationDuration,()=>{this.collapseFullFinish()})}getTargetWidth(){return 0}getTargetLeft(){return 0}getFullTargetWidth(){return 0}getFullTargetLeft(){return 0}toggleStart(){}toggleFinish(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()}expandFullStart(){}expandFullFinish(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()}collapseFullStart(){}collapseFullFinish(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()}focusExpandButton(){setTimeout(()=>{this.$expandButton.focus()},1)}focusExpandFullButton(){setTimeout(()=>{this.$expandFullButton.focus()},1)}focusCollapseButton(){setTimeout(()=>{this.$collapseButton.focus()},1)}resize(){super.resize(),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))}},Ye=class extends $e{constructor(e){super(e)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth)}init(){super.init(),M.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen)&&this.toggle(!0),this.extensionHost.subscribe(T.TOGGLE_EXPAND_RIGHT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}getTargetWidth(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth}getTargetLeft(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(T.OPEN_RIGHT_PANEL):this.extensionHost.publish(T.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})}resize(){super.resize(),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})}},Ee=ie(Pe()),Xe=k(),it=class extends Ye{constructor(e){super(e)}create(){this.setConfig("moreInfoRightPanel"),super.create(),this.extensionHost.subscribe(T.CANVAS_INDEX_CHANGE,()=>{this.databind()}),this.extensionHost.subscribe(T.RANGE_CHANGE,()=>{this.databind()}),this.setTitle(this.config.content.title),this.$metadata=Xe('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new Ee.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",e=>{let l=q.getHashParameterFromString("rid",e);if(l){let _=this.extension.helper.getRangeById(l);_&&this.extensionHost.publish(T.RANGE_CHANGE,_)}let f=q.getHashParameterFromString("t",e);if(f!==null){let _=Number(f);Number.isNaN(_)||this.extensionHost.publish(T.CURRENT_TIME_CHANGE,_)}},!1)}toggleFinish(){super.toggleFinish(),this.databind()}databind(){this.metadataComponent.set(this._getData())}_getCurrentRange(){return this.extension.helper.getCurrentRange()}_getData(){let e=this.extension.getCurrentCanvases();return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:e,canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:M.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new xe(this.config.license?this.config.license:{}),limit:this.config.options.textLimit||4,limitType:Ee.LimitType.LINES,limitToRange:M.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:l=>Y(l),showAllLanguages:this.config.options.showAllLanguages}}resize(){super.resize(),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())}},oe;(function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_CENTER=1]="TOP_CENTER",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.CENTER_LEFT=3]="CENTER_LEFT",e[e.CENTER=4]="CENTER",e[e.CENTER_RIGHT=5]="CENTER_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_CENTER=7]="BOTTOM_CENTER",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(oe||(oe={}));var ae=k(),nt=class extends ne{constructor(e){super(e,!1,!0),this.subtitleExpanded=!1,this.isAttributionOpen=!1,this.attributionPosition=oe.BOTTOM_LEFT,this.isAttributionLoaded=!1}create(){super.create(),this.$title=ae('<h1 class="title"></h1>'),this.$element.append(this.$title),this.$subtitle=ae(`<div class="subtitle">
                                <div class="wrapper">
                                    <button type="button" class="expand-btn" aria-label="Expand">
                                        <span aria-hidden="true">+</span>
                                    </button>
                                    <span class="text"></span>
                                </div>
                            </div>`),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=ae('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$attribution=ae(`
                                <div class="attribution">
                                  <div class="header">
                                    <div class="title"></div>
                                    <button type="button" class="close" aria-label="Close">
                                      <span aria-hidden="true">&#215;</span>
                                    </button>
                                  </div>
                                  <div class="main">
                                    <div class="attribution-text"></div>
                                    <div class="license"></div>
                                    <div class="logo"></div>
                                  </div>
                                </div>
        `),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",e=>{e.preventDefault(),this.closeAttribution()}),this.$subtitleExpand.on("click",e=>{e.preventDefault(),this.subtitleExpanded=!this.subtitleExpanded,this.subtitleExpanded?(this.$subtitleWrapper.addClass("expanded"),this.$subtitleExpand.text("-")):(this.$subtitleWrapper.removeClass("expanded"),this.$subtitleExpand.text("+")),this.resize()}),M.getBool(this.options.titleEnabled,!0)?this.$title.show():this.$title.hide(),M.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.show():this.$subtitle.hide(),this.whenResized(()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(T.RANGE_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(T.CANVAS_INDEX_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(T.MANIFEST_INDEX_CHANGE,()=>{this.updateRequiredStatement()})}openAttribution(){this.$attribution.show(),this.isAttributionOpen=!0}closeAttribution(){this.$attribution.hide(),this.isAttributionOpen=!1}updateRequiredStatement(){if(this.isAttributionLoaded)return;let e=M.getBool(this.config.options.mostSpecificRequiredStatement,!1),l=e?this.extension.helper.getMostSpecificRequiredStatement():this.extension.helper.getRequiredStatement(),f=M.getBool(this.options.requiredStatementEnabled,!0);if(!l||!l.value||!f)return;this.openAttribution();let _=this.$attribution.find(".title"),I=this.$attribution.find(".attribution-text"),E=this.$attribution.find(".license"),d=this.$attribution.find(".logo");if(l.label){let m=Y(l.label);_.html(m)}else _.text(this.content.attribution);if(l.value){let m=Y(l.value);I.html(m);let o=()=>this.resize();I.find("img").one("load",()=>{this.resize()}).each(function(){this.complete&&o()}),I.find("img").one("error",()=>{o()}),I.targetBlank()}E.hide(),d.hide(),this.resize(),e||(this.isAttributionLoaded=!0)}resize(){super.resize();let e=z(this.extension.shell.$leftPanel)?Math.floor(this.extension.shell.$leftPanel.width()):0,l=z(this.extension.shell.$rightPanel)?Math.floor(this.extension.shell.$rightPanel.width()):0,f=Math.floor(this.$element.parent().width()-e-l);this.$element.css({left:e,width:f});let _,I;if(this.options&&this.options.titleEnabled===!1||!z(this.$title)?_=0:_=this.$title.outerHeight(!0),this.options&&this.options.subtitleEnabled===!1||!z(this.$subtitle)?I=0:I=this.$subtitle.outerHeight(!0),this.$content.height(this.$element.height()-_-I),this.$content.width(this.$element.width()),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case oe.BOTTOM_LEFT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",0);break;case oe.BOTTOM_RIGHT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",this.$content.width()-this.$attribution.outerWidth()-this.$attribution.horizontalMargins());break}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(Y(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.show(),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.hide()}},st=class extends $e{constructor(e){super(e)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth),this.extensionHost.subscribe(T.TOGGLE_EXPAND_LEFT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}init(){super.init(),M.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen)&&this.toggle(!0)}getTargetWidth(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth}getFullTargetWidth(){return this.$element.parent().width()}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(T.OPEN_LEFT_PANEL):this.extensionHost.publish(T.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})}resize(){super.resize(),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())}},j=k(),ot=class extends Z{constructor(e){super(e)}create(){this.setConfig("settingsDialogue"),super.create(),this.openCommand=T.SHOW_SETTINGS_DIALOGUE,this.closeCommand=T.HIDE_SETTINGS_DIALOGUE;let e;this.extensionHost.subscribe(this.openCommand,l=>{e=l,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{e&&e.focus(),this.close()}),this.$title=j('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$scroll=j('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=j('<div class="version"></div>'),this.$content.append(this.$version),this.$website=j('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=j('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=j('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=j('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this._createAccessibilityMenu(),this.$element.hide()}getSettings(){return this.extension.getSettings()}updateSettings(e){this.extension.updateSettings(e),this.extensionHost.publish(T.UPDATE_SETTINGS,e)}open(){super.open(),this.$version.text("v"+process.env.PACKAGE_VERSION)}_createLocalesMenu(){let e=this.extension.data.locales;if(e&&e.length>1){for(let l=0;l<e.length;l++){let f=e[l];this.$localeDropDown.append('<option value="'+f.name+'">'+f.label+"</option>")}this.$localeDropDown.val(e[0].name)}else this.$locale.hide();this.$localeDropDown.change(()=>{this.extension.changeLocale(this.$localeDropDown.val())})}resize(){super.resize()}_createAccessibilityMenu(){this.$reducedAnimation=j('<div class="setting reducedAnimation"></div>'),this.$scroll.append(this.$reducedAnimation),this.$reducedAnimationCheckbox=j('<input id="reducedAnimation" type="checkbox" tabindex="0" />'),this.$reducedAnimation.append(this.$reducedAnimationCheckbox),this.$reducedAnimationLabel=j('<label for="reducedAnimation">'+this.content.reducedMotion+"</label>"),this.$reducedAnimation.append(this.$reducedAnimationLabel),this.$reducedAnimationCheckbox.change(()=>{let e={};this.$reducedAnimationCheckbox.is(":checked")?e.reducedAnimation=!0:e.reducedAnimation=!1,this.updateSettings(e)})}},H=k(),rt=class extends Z{constructor(e){super(e),this.aspectRatio=.75,this.isEmbedViewVisible=!1,this.isShareViewVisible=!1,this.maxWidth=8e3,this.maxHeight=this.maxWidth*this.aspectRatio,this.minWidth=200,this.minHeight=this.minWidth*this.aspectRatio,this.shareManifestsEnabled=!1}create(){this.setConfig("shareDialogue"),super.create(),this.openCommand=T.SHOW_SHARE_DIALOGUE,this.closeCommand=T.HIDE_SHARE_DIALOGUE,this.shareManifestsEnabled=this.options.shareManifestsEnabled||!1;let e;this.extensionHost.subscribe(this.openCommand,f=>{e=f,this.open(f),this.isShareAvailable()?this.openShareView():this.openEmbedView()}),this.extensionHost.subscribe(this.closeCommand,()=>{e&&e.focus(),this.close()}),this.extensionHost.subscribe(T.SHOW_EMBED_DIALOGUE,f=>{this.open(f),this.openEmbedView()}),this.$tabs=H('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=H('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),this.$tabs.append(this.$shareButton),this.$embedButton=H('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),this.$tabs.append(this.$embedButton),this.$tabsContent=H('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=H('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=H('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=H('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=H('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=H(`<input class="shareInput" type="text" readonly="readonly" aria-label="${this.content.shareUrl}"/>`),this.$shareView.append(this.$shareInput),this.$shareFrame=H('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=H('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=H('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=H(`<input class="code" type="text" readonly="readonly" aria-label="${this.content.embed}"/>`),this.$embedView.append(this.$code),this.$customSize=H('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=H('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=H('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=H('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=H('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=H('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);let l=this.extension.getIIIFShareUrl(this.shareManifestsEnabled);this.shareManifestsEnabled&&(this.$iiifButton=H('<a class="imageBtn iiif" href="'+l+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton)),this.$termsOfUseButton=H('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",f=>ue.numericalInput(f)),this.$heightInput.on("keydown",f=>ue.numericalInput(f)),this.$shareInput.focus(function(){H(this).select()}),this.$code.focus(function(){H(this).select()}),this.onAccessibleClick(this.$shareButton,()=>{this.openShareView()}),this.onAccessibleClick(this.$embedButton,()=>{this.openEmbedView()}),this.$customSizeDropDown.change(()=>{this.update()}),this.$widthInput.change(()=>{this.updateHeightRatio(),this.update()}),this.$heightInput.change(()=>{this.updateWidthRatio(),this.update()}),this.onAccessibleClick(this.$termsOfUseButton,()=>{this.extensionHost.publish(T.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.update()}open(e){super.open(e),this.update()}getShareUrl(){return this.extension.getShareUrl()}isShareAvailable(){return!!this.getShareUrl()}update(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();let e=this.getSelectedSize();e.val()==="custom"?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number(e.data("width")),this.currentHeight=Number(e.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()}updateShareOptions(){let e=this.getShareUrl();e&&(this.$shareInput.val(e),this.$shareLink.prop("href",e),this.$shareLink.text(e)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())}updateInstructions(){M.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())}getSelectedSize(){return this.$customSizeDropDown.find(":selected")}updateWidthRatio(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))}updateHeightRatio(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))}updateShareFrame(){let e=this.extension.helper.getShareServiceUrl();!e||(M.getBool(this.config.options.shareFrameEnabled,!0)&&e?(this.$shareFrame.prop("src",e),this.$shareFrame.show()):this.$shareFrame.hide())}updateTermsOfUseButton(){let e=this.extension.helper.getRequiredStatement();M.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&e&&e.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}openShareView(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()}openEmbedView(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()}close(){super.close()}getViews(){return this.$tabsContent.find(".view")}equaliseViewHeights(){this.getViews().equaliseHeight(!0)}resize(){this.equaliseViewHeights(),this.setDockedPosition()}};export{ne as D,F,et as X,Je as Y,tt as Z,rt as a,nt as e,st as i,Pe as j,Z as k,ot as n,oe as s,it as t};
