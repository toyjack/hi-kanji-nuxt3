import{D as o,G as ia,K as __vitePreload,M as e,I as t,T,P,S,E as n$1,a0 as d,U as p,N as ro,a3 as D,Q as N,O as ao,a2 as io,a4 as f}from"./entry-c293202b.mjs";import{o as o$1}from"./chunk-3UUJB7QR-b602784f.mjs";import{m}from"./chunk-6AUGIHTP-7a1cbd70.mjs";import{i}from"./chunk-CHPN5XCG-6b41ee64.mjs";import{n}from"./chunk-IRDJNOQF-c2fce4bf.mjs";import{x,z,V as Ve$1,L as Le}from"./chunk-CXIKZ7FQ-11b2f7ce.mjs";import"./chunk-VVWTEMUP-e9d05752.mjs";import{_,h}from"./chunk-RSUYDEOQ-fb229a4d.mjs";import{Y as Yt$1,t as te,k,X as Xt,F,Z as Zt,e as ee,n as ne,a as se}from"./chunk-P2U3GQ3L-e6410a9a.mjs";import{G,H,g as gt$1}from"./IIIFContentHandler-2D2CUZM6-4294b090.mjs";var Ke=n$1((exports,module)=>{function OpenSeadragon(s){return new OpenSeadragon.Viewer(s)}(function(s){s.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var r={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},a=Object.prototype.toString,l=Object.prototype.hasOwnProperty;s.isFunction=function(c){return s.type(c)==="function"},s.isArray=Array.isArray||function(c){return s.type(c)==="array"},s.isWindow=function(c){return c&&typeof c=="object"&&"setInterval"in c},s.type=function(c){return c==null?String(c):r[a.call(c)]||"object"},s.isPlainObject=function(c){if(!c||OpenSeadragon.type(c)!=="object"||c.nodeType||s.isWindow(c)||c.constructor&&!l.call(c,"constructor")&&!l.call(c.constructor.prototype,"isPrototypeOf"))return!1;var u;for(var g in c)u=g;return u===void 0||l.call(c,u)},s.isEmptyObject=function(c){for(var u in c)return!1;return!0},s.freezeObject=function(c){return Object.freeze?s.freezeObject=Object.freeze:s.freezeObject=function(u){return u},s.freezeObject(c)},s.supportsCanvas=function(){var c=document.createElement("canvas");return!!(s.isFunction(c.getContext)&&c.getContext("2d"))}(),s.isCanvasTainted=function(c){var u=!1;try{c.getContext("2d").getImageData(0,0,1,1)}catch{u=!0}return u},s.pixelDensityRatio=function(){if(s.supportsCanvas){var c=document.createElement("canvas").getContext("2d"),u=window.devicePixelRatio||1,g=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1;return Math.max(u,1)/g}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var s,r,a,l,c,u,g=arguments[0]||{},v=arguments.length,C=!1,R=1;for(typeof g=="boolean"&&(C=g,g=arguments[1]||{},R=2),typeof g!="object"&&!OpenSeadragon.isFunction(g)&&(g={}),v===R&&(g=this,--R);R<v;R++)if(s=arguments[R],s!==null||s!==void 0)for(r in s)a=g[r],l=s[r],g!==l&&(C&&l&&(OpenSeadragon.isPlainObject(l)||(c=OpenSeadragon.isArray(l)))?(c?(c=!1,u=a&&OpenSeadragon.isArray(a)?a:[]):u=a&&OpenSeadragon.isPlainObject(a)?a:{},g[r]=OpenSeadragon.extend(C,u,l)):l!==void 0&&(g[r]=l));return g};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var s=navigator.userAgent;return typeof s!="string"?!1:s.indexOf("iPhone")!==-1||s.indexOf("iPad")!==-1||s.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(s,r){return function(){var a=arguments;return a===void 0&&(a=[]),r.apply(s,a)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(s){return typeof s=="string"&&(s=document.getElementById(s)),s},getElementPosition:function(s){var r=new $.Point,a,l;for(s=$.getElement(s),a=$.getElementStyle(s).position=="fixed",l=getOffsetParent(s,a);l;)r.x+=s.offsetLeft,r.y+=s.offsetTop,a&&(r=r.plus($.getPageScroll())),s=l,a=$.getElementStyle(s).position=="fixed",l=getOffsetParent(s,a);return r},getElementOffset:function(s){s=$.getElement(s);var r=s&&s.ownerDocument,a,l,c={top:0,left:0};return r?(a=r.documentElement,typeof s.getBoundingClientRect!="undefined"&&(c=s.getBoundingClientRect()),l=r==r.window?r:r.nodeType===9?r.defaultView||r.parentWindow:!1,new $.Point(c.left+(l.pageXOffset||a.scrollLeft)-(a.clientLeft||0),c.top+(l.pageYOffset||a.scrollTop)-(a.clientTop||0))):new $.Point},getElementSize:function(s){return s=$.getElement(s),new $.Point(s.clientWidth,s.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(s){return s=$.getElement(s),s.currentStyle}:function(s){return s=$.getElement(s),window.getComputedStyle(s,"")},getCssPropertyWithVendorPrefix:function(s){var r={};return $.getCssPropertyWithVendorPrefix=function(a){if(r[a]!==void 0)return r[a];var l=document.createElement("div").style,c=null;if(l[a]!==void 0)c=a;else for(var u=["Webkit","Moz","MS","O","webkit","moz","ms","o"],g=$.capitalizeFirstLetter(a),v=0;v<u.length;v++){var C=u[v]+g;if(l[C]!==void 0){c=C;break}}return r[a]=c,c},$.getCssPropertyWithVendorPrefix(s)},capitalizeFirstLetter:function(s){return s.charAt(0).toUpperCase()+s.slice(1)},positiveModulo:function(s,r){var a=s%r;return a<0&&(a+=r),a},pointInElement:function(s,r){s=$.getElement(s);var a=$.getElementOffset(s),l=$.getElementSize(s);return r.x>=a.x&&r.x<a.x+l.x&&r.y<a.y+l.y&&r.y>=a.y},getEvent:function(s){return s?$.getEvent=function(r){return r}:$.getEvent=function(){return window.event},$.getEvent(s)},getMousePosition:function(s){if(typeof s.pageX=="number")$.getMousePosition=function(r){var a=new $.Point;return r=$.getEvent(r),a.x=r.pageX,a.y=r.pageY,a};else if(typeof s.clientX=="number")$.getMousePosition=function(r){var a=new $.Point;return r=$.getEvent(r),a.x=r.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.y=r.clientY+document.body.scrollTop+document.documentElement.scrollTop,a};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(s)},getPageScroll:function(){var s=document.documentElement||{},r=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(r.scrollLeft||r.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(s.scrollLeft||s.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(s){if(typeof window.scrollTo!="undefined")$.setPageScroll=function(l){window.scrollTo(l.x,l.y)};else{var r=$.getPageScroll();if(r.x===s.x&&r.y===s.y)return;document.body.scrollLeft=s.x,document.body.scrollTop=s.y;var a=$.getPageScroll();if(a.x!==r.x&&a.y!==r.y){$.setPageScroll=function(l){document.body.scrollLeft=l.x,document.body.scrollTop=l.y};return}if(document.documentElement.scrollLeft=s.x,document.documentElement.scrollTop=s.y,a=$.getPageScroll(),a.x!==r.x&&a.y!==r.y){$.setPageScroll=function(l){document.documentElement.scrollLeft=l.x,document.documentElement.scrollTop=l.y};return}$.setPageScroll=function(l){}}return $.setPageScroll(s)},getWindowSize:function(){var s=document.documentElement||{},r=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(s.clientWidth||s.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(r.clientWidth||r.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(s){s=$.getElement(s);var r=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(r[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(r[1].style,{display:"table-row"}),$.extend(r[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),r[0].appendChild(r[1]),r[1].appendChild(r[2]),r[2].appendChild(s),r[0]},makeNeutralElement:function(s){var r=document.createElement(s),a=r.style;return a.background="transparent none",a.border="none",a.margin="0px",a.padding="0px",a.position="static",r},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(s){return $.makeTransparentImage=function(r){var a=$.makeNeutralElement("img");return a.src=r,a},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(r){var a=$.makeNeutralElement("img"),l=null;return l=$.makeNeutralElement("span"),l.style.display="inline-block",a.onload=function(){l.style.width=l.style.width||a.width+"px",l.style.height=l.style.height||a.height+"px",a.onload=null,a=null},a.src=r,l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+r+"', sizingMethod='scale')",l}),$.makeTransparentImage(s)},setElementOpacity:function(s,r,a){var l,c;s=$.getElement(s),a&&!$.Browser.alpha&&(r=Math.round(r)),$.Browser.opacity?s.style.opacity=r<1?r:"":r<1?(l=Math.round(100*r),c="alpha(opacity="+l+")",s.style.filter=c):s.style.filter=""},setElementTouchActionNone:function(s){s=$.getElement(s),typeof s.style.touchAction!="undefined"?s.style.touchAction="none":typeof s.style.msTouchAction!="undefined"&&(s.style.msTouchAction="none")},addClass:function(s,r){s=$.getElement(s),s.className?(" "+s.className+" ").indexOf(" "+r+" ")===-1&&(s.className+=" "+r):s.className=r},indexOf:function(s,r,a){return Array.prototype.indexOf?this.indexOf=function(l,c,u){return l.indexOf(c,u)}:this.indexOf=function(l,c,u){var g,v=u||0,C;if(!l)throw new TypeError;if(C=l.length,C===0||v>=C)return-1;for(v<0&&(v=C-Math.abs(v)),g=v;g<C;g++)if(l[g]===c)return g;return-1},this.indexOf(s,r,a)},removeClass:function(s,r){var a,l=[],c;for(s=$.getElement(s),a=s.className.split(/\s+/),c=0;c<a.length;c++)a[c]&&a[c]!==r&&l.push(a[c]);s.className=l.join(" ")},addEvent:function(){if(window.addEventListener)return function(s,r,a,l){s=$.getElement(s),s.addEventListener(r,a,l)};if(window.attachEvent)return function(s,r,a,l){s=$.getElement(s),s.attachEvent("on"+r,a)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(s,r,a,l){s=$.getElement(s),s.removeEventListener(r,a,l)};if(window.detachEvent)return function(s,r,a,l){s=$.getElement(s),s.detachEvent("on"+r,a)};throw new Error("No known event model.")}(),cancelEvent:function(s){s=$.getEvent(s),s.preventDefault?$.cancelEvent=function(r){r.preventDefault()}:$.cancelEvent=function(r){r=$.getEvent(r),r.cancel=!0,r.returnValue=!1},$.cancelEvent(s)},stopEvent:function(s){s=$.getEvent(s),s.stopPropagation?$.stopEvent=function(r){r.stopPropagation()}:$.stopEvent=function(r){r=$.getEvent(r),r.cancelBubble=!0},$.stopEvent(s)},createCallback:function(s,r){var a=[],l;for(l=2;l<arguments.length;l++)a.push(arguments[l]);return function(){var c=a.concat([]),u;for(u=0;u<arguments.length;u++)c.push(arguments[u]);return r.apply(s,c)}},getUrlParameter:function(s){var r=URLPARAMS[s];return r||null},getUrlProtocol:function(s){var r=s.match(/^([a-z]+:)\/\//i);return r===null?window.location.protocol:r[1].toLowerCase()},createAjaxRequest:function(s){var r;try{r=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{r=!1}if(r)window.XMLHttpRequest?$.createAjaxRequest=function(a){return a?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(s)},makeAjaxRequest:function(s,r,a){var l,c,u;$.isPlainObject(s)&&(r=s.success,a=s.error,l=s.withCredentials,c=s.headers,u=s.responseType||null,s=s.url);var g=$.getUrlProtocol(s),v=$.createAjaxRequest(g==="file:");if(!$.isFunction(r))throw new Error("makeAjaxRequest requires a success callback");v.onreadystatechange=function(){v.readyState==4&&(v.onreadystatechange=function(){},v.status>=200&&v.status<300||v.status===0&&g!=="http:"&&g!=="https:"?r(v):($.console.log("AJAX request returned %d: %s",v.status,s),$.isFunction(a)&&a(v)))};try{if(v.open("GET",s,!0),u&&(v.responseType=u),c)for(var C in c)Object.prototype.hasOwnProperty.call(c,C)&&c[C]&&v.setRequestHeader(C,c[C]);l&&(v.withCredentials=!0),v.send(null)}catch(V){var R=V.message,I=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(I&&typeof V.number!="undefined"&&V.number==-2147024891&&(R+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",V.name,R),v.onreadystatechange=function(){},window.XDomainRequest){var L=new window.XDomainRequest;if(L){L.onload=function(j){$.isFunction(r)&&r({responseText:L.responseText,status:200,statusText:"OK"})},L.onerror=function(j){$.isFunction(a)&&a({responseText:L.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{L.open("GET",s),L.send()}catch{$.isFunction(a)&&a(v,V)}}}else $.isFunction(a)&&a(v,V)}return v},jsonp:function(s){var r,a=s.url,l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,c=s.callbackName||"openseadragon"+$.now(),u=window[c],g="$1"+c+"$2",v=s.param||"callback",C=s.callback;a=a.replace(/(\=)\?(&|$)|\?\?/i,g),a+=(/\?/.test(a)?"&":"?")+v+"="+c,window[c]=function(R){if(u)window[c]=u;else try{delete window[c]}catch{}C&&$.isFunction(C)&&C(R)},r=document.createElement("script"),(s.async!==void 0||s.async!==!1)&&(r.async="async"),s.scriptCharset&&(r.charset=s.scriptCharset),r.src=a,r.onload=r.onreadystatechange=function(R,I){(I||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,l&&r.parentNode&&l.removeChild(r),r=void 0)},l.insertBefore(r,l.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(s){if(window.DOMParser)$.parseXml=function(r){var a=null,l;return l=new DOMParser,a=l.parseFromString(r,"text/xml"),a};else if(window.ActiveXObject)$.parseXml=function(r){var a=null;return a=new ActiveXObject("Microsoft.XMLDOM"),a.async=!1,a.loadXML(r),a};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(s)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(s){return s=s||"",!!FILEFORMATS[s.toLowerCase()]}});var nullfunction=function(s){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var s=navigator.appVersion,r=navigator.userAgent,a;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(r.substring(r.indexOf("MSIE")+5,r.indexOf(";",r.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(r.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(r.substring(r.indexOf("Firefox")+8))):r.indexOf("Safari")>=0?($.Browser.vendor=r.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(r.substring(r.substring(0,r.indexOf("Safari")).lastIndexOf("/")+1,r.indexOf("Safari")))):(a=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),a.exec(r)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(s);break}var l=window.location.search.substring(1),c=l.split("&"),u,g,v;for(v=0;v<c.length;v++)if(u=c[v],g=u.indexOf("="),g>0){var C=u.substring(0,g),R=u.substring(g+1);try{URLPARAMS[C]=decodeURIComponent(R)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",C,R)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(s){var r=s.requestAnimationFrame||s.mozRequestAnimationFrame||s.webkitRequestAnimationFrame||s.msRequestAnimationFrame,a=s.cancelAnimationFrame||s.mozCancelAnimationFrame||s.webkitCancelAnimationFrame||s.msCancelAnimationFrame;if(r&&a)$.requestAnimationFrame=function(){return r.apply(s,arguments)},$.cancelAnimationFrame=function(){return a.apply(s,arguments)};else{var l=[],c=[],u=0,g;$.requestAnimationFrame=function(v){return l.push([++u,v]),g||(g=setInterval(function(){if(l.length){var C=$.now(),R=c;for(c=l,l=R;c.length;)c.shift()[1](C)}else clearInterval(g),g=void 0},1e3/50)),u},$.cancelAnimationFrame=function(v){var C,R;for(C=0,R=l.length;C<R;C+=1)if(l[C][0]===v){l.splice(C,1);return}for(C=0,R=c.length;C<R;C+=1)if(c[C][0]===v){c.splice(C,1);return}}}}(window);function getOffsetParent(s,r){return r&&s!=document.body?document.body:s.offsetParent}}(OpenSeadragon),function(s,r){typeof define=="function"&&define.amd?define([],r):typeof module=="object"&&module.exports?module.exports=r():s.OpenSeadragon=r()}(exports,function(){return OpenSeadragon}),function(s){var r={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.fullscreenElement},r.requestFullScreen=function(a){return a.requestFullscreen()},r.exitFullScreen=function(){document.exitFullscreen()},r.fullScreenEventName="fullscreenchange",r.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.msFullscreenElement},r.requestFullScreen=function(a){return a.msRequestFullscreen()},r.exitFullScreen=function(){document.msExitFullscreen()},r.fullScreenEventName="MSFullscreenChange",r.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.webkitFullscreenElement},r.requestFullScreen=function(a){return a.webkitRequestFullscreen()},r.exitFullScreen=function(){document.webkitExitFullscreen()},r.fullScreenEventName="webkitfullscreenchange",r.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},r.requestFullScreen=function(a){return a.webkitRequestFullScreen()},r.exitFullScreen=function(){document.webkitCancelFullScreen()},r.fullScreenEventName="webkitfullscreenchange",r.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.mozFullScreenElement},r.requestFullScreen=function(a){return a.mozRequestFullScreen()},r.exitFullScreen=function(){document.mozCancelFullScreen()},r.fullScreenEventName="mozfullscreenchange",r.fullScreenErrorEventName="mozfullscreenerror"),r.isFullScreen=function(){return r.getFullScreenElement()!==null},r.cancelFullScreen=function(){s.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),r.exitFullScreen()},s.extend(s,r)}(OpenSeadragon),function(s){s.EventSource=function(){this.events={}},s.EventSource.prototype={addOnceHandler:function(r,a,l,c){var u=this;c=c||1;var g=0,v=function(C){g++,g===c&&u.removeHandler(r,v),a(C)};this.addHandler(r,v,l)},addHandler:function(r,a,l){var c=this.events[r];c||(this.events[r]=c=[]),a&&s.isFunction(a)&&(c[c.length]={handler:a,userData:l||null})},removeHandler:function(r,a){var l=this.events[r],c=[],u;if(!!l&&s.isArray(l)){for(u=0;u<l.length;u++)l[u].handler!==a&&c.push(l[u]);this.events[r]=c}},removeAllHandlers:function(r){if(r)this.events[r]=[];else for(var a in this.events)this.events[a]=[]},getHandler:function(r){var a=this.events[r];return!a||!a.length?null:(a=a.length===1?[a[0]]:Array.apply(null,a),function(l,c){var u,g=a.length;for(u=0;u<g;u++)a[u]&&(c.eventSource=l,c.userData=a[u].userData,a[u].handler(c))})},raiseEvent:function(r,a){var l=this.getHandler(r);l&&(a||(a={}),l(this,a))}}}(OpenSeadragon),function(s){var r=[],a={};s.MouseTracker=function(b){r.push(this);var y=arguments;s.isPlainObject(b)||(b={element:y[0],clickTimeThreshold:y[1],clickDistThreshold:y[2]}),this.hash=Math.random(),this.element=s.getElement(b.element),this.clickTimeThreshold=b.clickTimeThreshold||s.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=b.clickDistThreshold||s.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=b.dblClickTimeThreshold||s.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=b.dblClickDistThreshold||s.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=b.userData||null,this.stopDelay=b.stopDelay||50,this.enterHandler=b.enterHandler||null,this.exitHandler=b.exitHandler||null,this.pressHandler=b.pressHandler||null,this.nonPrimaryPressHandler=b.nonPrimaryPressHandler||null,this.releaseHandler=b.releaseHandler||null,this.nonPrimaryReleaseHandler=b.nonPrimaryReleaseHandler||null,this.moveHandler=b.moveHandler||null,this.scrollHandler=b.scrollHandler||null,this.clickHandler=b.clickHandler||null,this.dblClickHandler=b.dblClickHandler||null,this.dragHandler=b.dragHandler||null,this.dragEndHandler=b.dragEndHandler||null,this.pinchHandler=b.pinchHandler||null,this.stopHandler=b.stopHandler||null,this.keyDownHandler=b.keyDownHandler||null,this.keyUpHandler=b.keyUpHandler||null,this.keyHandler=b.keyHandler||null,this.focusHandler=b.focusHandler||null,this.blurHandler=b.blurHandler||null;var A=this;a[this.hash]={click:function(B){q(A,B)},dblclick:function(B){ae(A,B)},keydown:function(B){E(A,B)},keyup:function(B){M(A,B)},keypress:function(B){U(A,B)},focus:function(B){W(A,B)},blur:function(B){X(A,B)},wheel:function(B){Y(A,B)},mousewheel:function(B){he(A,B)},DOMMouseScroll:function(B){he(A,B)},MozMousePixelScroll:function(B){he(A,B)},mouseenter:function(B){Re(A,B)},mouseleave:function(B){ye(A,B)},mouseover:function(B){de(A,B)},mouseout:function(B){Fe(A,B)},mousedown:function(B){We(A,B)},mouseup:function(B){ge(A,B)},mouseupcaptured:function(B){Ye(A,B)},mousemove:function(B){ht(A,B)},mousemovecaptured:function(B){it(A,B)},touchstart:function(B){ct(A,B)},touchend:function(B){ut(A,B)},touchendcaptured:function(B){dt(A,B)},touchmove:function(B){pt(A,B)},touchmovecaptured:function(B){St(A,B)},touchcancel:function(B){It(A,B)},gesturestart:function(B){Ot(A,B)},gesturechange:function(B){w(A,B)},pointerover:function(B){O(A,B)},MSPointerOver:function(B){O(A,B)},pointerout:function(B){Z(A,B)},MSPointerOut:function(B){Z(A,B)},pointerdown:function(B){K(A,B)},MSPointerDown:function(B){K(A,B)},pointerup:function(B){Q(A,B)},MSPointerUp:function(B){Q(A,B)},pointermove:function(B){Me(A,B)},MSPointerMove:function(B){Me(A,B)},pointercancel:function(B){be(A,B)},MSPointerCancel:function(B){be(A,B)},pointerupcaptured:function(B){Ie(A,B)},pointermovecaptured:function(B){je(A,B)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},b.startDisabled||this.setTracking(!0)},s.MouseTracker.prototype={destroy:function(){var b;for(u(this),this.element=null,b=0;b<r.length;b++)if(r[b]===this){r.splice(b,1);break}a[this.hash]=null,delete a[this.hash]},isTracking:function(){return a[this.hash].tracking},setTracking:function(b){return b?c(this):u(this),this},getActivePointersListsExceptType:function(b){for(var y=a[this.hash],A=[],B=0;B<y.activePointersLists.length;++B)y.activePointersLists[B].type!==b&&A.push(y.activePointersLists[B]);return A},getActivePointersListByType:function(b){var y=a[this.hash],A,B=y.activePointersLists.length,J;for(A=0;A<B;A++)if(y.activePointersLists[A].type===b)return y.activePointersLists[A];return J=new s.MouseTracker.GesturePointList(b),y.activePointersLists.push(J),J},getActivePointerCount:function(){var b=a[this.hash],y,A=b.activePointersLists.length,B=0;for(y=0;y<A;y++)B+=b.activePointersLists[y].getLength();return B},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},s.MouseTracker.resetAllMouseTrackers=function(){for(var b=0;b<r.length;b++)r[b].isTracking()&&(r[b].setTracking(!1),r[b].setTracking(!0))},s.MouseTracker.gesturePointVelocityTracker=function(){var b=[],y=0,A=0,B=function(re,xe){return re.hash.toString()+xe.type+xe.id.toString()},J=function(){var re,xe=b.length,Oe,De,Ze=s.now(),Ce,ot,st;for(Ce=Ze-A,A=Ze,re=0;re<xe;re++)Oe=b[re],De=Oe.gPoint,De.direction=Math.atan2(De.currentPos.y-Oe.lastPos.y,De.currentPos.x-Oe.lastPos.x),ot=Oe.lastPos.distanceTo(De.currentPos),Oe.lastPos=De.currentPos,st=1e3*ot/(Ce+1),De.speed=.75*st+.25*De.speed},ue=function(re,xe){var Oe=B(re,xe);b.push({guid:Oe,gPoint:xe,lastPos:xe.currentPos}),b.length===1&&(A=s.now(),y=window.setInterval(J,50))},le=function(re,xe){var Oe=B(re,xe),De,Ze=b.length;for(De=0;De<Ze;De++)if(b[De].guid===Oe){b.splice(De,1),Ze--,Ze===0&&window.clearInterval(y);break}};return{addPoint:ue,removePoint:le}}(),s.MouseTracker.captureElement=document,s.MouseTracker.wheelEventName=s.Browser.vendor==s.BROWSERS.IE&&s.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",s.MouseTracker.supportsMouseCapture=function(){var b=document.createElement("div");return s.isFunction(b.setCapture)&&s.isFunction(b.releaseCapture)}(),s.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",s.MouseTracker.wheelEventName],s.MouseTracker.wheelEventName=="DOMMouseScroll"&&s.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||s.Browser.vendor!==s.BROWSERS.IE)?(s.MouseTracker.havePointerEvents=!0,s.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),s.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?s.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:s.MouseTracker.maxTouchPoints=0,s.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(s.MouseTracker.havePointerEvents=!0,s.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),s.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?s.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:s.MouseTracker.maxTouchPoints=0,s.MouseTracker.haveMouseEnter=!1):(s.MouseTracker.havePointerEvents=!1,s.Browser.vendor===s.BROWSERS.IE&&s.Browser.version<9?(s.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),s.MouseTracker.haveMouseEnter=!0):(s.MouseTracker.subscribeEvents.push("mouseover","mouseout"),s.MouseTracker.haveMouseEnter=!1),s.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&s.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&s.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),s.MouseTracker.mousePointerId="legacy-mouse",s.MouseTracker.maxTouchPoints=10),s.MouseTracker.GesturePointList=function(b){this._gPoints=[],this.type=b,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},s.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(b){return this._gPoints.push(b)},removeById:function(b){var y,A=this._gPoints.length;for(y=0;y<A;y++)if(this._gPoints[y].id===b){this._gPoints.splice(y,1);break}return this._gPoints.length},getByIndex:function(b){return b<this._gPoints.length?this._gPoints[b]:null},getById:function(b){var y,A=this._gPoints.length;for(y=0;y<A;y++)if(this._gPoints[y].id===b)return this._gPoints[y];return null},getPrimary:function(b){var y,A=this._gPoints.length;for(y=0;y<A;y++)if(this._gPoints[y].isPrimary)return this._gPoints[y];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function l(b){var y=a[b.hash],A,B=y.activePointersLists.length;for(A=0;A<B;A++)y.activePointersLists[A].captureCount>0&&(s.removeEvent(s.MouseTracker.captureElement,"mousemove",y.mousemovecaptured,!0),s.removeEvent(s.MouseTracker.captureElement,"mouseup",y.mouseupcaptured,!0),s.removeEvent(s.MouseTracker.captureElement,s.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",y.pointermovecaptured,!0),s.removeEvent(s.MouseTracker.captureElement,s.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",y.pointerupcaptured,!0),s.removeEvent(s.MouseTracker.captureElement,"touchmove",y.touchmovecaptured,!0),s.removeEvent(s.MouseTracker.captureElement,"touchend",y.touchendcaptured,!0),y.activePointersLists[A].captureCount=0);for(A=0;A<B;A++)y.activePointersLists.pop()}function c(b){var y=a[b.hash],A,B;if(!y.tracking){for(B=0;B<s.MouseTracker.subscribeEvents.length;B++)A=s.MouseTracker.subscribeEvents[B],s.addEvent(b.element,A,y[A],!1);l(b),y.tracking=!0}}function u(b){var y=a[b.hash],A,B;if(y.tracking){for(B=0;B<s.MouseTracker.subscribeEvents.length;B++)A=s.MouseTracker.subscribeEvents[B],s.removeEvent(b.element,A,y[A],!1);l(b),y.tracking=!1}}function g(b,y){var A=a[b.hash];if(y==="pointerevent")return{upName:s.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:A.pointerupcaptured,moveName:s.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:A.pointermovecaptured};if(y==="mouse")return{upName:"mouseup",upHandler:A.mouseupcaptured,moveName:"mousemove",moveHandler:A.mousemovecaptured};if(y==="touch")return{upName:"touchend",upHandler:A.touchendcaptured,moveName:"touchmove",moveHandler:A.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function v(b,y,A){var B=b.getActivePointersListByType(y),J;B.captureCount+=A||1,B.captureCount===1&&(s.Browser.vendor===s.BROWSERS.IE&&s.Browser.version<9?b.element.setCapture(!0):(J=g(b,s.MouseTracker.havePointerEvents?"pointerevent":y),Ht&&Lt(window.top)&&s.addEvent(window.top,J.upName,J.upHandler,!0),s.addEvent(s.MouseTracker.captureElement,J.upName,J.upHandler,!0),s.addEvent(s.MouseTracker.captureElement,J.moveName,J.moveHandler,!0)))}function C(b,y,A){var B=b.getActivePointersListByType(y),J;B.captureCount-=A||1,B.captureCount===0&&(s.Browser.vendor===s.BROWSERS.IE&&s.Browser.version<9?b.element.releaseCapture():(J=g(b,s.MouseTracker.havePointerEvents?"pointerevent":y),Ht&&Lt(window.top)&&s.removeEvent(window.top,J.upName,J.upHandler,!0),s.removeEvent(s.MouseTracker.captureElement,J.moveName,J.moveHandler,!0),s.removeEvent(s.MouseTracker.captureElement,J.upName,J.upHandler,!0)))}function R(b){var y;if(s.MouseTracker.unprefixedPointerEvents)y=b.pointerType;else switch(b.pointerType){case 2:y="touch";break;case 3:y="pen";break;case 4:y="mouse";break;default:y=""}return y}function I(b){return s.getMousePosition(b)}function L(b,y){return V(I(b),y)}function V(b,y){var A=s.getElementOffset(y);return b.minus(A)}function j(b,y){return new s.Point((b.x+y.x)/2,(b.y+y.y)/2)}function q(b,y){b.clickHandler&&s.cancelEvent(y)}function ae(b,y){b.dblClickHandler&&s.cancelEvent(y)}function E(b,y){var A;b.keyDownHandler&&(y=s.getEvent(y),A=b.keyDownHandler({eventSource:b,keyCode:y.keyCode?y.keyCode:y.charCode,ctrl:y.ctrlKey,shift:y.shiftKey,alt:y.altKey,meta:y.metaKey,originalEvent:y,preventDefaultAction:!1,userData:b.userData}),A||s.cancelEvent(y))}function M(b,y){var A;b.keyUpHandler&&(y=s.getEvent(y),A=b.keyUpHandler({eventSource:b,keyCode:y.keyCode?y.keyCode:y.charCode,ctrl:y.ctrlKey,shift:y.shiftKey,alt:y.altKey,meta:y.metaKey,originalEvent:y,preventDefaultAction:!1,userData:b.userData}),A||s.cancelEvent(y))}function U(b,y){var A;b.keyHandler&&(y=s.getEvent(y),A=b.keyHandler({eventSource:b,keyCode:y.keyCode?y.keyCode:y.charCode,ctrl:y.ctrlKey,shift:y.shiftKey,alt:y.altKey,meta:y.metaKey,originalEvent:y,preventDefaultAction:!1,userData:b.userData}),A||s.cancelEvent(y))}function W(b,y){var A;b.focusHandler&&(y=s.getEvent(y),A=b.focusHandler({eventSource:b,originalEvent:y,preventDefaultAction:!1,userData:b.userData}),A===!1&&s.cancelEvent(y))}function X(b,y){var A;b.blurHandler&&(y=s.getEvent(y),A=b.blurHandler({eventSource:b,originalEvent:y,preventDefaultAction:!1,userData:b.userData}),A===!1&&s.cancelEvent(y))}function Y(b,y){ie(b,y,y)}function he(b,y){y=s.getEvent(y);var A={target:y.target||y.srcElement,type:"wheel",shiftKey:y.shiftKey||!1,clientX:y.clientX,clientY:y.clientY,pageX:y.pageX?y.pageX:y.clientX,pageY:y.pageY?y.pageY:y.clientY,deltaMode:y.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};s.MouseTracker.wheelEventName=="mousewheel"?A.deltaY=-y.wheelDelta/s.DEFAULT_SETTINGS.pixelsPerWheelLine:A.deltaY=y.detail,ie(b,A,y)}function ie(b,y,A){var B=0,J;B=y.deltaY<0?1:-1,b.scrollHandler&&(J=b.scrollHandler({eventSource:b,pointerType:"mouse",position:L(y,b.element),scroll:B,shift:y.shiftKey,isTouchEvent:!1,originalEvent:A,preventDefaultAction:!1,userData:b.userData}),J===!1&&s.cancelEvent(A))}function we(b,y){if(b===y)return!1;for(;y&&y!==b;)y=y.parentNode;return y===b}function Re(b,y){y=s.getEvent(y),He(b,y)}function de(b,y){y=s.getEvent(y),!(y.currentTarget===y.relatedTarget||we(y.currentTarget,y.relatedTarget))&&He(b,y)}function He(b,y){var A={id:s.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:I(y),currentTime:s.now()};Je(b,y,[A])}function ye(b,y){y=s.getEvent(y),ze(b,y)}function Fe(b,y){y=s.getEvent(y),!(y.currentTarget===y.relatedTarget||we(y.currentTarget,y.relatedTarget))&&ze(b,y)}function ze(b,y){var A={id:s.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:I(y),currentTime:s.now()};Qe(b,y,[A])}function qe(b){return s.Browser.vendor===s.BROWSERS.IE&&s.Browser.version<9?b===1?0:b===2?2:b===4?1:-1:b}function We(b,y){var A;y=s.getEvent(y),A={id:s.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:I(y),currentTime:s.now()},At(b,y,[A],qe(y.button))&&(s.stopEvent(y),v(b,"mouse")),(b.clickHandler||b.dblClickHandler||b.pressHandler||b.dragHandler||b.dragEndHandler)&&s.cancelEvent(y)}function ge(b,y){et(b,y)}function Ye(b,y){et(b,y),s.stopEvent(y)}function et(b,y){var A;y=s.getEvent(y),A={id:s.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:I(y),currentTime:s.now()},nt(b,y,[A],qe(y.button))&&C(b,"mouse")}function ht(b,y){rt(b,y)}function it(b,y){rt(b,y),s.stopEvent(y)}function rt(b,y){var A;y=s.getEvent(y),A={id:s.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:I(y),currentTime:s.now()},Bt(b,y,[A])}function tt(b,y,A){var B,J=A.getLength(),ue=[];if(A.type==="touch"||A.contacts>0){for(B=0;B<J;B++)ue.push(A.getByIndex(B));ue.length>0&&(nt(b,y,ue,0),A.captureCount=1,C(b,A.type),Qe(b,y,ue))}}function ct(b,y){var A,B,J,ue=y.changedTouches.length,le=[],re,xe=b.getActivePointersListByType("touch");for(A=s.now(),xe.getLength()>y.touches.length-ue&&(s.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),tt(b,y,xe)),B=0;B<ue;B++)le.push({id:y.changedTouches[B].identifier,type:"touch",currentPos:I(y.changedTouches[B]),currentTime:A});for(Je(b,y,le),B=0;B<r.length;B++)if(r[B]!==b&&r[B].isTracking()&&we(r[B].element,b.element)){for(re=[],J=0;J<ue;J++)re.push({id:y.changedTouches[J].identifier,type:"touch",currentPos:I(y.changedTouches[J]),currentTime:A});Je(r[B],y,re)}At(b,y,le,0)&&(s.stopEvent(y),v(b,"touch",ue)),s.cancelEvent(y)}function ut(b,y){at(b,y)}function dt(b,y){at(b,y),s.stopEvent(y)}function at(b,y){var A,B,J,ue=y.changedTouches.length,le=[],re;for(A=s.now(),B=0;B<ue;B++)le.push({id:y.changedTouches[B].identifier,type:"touch",currentPos:I(y.changedTouches[B]),currentTime:A});for(nt(b,y,le,0)&&C(b,"touch",ue),Qe(b,y,le),B=0;B<r.length;B++)if(r[B]!==b&&r[B].isTracking()&&we(r[B].element,b.element)){for(re=[],J=0;J<ue;J++)re.push({id:y.changedTouches[J].identifier,type:"touch",currentPos:I(y.changedTouches[J]),currentTime:A});Qe(r[B],y,re)}s.cancelEvent(y)}function pt(b,y){lt(b,y)}function St(b,y){lt(b,y),s.stopEvent(y)}function lt(b,y){var A,B=y.changedTouches.length,J=[];for(A=0;A<B;A++)J.push({id:y.changedTouches[A].identifier,type:"touch",currentPos:I(y.changedTouches[A]),currentTime:s.now()});Bt(b,y,J),s.cancelEvent(y)}function It(b,y){var A=b.getActivePointersListByType("touch");tt(b,y,A)}function Ot(b,y){return y.stopPropagation(),y.preventDefault(),!1}function w(b,y){return y.stopPropagation(),y.preventDefault(),!1}function O(b,y){var A;y.currentTarget===y.relatedTarget||we(y.currentTarget,y.relatedTarget)||(A={id:y.pointerId,type:R(y),isPrimary:y.isPrimary,currentPos:I(y),currentTime:s.now()},Je(b,y,[A]))}function Z(b,y){var A;y.currentTarget===y.relatedTarget||we(y.currentTarget,y.relatedTarget)||(A={id:y.pointerId,type:R(y),isPrimary:y.isPrimary,currentPos:I(y),currentTime:s.now()},Qe(b,y,[A]))}function K(b,y){var A;A={id:y.pointerId,type:R(y),isPrimary:y.isPrimary,currentPos:I(y),currentTime:s.now()},At(b,y,[A],y.button)&&(s.stopEvent(y),v(b,A.type)),(b.clickHandler||b.dblClickHandler||b.pressHandler||b.dragHandler||b.dragEndHandler||b.pinchHandler)&&s.cancelEvent(y)}function Q(b,y){ce(b,y)}function Ie(b,y){var A=b.getActivePointersListByType(R(y));A.getById(y.pointerId)&&ce(b,y),s.stopEvent(y)}function ce(b,y){var A;A={id:y.pointerId,type:R(y),isPrimary:y.isPrimary,currentPos:I(y),currentTime:s.now()},nt(b,y,[A],y.button)&&C(b,A.type)}function Me(b,y){ke(b,y)}function je(b,y){var A=b.getActivePointersListByType(R(y));A.getById(y.pointerId)&&ke(b,y),s.stopEvent(y)}function ke(b,y){var A;A={id:y.pointerId,type:R(y),isPrimary:y.isPrimary,currentPos:I(y),currentTime:s.now()},Bt(b,y,[A])}function be(b,y){var A;A={id:y.pointerId,type:R(y)},Dt(b,y,[A])}function Xe(b,y){return Object.prototype.hasOwnProperty.call(y,"isPrimary")||(b.getLength()===0?y.isPrimary=!0:y.isPrimary=!1),y.speed=0,y.direction=0,y.contactPos=y.currentPos,y.contactTime=y.currentTime,y.lastPos=y.currentPos,y.lastTime=y.currentTime,b.add(y)}function $e(b,y){var A,B;return b.getById(y.id)?(A=b.removeById(y.id),Object.prototype.hasOwnProperty.call(y,"isPrimary")||(B=b.getPrimary(),B||(B=b.getByIndex(0),B&&(B.isPrimary=!0)))):A=b.getLength(),A}function Je(b,y,A){var B=b.getActivePointersListByType(A[0].type),J,ue=A.length,le,re,xe;for(J=0;J<ue;J++)le=A[J],re=B.getById(le.id),re?(re.insideElement=!0,re.lastPos=re.currentPos,re.lastTime=re.currentTime,re.currentPos=le.currentPos,re.currentTime=le.currentTime,le=re):(le.captured=!1,le.insideElementPressed=!1,le.insideElement=!0,Xe(B,le)),b.enterHandler&&(xe=b.enterHandler({eventSource:b,pointerType:le.type,position:V(le.currentPos,b.element),buttons:B.buttons,pointers:b.getActivePointerCount(),insideElementPressed:le.insideElementPressed,buttonDownAny:B.buttons!==0,isTouchEvent:le.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),xe===!1&&s.cancelEvent(y))}function Qe(b,y,A){var B=b.getActivePointersListByType(A[0].type),J,ue=A.length,le,re,xe;for(J=0;J<ue;J++)le=A[J],re=B.getById(le.id),re&&(re.captured?(re.insideElement=!1,re.lastPos=re.currentPos,re.lastTime=re.currentTime,re.currentPos=le.currentPos,re.currentTime=le.currentTime):$e(B,re),le=re),b.exitHandler&&(xe=b.exitHandler({eventSource:b,pointerType:le.type,position:le.currentPos&&V(le.currentPos,b.element),buttons:B.buttons,pointers:b.getActivePointerCount(),insideElementPressed:re?re.insideElementPressed:!1,buttonDownAny:B.buttons!==0,isTouchEvent:le.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),xe===!1&&s.cancelEvent(y))}function At(b,y,A,B){var J=a[b.hash],ue,le=b.getActivePointersListByType(A[0].type),re,xe=A.length,Oe,De;typeof y.buttons!="undefined"?le.buttons=y.buttons:s.Browser.vendor===s.BROWSERS.IE&&s.Browser.version<9?B===0?le.buttons+=1:B===1?le.buttons+=4:B===2?le.buttons+=2:B===3?le.buttons+=8:B===4?le.buttons+=16:B===5&&(le.buttons+=32):B===0?le.buttons|=1:B===1?le.buttons|=4:B===2?le.buttons|=2:B===3?le.buttons|=8:B===4?le.buttons|=16:B===5&&(le.buttons|=32);var Ze=b.getActivePointersListsExceptType(A[0].type);for(re=0;re<Ze.length;re++)tt(b,y,Ze[re]);if(B!==0)return b.nonPrimaryPressHandler&&(ue=b.nonPrimaryPressHandler({eventSource:b,pointerType:A[0].type,position:V(A[0].currentPos,b.element),button:B,buttons:le.buttons,isTouchEvent:A[0].type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),ue===!1&&s.cancelEvent(y)),!1;for(re=0;re<xe;re++)Oe=A[re],De=le.getById(Oe.id),De?(De.captured=!0,De.insideElementPressed=!0,De.insideElement=!0,De.contactPos=Oe.currentPos,De.contactTime=Oe.currentTime,De.lastPos=De.currentPos,De.lastTime=De.currentTime,De.currentPos=Oe.currentPos,De.currentTime=Oe.currentTime,Oe=De):(Oe.captured=!0,Oe.insideElementPressed=!0,Oe.insideElement=!0,Xe(le,Oe)),le.addContact(),(b.dragHandler||b.dragEndHandler||b.pinchHandler)&&s.MouseTracker.gesturePointVelocityTracker.addPoint(b,Oe),le.contacts===1?b.pressHandler&&(ue=b.pressHandler({eventSource:b,pointerType:Oe.type,position:V(Oe.contactPos,b.element),buttons:le.buttons,isTouchEvent:Oe.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),ue===!1&&s.cancelEvent(y)):le.contacts===2&&b.pinchHandler&&Oe.type==="touch"&&(J.pinchGPoints=le.asArray(),J.lastPinchDist=J.currentPinchDist=J.pinchGPoints[0].currentPos.distanceTo(J.pinchGPoints[1].currentPos),J.lastPinchCenter=J.currentPinchCenter=j(J.pinchGPoints[0].currentPos,J.pinchGPoints[1].currentPos));return!0}function nt(b,y,A,B){var J=a[b.hash],ue=b.getActivePointersListByType(A[0].type),le,re,xe,Oe,De=A.length,Ze,Ce,ot=!1,st=!1,Nt;if(typeof y.buttons!="undefined"?ue.buttons=y.buttons:s.Browser.vendor===s.BROWSERS.IE&&s.Browser.version<9?B===0?ue.buttons-=1:B===1?ue.buttons-=4:B===2?ue.buttons-=2:B===3?ue.buttons-=8:B===4?ue.buttons-=16:B===5&&(ue.buttons-=32):B===0?ue.buttons^=-2:B===1?ue.buttons^=-5:B===2?ue.buttons^=-3:B===3?ue.buttons^=-9:B===4?ue.buttons^=-17:B===5&&(ue.buttons^=-33),B!==0){b.nonPrimaryReleaseHandler&&(le=b.nonPrimaryReleaseHandler({eventSource:b,pointerType:A[0].type,position:V(A[0].currentPos,b.element),button:B,buttons:ue.buttons,isTouchEvent:A[0].type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),le===!1&&s.cancelEvent(y));var Mt=b.getActivePointersListByType("mouse");return tt(b,y,Mt),!1}if(typeof A[0].currentPos=="undefined")return tt(b,y,ue),!1;for(Oe=0;Oe<De;Oe++)Ze=A[Oe],Ce=ue.getById(Ze.id),Ce&&(Ce.captured&&(Ce.captured=!1,ot=!0,st=!0),Ce.lastPos=Ce.currentPos,Ce.lastTime=Ce.currentTime,Ce.currentPos=Ze.currentPos,Ce.currentTime=Ze.currentTime,Ce.insideElement||$e(ue,Ce),re=Ce.currentPos,xe=Ce.currentTime,st?(ue.removeContact(),(b.dragHandler||b.dragEndHandler||b.pinchHandler)&&s.MouseTracker.gesturePointVelocityTracker.removePoint(b,Ce),ue.contacts===0?(b.releaseHandler&&(le=b.releaseHandler({eventSource:b,pointerType:Ce.type,position:V(re,b.element),buttons:ue.buttons,insideElementPressed:Ce.insideElementPressed,insideElementReleased:Ce.insideElement,isTouchEvent:Ce.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),le===!1&&s.cancelEvent(y)),b.dragEndHandler&&!Ce.currentPos.equals(Ce.contactPos)&&(le=b.dragEndHandler({eventSource:b,pointerType:Ce.type,position:V(Ce.currentPos,b.element),speed:Ce.speed,direction:Ce.direction,shift:y.shiftKey,isTouchEvent:Ce.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),le===!1&&s.cancelEvent(y)),(b.clickHandler||b.dblClickHandler)&&Ce.insideElement&&(Nt=xe-Ce.contactTime<=b.clickTimeThreshold&&Ce.contactPos.distanceTo(re)<=b.clickDistThreshold,b.clickHandler&&(le=b.clickHandler({eventSource:b,pointerType:Ce.type,position:V(Ce.currentPos,b.element),quick:Nt,shift:y.shiftKey,isTouchEvent:Ce.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),le===!1&&s.cancelEvent(y)),b.dblClickHandler&&Nt&&(ue.clicks++,ue.clicks===1?(J.lastClickPos=re,J.dblClickTimeOut=setTimeout(function(){ue.clicks=0},b.dblClickTimeThreshold)):ue.clicks===2&&(clearTimeout(J.dblClickTimeOut),ue.clicks=0,J.lastClickPos.distanceTo(re)<=b.dblClickDistThreshold&&(le=b.dblClickHandler({eventSource:b,pointerType:Ce.type,position:V(Ce.currentPos,b.element),shift:y.shiftKey,isTouchEvent:Ce.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),le===!1&&s.cancelEvent(y)),J.lastClickPos=null)))):ue.contacts===2&&b.pinchHandler&&Ce.type==="touch"&&(J.pinchGPoints=ue.asArray(),J.lastPinchDist=J.currentPinchDist=J.pinchGPoints[0].currentPos.distanceTo(J.pinchGPoints[1].currentPos),J.lastPinchCenter=J.currentPinchCenter=j(J.pinchGPoints[0].currentPos,J.pinchGPoints[1].currentPos))):b.releaseHandler&&(le=b.releaseHandler({eventSource:b,pointerType:Ce.type,position:V(re,b.element),buttons:ue.buttons,insideElementPressed:Ce.insideElementPressed,insideElementReleased:Ce.insideElement,isTouchEvent:Ce.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),le===!1&&s.cancelEvent(y)));return ot}function Bt(b,y,A){var B=a[b.hash],J=b.getActivePointersListByType(A[0].type),ue,le=A.length,re,xe,Oe,De,Ze;for(typeof y.buttons!="undefined"&&(J.buttons=y.buttons),ue=0;ue<le;ue++)re=A[ue],xe=J.getById(re.id),xe?(Object.prototype.hasOwnProperty.call(re,"isPrimary")&&(xe.isPrimary=re.isPrimary),xe.lastPos=xe.currentPos,xe.lastTime=xe.currentTime,xe.currentPos=re.currentPos,xe.currentTime=re.currentTime):(re.captured=!1,re.insideElementPressed=!1,re.insideElement=!0,Xe(J,re));b.stopHandler&&A[0].type==="mouse"&&(clearTimeout(b.stopTimeOut),b.stopTimeOut=setTimeout(function(){kt(b,y,A[0].type)},b.stopDelay)),J.contacts===0?b.moveHandler&&(Ze=b.moveHandler({eventSource:b,pointerType:A[0].type,position:V(A[0].currentPos,b.element),buttons:J.buttons,isTouchEvent:A[0].type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),Ze===!1&&s.cancelEvent(y)):J.contacts===1?(b.moveHandler&&(xe=J.asArray()[0],Ze=b.moveHandler({eventSource:b,pointerType:xe.type,position:V(xe.currentPos,b.element),buttons:J.buttons,isTouchEvent:xe.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),Ze===!1&&s.cancelEvent(y)),b.dragHandler&&(xe=J.asArray()[0],De=xe.currentPos.minus(xe.lastPos),Ze=b.dragHandler({eventSource:b,pointerType:xe.type,position:V(xe.currentPos,b.element),buttons:J.buttons,delta:De,speed:xe.speed,direction:xe.direction,shift:y.shiftKey,isTouchEvent:xe.type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),Ze===!1&&s.cancelEvent(y))):J.contacts===2&&(b.moveHandler&&(Oe=J.asArray(),Ze=b.moveHandler({eventSource:b,pointerType:Oe[0].type,position:V(j(Oe[0].currentPos,Oe[1].currentPos),b.element),buttons:J.buttons,isTouchEvent:Oe[0].type==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData}),Ze===!1&&s.cancelEvent(y)),b.pinchHandler&&A[0].type==="touch"&&(De=B.pinchGPoints[0].currentPos.distanceTo(B.pinchGPoints[1].currentPos),De!=B.currentPinchDist&&(B.lastPinchDist=B.currentPinchDist,B.currentPinchDist=De,B.lastPinchCenter=B.currentPinchCenter,B.currentPinchCenter=j(B.pinchGPoints[0].currentPos,B.pinchGPoints[1].currentPos),Ze=b.pinchHandler({eventSource:b,pointerType:"touch",gesturePoints:B.pinchGPoints,lastCenter:V(B.lastPinchCenter,b.element),center:V(B.currentPinchCenter,b.element),lastDistance:B.lastPinchDist,distance:B.currentPinchDist,shift:y.shiftKey,originalEvent:y,preventDefaultAction:!1,userData:b.userData}),Ze===!1&&s.cancelEvent(y))))}function Dt(b,y,A){nt(b,y,A,0),Qe(b,y,A)}function kt(b,y,A){b.stopHandler&&b.stopHandler({eventSource:b,pointerType:A,position:L(y,b.element),buttons:b.getActivePointersListByType(A).buttons,isTouchEvent:A==="touch",originalEvent:y,preventDefaultAction:!1,userData:b.userData})}var Ht=function(){try{return window.self!==window.top}catch{return!0}}();function Lt(b){try{return b.addEventListener&&b.removeEventListener}catch{return!1}}}(OpenSeadragon),function(s){s.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},s.Control=function(r,a,l){var c=r.parentNode;typeof a=="number"&&(s.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),a={anchor:a}),a.attachToViewer=typeof a.attachToViewer=="undefined"?!0:a.attachToViewer,this.autoFade=typeof a.autoFade=="undefined"?!0:a.autoFade,this.element=r,this.anchor=a.anchor,this.container=l,this.anchor==s.ControlAnchor.ABSOLUTE?(this.wrapper=s.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof a.top=="number"?a.top+"px":a.top,this.wrapper.style.left=typeof a.left=="number"?a.left+"px":a.left,this.wrapper.style.height=typeof a.height=="number"?a.height+"px":a.height,this.wrapper.style.width=typeof a.width=="number"?a.width+"px":a.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=s.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==s.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),a.attachToViewer?this.anchor==s.ControlAnchor.TOP_RIGHT||this.anchor==s.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):c.appendChild(this.wrapper)},s.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(r){this.wrapper.style.display=r?this.anchor==s.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(r){this.element[s.SIGNAL]&&s.Browser.vendor==s.BROWSERS.IE?s.setElementOpacity(this.element,r,!0):s.setElementOpacity(this.wrapper,r,!0)}}}(OpenSeadragon),function(s){s.ControlDock=function(a){var l=["topleft","topright","bottomright","bottomleft"],c,u;for(s.extend(!0,this,{id:"controldock-"+s.now()+"-"+Math.floor(Math.random()*1e6),container:s.makeNeutralElement("div"),controls:[]},a),this.container.onsubmit=function(){return!1},this.element&&(this.element=s.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),u=0;u<l.length;u++)c=l[u],this.controls[c]=s.makeNeutralElement("div"),this.controls[c].style.position="absolute",c.match("left")&&(this.controls[c].style.left="0px"),c.match("right")&&(this.controls[c].style.right="0px"),c.match("top")&&(this.controls[c].style.top="0px"),c.match("bottom")&&(this.controls[c].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},s.ControlDock.prototype={addControl:function(a,l){a=s.getElement(a);var c=null;if(!(r(this,a)>=0)){switch(l.anchor){case s.ControlAnchor.TOP_RIGHT:c=this.controls.topright,a.style.position="relative",a.style.paddingRight="0px",a.style.paddingTop="0px";break;case s.ControlAnchor.BOTTOM_RIGHT:c=this.controls.bottomright,a.style.position="relative",a.style.paddingRight="0px",a.style.paddingBottom="0px";break;case s.ControlAnchor.BOTTOM_LEFT:c=this.controls.bottomleft,a.style.position="relative",a.style.paddingLeft="0px",a.style.paddingBottom="0px";break;case s.ControlAnchor.TOP_LEFT:c=this.controls.topleft,a.style.position="relative",a.style.paddingLeft="0px",a.style.paddingTop="0px";break;case s.ControlAnchor.ABSOLUTE:c=this.container,a.style.margin="0px",a.style.padding="0px";break;default:case s.ControlAnchor.NONE:c=this.container,a.style.margin="0px",a.style.padding="0px";break}this.controls.push(new s.Control(a,l,c)),a.style.display="inline-block"}},removeControl:function(a){a=s.getElement(a);var l=r(this,a);return l>=0&&(this.controls[l].destroy(),this.controls.splice(l,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var a;for(a=this.controls.length-1;a>=0;a--)if(this.controls[a].isVisible())return!0;return!1},setControlsEnabled:function(a){var l;for(l=this.controls.length-1;l>=0;l--)this.controls[l].setVisible(a);return this}};function r(a,l){var c=a.controls,u;for(u=c.length-1;u>=0;u--)if(c[u].element==l)return u;return-1}}(OpenSeadragon),function(s){s.Placement=s.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(s){var r={},a=1;s.Viewer=function(w){var O=arguments,Z=this,K;if(s.isPlainObject(w)||(w={id:O[0],xmlPath:O.length>1?O[1]:void 0,prefixUrl:O.length>2?O[2]:void 0,controls:O.length>3?O[3]:void 0,overlays:O.length>4?O[4]:void 0}),w.config&&(s.extend(!0,w,w.config),delete w.config),s.extend(!0,this,{id:w.id,hash:w.hash||a++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},s.DEFAULT_SETTINGS,w),typeof this.hash=="undefined")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof r[this.hash]!="undefined"&&s.console.warn("Hash "+this.hash+" has already been used."),r[this.hash]={fsBoundsDelta:new s.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=s.now(),s.EventSource.call(this),this.addHandler("open-failed",function(Q){var Ie=s.getString("Errors.OpenFailed",Q.eventSource,Q.message);Z._showMessage(Ie)}),s.ControlDock.call(this,w),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=s.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(Q){Q.width="100%",Q.height="100%",Q.overflow="hidden",Q.position="absolute",Q.top="0px",Q.left="0px"}(this.canvas.style),s.setElementTouchActionNone(this.canvas),w.tabIndex!==""&&(this.canvas.tabIndex=w.tabIndex===void 0?0:w.tabIndex),this.container.className="openseadragon-container",function(Q){Q.width="100%",Q.height="100%",Q.position="relative",Q.overflow="hidden",Q.left="0px",Q.top="0px",Q.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new s.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:s.delegate(this,q),keyHandler:s.delegate(this,ae),clickHandler:s.delegate(this,E),dblClickHandler:s.delegate(this,M),dragHandler:s.delegate(this,U),dragEndHandler:s.delegate(this,W),enterHandler:s.delegate(this,X),exitHandler:s.delegate(this,Y),pressHandler:s.delegate(this,he),releaseHandler:s.delegate(this,ie),nonPrimaryPressHandler:s.delegate(this,we),nonPrimaryReleaseHandler:s.delegate(this,Re),scrollHandler:s.delegate(this,He),pinchHandler:s.delegate(this,de)}),this.outerTracker=new s.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:s.delegate(this,ye),exitHandler:s.delegate(this,Fe)}),this.toolbar&&(this.toolbar=new s.ControlDock({element:this.toolbar})),this.bindStandardControls(),r[this.hash].prevContainerSize=l(this.container),this.world=new s.World({viewer:this}),this.world.addHandler("add-item",function(Q){Z.source=Z.world.getItemAt(0).source,r[Z.hash].forceRedraw=!0,Z._updateRequestId||(Z._updateRequestId=v(Z,ze))}),this.world.addHandler("remove-item",function(Q){Z.world.getItemCount()?Z.source=Z.world.getItemAt(0).source:Z.source=null,r[Z.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(Q){Z.viewport&&Z.viewport._setContentBounds(Z.world.getHomeBounds(),Z.world.getContentFactor())}),this.world.addHandler("item-index-change",function(Q){Z.source=Z.world.getItemAt(0).source}),this.viewport=new s.Viewport({containerSize:r[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new s.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:w.timeout}),this.tileCache=new s.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new s.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=s.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(K=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(K,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(K=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(K,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new s.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),K=0;K<this.customControls.length;K++)this.addControl(this.customControls[K].id,{anchor:this.customControls[K].anchor});s.requestAnimationFrame(function(){R(Z)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},s.extend(s.Viewer.prototype,s.EventSource.prototype,s.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(w){return s.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(w)},openTileSource:function(w){return s.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(w)},open:function(w,O){var Z=this;if(this.close(),!!w){if(this.sequenceMode&&s.isArray(w)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof O!="undefined"&&!isNaN(O)&&(this.initialPage=O),this.tileSources=w,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(s.isArray(w)||(w=[w]),!!w.length){this._opening=!0;for(var K=w.length,Q=0,Ie=0,ce,Me=function(){if(Q+Ie===K)if(Q){(Z._firstOpen||!Z.preserveViewport)&&(Z.viewport.goHome(!0),Z.viewport.update()),Z._firstOpen=!1;var be=w[0];if(be.tileSource&&(be=be.tileSource),Z.overlays&&!Z.preserveOverlays)for(var Xe=0;Xe<Z.overlays.length;Xe++)Z.currentOverlays[Xe]=u(Z,Z.overlays[Xe]);Z._drawOverlays(),Z._opening=!1,Z.raiseEvent("open",{source:be})}else Z._opening=!1,Z.raiseEvent("open-failed",ce)},je=function(be){(!s.isPlainObject(be)||!be.tileSource)&&(be={tileSource:be}),be.index!==void 0&&(s.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete be.index),be.collectionImmediately===void 0&&(be.collectionImmediately=!0);var Xe=be.success;be.success=function(Je){if(Q++,be.tileSource.overlays)for(var Qe=0;Qe<be.tileSource.overlays.length;Qe++)Z.addOverlay(be.tileSource.overlays[Qe]);Xe&&Xe(Je),Me()};var $e=be.error;be.error=function(Je){Ie++,ce||(ce=Je),$e&&$e(Je),Me()},Z.addTiledImage(be)},ke=0;ke<w.length;ke++)je(w[ke]);return this}}},close:function(){return r[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),r[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(r[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(s.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),r[this.hash]=null,delete r[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(w){return this.innerTracker.setTracking(w),this.outerTracker.setTracking(w),this.raiseEvent("mouse-enabled",{enabled:w}),this},areControlsEnabled:function(){var w=this.controls.length,O;for(O=0;O<this.controls.length;O++)w=w&&this.controls[O].isVisible();return w},setControlsEnabled:function(w){return w?L(this):R(this),this.raiseEvent("controls-enabled",{enabled:w}),this},setDebugMode:function(w){for(var O=0;O<this.world.getItemCount();O++)this.world.getItemAt(O).debugMode=w;this.debugMode=w,this.forceRedraw()},isFullPage:function(){return r[this.hash].fullPage},setFullPage:function(w){var O=document.body,Z=O.style,K=document.documentElement.style,Q=this,Ie,ce;if(w==this.isFullPage())return this;var Me={fullPage:w,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",Me),Me.preventDefaultAction)return this;if(w){for(this.elementSize=s.getElementSize(this.element),this.pageScroll=s.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=Z.margin,this.docMargin=K.margin,Z.margin="0",K.margin="0",this.bodyPadding=Z.padding,this.docPadding=K.padding,Z.padding="0",K.padding="0",this.bodyWidth=Z.width,this.docWidth=K.width,Z.width="100%",K.width="100%",this.bodyHeight=Z.height,this.docHeight=K.height,Z.height="100%",K.height="100%",this.previousBody=[],r[this.hash].prevElementParent=this.element.parentNode,r[this.hash].prevNextSibling=this.element.nextSibling,r[this.hash].prevElementWidth=this.element.style.width,r[this.hash].prevElementHeight=this.element.style.height,Ie=O.childNodes.length,ce=0;ce<Ie;ce++)this.previousBody.push(O.childNodes[0]),O.removeChild(O.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,O.appendChild(this.toolbar.element),s.addClass(this.toolbar.element,"fullpage")),s.addClass(this.element,"fullpage"),O.appendChild(this.element),this.element.style.height=s.getWindowSize().y+"px",this.element.style.width=s.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=s.getElementSize(this.element).y-s.getElementSize(this.toolbar.element).y+"px"),r[this.hash].fullPage=!0,s.delegate(this,ye)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,Z.margin=this.bodyMargin,K.margin=this.docMargin,Z.padding=this.bodyPadding,K.padding=this.docPadding,Z.width=this.bodyWidth,K.width=this.docWidth,Z.height=this.bodyHeight,K.height=this.docHeight,O.removeChild(this.element),Ie=this.previousBody.length,ce=0;ce<Ie;ce++)O.appendChild(this.previousBody.shift());s.removeClass(this.element,"fullpage"),r[this.hash].prevElementParent.insertBefore(this.element,r[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(O.removeChild(this.toolbar.element),s.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=r[this.hash].prevElementWidth,this.element.style.height=r[this.hash].prevElementHeight;var je=0,ke=function(){s.setPageScroll(Q.pageScroll);var be=s.getPageScroll();je++,je<10&&(be.x!==Q.pageScroll.x||be.y!==Q.pageScroll.y)&&s.requestAnimationFrame(ke)};s.requestAnimationFrame(ke),r[this.hash].fullPage=!1,s.delegate(this,Fe)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:w}),this},setFullScreen:function(w){var O=this;if(!s.supportsFullScreen)return this.setFullPage(w);if(s.isFullScreen()===w)return this;var Z={fullScreen:w,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",Z),Z.preventDefaultAction)return this;if(w){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var K=function(){var Q=s.isFullScreen();Q||(s.removeEvent(document,s.fullScreenEventName,K),s.removeEvent(document,s.fullScreenErrorEventName,K),O.setFullPage(!1),O.isFullPage()&&(O.element.style.width=O.fullPageStyleWidth,O.element.style.height=O.fullPageStyleHeight)),O.navigator&&O.viewport&&setTimeout(function(){O.navigator.update(O.viewport)}),O.raiseEvent("full-screen",{fullScreen:Q})};s.addEvent(document,s.fullScreenEventName,K),s.addEvent(document,s.fullScreenErrorEventName,K),s.requestFullScreen(document.body)}else s.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(w){return this.container.style.visibility=w?"":"hidden",this.raiseEvent("visible",{visible:w}),this},addTiledImage:function(w){s.console.assert(w,"[Viewer.addTiledImage] options is required"),s.console.assert(w.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),s.console.assert(!w.replace||w.index>-1&&w.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var O=this;w.replace&&(w.replaceItem=O.world.getItemAt(w.index)),this._hideMessage(),w.placeholderFillStyle===void 0&&(w.placeholderFillStyle=this.placeholderFillStyle),w.opacity===void 0&&(w.opacity=this.opacity),w.preload===void 0&&(w.preload=this.preload),w.compositeOperation===void 0&&(w.compositeOperation=this.compositeOperation),w.crossOriginPolicy===void 0&&(w.crossOriginPolicy=w.tileSource.crossOriginPolicy!==void 0?w.tileSource.crossOriginPolicy:this.crossOriginPolicy),w.ajaxWithCredentials===void 0&&(w.ajaxWithCredentials=this.ajaxWithCredentials),w.loadTilesWithAjax===void 0&&(w.loadTilesWithAjax=this.loadTilesWithAjax),w.ajaxHeaders===void 0||w.ajaxHeaders===null?w.ajaxHeaders=this.ajaxHeaders:s.isPlainObject(w.ajaxHeaders)&&s.isPlainObject(this.ajaxHeaders)&&(w.ajaxHeaders=s.extend({},this.ajaxHeaders,w.ajaxHeaders));var Z={options:w};function K(ce){for(var Me=0;Me<O._loadQueue.length;Me++)if(O._loadQueue[Me]===Z){O._loadQueue.splice(Me,1);break}O._loadQueue.length===0&&Q(Z),O.raiseEvent("add-item-failed",ce),w.error&&w.error(ce)}function Q(ce){O.collectionMode&&(O.world.arrange({immediately:ce.options.collectionImmediately,rows:O.collectionRows,columns:O.collectionColumns,layout:O.collectionLayout,tileSize:O.collectionTileSize,tileMargin:O.collectionTileMargin}),O.world.setAutoRefigureSizes(!0))}if(s.isArray(w.tileSource)){setTimeout(function(){K({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:w.tileSource,options:w})});return}this._loadQueue.push(Z);function Ie(){for(var ce,Me,je;O._loadQueue.length&&(ce=O._loadQueue[0],!!ce.tileSource);){if(O._loadQueue.splice(0,1),ce.options.replace){var ke=O.world.getIndexOfItem(ce.options.replaceItem);ke!=-1&&(ce.options.index=ke),O.world.removeItem(ce.options.replaceItem)}Me=new s.TiledImage({viewer:O,source:ce.tileSource,viewport:O.viewport,drawer:O.drawer,tileCache:O.tileCache,imageLoader:O.imageLoader,x:ce.options.x,y:ce.options.y,width:ce.options.width,height:ce.options.height,fitBounds:ce.options.fitBounds,fitBoundsPlacement:ce.options.fitBoundsPlacement,clip:ce.options.clip,placeholderFillStyle:ce.options.placeholderFillStyle,opacity:ce.options.opacity,preload:ce.options.preload,degrees:ce.options.degrees,compositeOperation:ce.options.compositeOperation,springStiffness:O.springStiffness,animationTime:O.animationTime,minZoomImageRatio:O.minZoomImageRatio,wrapHorizontal:O.wrapHorizontal,wrapVertical:O.wrapVertical,immediateRender:O.immediateRender,blendTime:O.blendTime,alwaysBlend:O.alwaysBlend,minPixelRatio:O.minPixelRatio,smoothTileEdgesMinZoom:O.smoothTileEdgesMinZoom,iOSDevice:O.iOSDevice,crossOriginPolicy:ce.options.crossOriginPolicy,ajaxWithCredentials:ce.options.ajaxWithCredentials,loadTilesWithAjax:ce.options.loadTilesWithAjax,ajaxHeaders:ce.options.ajaxHeaders,debugMode:O.debugMode}),O.collectionMode&&O.world.setAutoRefigureSizes(!1),O.world.addItem(Me,{index:ce.options.index}),O._loadQueue.length===0&&Q(ce),O.world.getItemCount()===1&&!O.preserveViewport&&O.viewport.goHome(!0),O.navigator&&(je=s.extend({},ce.options,{replace:!1,originalTiledImage:Me,tileSource:ce.tileSource}),O.navigator.addTiledImage(je)),ce.options.success&&ce.options.success({item:Me})}}c(this,w.tileSource,w,function(ce){Z.tileSource=ce,Ie()},function(ce){ce.options=w,K(ce),Ie()})},addSimpleImage:function(w){s.console.assert(w,"[Viewer.addSimpleImage] options is required"),s.console.assert(w.url,"[Viewer.addSimpleImage] options.url is required");var O=s.extend({},w,{tileSource:{type:"image",url:w.url}});delete O.url,this.addTiledImage(O)},addLayer:function(w){var O=this;s.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var Z=s.extend({},w,{success:function(K){O.raiseEvent("add-layer",{options:w,drawer:K.item})},error:function(K){O.raiseEvent("add-layer-failed",K)}});return this.addTiledImage(Z),this},getLayerAtLevel:function(w){return s.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(w)},getLevelOfLayer:function(w){return s.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(w)},getLayersCount:function(){return s.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(w,O){return s.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(w,O)},removeLayer:function(w){return s.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(w)},forceRedraw:function(){return r[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var w=s.delegate(this,V),O=s.delegate(this,j),Z=s.delegate(this,Ot),K=s.delegate(this,It),Q=this.navImages,Ie=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Ie=!1),this.previousButton=new s.Button({element:this.previousButton?s.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.PreviousPage"),srcRest:ge(this.prefixUrl,Q.previous.REST),srcGroup:ge(this.prefixUrl,Q.previous.GROUP),srcHover:ge(this.prefixUrl,Q.previous.HOVER),srcDown:ge(this.prefixUrl,Q.previous.DOWN),onRelease:K,onFocus:w,onBlur:O}),this.nextButton=new s.Button({element:this.nextButton?s.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.NextPage"),srcRest:ge(this.prefixUrl,Q.next.REST),srcGroup:ge(this.prefixUrl,Q.next.GROUP),srcHover:ge(this.prefixUrl,Q.next.HOVER),srcDown:ge(this.prefixUrl,Q.next.DOWN),onRelease:Z,onFocus:w,onBlur:O}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Ie&&(this.paging=new s.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:s.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||s.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var w=s.delegate(this,Ye),O=s.delegate(this,ht),Z=s.delegate(this,tt),K=s.delegate(this,et),Q=s.delegate(this,ct),Ie=s.delegate(this,dt),ce=s.delegate(this,at),Me=s.delegate(this,pt),je=s.delegate(this,St),ke=s.delegate(this,lt),be=s.delegate(this,V),Xe=s.delegate(this,j),$e=this.navImages,Je=[],Qe=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Qe=!1),this.showZoomControl&&(Je.push(this.zoomInButton=new s.Button({element:this.zoomInButton?s.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.ZoomIn"),srcRest:ge(this.prefixUrl,$e.zoomIn.REST),srcGroup:ge(this.prefixUrl,$e.zoomIn.GROUP),srcHover:ge(this.prefixUrl,$e.zoomIn.HOVER),srcDown:ge(this.prefixUrl,$e.zoomIn.DOWN),onPress:w,onRelease:O,onClick:Z,onEnter:w,onExit:O,onFocus:be,onBlur:Xe})),Je.push(this.zoomOutButton=new s.Button({element:this.zoomOutButton?s.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.ZoomOut"),srcRest:ge(this.prefixUrl,$e.zoomOut.REST),srcGroup:ge(this.prefixUrl,$e.zoomOut.GROUP),srcHover:ge(this.prefixUrl,$e.zoomOut.HOVER),srcDown:ge(this.prefixUrl,$e.zoomOut.DOWN),onPress:K,onRelease:O,onClick:Q,onEnter:K,onExit:O,onFocus:be,onBlur:Xe}))),this.showHomeControl&&Je.push(this.homeButton=new s.Button({element:this.homeButton?s.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.Home"),srcRest:ge(this.prefixUrl,$e.home.REST),srcGroup:ge(this.prefixUrl,$e.home.GROUP),srcHover:ge(this.prefixUrl,$e.home.HOVER),srcDown:ge(this.prefixUrl,$e.home.DOWN),onRelease:Ie,onFocus:be,onBlur:Xe})),this.showFullPageControl&&Je.push(this.fullPageButton=new s.Button({element:this.fullPageButton?s.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.FullPage"),srcRest:ge(this.prefixUrl,$e.fullpage.REST),srcGroup:ge(this.prefixUrl,$e.fullpage.GROUP),srcHover:ge(this.prefixUrl,$e.fullpage.HOVER),srcDown:ge(this.prefixUrl,$e.fullpage.DOWN),onRelease:ce,onFocus:be,onBlur:Xe})),this.showRotationControl&&(Je.push(this.rotateLeftButton=new s.Button({element:this.rotateLeftButton?s.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.RotateLeft"),srcRest:ge(this.prefixUrl,$e.rotateleft.REST),srcGroup:ge(this.prefixUrl,$e.rotateleft.GROUP),srcHover:ge(this.prefixUrl,$e.rotateleft.HOVER),srcDown:ge(this.prefixUrl,$e.rotateleft.DOWN),onRelease:Me,onFocus:be,onBlur:Xe})),Je.push(this.rotateRightButton=new s.Button({element:this.rotateRightButton?s.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.RotateRight"),srcRest:ge(this.prefixUrl,$e.rotateright.REST),srcGroup:ge(this.prefixUrl,$e.rotateright.GROUP),srcHover:ge(this.prefixUrl,$e.rotateright.HOVER),srcDown:ge(this.prefixUrl,$e.rotateright.DOWN),onRelease:je,onFocus:be,onBlur:Xe}))),this.showFlipControl&&Je.push(this.flipButton=new s.Button({element:this.flipButton?s.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:s.getString("Tooltips.Flip"),srcRest:ge(this.prefixUrl,$e.flip.REST),srcGroup:ge(this.prefixUrl,$e.flip.GROUP),srcHover:ge(this.prefixUrl,$e.flip.HOVER),srcDown:ge(this.prefixUrl,$e.flip.DOWN),onRelease:ke,onFocus:be,onBlur:Xe})),Qe&&(this.buttons=new s.ButtonGroup({buttons:Je,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",s.delegate(this,ut)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||s.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||s.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(w){return this.tileSources&&w>=0&&w<this.tileSources.length&&(this._sequenceIndex=w,this._updateSequenceButtons(w),this.open(this.tileSources[w]),this.referenceStrip&&this.referenceStrip.setFocus(w),this.raiseEvent("page",{page:w})),this},addOverlay:function(w,O,Z,K){var Q;if(s.isPlainObject(w)?Q=w:Q={element:w,location:O,placement:Z,onDraw:K},w=s.getElement(Q.element),g(this.currentOverlays,w)>=0)return this;var Ie=u(this,Q);return this.currentOverlays.push(Ie),Ie.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:w,location:Q.location,placement:Q.placement}),this},updateOverlay:function(w,O,Z){var K;return w=s.getElement(w),K=g(this.currentOverlays,w),K>=0&&(this.currentOverlays[K].update(O,Z),r[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:w,location:O,placement:Z})),this},removeOverlay:function(w){var O;return w=s.getElement(w),O=g(this.currentOverlays,w),O>=0&&(this.currentOverlays[O].destroy(),this.currentOverlays.splice(O,1),r[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:w})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return r[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(w){var O;return w=s.getElement(w),O=g(this.currentOverlays,w),O>=0?this.currentOverlays[O]:null},_updateSequenceButtons:function(w){this.nextButton&&(!this.tileSources||this.tileSources.length-1===w?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(w>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(w){this._hideMessage();var O=s.makeNeutralElement("div");O.appendChild(document.createTextNode(w)),this.messageDiv=s.makeCenteredNode(O),s.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var w=this.messageDiv;w&&(w.parentNode.removeChild(w),delete this.messageDiv)},gestureSettingsByDeviceType:function(w){switch(w){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var w,O=this.currentOverlays.length;for(w=0;w<O;w++)this.currentOverlays[w].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new s.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else s.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function l(w){return w=s.getElement(w),new s.Point(w.clientWidth===0?1:w.clientWidth,w.clientHeight===0?1:w.clientHeight)}function c(w,O,Z,K,Q){var Ie=w;if(s.type(O)=="string"){if(O.match(/^\s*<.*>\s*$/))O=s.parseXml(O);else if(O.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var ce=s.parseJSON(O);O=ce}catch{}}function Me(je,ke){je.ready?K(je):(je.addHandler("ready",function(){K(je)}),je.addHandler("open-failed",function(be){Q({message:be.message,source:ke})}))}setTimeout(function(){if(s.type(O)=="string")O=new s.TileSource({url:O,crossOriginPolicy:Z.crossOriginPolicy!==void 0?Z.crossOriginPolicy:w.crossOriginPolicy,ajaxWithCredentials:w.ajaxWithCredentials,ajaxHeaders:w.ajaxHeaders,useCanvas:w.useCanvas,success:function(Xe){K(Xe.tileSource)}}),O.addHandler("open-failed",function(Xe){Q(Xe)});else if(s.isPlainObject(O)||O.nodeType)if(O.crossOriginPolicy===void 0&&(Z.crossOriginPolicy!==void 0||w.crossOriginPolicy!==void 0)&&(O.crossOriginPolicy=Z.crossOriginPolicy!==void 0?Z.crossOriginPolicy:w.crossOriginPolicy),O.ajaxWithCredentials===void 0&&(O.ajaxWithCredentials=w.ajaxWithCredentials),O.useCanvas===void 0&&(O.useCanvas=w.useCanvas),s.isFunction(O.getTileUrl)){var je=new s.TileSource(O);je.getTileUrl=O.getTileUrl,K(je)}else{var ke=s.TileSource.determineType(Ie,O);if(!ke){Q({message:"Unable to load TileSource",source:O});return}var be=ke.prototype.configure.apply(Ie,[O]);Me(new ke(be),O)}else Me(O,O)})}function u(w,O){if(O instanceof s.Overlay)return O;var Z=null;if(O.element)Z=s.getElement(O.element);else{var K=O.id?O.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);Z=s.getElement(O.id),Z||(Z=document.createElement("a"),Z.href="#/overlay/"+K),Z.id=K,s.addClass(Z,O.className?O.className:"openseadragon-overlay")}var Q=O.location,Ie=O.width,ce=O.height;if(!Q){var Me=O.x,je=O.y;if(O.px!==void 0){var ke=w.viewport.imageToViewportRectangle(new s.Rect(O.px,O.py,Ie||0,ce||0));Me=ke.x,je=ke.y,Ie=Ie!==void 0?ke.width:void 0,ce=ce!==void 0?ke.height:void 0}Q=new s.Point(Me,je)}var be=O.placement;return be&&s.type(be)==="string"&&(be=s.Placement[O.placement.toUpperCase()]),new s.Overlay({element:Z,location:Q,placement:be,onDraw:O.onDraw,checkResize:O.checkResize,width:Ie,height:ce,rotationMode:O.rotationMode})}function g(w,O){var Z;for(Z=w.length-1;Z>=0;Z--)if(w[Z].element===O)return Z;return-1}function v(w,O){return s.requestAnimationFrame(function(){O(w)})}function C(w){s.requestAnimationFrame(function(){I(w)})}function R(w){!w.autoHideControls||(w.controlsShouldFade=!0,w.controlsFadeBeginTime=s.now()+w.controlsFadeDelay,window.setTimeout(function(){C(w)},w.controlsFadeDelay))}function I(w){var O,Z,K,Q;if(w.controlsShouldFade){for(O=s.now(),Z=O-w.controlsFadeBeginTime,K=1-Z/w.controlsFadeLength,K=Math.min(1,K),K=Math.max(0,K),Q=w.controls.length-1;Q>=0;Q--)w.controls[Q].autoFade&&w.controls[Q].setOpacity(K);K>0&&C(w)}}function L(w){var O;for(w.controlsShouldFade=!1,O=w.controls.length-1;O>=0;O--)w.controls[O].setOpacity(1)}function V(){L(this)}function j(){R(this)}function q(w){var O={originalEvent:w.originalEvent,preventDefaultAction:w.preventDefaultAction,preventVerticalPan:w.preventVerticalPan,preventHorizontalPan:w.preventHorizontalPan};if(this.raiseEvent("canvas-key",O),!O.preventDefaultAction&&!w.ctrl&&!w.alt&&!w.meta)switch(w.keyCode){case 38:return O.preventVerticalPan||(w.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return O.preventVerticalPan||(w.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return O.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return O.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function ae(w){var O={originalEvent:w.originalEvent,preventDefaultAction:w.preventDefaultAction,preventVerticalPan:w.preventVerticalPan,preventHorizontalPan:w.preventHorizontalPan};if(this.raiseEvent("canvas-key",O),!O.preventDefaultAction&&!w.ctrl&&!w.alt&&!w.meta)switch(w.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return O.preventVerticalPan||(w.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return O.preventVerticalPan||(w.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return O.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return O.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new s.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(s.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(s.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(s.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(s.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function E(w){var O,Z=document.activeElement==this.canvas;Z||this.canvas.focus(),this.viewport.flipped&&(w.position.x=this.viewport.getContainerSize().x-w.position.x);var K={tracker:w.eventSource,position:w.position,quick:w.quick,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:w.preventDefaultAction};this.raiseEvent("canvas-click",K),!K.preventDefaultAction&&this.viewport&&w.quick&&(O=this.gestureSettingsByDeviceType(w.pointerType),O.clickToZoom&&(this.viewport.zoomBy(w.shift?1/this.zoomPerClick:this.zoomPerClick,O.zoomToRefPoint?this.viewport.pointFromPixel(w.position,!0):null),this.viewport.applyConstraints()))}function M(w){var O,Z={tracker:w.eventSource,position:w.position,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:w.preventDefaultAction};this.raiseEvent("canvas-double-click",Z),!Z.preventDefaultAction&&this.viewport&&(O=this.gestureSettingsByDeviceType(w.pointerType),O.dblClickToZoom&&(this.viewport.zoomBy(w.shift?1/this.zoomPerClick:this.zoomPerClick,O.zoomToRefPoint?this.viewport.pointFromPixel(w.position,!0):null),this.viewport.applyConstraints()))}function U(w){var O,Z={tracker:w.eventSource,position:w.position,delta:w.delta,speed:w.speed,direction:w.direction,shift:w.shift,originalEvent:w.originalEvent,preventDefaultAction:w.preventDefaultAction};if(this.raiseEvent("canvas-drag",Z),!Z.preventDefaultAction&&this.viewport){if(O=this.gestureSettingsByDeviceType(w.pointerType),this.panHorizontal||(w.delta.x=0),this.panVertical||(w.delta.y=0),this.viewport.flipped&&(w.delta.x=-w.delta.x),this.constrainDuringPan){var K=this.viewport.deltaPointsFromPixels(w.delta.negate());this.viewport.centerSpringX.target.value+=K.x,this.viewport.centerSpringY.target.value+=K.y;var Q=this.viewport.getBounds(),Ie=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=K.x,this.viewport.centerSpringY.target.value-=K.y,Q.x!=Ie.x&&(w.delta.x=0),Q.y!=Ie.y&&(w.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(w.delta.negate()),O.flickEnabled&&!this.constrainDuringPan)}}function W(w){if(!w.preventDefaultAction&&this.viewport){var O=this.gestureSettingsByDeviceType(w.pointerType);if(O.flickEnabled&&w.speed>=O.flickMinSpeed){var Z=0;this.panHorizontal&&(Z=O.flickMomentum*w.speed*Math.cos(w.direction));var K=0;this.panVertical&&(K=O.flickMomentum*w.speed*Math.sin(w.direction));var Q=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Ie=this.viewport.pointFromPixel(new s.Point(Q.x-Z,Q.y-K));this.viewport.panTo(Ie,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:w.eventSource,position:w.position,speed:w.speed,direction:w.direction,shift:w.shift,originalEvent:w.originalEvent})}function X(w){this.raiseEvent("canvas-enter",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function Y(w){window.location!=window.parent.location&&s.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function he(w){this.raiseEvent("canvas-press",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,insideElementPressed:w.insideElementPressed,insideElementReleased:w.insideElementReleased,originalEvent:w.originalEvent})}function ie(w){this.raiseEvent("canvas-release",{tracker:w.eventSource,pointerType:w.pointerType,position:w.position,insideElementPressed:w.insideElementPressed,insideElementReleased:w.insideElementReleased,originalEvent:w.originalEvent})}function we(w){this.raiseEvent("canvas-nonprimary-press",{tracker:w.eventSource,position:w.position,pointerType:w.pointerType,button:w.button,buttons:w.buttons,originalEvent:w.originalEvent})}function Re(w){this.raiseEvent("canvas-nonprimary-release",{tracker:w.eventSource,position:w.position,pointerType:w.pointerType,button:w.button,buttons:w.buttons,originalEvent:w.originalEvent})}function de(w){var O,Z,K,Q;if(!w.preventDefaultAction&&this.viewport&&(O=this.gestureSettingsByDeviceType(w.pointerType),O.pinchToZoom&&(Z=this.viewport.pointFromPixel(w.center,!0),K=this.viewport.pointFromPixel(w.lastCenter,!0),Q=K.minus(Z),this.panHorizontal||(Q.x=0),this.panVertical||(Q.y=0),this.viewport.zoomBy(w.distance/w.lastDistance,Z,!0),O.zoomToRefPoint&&this.viewport.panBy(Q,!0),this.viewport.applyConstraints()),O.pinchRotate)){var Ie=Math.atan2(w.gesturePoints[0].currentPos.y-w.gesturePoints[1].currentPos.y,w.gesturePoints[0].currentPos.x-w.gesturePoints[1].currentPos.x),ce=Math.atan2(w.gesturePoints[0].lastPos.y-w.gesturePoints[1].lastPos.y,w.gesturePoints[0].lastPos.x-w.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(Ie-ce)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:w.eventSource,gesturePoints:w.gesturePoints,lastCenter:w.lastCenter,center:w.center,lastDistance:w.lastDistance,distance:w.distance,shift:w.shift,originalEvent:w.originalEvent}),!1}function He(w){var O,Z,K,Q;if(K=s.now(),Q=K-this._lastScrollTime,Q>this.minScrollDeltaTime){if(this._lastScrollTime=K,this.viewport.flipped&&(w.position.x=this.viewport.getContainerSize().x-w.position.x),!w.preventDefaultAction&&this.viewport&&(O=this.gestureSettingsByDeviceType(w.pointerType),O.scrollToZoom&&(Z=Math.pow(this.zoomPerScroll,w.scroll),this.viewport.zoomBy(Z,O.zoomToRefPoint?this.viewport.pointFromPixel(w.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:w.eventSource,position:w.position,scroll:w.scroll,shift:w.shift,originalEvent:w.originalEvent}),O&&O.scrollToZoom)return!1}else if(O=this.gestureSettingsByDeviceType(w.pointerType),O&&O.scrollToZoom)return!1}function ye(w){r[this.hash].mouseInside=!0,L(this),this.raiseEvent("container-enter",{tracker:w.eventSource,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function Fe(w){w.pointers<1&&(r[this.hash].mouseInside=!1,r[this.hash].animating||R(this)),this.raiseEvent("container-exit",{tracker:w.eventSource,position:w.position,buttons:w.buttons,pointers:w.pointers,insideElementPressed:w.insideElementPressed,buttonDownAny:w.buttonDownAny,originalEvent:w.originalEvent})}function ze(w){qe(w),w.isOpen()?w._updateRequestId=v(w,ze):w._updateRequestId=!1}function qe(w){if(!w._opening){if(w.autoResize){var O=l(w.container),Z=r[w.hash].prevContainerSize;if(!O.equals(Z)){var K=w.viewport;if(w.preserveImageSizeOnResize){var Q=Z.x/O.x,Ie=K.getZoom()*Q,ce=K.getCenter();K.resize(O,!1),K.zoomTo(Ie,null,!0),K.panTo(ce,!0)}else{var Me=K.getBounds();K.resize(O,!0),K.fitBoundsWithConstraints(Me,!0)}r[w.hash].prevContainerSize=O,r[w.hash].forceRedraw=!0}}var je=w.viewport.update(),ke=w.world.update()||je;je&&w.raiseEvent("viewport-change"),w.referenceStrip&&(ke=w.referenceStrip.update(w.viewport)||ke),!r[w.hash].animating&&ke&&(w.raiseEvent("animation-start"),L(w)),(ke||r[w.hash].forceRedraw||w.world.needsDraw())&&(We(w),w._drawOverlays(),w.navigator&&w.navigator.update(w.viewport),r[w.hash].forceRedraw=!1,ke&&w.raiseEvent("animation")),r[w.hash].animating&&!ke&&(w.raiseEvent("animation-finish"),r[w.hash].mouseInside||R(w)),r[w.hash].animating=ke}}function We(w){w.imageLoader.clear(),w.drawer.clear(),w.world.draw(),w.raiseEvent("update-viewport",{})}function ge(w,O){return w?w+O:O}function Ye(){r[this.hash].lastZoomTime=s.now(),r[this.hash].zoomFactor=this.zoomPerSecond,r[this.hash].zooming=!0,it(this)}function et(){r[this.hash].lastZoomTime=s.now(),r[this.hash].zoomFactor=1/this.zoomPerSecond,r[this.hash].zooming=!0,it(this)}function ht(){r[this.hash].zooming=!1}function it(w){s.requestAnimationFrame(s.delegate(w,rt))}function rt(){var w,O,Z;r[this.hash].zooming&&this.viewport&&(w=s.now(),O=w-r[this.hash].lastZoomTime,Z=Math.pow(r[this.hash].zoomFactor,O/1e3),this.viewport.zoomBy(Z),this.viewport.applyConstraints(),r[this.hash].lastZoomTime=w,it(this))}function tt(){this.viewport&&(r[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function ct(){this.viewport&&(r[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function ut(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function dt(){this.viewport&&this.viewport.goHome()}function at(){this.isFullPage()&&!s.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function pt(){if(this.viewport){var w=this.viewport.getRotation();this.viewport.flipped?w=s.positiveModulo(w+this.rotationIncrement,360):w=s.positiveModulo(w-this.rotationIncrement,360),this.viewport.setRotation(w)}}function St(){if(this.viewport){var w=this.viewport.getRotation();this.viewport.flipped?w=s.positiveModulo(w-this.rotationIncrement,360):w=s.positiveModulo(w+this.rotationIncrement,360),this.viewport.setRotation(w)}}function lt(){this.viewport.toggleFlip()}function It(){var w=this._sequenceIndex-1;this.navPrevNextWrap&&w<0&&(w+=this.tileSources.length),this.goToPage(w)}function Ot(){var w=this._sequenceIndex+1;this.navPrevNextWrap&&w>=this.tileSources.length&&(w=0),this.goToPage(w)}}(OpenSeadragon),function(s){s.Navigator=function(v){var C=v.viewer,R=this,I,L;v.id?(this.element=document.getElementById(v.id),v.controlOptions={anchor:s.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(v.id="navigator-"+s.now(),this.element=s.makeNeutralElement("div"),v.controlOptions={anchor:s.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:v.autoFade},v.position&&(v.position=="BOTTOM_RIGHT"?v.controlOptions.anchor=s.ControlAnchor.BOTTOM_RIGHT:v.position=="BOTTOM_LEFT"?v.controlOptions.anchor=s.ControlAnchor.BOTTOM_LEFT:v.position=="TOP_RIGHT"?v.controlOptions.anchor=s.ControlAnchor.TOP_RIGHT:v.position=="TOP_LEFT"?v.controlOptions.anchor=s.ControlAnchor.TOP_LEFT:v.position=="ABSOLUTE"&&(v.controlOptions.anchor=s.ControlAnchor.ABSOLUTE,v.controlOptions.top=v.top,v.controlOptions.left=v.left,v.controlOptions.height=v.height,v.controlOptions.width=v.width))),this.element.id=v.id,this.element.className+=" navigator",v=s.extend(!0,{sizeRatio:s.DEFAULT_SETTINGS.navigatorSizeRatio},v,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:v.autoResize,minZoomImageRatio:1,background:v.background,opacity:v.opacity,borderColor:v.borderColor,displayRegionColor:v.displayRegionColor}),v.minPixelRatio=this.minPixelRatio=C.minPixelRatio,s.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new s.Point(1,1),this.totalBorderWidths=new s.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),v.controlOptions.anchor!=s.ControlAnchor.NONE&&function(q,ae){q.margin="0px",q.border=ae+"px solid "+v.borderColor,q.padding="0px",q.background=v.background,q.opacity=v.opacity,q.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=s.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(q,ae){q.position="relative",q.top="0px",q.left="0px",q.fontSize="0px",q.overflow="hidden",q.border=ae+"px solid "+v.displayRegionColor,q.margin="0px",q.padding="0px",q.background="transparent",q.float="left",q.cssFloat="left",q.styleFloat="left",q.zIndex=999999999,q.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=s.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",C.addControl(this.element,v.controlOptions),this._resizeWithViewer=v.controlOptions.anchor!=s.ControlAnchor.ABSOLUTE&&v.controlOptions.anchor!=s.ControlAnchor.NONE,v.width&&v.height?(this.setWidth(v.width),this.setHeight(v.height)):this._resizeWithViewer&&(I=s.getElementSize(C.element),this.element.style.height=Math.round(I.y*v.sizeRatio)+"px",this.element.style.width=Math.round(I.x*v.sizeRatio)+"px",this.oldViewerSize=I,L=s.getElementSize(this.element),this.elementArea=L.x*L.y),this.oldContainerSize=new s.Point(0,0),s.Viewer.apply(this,[v]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function V(q){u(R.displayRegionContainer,q),u(R.displayRegion,-q),R.viewport.setRotation(q)}if(v.navigatorRotate){var j=v.viewer.viewport?v.viewer.viewport.getRotation():v.viewer.degrees||0;V(j),v.viewer.addHandler("rotate",function(q){V(q.degrees)})}this.innerTracker.destroy(),this.innerTracker=new s.MouseTracker({element:this.element,dragHandler:s.delegate(this,a),clickHandler:s.delegate(this,r),releaseHandler:s.delegate(this,l),scrollHandler:s.delegate(this,c)}),this.addHandler("reset-size",function(){R.viewport&&R.viewport.goHome(!0)}),C.world.addHandler("item-index-change",function(q){window.setTimeout(function(){var ae=R.world.getItemAt(q.previousIndex);R.world.setItemIndex(ae,q.newIndex)},1)}),C.world.addHandler("remove-item",function(q){var ae=q.item,E=R._getMatchingItem(ae);E&&R.world.removeItem(E)}),this.update(C.viewport)},s.extend(s.Navigator.prototype,s.EventSource.prototype,s.Viewer.prototype,{updateSize:function(){if(this.viewport){var v=new s.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);v.equals(this.oldContainerSize)||(this.viewport.resize(v,!0),this.viewport.goHome(!0),this.oldContainerSize=v,this.drawer.clear(),this.world.draw())}},setWidth:function(v){this.width=v,this.element.style.width=typeof v=="number"?v+"px":v,this._resizeWithViewer=!1},setHeight:function(v){this.height=v,this.element.style.height=typeof v=="number"?v+"px":v,this._resizeWithViewer=!1},setFlip:function(v){return this.viewport.setFlip(v),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(v){g(this.displayRegion,v),g(this.canvas,v),g(this.element,v)},update:function(v){var C,R,I,L,V,j;if(C=s.getElementSize(this.viewer.element),this._resizeWithViewer&&C.x&&C.y&&!C.equals(this.oldViewerSize)&&(this.oldViewerSize=C,this.maintainSizeRatio||!this.elementArea?(R=C.x*this.sizeRatio,I=C.y*this.sizeRatio):(R=Math.sqrt(this.elementArea*(C.x/C.y)),I=this.elementArea/R),this.element.style.width=Math.round(R)+"px",this.element.style.height=Math.round(I)+"px",this.elementArea||(this.elementArea=R*I),this.updateSize()),v&&this.viewport){L=v.getBoundsNoRotate(!0),V=this.viewport.pixelFromPointNoRotate(L.getTopLeft(),!1),j=this.viewport.pixelFromPointNoRotate(L.getBottomRight(),!1).minus(this.totalBorderWidths);var q=this.displayRegion.style;q.display=this.world.getItemCount()?"block":"none",q.top=Math.round(V.y)+"px",q.left=Math.round(V.x)+"px";var ae=Math.abs(V.x-j.x),E=Math.abs(V.y-j.y);q.width=Math.round(Math.max(ae,0))+"px",q.height=Math.round(Math.max(E,0))+"px"}},addTiledImage:function(v){var C=this,R=v.originalTiledImage;delete v.original;var I=s.extend({},v,{success:function(L){var V=L.item;V._originalForNavigator=R,C._matchBounds(V,R,!0);function j(){C._matchBounds(V,R)}function q(){C._matchOpacity(V,R)}function ae(){C._matchCompositeOperation(V,R)}R.addHandler("bounds-change",j),R.addHandler("clip-change",j),R.addHandler("opacity-change",q),R.addHandler("composite-operation-change",ae)}});return s.Viewer.prototype.addTiledImage.apply(this,[I])},_getMatchingItem:function(v){for(var C=this.world.getItemCount(),R,I=0;I<C;I++)if(R=this.world.getItemAt(I),R._originalForNavigator===v)return R;return null},_matchBounds:function(v,C,R){var I=C.getBoundsNoRotate();v.setPosition(I.getTopLeft(),R),v.setWidth(I.width,R),v.setRotation(C.getRotation(),R),v.setClip(C.getClip())},_matchOpacity:function(v,C){v.setOpacity(C.opacity)},_matchCompositeOperation:function(v,C){v.setCompositeOperation(C.compositeOperation)}});function r(v){var C={tracker:v.eventSource,position:v.position,quick:v.quick,shift:v.shift,originalEvent:v.originalEvent,preventDefaultAction:v.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",C),!C.preventDefaultAction&&v.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(v.position.x=this.viewport.getContainerSize().x-v.position.x);var R=this.viewport.pointFromPixel(v.position);this.panVertical?this.panHorizontal||(R.x=this.viewer.viewport.getCenter(!0).x):R.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(R),this.viewer.viewport.applyConstraints()}}function a(v){var C={tracker:v.eventSource,position:v.position,delta:v.delta,speed:v.speed,direction:v.direction,shift:v.shift,originalEvent:v.originalEvent,preventDefaultAction:v.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",C),!C.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(v.delta.x=0),this.panVertical||(v.delta.y=0),this.viewer.viewport.flipped&&(v.delta.x=-v.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(v.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function l(v){v.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function c(v){return this.viewer.raiseEvent("navigator-scroll",{tracker:v.eventSource,position:v.position,scroll:v.scroll,shift:v.shift,originalEvent:v.originalEvent}),!1}function u(v,C){g(v,"rotate("+C+"deg)")}function g(v,C){v.style.webkitTransform=C,v.style.mozTransform=C,v.style.msTransform=C,v.style.oTransform=C,v.style.transform=C}}(OpenSeadragon),function(s){var r={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};s.extend(s,{getString:function(a){var l=a.split("."),c=null,u=arguments,g=r,v;for(v=0;v<l.length-1;v++)g=g[l[v]]||{};return c=g[l[v]],typeof c!="string"&&(s.console.log("Untranslated source string:",a),c=""),c.replace(/\{\d+\}/g,function(C){var R=parseInt(C.match(/\d+/),10)+1;return R<u.length?u[R]:""})},setString:function(a,l){var c=a.split("."),u=r,g;for(g=0;g<c.length-1;g++)u[c[g]]||(u[c[g]]={}),u=u[c[g]];u[c[g]]=l}})}(OpenSeadragon),function(s){s.Point=function(r,a){this.x=typeof r=="number"?r:0,this.y=typeof a=="number"?a:0},s.Point.prototype={clone:function(){return new s.Point(this.x,this.y)},plus:function(r){return new s.Point(this.x+r.x,this.y+r.y)},minus:function(r){return new s.Point(this.x-r.x,this.y-r.y)},times:function(r){return new s.Point(this.x*r,this.y*r)},divide:function(r){return new s.Point(this.x/r,this.y/r)},negate:function(){return new s.Point(-this.x,-this.y)},distanceTo:function(r){return Math.sqrt(Math.pow(this.x-r.x,2)+Math.pow(this.y-r.y,2))},squaredDistanceTo:function(r){return Math.pow(this.x-r.x,2)+Math.pow(this.y-r.y,2)},apply:function(r){return new s.Point(r(this.x),r(this.y))},equals:function(r){return r instanceof s.Point&&this.x===r.x&&this.y===r.y},rotate:function(r,a){a=a||new s.Point(0,0);var l,c;if(r%90==0){var u=s.positiveModulo(r,360);switch(u){case 0:l=1,c=0;break;case 90:l=0,c=1;break;case 180:l=-1,c=0;break;case 270:l=0,c=-1;break}}else{var g=r*Math.PI/180;l=Math.cos(g),c=Math.sin(g)}var v=l*(this.x-a.x)-c*(this.y-a.y)+a.x,C=c*(this.x-a.x)+l*(this.y-a.y)+a.y;return new s.Point(v,C)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(s){s.TileSource=function(a,l,c,u,g,v){var C=this,R=arguments,I,L;if(s.isPlainObject(a)?I=a:I={width:R[0],height:R[1],tileSize:R[2],tileOverlap:R[3],minLevel:R[4],maxLevel:R[5]},s.EventSource.call(this),s.extend(!0,this,I),!this.success){for(L=0;L<arguments.length;L++)if(s.isFunction(arguments[L])){this.success=arguments[L];break}}this.success&&this.addHandler("ready",function(V){C.success(V)}),s.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new s.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=I.width&&I.height?I.width/I.height:1,this.dimensions=new s.Point(I.width,I.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=I.tileOverlap?I.tileOverlap:0,this.minLevel=I.minLevel?I.minLevel:0,this.maxLevel=I.maxLevel!==void 0&&I.maxLevel!==null?I.maxLevel:I.width&&I.height?Math.ceil(Math.log(Math.max(I.width,I.height))/Math.log(2)):0,this.success&&s.isFunction(this.success)&&this.success(this))},s.TileSource.prototype={getTileSize:function(a){return s.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(a){return this._tileWidth?this._tileWidth:this.getTileSize(a)},getTileHeight:function(a){return this._tileHeight?this._tileHeight:this.getTileSize(a)},getLevelScale:function(a){var l={},c;for(c=0;c<=this.maxLevel;c++)l[c]=1/Math.pow(2,this.maxLevel-c);return this.getLevelScale=function(u){return l[u]},this.getLevelScale(a)},getNumTiles:function(a){var l=this.getLevelScale(a),c=Math.ceil(l*this.dimensions.x/this.getTileWidth(a)),u=Math.ceil(l*this.dimensions.y/this.getTileHeight(a));return new s.Point(c,u)},getPixelRatio:function(a){var l=this.dimensions.times(this.getLevelScale(a)),c=1/l.x,u=1/l.y;return new s.Point(c,u)},getClosestLevel:function(){var a,l;for(a=this.minLevel+1;a<=this.maxLevel&&(l=this.getNumTiles(a),!(l.x>1||l.y>1));a++);return a-1},getTileAtPoint:function(a,l){var c=l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/this.aspectRatio;s.console.assert(c,"[TileSource.getTileAtPoint] must be called with a valid point.");var u=this.dimensions.x*this.getLevelScale(a),g=l.x*u,v=l.y*u,C=Math.floor(g/this.getTileWidth(a)),R=Math.floor(v/this.getTileHeight(a));l.x>=1&&(C=this.getNumTiles(a).x-1);var I=1e-15;return l.y>=1/this.aspectRatio-I&&(R=this.getNumTiles(a).y-1),new s.Point(C,R)},getTileBounds:function(a,l,c,u){var g=this.dimensions.times(this.getLevelScale(a)),v=this.getTileWidth(a),C=this.getTileHeight(a),R=l===0?0:v*l-this.tileOverlap,I=c===0?0:C*c-this.tileOverlap,L=v+(l===0?1:2)*this.tileOverlap,V=C+(c===0?1:2)*this.tileOverlap,j=1/g.x;return L=Math.min(L,g.x-R),V=Math.min(V,g.y-I),u?new s.Rect(0,0,L,V):new s.Rect(R*j,I*j,L*j,V*j)},getImageInfo:function(a){var l=this,c,u,g,v,C,R,I;a&&(C=a.split("/"),R=C[C.length-1],I=R.lastIndexOf("."),I>-1&&(C[C.length-1]=R.slice(0,I))),u=function(L){typeof L=="string"&&(L=s.parseXml(L));var V=s.TileSource.determineType(l,L,a);if(!V){l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:a});return}v=V.prototype.configure.apply(l,[L,a]),v.ajaxWithCredentials===void 0&&(v.ajaxWithCredentials=l.ajaxWithCredentials),g=new V(v),l.ready=!0,l.raiseEvent("ready",{tileSource:g})},a.match(/\.js$/)?(c=a.split("/").pop().replace(".js",""),s.jsonp({url:a,async:!1,callbackName:c,callback:u})):s.makeAjaxRequest({url:a,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(L){var V=r(L);u(V)},error:function(L,V){var j;try{j="HTTP "+L.status+" attempting to load TileSource"}catch{var q;typeof V=="undefined"||!V.toString?q="Unknown error":q=V.toString(),j=q+" attempting to load TileSource"}l.raiseEvent("open-failed",{message:j,source:a})}})},supports:function(a,l){return!1},configure:function(a,l){throw new Error("Method not implemented.")},getTileUrl:function(a,l,c){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(a,l,c){return{}},tileExists:function(a,l,c){var u=this.getNumTiles(a);return a>=this.minLevel&&a<=this.maxLevel&&l>=0&&c>=0&&l<u.x&&c<u.y}},s.extend(!0,s.TileSource.prototype,s.EventSource.prototype);function r(a){var l=a.responseText,c=a.status,u,g;if(a){if(a.status!==200&&a.status!==0)throw c=a.status,u=c==404?"Not Found":a.statusText,new Error(s.getString("Errors.Status",c,u))}else throw new Error(s.getString("Errors.Security"));if(l.match(/\s*<.*/))try{g=a.responseXML&&a.responseXML.documentElement?a.responseXML:s.parseXml(l)}catch{g=a.responseText}else if(l.match(/\s*[\{\[].*/))try{g=s.parseJSON(l)}catch{g=l}else g=l;return g}s.TileSource.determineType=function(a,l,c){var u;for(u in OpenSeadragon)if(u.match(/.+TileSource$/)&&s.isFunction(OpenSeadragon[u])&&s.isFunction(OpenSeadragon[u].prototype.supports)&&OpenSeadragon[u].prototype.supports.call(a,l,c))return OpenSeadragon[u];s.console.error("No TileSource was able to open %s %s",c,l)}}(OpenSeadragon),function(s){s.DziTileSource=function(l,c,u,g,v,C,R,I,L){var V,j,q,ae;if(s.isPlainObject(l)?ae=l:ae={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=ae.tilesUrl,this.fileFormat=ae.fileFormat,this.displayRects=ae.displayRects,this.displayRects)for(V=this.displayRects.length-1;V>=0;V--)for(j=this.displayRects[V],q=j.minLevel;q<=j.maxLevel;q++)this._levelRects[q]||(this._levelRects[q]=[]),this._levelRects[q].push(j);s.TileSource.apply(this,[ae])},s.extend(s.DziTileSource.prototype,s.TileSource.prototype,{supports:function(l,c){var u;return l.Image?u=l.Image.xmlns:l.documentElement&&(l.documentElement.localName=="Image"||l.documentElement.tagName=="Image")&&(u=l.documentElement.namespaceURI),u=(u||"").toLowerCase(),u.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||u.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(l,c){var u;return s.isPlainObject(l)?u=a(this,l):u=r(this,l),c&&!u.tilesUrl&&(u.tilesUrl=c.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),c.search(/\.(dzi|xml|js)\?/)!=-1?u.queryParams=c.match(/\?.*/):u.queryParams=""),u},getTileUrl:function(l,c,u){return[this.tilesUrl,l,"/",c,"_",u,".",this.fileFormat,this.queryParams].join("")},tileExists:function(l,c,u){var g=this._levelRects[l],v,C,R,I,L,V,j;if(this.minLevel&&l<this.minLevel||this.maxLevel&&l>this.maxLevel)return!1;if(!g||!g.length)return!0;for(j=g.length-1;j>=0;j--)if(v=g[j],!(l<v.minLevel||l>v.maxLevel)&&(C=this.getLevelScale(l),R=v.x*C,I=v.y*C,L=R+v.width*C,V=I+v.height*C,R=Math.floor(R/this._tileWidth),I=Math.floor(I/this._tileWidth),L=Math.ceil(L/this._tileWidth),V=Math.ceil(V/this._tileWidth),R<=c&&c<L&&I<=u&&u<V))return!0;return!1}});function r(l,c){if(!c||!c.documentElement)throw new Error(s.getString("Errors.Xml"));var u=c.documentElement,g=u.localName||u.tagName,v=c.documentElement.namespaceURI,C=null,R=[],I,L,V,j,q;if(g=="Image")try{if(j=u.getElementsByTagName("Size")[0],j===void 0&&(j=u.getElementsByTagNameNS(v,"Size")[0]),C={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:u.getAttribute("Url"),Format:u.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(u.getAttribute("Overlap"),10),TileSize:parseInt(u.getAttribute("TileSize"),10),Size:{Height:parseInt(j.getAttribute("Height"),10),Width:parseInt(j.getAttribute("Width"),10)}}},!s.imageFormatSupported(C.Image.Format))throw new Error(s.getString("Errors.ImageFormat",C.Image.Format.toUpperCase()));for(I=u.getElementsByTagName("DisplayRect"),I===void 0&&(I=u.getElementsByTagNameNS(v,"DisplayRect")[0]),q=0;q<I.length;q++)L=I[q],V=L.getElementsByTagName("Rect")[0],V===void 0&&(V=L.getElementsByTagNameNS(v,"Rect")[0]),R.push({Rect:{X:parseInt(V.getAttribute("X"),10),Y:parseInt(V.getAttribute("Y"),10),Width:parseInt(V.getAttribute("Width"),10),Height:parseInt(V.getAttribute("Height"),10),MinLevel:parseInt(L.getAttribute("MinLevel"),10),MaxLevel:parseInt(L.getAttribute("MaxLevel"),10)}});return R.length&&(C.Image.DisplayRect=R),a(l,C)}catch(M){throw M instanceof Error?M:new Error(s.getString("Errors.Dzi"))}else{if(g=="Collection")throw new Error(s.getString("Errors.Dzc"));if(g=="Error"){var ae=u.getElementsByTagName("Message")[0],E=ae.firstChild.nodeValue;throw new Error(E)}}throw new Error(s.getString("Errors.Dzi"))}function a(l,c){var u=c.Image,g=u.Url,v=u.Format,C=u.Size,R=u.DisplayRect||[],I=parseInt(C.Width,10),L=parseInt(C.Height,10),V=parseInt(u.TileSize,10),j=parseInt(u.Overlap,10),q=[],ae,E;for(E=0;E<R.length;E++)ae=R[E].Rect,q.push(new s.DisplayRect(parseInt(ae.X,10),parseInt(ae.Y,10),parseInt(ae.Width,10),parseInt(ae.Height,10),parseInt(ae.MinLevel,10),parseInt(ae.MaxLevel,10)));return s.extend(!0,{width:I,height:L,tileSize:V,tileOverlap:j,minLevel:null,maxLevel:null,tilesUrl:g,fileFormat:v,displayRects:q},c)}}(OpenSeadragon),function(s){s.IIIFTileSource=function(u){if(s.extend(!0,this,u),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(u.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=u.version,this.tile_width&&this.tile_height)u.tileWidth=this.tile_width,u.tileHeight=this.tile_height;else if(this.tile_width)u.tileSize=this.tile_width;else if(this.tile_height)u.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)u.tileWidth=this.tiles[0].width,u.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var g=0;g<this.tiles.length;g++)for(var v=0;v<this.tiles[g].scaleFactors.length;v++){var C=this.tiles[g].scaleFactors[v];this.scale_factors.push(C),u.tileSizePerScaleFactor[C]={width:this.tiles[g].width,height:this.tiles[g].height||this.tiles[g].width}}}else if(r(u)){for(var R=Math.min(this.height,this.width),I=[256,512,1024],L=[],V=0;V<I.length;V++)I[V]<=R&&L.push(I[V]);L.length>0?u.tileSize=Math.max.apply(null,L):u.tileSize=R}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,u.levels=a(this),s.extend(!0,u,{width:u.levels[u.levels.length-1].width,height:u.levels[u.levels.length-1].height,tileSize:Math.max(u.height,u.width),tileOverlap:0,minLevel:0,maxLevel:u.levels.length-1}),this.levels=u.levels):s.console.error("Nothing in the info.json to construct image pyramids from");if(!u.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)u.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var j=Math.max.apply(null,this.scale_factors);u.maxLevel=Math.round(Math.log(j)*Math.LOG2E)}s.TileSource.apply(this,[u])},s.extend(s.IIIFTileSource.prototype,s.TileSource.prototype,{supports:function(u,g){return u.protocol&&u.protocol=="http://iiif.io/api/image"||u["@context"]&&(u["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||u["@context"]=="http://iiif.io/api/image/1/context.json")||u.profile&&u.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||u.identifier&&u.width&&u.height?!0:!!(u.documentElement&&u.documentElement.tagName=="info"&&u.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(u,g){if(s.isPlainObject(u)){if(!u["@context"])u["@context"]="http://iiif.io/api/image/1.0/context.json",u["@id"]=g.replace("/info.json",""),u.version=1;else{var v=u["@context"];if(Array.isArray(v)){for(var C=0;C<v.length;C++)if(typeof v[C]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(v[C])||v[C]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){v=v[C];break}}switch(v){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":u.version=1;break;case"http://iiif.io/api/image/2/context.json":u.version=2;break;case"http://iiif.io/api/image/3/context.json":u.version=3;break;default:s.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!u["@id"]&&u.id&&(u["@id"]=u.id),u.preferredFormats){for(var R=0;R<u.preferredFormats.length;R++)if(OpenSeadragon.imageFormatSupported(u.preferredFormats[R])){u.tileFormat=u.preferredFormats[R];break}}return u}else{var I=l(u);return I["@context"]="http://iiif.io/api/image/1.0/context.json",I["@id"]=g.replace("/info.xml",""),I.version=1,I}},getTileWidth:function(u){if(this.emulateLegacyImagePyramid)return s.TileSource.prototype.getTileWidth.call(this,u);var g=Math.pow(2,this.maxLevel-u);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[g]?this.tileSizePerScaleFactor[g].width:this._tileWidth},getTileHeight:function(u){if(this.emulateLegacyImagePyramid)return s.TileSource.prototype.getTileHeight.call(this,u);var g=Math.pow(2,this.maxLevel-u);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[g]?this.tileSizePerScaleFactor[g].height:this._tileHeight},getLevelScale:function(u){if(this.emulateLegacyImagePyramid){var g=NaN;return this.levels.length>0&&u>=this.minLevel&&u<=this.maxLevel&&(g=this.levels[u].width/this.levels[this.maxLevel].width),g}return s.TileSource.prototype.getLevelScale.call(this,u)},getNumTiles:function(u){if(this.emulateLegacyImagePyramid){var g=this.getLevelScale(u);return g?new s.Point(1,1):new s.Point(0,0)}return s.TileSource.prototype.getNumTiles.call(this,u)},getTileAtPoint:function(u,g){return this.emulateLegacyImagePyramid?new s.Point(0,0):s.TileSource.prototype.getTileAtPoint.call(this,u,g)},getTileUrl:function(u,g,v){if(this.emulateLegacyImagePyramid){var C=null;return this.levels.length>0&&u>=this.minLevel&&u<=this.maxLevel&&(C=this.levels[u].url),C}var R="0",I=Math.pow(.5,this.maxLevel-u),L=Math.ceil(this.width*I),V=Math.ceil(this.height*I),j,q,ae,E,M,U,W,X,Y,he,ie,we,Re,de;return j=this.getTileWidth(u),q=this.getTileHeight(u),ae=Math.ceil(j/I),E=Math.ceil(q/I),this.version===1?Re="native."+this.tileFormat:Re="default."+this.tileFormat,L<j&&V<q?(this.version===2&&L===this.width||this.version===3&&L===this.width&&V===this.height?he="max":this.version===3?he=L+","+V:he=L+",",M="full"):(U=g*ae,W=v*E,X=Math.min(ae,this.width-U),Y=Math.min(E,this.height-W),g===0&&v===0&&X===this.width&&Y===this.height?M="full":M=[U,W,X,Y].join(","),ie=Math.ceil(X*I),we=Math.ceil(Y*I),this.version===2&&ie===this.width||this.version===3&&ie===this.width&&we===this.height?he="max":this.version===3?he=ie+","+we:he=ie+","),de=[this["@id"],M,he,R,Re].join("/"),de},__testonly__:{canBeTiled:r,constructLevels:a}});function r(u){var g=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],v=Array.isArray(u.profile)?u.profile[0]:u.profile,C=g.indexOf(v)!==-1,R=!1;return u.version===2&&u.profile.length>1&&u.profile[1].supports&&(R=u.profile[1].supports.indexOf("sizeByW")!==-1),u.version===3&&u.extraFeatures&&(R=u.extraFeatures.indexOf("sizeByWh")!==-1),!C||R}function a(u){for(var g=[],v=0;v<u.sizes.length;v++)g.push({url:u["@id"]+"/full/"+u.sizes[v].width+","+(u.version===3?u.sizes[v].height:"")+"/0/default."+u.tileFormat,width:u.sizes[v].width,height:u.sizes[v].height});return g.sort(function(C,R){return C.width-R.width})}function l(u){if(!u||!u.documentElement)throw new Error(s.getString("Errors.Xml"));var g=u.documentElement,v=g.tagName,C=null;if(v=="info")try{return C={},c(g,C),C}catch(R){throw R instanceof Error?R:new Error(s.getString("Errors.IIIF"))}throw new Error(s.getString("Errors.IIIF"))}function c(u,g,v){var C,R;if(u.nodeType==3&&v)R=u.nodeValue.trim(),R.match(/^\d*$/)&&(R=Number(R)),g[v]?(s.isArray(g[v])||(g[v]=[g[v]]),g[v].push(R)):g[v]=R;else if(u.nodeType==1)for(C=0;C<u.childNodes.length;C++)c(u.childNodes[C],g,u.nodeName)}}(OpenSeadragon),function(s){s.OsmTileSource=function(r,a,l,c,u){var g;s.isPlainObject(r)?g=r:g={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!g.width||!g.height)&&(g.width=65572864,g.height=65572864),g.tileSize||(g.tileSize=256,g.tileOverlap=0),g.tilesUrl||(g.tilesUrl="http://tile.openstreetmap.org/"),g.minLevel=8,s.TileSource.apply(this,[g])},s.extend(s.OsmTileSource.prototype,s.TileSource.prototype,{supports:function(r,a){return r.type&&r.type=="openstreetmaps"},configure:function(r,a){return r},getTileUrl:function(r,a,l){return this.tilesUrl+(r-8)+"/"+a+"/"+l+".png"}})}(OpenSeadragon),function(s){s.TmsTileSource=function(r,a,l,c,u){var g;s.isPlainObject(r)?g=r:g={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var v=Math.ceil(g.width/256)*256,C=Math.ceil(g.height/256)*256,R;v>C?R=v/256:R=C/256,g.maxLevel=Math.ceil(Math.log(R)/Math.log(2))-1,g.tileSize=256,g.width=v,g.height=C,s.TileSource.apply(this,[g])},s.extend(s.TmsTileSource.prototype,s.TileSource.prototype,{supports:function(r,a){return r.type&&r.type=="tiledmapservice"},configure:function(r,a){return r},getTileUrl:function(r,a,l){var c=this.getNumTiles(r).y-1;return this.tilesUrl+r+"/"+a+"/"+(c-l)+".png"}})}(OpenSeadragon),function(s){s.ZoomifyTileSource=function(r){r.tileSize=256;var a={x:r.width,y:r.height};for(r.imageSizes=[{x:r.width,y:r.height}],r.gridSize=[this._getGridSize(r.width,r.height,r.tileSize)];parseInt(a.x,10)>r.tileSize||parseInt(a.y,10)>r.tileSize;)a.x=Math.floor(a.x/2),a.y=Math.floor(a.y/2),r.imageSizes.push({x:a.x,y:a.y}),r.gridSize.push(this._getGridSize(a.x,a.y,r.tileSize));r.imageSizes.reverse(),r.gridSize.reverse(),r.minLevel=0,r.maxLevel=r.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[r])},s.extend(s.ZoomifyTileSource.prototype,s.TileSource.prototype,{_getGridSize:function(r,a,l){return{x:Math.ceil(r/l),y:Math.ceil(a/l)}},_calculateAbsoluteTileNumber:function(r,a,l){for(var c=0,u={},g=0;g<r;g++)u=this.gridSize[g],c+=u.x*u.y;return u=this.gridSize[r],c+=u.x*l+a,c},supports:function(r,a){return r.type&&r.type=="zoomifytileservice"},configure:function(r,a){return r},getTileUrl:function(r,a,l){var c=0,u=this._calculateAbsoluteTileNumber(r,a,l);return c=Math.floor(u/256),this.tilesUrl+"TileGroup"+c+"/"+r+"-"+a+"-"+l+".jpg"}})}(OpenSeadragon),function(s){s.LegacyTileSource=function(c){var u,g,v;s.isArray(c)&&(u={type:"legacy-image-pyramid",levels:c}),u.levels=r(u.levels),u.levels.length>0?(g=u.levels[u.levels.length-1].width,v=u.levels[u.levels.length-1].height):(g=0,v=0,s.console.error("No supported image formats found")),s.extend(!0,u,{width:g,height:v,tileSize:Math.max(v,g),tileOverlap:0,minLevel:0,maxLevel:u.levels.length>0?u.levels.length-1:0}),s.TileSource.apply(this,[u]),this.levels=u.levels},s.extend(s.LegacyTileSource.prototype,s.TileSource.prototype,{supports:function(c,u){return c.type&&c.type=="legacy-image-pyramid"||c.documentElement&&c.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(c,u){var g;return s.isPlainObject(c)?g=l(this,c):g=a(this,c),g},getLevelScale:function(c){var u=NaN;return this.levels.length>0&&c>=this.minLevel&&c<=this.maxLevel&&(u=this.levels[c].width/this.levels[this.maxLevel].width),u},getNumTiles:function(c){var u=this.getLevelScale(c);return u?new s.Point(1,1):new s.Point(0,0)},getTileUrl:function(c,u,g){var v=null;return this.levels.length>0&&c>=this.minLevel&&c<=this.maxLevel&&(v=this.levels[c].url),v}});function r(c){var u=[],g,v;for(v=0;v<c.length;v++)g=c[v],g.height&&g.width&&g.url?u.push({url:g.url,width:Number(g.width),height:Number(g.height)}):s.console.error("Unsupported image format: %s",g.url?g.url:"<no URL>");return u.sort(function(C,R){return C.height-R.height})}function a(c,u){if(!u||!u.documentElement)throw new Error(s.getString("Errors.Xml"));var g=u.documentElement,v=g.tagName,C=null,R=[],I,L;if(v=="image")try{for(C={type:g.getAttribute("type"),levels:[]},R=g.getElementsByTagName("level"),L=0;L<R.length;L++)I=R[L],C.levels.push({url:I.getAttribute("url"),width:parseInt(I.getAttribute("width"),10),height:parseInt(I.getAttribute("height"),10)});return l(c,C)}catch(V){throw V instanceof Error?V:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(v=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(v=="error")throw new Error("Error: "+u)}throw new Error("Unknown element "+v)}function l(c,u){return u.levels}}(OpenSeadragon),function(s){s.ImageTileSource=function(r){r=s.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},r),s.TileSource.apply(this,[r])},s.extend(s.ImageTileSource.prototype,s.TileSource.prototype,{supports:function(r,a){return r.type&&r.type==="image"},configure:function(r,a){return r},getImageInfo:function(r){var a=this._image=new Image,l=this;this.crossOriginPolicy&&(a.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(a.useCredentials=this.ajaxWithCredentials),s.addEvent(a,"load",function(){l.width=Object.prototype.hasOwnProperty.call(a,"naturalWidth")?a.naturalWidth:a.width,l.height=Object.prototype.hasOwnProperty.call(a,"naturalHeight")?a.naturalHeight:a.height,l.aspectRatio=l.width/l.height,l.dimensions=new s.Point(l.width,l.height),l._tileWidth=l.width,l._tileHeight=l.height,l.tileOverlap=0,l.minLevel=0,l.levels=l._buildLevels(),l.maxLevel=l.levels.length-1,l.ready=!0,l.raiseEvent("ready",{tileSource:l})}),s.addEvent(a,"error",function(){l.raiseEvent("open-failed",{message:"Error loading image at "+r,source:r})}),a.src=r},getLevelScale:function(r){var a=NaN;return r>=this.minLevel&&r<=this.maxLevel&&(a=this.levels[r].width/this.levels[this.maxLevel].width),a},getNumTiles:function(r){var a=this.getLevelScale(r);return a?new s.Point(1,1):new s.Point(0,0)},getTileUrl:function(r,a,l){var c=null;return r>=this.minLevel&&r<=this.maxLevel&&(c=this.levels[r].url),c},getContext2D:function(r,a,l){var c=null;return r>=this.minLevel&&r<=this.maxLevel&&(c=this.levels[r].context2D),c},_buildLevels:function(){var r=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!s.supportsCanvas||!this.useCanvas)return delete this._image,r;var a=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,l=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,c=document.createElement("canvas"),u=c.getContext("2d");if(c.width=a,c.height=l,u.drawImage(this._image,0,0,a,l),r[0].context2D=u,delete this._image,s.isCanvasTainted(c))return r;for(;a>=2&&l>=2;){a=Math.floor(a/2),l=Math.floor(l/2);var g=document.createElement("canvas"),v=g.getContext("2d");g.width=a,g.height=l,v.drawImage(c,0,0,a,l),r.splice(0,0,{context2D:v,width:a,height:l}),c=g,u=v}return r}})}(OpenSeadragon),function(s){s.TileSourceCollection=function(r,a,l,c){s.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(s){s.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},s.Button=function(v){var C=this;s.EventSource.call(this),s.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:s.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:s.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},v),this.element=v.element||s.makeNeutralElement("div"),v.element||(this.imgRest=s.makeTransparentImage(this.srcRest),this.imgGroup=s.makeTransparentImage(this.srcGroup),this.imgHover=s.makeTransparentImage(this.srcHover),this.imgDown=s.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",s.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",s.Browser.vendor==s.BROWSERS.FIREFOX&&s.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=s.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new s.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(R){R.insideElementPressed?(u(C,s.ButtonState.DOWN),C.raiseEvent("enter",{originalEvent:R.originalEvent})):R.buttonDownAny||u(C,s.ButtonState.HOVER)},focusHandler:function(R){this.enterHandler(R),C.raiseEvent("focus",{originalEvent:R.originalEvent})},exitHandler:function(R){g(C,s.ButtonState.GROUP),R.insideElementPressed&&C.raiseEvent("exit",{originalEvent:R.originalEvent})},blurHandler:function(R){this.exitHandler(R),C.raiseEvent("blur",{originalEvent:R.originalEvent})},pressHandler:function(R){u(C,s.ButtonState.DOWN),C.raiseEvent("press",{originalEvent:R.originalEvent})},releaseHandler:function(R){R.insideElementPressed&&R.insideElementReleased?(g(C,s.ButtonState.HOVER),C.raiseEvent("release",{originalEvent:R.originalEvent})):R.insideElementPressed?g(C,s.ButtonState.GROUP):u(C,s.ButtonState.HOVER)},clickHandler:function(R){R.quick&&C.raiseEvent("click",{originalEvent:R.originalEvent})},keyHandler:function(R){return R.keyCode===13?(C.raiseEvent("click",{originalEvent:R.originalEvent}),C.raiseEvent("release",{originalEvent:R.originalEvent}),!1):!0}}),g(this,s.ButtonState.REST)},s.extend(s.Button.prototype,s.EventSource.prototype,{notifyGroupEnter:function(){u(this,s.ButtonState.GROUP)},notifyGroupExit:function(){g(this,s.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,s.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,s.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function r(v){s.requestAnimationFrame(function(){a(v)})}function a(v){var C,R,I;v.shouldFade&&(C=s.now(),R=C-v.fadeBeginTime,I=1-R/v.fadeLength,I=Math.min(1,I),I=Math.max(0,I),v.imgGroup&&s.setElementOpacity(v.imgGroup,I,!0),I>0&&r(v))}function l(v){v.shouldFade=!0,v.fadeBeginTime=s.now()+v.fadeDelay,window.setTimeout(function(){r(v)},v.fadeDelay)}function c(v){v.shouldFade=!1,v.imgGroup&&s.setElementOpacity(v.imgGroup,1,!0)}function u(v,C){v.element.disabled||(C>=s.ButtonState.GROUP&&v.currentState==s.ButtonState.REST&&(c(v),v.currentState=s.ButtonState.GROUP),C>=s.ButtonState.HOVER&&v.currentState==s.ButtonState.GROUP&&(v.imgHover&&(v.imgHover.style.visibility=""),v.currentState=s.ButtonState.HOVER),C>=s.ButtonState.DOWN&&v.currentState==s.ButtonState.HOVER&&(v.imgDown&&(v.imgDown.style.visibility=""),v.currentState=s.ButtonState.DOWN))}function g(v,C){v.element.disabled||(C<=s.ButtonState.HOVER&&v.currentState==s.ButtonState.DOWN&&(v.imgDown&&(v.imgDown.style.visibility="hidden"),v.currentState=s.ButtonState.HOVER),C<=s.ButtonState.GROUP&&v.currentState==s.ButtonState.HOVER&&(v.imgHover&&(v.imgHover.style.visibility="hidden"),v.currentState=s.ButtonState.GROUP),C<=s.ButtonState.REST&&v.currentState==s.ButtonState.GROUP&&(l(v),v.currentState=s.ButtonState.REST))}}(OpenSeadragon),function(s){s.ButtonGroup=function(r){s.extend(!0,this,{buttons:[],clickTimeThreshold:s.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:s.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},r);var a=this.buttons.concat([]),l=this,c;if(this.element=r.element||s.makeNeutralElement("div"),!r.group)for(this.element.style.display="inline-block",c=0;c<a.length;c++)this.element.appendChild(a[c].element);s.setElementTouchActionNone(this.element),this.tracker=new s.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(u){var g;for(g=0;g<l.buttons.length;g++)l.buttons[g].notifyGroupEnter()},exitHandler:function(u){var g;if(!u.insideElementPressed)for(g=0;g<l.buttons.length;g++)l.buttons[g].notifyGroupExit()}})},s.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(s){s.Rect=function(r,a,l,c,u){this.x=typeof r=="number"?r:0,this.y=typeof a=="number"?a:0,this.width=typeof l=="number"?l:0,this.height=typeof c=="number"?c:0,this.degrees=typeof u=="number"?u:0,this.degrees=s.positiveModulo(this.degrees,360);var g,v;this.degrees>=270?(g=this.getTopRight(),this.x=g.x,this.y=g.y,v=this.height,this.height=this.width,this.width=v,this.degrees-=270):this.degrees>=180?(g=this.getBottomRight(),this.x=g.x,this.y=g.y,this.degrees-=180):this.degrees>=90&&(g=this.getBottomLeft(),this.x=g.x,this.y=g.y,v=this.height,this.height=this.width,this.width=v,this.degrees-=90)},s.Rect.fromSummits=function(r,a,l){var c=r.distanceTo(a),u=r.distanceTo(l),g=a.minus(r),v=Math.atan(g.y/g.x);return g.x<0?v+=Math.PI:g.y<0&&(v+=2*Math.PI),new s.Rect(r.x,r.y,c,u,v/Math.PI*180)},s.Rect.prototype={clone:function(){return new s.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new s.Point(this.x,this.y)},getBottomRight:function(){return new s.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new s.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new s.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new s.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new s.Point(this.width,this.height)},equals:function(r){return r instanceof s.Rect&&this.x===r.x&&this.y===r.y&&this.width===r.width&&this.height===r.height&&this.degrees===r.degrees},times:function(r){return new s.Rect(this.x*r,this.y*r,this.width*r,this.height*r,this.degrees)},translate:function(r){return new s.Rect(this.x+r.x,this.y+r.y,this.width,this.height,this.degrees)},union:function(r){var a=this.getBoundingBox(),l=r.getBoundingBox(),c=Math.min(a.x,l.x),u=Math.min(a.y,l.y),g=Math.max(a.x+a.width,l.x+l.width),v=Math.max(a.y+a.height,l.y+l.height);return new s.Rect(c,u,g-c,v-u)},intersection:function(r){var a=1e-10,l=[],c=this.getTopLeft();r.containsPoint(c,a)&&l.push(c);var u=this.getTopRight();r.containsPoint(u,a)&&l.push(u);var g=this.getBottomLeft();r.containsPoint(g,a)&&l.push(g);var v=this.getBottomRight();r.containsPoint(v,a)&&l.push(v);var C=r.getTopLeft();this.containsPoint(C,a)&&l.push(C);var R=r.getTopRight();this.containsPoint(R,a)&&l.push(R);var I=r.getBottomLeft();this.containsPoint(I,a)&&l.push(I);var L=r.getBottomRight();this.containsPoint(L,a)&&l.push(L);for(var V=this._getSegments(),j=r._getSegments(),q=0;q<V.length;q++)for(var ae=V[q],E=0;E<j.length;E++){var M=j[E],U=W(ae[0],ae[1],M[0],M[1]);U&&l.push(U)}function W(de,He,ye,Fe){var ze=He.minus(de),qe=Fe.minus(ye),We=-qe.x*ze.y+ze.x*qe.y;if(We===0)return null;var ge=(ze.x*(de.y-ye.y)-ze.y*(de.x-ye.x))/We,Ye=(qe.x*(de.y-ye.y)-qe.y*(de.x-ye.x))/We;return-a<=ge&&ge<=1-a&&-a<=Ye&&Ye<=1-a?new s.Point(de.x+Ye*ze.x,de.y+Ye*ze.y):null}if(l.length===0)return null;for(var X=l[0].x,Y=l[0].x,he=l[0].y,ie=l[0].y,we=1;we<l.length;we++){var Re=l[we];Re.x<X&&(X=Re.x),Re.x>Y&&(Y=Re.x),Re.y<he&&(he=Re.y),Re.y>ie&&(ie=Re.y)}return new s.Rect(X,he,Y-X,ie-he)},_getSegments:function(){var r=this.getTopLeft(),a=this.getTopRight(),l=this.getBottomLeft(),c=this.getBottomRight();return[[r,a],[a,c],[c,l],[l,r]]},rotate:function(r,a){if(r=s.positiveModulo(r,360),r===0)return this.clone();a=a||this.getCenter();var l=this.getTopLeft().rotate(r,a),c=this.getTopRight().rotate(r,a),u=c.minus(l);u=u.apply(function(v){var C=1e-15;return Math.abs(v)<C?0:v});var g=Math.atan(u.y/u.x);return u.x<0?g+=Math.PI:u.y<0&&(g+=2*Math.PI),new s.Rect(l.x,l.y,this.width,this.height,g/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var r=this.getTopLeft(),a=this.getTopRight(),l=this.getBottomLeft(),c=this.getBottomRight(),u=Math.min(r.x,a.x,l.x,c.x),g=Math.max(r.x,a.x,l.x,c.x),v=Math.min(r.y,a.y,l.y,c.y),C=Math.max(r.y,a.y,l.y,c.y);return new s.Rect(u,v,g-u,C-v)},getIntegerBoundingBox:function(){var r=this.getBoundingBox(),a=Math.floor(r.x),l=Math.floor(r.y),c=Math.ceil(r.width+r.x-a),u=Math.ceil(r.height+r.y-l);return new s.Rect(a,l,c,u)},containsPoint:function(r,a){a=a||0;var l=this.getTopLeft(),c=this.getTopRight(),u=this.getBottomLeft(),g=c.minus(l),v=u.minus(l);return(r.x-l.x)*g.x+(r.y-l.y)*g.y>=-a&&(r.x-c.x)*g.x+(r.y-c.y)*g.y<=a&&(r.x-l.x)*v.x+(r.y-l.y)*v.y>=-a&&(r.x-u.x)*v.x+(r.y-u.y)*v.y<=a},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(s){var r={};s.ReferenceStrip=function(R){var I=this,L=R.viewer,V=s.getElementSize(L.element),j,q,ae;for(R.id||(R.id="referencestrip-"+s.now(),this.element=s.makeNeutralElement("div"),this.element.id=R.id,this.element.className="referencestrip"),R=s.extend(!0,{sizeRatio:s.DEFAULT_SETTINGS.referenceStripSizeRatio,position:s.DEFAULT_SETTINGS.referenceStripPosition,scroll:s.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:s.DEFAULT_SETTINGS.clickTimeThreshold},R,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),s.extend(this,R),r[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,q=this.element.style,q.marginTop="0px",q.marginRight="0px",q.marginBottom="0px",q.marginLeft="0px",q.left="0px",q.bottom="0px",q.border="0px",q.background="#000",q.position="relative",s.setElementTouchActionNone(this.element),s.setElementOpacity(this.element,.8),this.viewer=L,this.innerTracker=new s.MouseTracker({element:this.element,dragHandler:s.delegate(this,a),scrollHandler:s.delegate(this,l),enterHandler:s.delegate(this,u),exitHandler:s.delegate(this,g),keyDownHandler:s.delegate(this,v),keyHandler:s.delegate(this,C)}),R.width&&R.height?(this.element.style.width=R.width+"px",this.element.style.height=R.height+"px",L.addControl(this.element,{anchor:s.ControlAnchor.BOTTOM_LEFT})):R.scroll=="horizontal"?(this.element.style.width=V.x*R.sizeRatio*L.tileSources.length+12*L.tileSources.length+"px",this.element.style.height=V.y*R.sizeRatio+"px",L.addControl(this.element,{anchor:s.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=V.y*R.sizeRatio*L.tileSources.length+12*L.tileSources.length+"px",this.element.style.width=V.x*R.sizeRatio+"px",L.addControl(this.element,{anchor:s.ControlAnchor.TOP_LEFT})),this.panelWidth=V.x*this.sizeRatio+8,this.panelHeight=V.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},ae=0;ae<L.tileSources.length;ae++)j=s.makeNeutralElement("div"),j.id=this.element.id+"-"+ae,j.style.width=I.panelWidth+"px",j.style.height=I.panelHeight+"px",j.style.display="inline",j.style.float="left",j.style.cssFloat="left",j.style.styleFloat="left",j.style.padding="2px",s.setElementTouchActionNone(j),j.innerTracker=new s.MouseTracker({element:j,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(E){E.eventSource.dragging=s.now()},releaseHandler:function(E){var M=E.eventSource,U=M.element.id,W=Number(U.split("-")[2]),X=s.now();E.insideElementPressed&&E.insideElementReleased&&M.dragging&&X-M.dragging<M.clickTimeThreshold&&(M.dragging=null,L.goToPage(W))}}),this.element.appendChild(j),j.activePanel=!1,this.panels.push(j);c(this,this.scroll=="vertical"?V.y:V.x,0),this.setFocus(0)},s.extend(s.ReferenceStrip.prototype,s.EventSource.prototype,s.Viewer.prototype,{setFocus:function(R){var I=this.element.querySelector("#"+this.element.id+"-"+R),L=s.getElementSize(this.viewer.canvas),V=Number(this.element.style.width.replace("px","")),j=Number(this.element.style.height.replace("px","")),q=-Number(this.element.style.marginLeft.replace("px","")),ae=-Number(this.element.style.marginTop.replace("px","")),E;this.currentSelected!==I&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=I,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(E=Number(R)*(this.panelWidth+3),E>q+L.x-this.panelWidth?(E=Math.min(E,V-L.x),this.element.style.marginLeft=-E+"px",c(this,L.x,-E)):E<q&&(E=Math.max(0,E-L.x/2),this.element.style.marginLeft=-E+"px",c(this,L.x,-E))):(E=Number(R)*(this.panelHeight+3),E>ae+L.y-this.panelHeight?(E=Math.min(E,j-L.y),this.element.style.marginTop=-E+"px",c(this,L.y,-E)):E<ae&&(E=Math.max(0,E-L.y/2),this.element.style.marginTop=-E+"px",c(this,L.y,-E))),this.currentPage=R,u.call(this,{eventSource:this.innerTracker}))},update:function(){return r[this.id].animating?(s.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var R in this.miniViewers)this.miniViewers[R].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function a(R){var I=Number(this.element.style.marginLeft.replace("px","")),L=Number(this.element.style.marginTop.replace("px","")),V=Number(this.element.style.width.replace("px","")),j=Number(this.element.style.height.replace("px","")),q=s.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-R.delta.x>0?I>-(V-q.x)&&(this.element.style.marginLeft=I+R.delta.x*2+"px",c(this,q.x,I+R.delta.x*2)):-R.delta.x<0&&I<0&&(this.element.style.marginLeft=I+R.delta.x*2+"px",c(this,q.x,I+R.delta.x*2)):-R.delta.y>0?L>-(j-q.y)&&(this.element.style.marginTop=L+R.delta.y*2+"px",c(this,q.y,L+R.delta.y*2)):-R.delta.y<0&&L<0&&(this.element.style.marginTop=L+R.delta.y*2+"px",c(this,q.y,L+R.delta.y*2))),!1}function l(R){var I=Number(this.element.style.marginLeft.replace("px","")),L=Number(this.element.style.marginTop.replace("px","")),V=Number(this.element.style.width.replace("px","")),j=Number(this.element.style.height.replace("px","")),q=s.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?R.scroll>0?I>-(V-q.x)&&(this.element.style.marginLeft=I-R.scroll*60+"px",c(this,q.x,I-R.scroll*60)):R.scroll<0&&I<0&&(this.element.style.marginLeft=I-R.scroll*60+"px",c(this,q.x,I-R.scroll*60)):R.scroll<0?L>q.y-j&&(this.element.style.marginTop=L+R.scroll*60+"px",c(this,q.y,L+R.scroll*60)):R.scroll>0&&L<0&&(this.element.style.marginTop=L+R.scroll*60+"px",c(this,q.y,L+R.scroll*60))),!1}function c(R,I,L){var V,j,q,ae,E,M,U;for(R.scroll=="horizontal"?V=R.panelWidth:V=R.panelHeight,j=Math.ceil(I/V)+5,q=Math.ceil((Math.abs(L)+I)/V)+1,j=q-j,j=j<0?0:j,M=j;M<q&&M<R.panels.length;M++)if(U=R.panels[M],!U.activePanel){var W,X=R.viewer.tileSources[M];X.referenceStripThumbnailUrl?W={type:"image",url:X.referenceStripThumbnailUrl}:W=X,ae=new s.Viewer({id:U.id,tileSources:[W],element:U,navigatorSizeRatio:R.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:R.viewer.loadTilesWithAjax,ajaxHeaders:R.viewer.ajaxHeaders,useCanvas:R.useCanvas}),ae.displayRegion=s.makeNeutralElement("div"),ae.displayRegion.id=U.id+"-displayregion",ae.displayRegion.className="displayregion",E=ae.displayRegion.style,E.position="relative",E.top="0px",E.left="0px",E.fontSize="0px",E.overflow="hidden",E.float="left",E.cssFloat="left",E.styleFloat="left",E.zIndex=999999999,E.cursor="default",E.width=R.panelWidth-4+"px",E.height=R.panelHeight-4+"px",ae.displayRegion.innerTracker=new s.MouseTracker({element:ae.displayRegion,startDisabled:!0}),U.getElementsByTagName("div")[0].appendChild(ae.displayRegion),R.miniViewers[U.id]=ae,U.activePanel=!0}}function u(R){var I=R.eventSource.element;return this.scroll=="horizontal"?I.style.marginBottom="0px":I.style.marginLeft="0px",!1}function g(R){var I=R.eventSource.element;return this.scroll=="horizontal"?I.style.marginBottom="-"+s.getElementSize(I).y/2+"px":I.style.marginLeft="-"+s.getElementSize(I).x/2+"px",!1}function v(R){if(!R.preventDefaultAction&&!R.ctrl&&!R.alt&&!R.meta)switch(R.keyCode){case 38:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function C(R){if(!R.preventDefaultAction&&!R.ctrl&&!R.alt&&!R.meta)switch(R.keyCode){case 61:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(s){s.DisplayRect=function(r,a,l,c,u,g){s.Rect.apply(this,[r,a,l,c]),this.minLevel=u,this.maxLevel=g},s.extend(s.DisplayRect.prototype,s.Rect.prototype)}(OpenSeadragon),function(s){s.Spring=function(a){var l=arguments;typeof a!="object"&&(a={initial:l.length&&typeof l[0]=="number"?l[0]:void 0,springStiffness:l.length>1?l[1].springStiffness:5,animationTime:l.length>1?l[1].animationTime:1.5}),s.console.assert(typeof a.springStiffness=="number"&&a.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),s.console.assert(typeof a.animationTime=="number"&&a.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),a.exponential&&(this._exponential=!0,delete a.exponential),s.extend(!0,this,a),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:s.now()},s.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},s.Spring.prototype={resetTo:function(a){s.console.assert(!this._exponential||a!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=a,this.start.time=this.target.time=this.current.time=s.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(a){s.console.assert(!this._exponential||a!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=a,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(a){this.start.value+=a,this.target.value+=a,this._exponential&&(s.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(a){this._exponential=a,this._exponential&&(s.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=s.now();var a,l;this._exponential?(a=this.start._logValue,l=this.target._logValue):(a=this.start.value,l=this.target.value);var c=this.current.time>=this.target.time?l:a+(l-a)*r(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),u=this.current.value;return this._exponential?this.current.value=Math.exp(c):this.current.value=c,u!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function r(a,l){return(1-Math.exp(a*-l))/(1-Math.exp(-a))}}(OpenSeadragon),function(s){function r(l){s.extend(!0,this,{timeout:s.DEFAULT_SETTINGS.timeout,jobId:null},l),this.image=null}r.prototype={errorMsg:null,start:function(){var l=this,c=this.abort;this.image=new Image,this.image.onload=function(){l.finish(!0)},this.image.onabort=this.image.onerror=function(){l.errorMsg="Image load aborted",l.finish(!1)},this.jobId=window.setTimeout(function(){l.errorMsg="Image load exceeded timeout ("+l.timeout+" ms)",l.finish(!1)},this.timeout),this.loadWithAjax?(this.request=s.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(u){var g;try{g=new window.Blob([u.response])}catch(I){var v=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(I.name==="TypeError"&&v){var C=new v;C.append(u.response),g=C.getBlob()}}g.size===0&&(l.errorMsg="Empty image response.",l.finish(!1));var R=(window.URL||window.webkitURL).createObjectURL(g);l.image.src=R},error:function(u){l.errorMsg="Image load aborted - XHR error",l.finish(!1)}}),this.abort=function(){l.request.abort(),typeof c=="function"&&c()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(l){this.image.onload=this.image.onerror=this.image.onabort=null,l||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},s.ImageLoader=function(l){s.extend(!0,this,{jobLimit:s.DEFAULT_SETTINGS.imageLoaderLimit,timeout:s.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},l)},s.ImageLoader.prototype={addJob:function(l){var c=this,u=function(C){a(c,C,l.callback)},g={src:l.src,loadWithAjax:l.loadWithAjax,ajaxHeaders:l.loadWithAjax?l.ajaxHeaders:null,crossOriginPolicy:l.crossOriginPolicy,ajaxWithCredentials:l.ajaxWithCredentials,callback:u,abort:l.abort,timeout:this.timeout},v=new r(g);!this.jobLimit||this.jobsInProgress<this.jobLimit?(v.start(),this.jobsInProgress++):this.jobQueue.push(v)},clear:function(){for(var l=0;l<this.jobQueue.length;l++){var c=this.jobQueue[l];typeof c.abort=="function"&&c.abort()}this.jobQueue=[]}};function a(l,c,u){var g;l.jobsInProgress--,(!l.jobLimit||l.jobsInProgress<l.jobLimit)&&l.jobQueue.length>0&&(g=l.jobQueue.shift(),g.start(),l.jobsInProgress++),u(c.image,c.errorMsg,c.request)}}(OpenSeadragon),function(s){s.Tile=function(r,a,l,c,u,g,v,C,R,I){this.level=r,this.x=a,this.y=l,this.bounds=c,this.sourceBounds=I,this.exists=u,this.url=g,this.context2D=v,this.loadWithAjax=C,this.ajaxHeaders=R,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},s.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(r){if(!this.cacheImageRecord){s.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){s.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=s.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=r&&r.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",s.setElementOpacity(this.element,this.opacity)},drawCanvas:function(r,a,l,c){var u=this.position.times(s.pixelDensityRatio),g=this.size.times(s.pixelDensityRatio),v;if(!this.context2D&&!this.cacheImageRecord){s.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(v=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!v){s.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}r.save(),r.globalAlpha=this.opacity,typeof l=="number"&&l!==1&&(u=u.times(l),g=g.times(l)),c instanceof s.Point&&(u=u.plus(c)),r.globalAlpha===1&&this._hasTransparencyChannel()&&r.clearRect(u.x,u.y,g.x,g.y),a({context:r,tile:this,rendered:v});var C,R;this.sourceBounds?(C=Math.min(this.sourceBounds.width,v.canvas.width),R=Math.min(this.sourceBounds.height,v.canvas.height)):(C=v.canvas.width,R=v.canvas.height),r.drawImage(v.canvas,0,0,C,R,u.x,u.y,g.x,g.y),r.restore()},getScaleForEdgeSmoothing:function(){var r;if(this.cacheImageRecord)r=this.cacheImageRecord.getRenderedContext();else if(this.context2D)r=this.context2D;else return s.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return r.canvas.width/(this.size.x*s.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(r,a,l){var c=Math.max(1,Math.ceil((l.x-a.x)/2)),u=Math.max(1,Math.ceil((l.y-a.y)/2));return new s.Point(c,u).minus(this.position.times(s.pixelDensityRatio).times(r||1).apply(function(g){return g%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(s){s.OverlayPlacement=s.Placement,s.OverlayRotationMode=s.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),s.Overlay=function(r,a,l){var c;s.isPlainObject(r)?c=r:c={element:r,location:a,placement:l},this.element=c.element,this.style=c.element.style,this._init(c)},s.Overlay.prototype={_init:function(r){this.location=r.location,this.placement=r.placement===void 0?s.Placement.TOP_LEFT:r.placement,this.onDraw=r.onDraw,this.checkResize=r.checkResize===void 0?!0:r.checkResize,this.width=r.width===void 0?null:r.width,this.height=r.height===void 0?null:r.height,this.rotationMode=r.rotationMode||s.OverlayRotationMode.EXACT,this.location instanceof s.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=s.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new s.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(r,a){var l=s.Placement.properties[this.placement];!l||(l.isHorizontallyCentered?r.x-=a.x/2:l.isRight&&(r.x-=a.x),l.isVerticallyCentered?r.y-=a.y/2:l.isBottom&&(r.y-=a.y))},destroy:function(){var r=this.element,a=this.style;r.parentNode&&(r.parentNode.removeChild(r),r.prevElementParent&&(a.display="none",document.body.appendChild(r))),this.onDraw=null,a.top="",a.left="",a.position="",this.width!==null&&(a.width=""),this.height!==null&&(a.height="");var l=s.getCssPropertyWithVendorPrefix("transformOrigin"),c=s.getCssPropertyWithVendorPrefix("transform");l&&c&&(a[l]="",a[c]="")},drawHTML:function(r,a){var l=this.element;l.parentNode!==r&&(l.prevElementParent=l.parentNode,l.prevNextSibling=l.nextSibling,r.appendChild(l),this.style.position="absolute",this.size=s.getElementSize(l));var c=this._getOverlayPositionAndSize(a),u=c.position,g=this.size=c.size,v=c.rotate;if(this.onDraw)this.onDraw(u,g,this.element);else{var C=this.style;C.left=u.x+"px",C.top=u.y+"px",this.width!==null&&(C.width=g.x+"px"),this.height!==null&&(C.height=g.y+"px");var R=s.getCssPropertyWithVendorPrefix("transformOrigin"),I=s.getCssPropertyWithVendorPrefix("transform");R&&I&&(v?(C[R]=this._getTransformOrigin(),C[I]="rotate("+v+"deg)"):(C[R]="",C[I]="")),C.display!=="none"&&(C.display="block")}},_getOverlayPositionAndSize:function(r){var a=r.pixelFromPoint(this.location,!0),l=this._getSizeInPixels(r);this.adjust(a,l);var c=0;if(r.degrees&&this.rotationMode!==s.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===s.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var u=new s.Rect(a.x,a.y,l.x,l.y),g=this._getBoundingBox(u,r.degrees);a=g.getTopLeft(),l=g.getSize()}else c=r.degrees;return{position:a,size:l,rotate:c}},_getSizeInPixels:function(r){var a=this.size.x,l=this.size.y;if(this.width!==null||this.height!==null){var c=r.deltaPixelsFromPointsNoRotate(new s.Point(this.width||0,this.height||0),!0);this.width!==null&&(a=c.x),this.height!==null&&(l=c.y)}if(this.checkResize&&(this.width===null||this.height===null)){var u=this.size=s.getElementSize(this.element);this.width===null&&(a=u.x),this.height===null&&(l=u.y)}return new s.Point(a,l)},_getBoundingBox:function(r,a){var l=this._getPlacementPoint(r);return r.rotate(a,l).getBoundingBox()},_getPlacementPoint:function(r){var a=new s.Point(r.x,r.y),l=s.Placement.properties[this.placement];return l&&(l.isHorizontallyCentered?a.x+=r.width/2:l.isRight&&(a.x+=r.width),l.isVerticallyCentered?a.y+=r.height/2:l.isBottom&&(a.y+=r.height)),a},_getTransformOrigin:function(){var r="",a=s.Placement.properties[this.placement];return a&&(a.isLeft?r="left":a.isRight&&(r="right"),a.isTop?r+=" top":a.isBottom&&(r+=" bottom")),r},update:function(r,a){var l=s.isPlainObject(r)?r:{location:r,placement:a};this._init({location:l.location||this.location,placement:l.placement!==void 0?l.placement:this.placement,onDraw:l.onDraw||this.onDraw,checkResize:l.checkResize||this.checkResize,width:l.width!==void 0?l.width:this.width,height:l.height!==void 0?l.height:this.height,rotationMode:l.rotationMode||this.rotationMode})},getBounds:function(r){s.console.assert(r,"A viewport must now be passed to Overlay.getBounds.");var a=this.width,l=this.height;if(a===null||l===null){var c=r.deltaPointsFromPixelsNoRotate(this.size,!0);a===null&&(a=c.x),l===null&&(l=c.y)}var u=this.location.clone();return this.adjust(u,new s.Point(a,l)),this._adjustBoundsForRotation(r,new s.Rect(u.x,u.y,a,l))},_adjustBoundsForRotation:function(r,a){if(!r||r.degrees===0||this.rotationMode===s.OverlayRotationMode.EXACT)return a;if(this.rotationMode===s.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return a;var l=this._getOverlayPositionAndSize(r);return r.viewerElementToViewportRectangle(new s.Rect(l.position.x,l.position.y,l.size.x,l.size.y))}return a.rotate(-r.degrees,this._getPlacementPoint(a))}}}(OpenSeadragon),function(s){s.Drawer=function(r){s.console.assert(r.viewer,"[Drawer] options.viewer is required");var a=arguments;if(s.isPlainObject(r)||(r={source:a[0],viewport:a[1],element:a[2]}),s.console.assert(r.viewport,"[Drawer] options.viewport is required"),s.console.assert(r.element,"[Drawer] options.element is required"),r.source&&s.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=r.viewer,this.viewport=r.viewport,this.debugGridColor=typeof r.debugGridColor=="string"?[r.debugGridColor]:r.debugGridColor||s.DEFAULT_SETTINGS.debugGridColor,r.opacity&&s.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=s.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=s.getElement(r.element),this.canvas=s.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var l=this._calculateCanvasSize();this.canvas.width=l.x,this.canvas.height=l.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",s.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},s.Drawer.prototype={addOverlay:function(r,a,l,c){return s.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(r,a,l,c),this},updateOverlay:function(r,a,l){return s.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(r,a,l),this},removeOverlay:function(r){return s.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(r),this},clearOverlays:function(){return s.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(r){var a=this.viewport.pixelFromPointNoRotate(r,!0);return new s.Point(a.x*s.pixelDensityRatio,a.y*s.pixelDensityRatio)},clipWithPolygons:function(r,a){if(this.useCanvas){var l=this._getContext(a);l.beginPath(),r.forEach(function(c){c.forEach(function(u,g){l[g===0?"moveTo":"lineTo"](u.x,u.y)})}),l.clip()}},setOpacity:function(r){s.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var a=this.viewer.world,l=0;l<a.getItemCount();l++)a.getItemAt(l).setOpacity(r);return this},getOpacity:function(){s.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var r=this.viewer.world,a=0,l=0;l<r.getItemCount();l++){var c=r.getItemAt(l).getOpacity();c>a&&(a=c)}return a},needsUpdate:function(){return s.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return s.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return s.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return s.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var r=this._calculateCanvasSize();if((this.canvas.width!=r.x||this.canvas.height!=r.y)&&(this.canvas.width=r.x,this.canvas.height=r.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var a=this._calculateSketchCanvasSize();this.sketchCanvas.width=a.x,this.sketchCanvas.height=a.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(r,a){if(this.useCanvas){var l=this._getContext(r);if(a)l.clearRect(a.x,a.y,a.width,a.height);else{var c=l.canvas;l.clearRect(0,0,c.width,c.height)}}},viewportToDrawerRectangle:function(r){var a=this.viewport.pixelFromPointNoRotate(r.getTopLeft(),!0),l=this.viewport.deltaPixelsFromPointsNoRotate(r.getSize(),!0);return new s.Rect(a.x*s.pixelDensityRatio,a.y*s.pixelDensityRatio,l.x*s.pixelDensityRatio,l.y*s.pixelDensityRatio)},drawTile:function(r,a,l,c,u){if(s.console.assert(r,"[Drawer.drawTile] tile is required"),s.console.assert(a,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var g=this._getContext(l);c=c||1,r.drawCanvas(g,a,c,u)}else r.drawHTML(this.canvas)},_getContext:function(r){var a=this.context;if(r){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var l=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=l.x,this.sketchCanvas.height=l.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var c=this;this.viewer.addHandler("rotate",function u(){if(c.viewport.getRotation()!==0){c.viewer.removeHandler("rotate",u);var g=c._calculateSketchCanvasSize();c.sketchCanvas.width=g.x,c.sketchCanvas.height=g.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}a=this.sketchContext}return a},saveContext:function(r){!this.useCanvas||this._getContext(r).save()},restoreContext:function(r){!this.useCanvas||this._getContext(r).restore()},setClip:function(r,a){if(this.useCanvas){var l=this._getContext(a);l.beginPath(),l.rect(r.x,r.y,r.width,r.height),l.clip()}},drawRectangle:function(r,a,l){if(this.useCanvas){var c=this._getContext(l);c.save(),c.fillStyle=a,c.fillRect(r.x,r.y,r.width,r.height),c.restore()}},blendSketch:function(r,a,l,c){var u=r;if(s.isPlainObject(u)||(u={opacity:r,scale:a,translate:l,compositeOperation:c}),!(!this.useCanvas||!this.sketchCanvas)){r=u.opacity,c=u.compositeOperation;var g=u.bounds;if(this.context.save(),this.context.globalAlpha=r,c&&(this.context.globalCompositeOperation=c),g)g.x<0&&(g.width+=g.x,g.x=0),g.x+g.width>this.canvas.width&&(g.width=this.canvas.width-g.x),g.y<0&&(g.height+=g.y,g.y=0),g.y+g.height>this.canvas.height&&(g.height=this.canvas.height-g.y),this.context.drawImage(this.sketchCanvas,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);else{a=u.scale||1,l=u.translate;var v=l instanceof s.Point?l:new s.Point(0,0),C=0,R=0;if(l){var I=this.sketchCanvas.width-this.canvas.width,L=this.sketchCanvas.height-this.canvas.height;C=Math.round(I/2),R=Math.round(L/2)}this.context.drawImage(this.sketchCanvas,v.x-C*a,v.y-R*a,(this.canvas.width+2*C)*a,(this.canvas.height+2*R)*a,-C,-R,this.canvas.width+2*C,this.canvas.height+2*R)}this.context.restore()}},drawDebugInfo:function(r,a,l,c){if(this.useCanvas){var u=this.viewer.world.getIndexOfItem(c)%this.debugGridColor.length,g=this.context;g.save(),g.lineWidth=2*s.pixelDensityRatio,g.font="small-caps bold "+13*s.pixelDensityRatio+"px arial",g.strokeStyle=this.debugGridColor[u],g.fillStyle=this.debugGridColor[u],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),c.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:c.getRotation(!0),point:c.viewport.pixelFromPointNoRotate(c._getRotationPoint(!0),!0)}),c.viewport.degrees===0&&c.getRotation(!0)%360==0&&c._drawer.viewer.viewport.getFlip()&&c._drawer._flip(),g.strokeRect(r.position.x*s.pixelDensityRatio,r.position.y*s.pixelDensityRatio,r.size.x*s.pixelDensityRatio,r.size.y*s.pixelDensityRatio);var v=(r.position.x+r.size.x/2)*s.pixelDensityRatio,C=(r.position.y+r.size.y/2)*s.pixelDensityRatio;g.translate(v,C),g.rotate(Math.PI/180*-this.viewport.degrees),g.translate(-v,-C),r.x===0&&r.y===0&&(g.fillText("Zoom: "+this.viewport.getZoom(),r.position.x*s.pixelDensityRatio,(r.position.y-30)*s.pixelDensityRatio),g.fillText("Pan: "+this.viewport.getBounds().toString(),r.position.x*s.pixelDensityRatio,(r.position.y-20)*s.pixelDensityRatio)),g.fillText("Level: "+r.level,(r.position.x+10)*s.pixelDensityRatio,(r.position.y+20)*s.pixelDensityRatio),g.fillText("Column: "+r.x,(r.position.x+10)*s.pixelDensityRatio,(r.position.y+30)*s.pixelDensityRatio),g.fillText("Row: "+r.y,(r.position.x+10)*s.pixelDensityRatio,(r.position.y+40)*s.pixelDensityRatio),g.fillText("Order: "+l+" of "+a,(r.position.x+10)*s.pixelDensityRatio,(r.position.y+50)*s.pixelDensityRatio),g.fillText("Size: "+r.size.toString(),(r.position.x+10)*s.pixelDensityRatio,(r.position.y+60)*s.pixelDensityRatio),g.fillText("Position: "+r.position.toString(),(r.position.x+10)*s.pixelDensityRatio,(r.position.y+70)*s.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),c.getRotation(!0)%360!=0&&this._restoreRotationChanges(),c.viewport.degrees===0&&c.getRotation(!0)%360==0&&c._drawer.viewer.viewport.getFlip()&&c._drawer._flip(),g.restore()}},debugRect:function(r){if(this.useCanvas){var a=this.context;a.save(),a.lineWidth=2*s.pixelDensityRatio,a.strokeStyle=this.debugGridColor[0],a.fillStyle=this.debugGridColor[0],a.strokeRect(r.x*s.pixelDensityRatio,r.y*s.pixelDensityRatio,r.width*s.pixelDensityRatio,r.height*s.pixelDensityRatio),a.restore()}},setImageSmoothingEnabled:function(r){this.useCanvas&&(this._imageSmoothingEnabled=r,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(r){r.msImageSmoothingEnabled=this._imageSmoothingEnabled,r.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(r){var a=this._getContext(r).canvas;return new s.Point(a.width,a.height)},getCanvasCenter:function(){return new s.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(r){var a=r.point?r.point.times(s.pixelDensityRatio):this.getCanvasCenter(),l=this._getContext(r.useSketch);l.save(),l.translate(a.x,a.y),this.viewer.viewport.flipped?(l.rotate(Math.PI/180*-r.degrees),l.scale(-1,1)):l.rotate(Math.PI/180*r.degrees),l.translate(-a.x,-a.y)},_flip:function(r){r=r||{};var a=r.point?r.point.times(s.pixelDensityRatio):this.getCanvasCenter(),l=this._getContext(r.useSketch);l.translate(a.x,0),l.scale(-1,1),l.translate(-a.x,0)},_restoreRotationChanges:function(r){var a=this._getContext(r);a.restore()},_calculateCanvasSize:function(){var r=s.pixelDensityRatio,a=this.viewport.getContainerSize();return{x:Math.round(a.x*r),y:Math.round(a.y*r)}},_calculateSketchCanvasSize:function(){var r=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return r;var a=Math.ceil(Math.sqrt(r.x*r.x+r.y*r.y));return{x:a,y:a}}}}(OpenSeadragon),function(s){s.Viewport=function(r){var a=arguments;a.length&&a[0]instanceof s.Point&&(r={containerSize:a[0],contentSize:a[1],config:a[2]}),r.config&&(s.extend(!0,r,r.config),delete r.config),this._margins=s.extend({left:0,top:0,right:0,bottom:0},r.margins||{}),delete r.margins,s.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:s.DEFAULT_SETTINGS.springStiffness,animationTime:s.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:s.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:s.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:s.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:s.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:s.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:s.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:s.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:s.DEFAULT_SETTINGS.maxZoomLevel,degrees:s.DEFAULT_SETTINGS.degrees,flipped:s.DEFAULT_SETTINGS.flipped,homeFillsViewer:s.DEFAULT_SETTINGS.homeFillsViewer},r),this._updateContainerInnerSize(),this.centerSpringX=new s.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new s.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new s.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new s.Rect(0,0,1,1),1),this.goHome(!0),this.update()},s.Viewport.prototype={resetContentSize:function(r){return s.console.assert(r,"[Viewport.resetContentSize] contentSize is required"),s.console.assert(r instanceof s.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),s.console.assert(r.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),s.console.assert(r.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new s.Rect(0,0,1,r.y/r.x),r.x),this},setHomeBounds:function(r,a){s.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(r,a)},_setContentBounds:function(r,a){s.console.assert(r,"[Viewport._setContentBounds] bounds is required"),s.console.assert(r instanceof s.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),s.console.assert(r.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),s.console.assert(r.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=r.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(a),this._contentBounds=r.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(a),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:a,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var r=this._contentAspectRatio/this.getAspectRatio(),a;return this.homeFillsViewer?a=r>=1?r:1:a=r>=1?1:r,a/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var r=this._contentBounds.getCenter(),a=1/this.getHomeZoom(),l=a/this.getAspectRatio();return new s.Rect(r.x-a/2,r.y-l/2,a,l)},goHome:function(r){return this.viewer&&this.viewer.raiseEvent("home",{immediately:r}),this.fitBounds(this.getHomeBounds(),r)},getMinZoom:function(){var r=this.getHomeZoom(),a=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*r;return a},getMaxZoom:function(){var r=this.maxZoomLevel;return r||(r=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,r/=this._contentBounds.width),Math.max(r,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new s.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return s.extend({},this._margins)},setMargins:function(r){s.console.assert(s.type(r)==="object","[Viewport.setMargins] margins must be an object"),this._margins=s.extend({left:0,top:0,right:0,bottom:0},r),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(r){return this.getBoundsNoRotate(r).rotate(-this.getRotation())},getBoundsNoRotate:function(r){var a=this.getCenter(r),l=1/this.getZoom(r),c=l/this.getAspectRatio();return new s.Rect(a.x-l/2,a.y-c/2,l,c)},getBoundsWithMargins:function(r){return this.getBoundsNoRotateWithMargins(r).rotate(-this.getRotation(),this.getCenter(r))},getBoundsNoRotateWithMargins:function(r){var a=this.getBoundsNoRotate(r),l=this._containerInnerSize.x*this.getZoom(r);return a.x-=this._margins.left/l,a.y-=this._margins.top/l,a.width+=(this._margins.left+this._margins.right)/l,a.height+=(this._margins.top+this._margins.bottom)/l,a},getCenter:function(r){var a=new s.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),l=new s.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),c,u,g,v,C,R,I,L;return r?a:this.zoomPoint?(c=this.pixelFromPoint(this.zoomPoint,!0),u=this.getZoom(),g=1/u,v=g/this.getAspectRatio(),C=new s.Rect(a.x-g/2,a.y-v/2,g,v),R=this._pixelFromPoint(this.zoomPoint,C),I=R.minus(c),L=I.divide(this._containerInnerSize.x*u),l.plus(L)):l},getZoom:function(r){return r?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(r){return Math.max(Math.min(r,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(r){var a=new s.Rect(r.x,r.y,r.width,r.height);if(!this.wrapHorizontal){var l=this.visibilityRatio*a.width,c=a.x+a.width,u=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,g=this._contentBoundsNoRotate.x-c+l,v=u-a.x-l;l>this._contentBoundsNoRotate.width?a.x+=(g+v)/2:v<0?a.x+=v:g>0&&(a.x+=g)}if(!this.wrapVertical){var C=this.visibilityRatio*a.height,R=a.y+a.height,I=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,L=this._contentBoundsNoRotate.y-R+C,V=I-a.y-C;C>this._contentBoundsNoRotate.height?a.y+=(L+V)/2:V<0?a.y+=V:L>0&&(a.y+=L)}return a},_raiseConstraintsEvent:function(r){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:r})},applyConstraints:function(r){var a=this.getZoom(),l=this._applyZoomConstraints(a);a!==l&&this.zoomTo(l,this.zoomPoint,r);var c=this.getBoundsNoRotate(),u=this._applyBoundaryConstraints(c);return this._raiseConstraintsEvent(r),(c.x!==u.x||c.y!==u.y||r)&&this.fitBounds(u.rotate(-this.getRotation()),r),this},ensureVisible:function(r){return this.applyConstraints(r)},_fitBounds:function(r,a){a=a||{};var l=a.immediately||!1,c=a.constraints||!1,u=this.getAspectRatio(),g=r.getCenter(),v=new s.Rect(r.x,r.y,r.width,r.height,r.degrees+this.getRotation()).getBoundingBox();v.getAspectRatio()>=u?v.height=v.width/u:v.width=v.height*u,v.x=g.x-v.width/2,v.y=g.y-v.height/2;var C=1/v.width;if(c){var R=v.getAspectRatio(),I=this._applyZoomConstraints(C);C!==I&&(C=I,v.width=1/C,v.x=g.x-v.width/2,v.height=v.width/R,v.y=g.y-v.height/2),v=this._applyBoundaryConstraints(v),g=v.getCenter(),this._raiseConstraintsEvent(l)}if(l)return this.panTo(g,!0),this.zoomTo(C,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var L=this.getBounds(),V=this.getZoom();if(V===0||Math.abs(C/V-1)<1e-8)return this.zoomTo(C,!0),this.panTo(g,l);v=v.rotate(-this.getRotation());var j=v.getTopLeft().times(C).minus(L.getTopLeft().times(V)).divide(C-V);return this.zoomTo(C,j,l)},fitBounds:function(r,a){return this._fitBounds(r,{immediately:a,constraints:!1})},fitBoundsWithConstraints:function(r,a){return this._fitBounds(r,{immediately:a,constraints:!0})},fitVertically:function(r){var a=new s.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(a,r)},fitHorizontally:function(r){var a=new s.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(a,r)},getConstrainedBounds:function(r){var a,l;return a=this.getBounds(r),l=this._applyBoundaryConstraints(a),l},panBy:function(r,a){var l=new s.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(l.plus(r),a)},panTo:function(r,a){return a?(this.centerSpringX.resetTo(r.x),this.centerSpringY.resetTo(r.y)):(this.centerSpringX.springTo(r.x),this.centerSpringY.springTo(r.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:r,immediately:a}),this},zoomBy:function(r,a,l){return this.zoomTo(this.zoomSpring.target.value*r,a,l)},zoomTo:function(r,a,l){var c=this;return this.zoomPoint=a instanceof s.Point&&!isNaN(a.x)&&!isNaN(a.y)?a:null,l?this._adjustCenterSpringsForZoomPoint(function(){c.zoomSpring.resetTo(r)}):this.zoomSpring.springTo(r),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:r,refPoint:a,immediately:l}),this},setRotation:function(r){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=s.positiveModulo(r,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:r}),this)},getRotation:function(){return this.degrees},resize:function(r,a){var l=this.getBoundsNoRotate(),c=l,u;return this.containerSize.x=r.x,this.containerSize.y=r.y,this._updateContainerInnerSize(),a&&(u=r.x/this.containerSize.x,c.width=l.width*u,c.height=c.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:r,maintain:a}),this.fitBounds(c,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new s.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var r=this;this._adjustCenterSpringsForZoomPoint(function(){r.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var a=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,a},_adjustCenterSpringsForZoomPoint:function(r){if(this.zoomPoint){var a=this.pixelFromPoint(this.zoomPoint,!0);r();var l=this.pixelFromPoint(this.zoomPoint,!0),c=l.minus(a),u=this.deltaPointsFromPixels(c,!0);this.centerSpringX.shiftBy(u.x),this.centerSpringY.shiftBy(u.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else r()},deltaPixelsFromPointsNoRotate:function(r,a){return r.times(this._containerInnerSize.x*this.getZoom(a))},deltaPixelsFromPoints:function(r,a){return this.deltaPixelsFromPointsNoRotate(r.rotate(this.getRotation()),a)},deltaPointsFromPixelsNoRotate:function(r,a){return r.divide(this._containerInnerSize.x*this.getZoom(a))},deltaPointsFromPixels:function(r,a){return this.deltaPointsFromPixelsNoRotate(r,a).rotate(-this.getRotation())},pixelFromPointNoRotate:function(r,a){return this._pixelFromPointNoRotate(r,this.getBoundsNoRotate(a))},pixelFromPoint:function(r,a){return this._pixelFromPoint(r,this.getBoundsNoRotate(a))},_pixelFromPointNoRotate:function(r,a){return r.minus(a.getTopLeft()).times(this._containerInnerSize.x/a.width).plus(new s.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(r,a){return this._pixelFromPointNoRotate(r.rotate(this.getRotation(),this.getCenter(!0)),a)},pointFromPixelNoRotate:function(r,a){var l=this.getBoundsNoRotate(a);return r.minus(new s.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/l.width).plus(l.getTopLeft())},pointFromPixel:function(r,a){return this.pointFromPixelNoRotate(r,a).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(r,a){var l=this._contentBoundsNoRotate.width;return new s.Point(r*this._contentSizeNoRotate.x/l,a*this._contentSizeNoRotate.x/l)},viewportToImageCoordinates:function(r,a){if(r instanceof s.Point)return this.viewportToImageCoordinates(r.x,r.y);if(this.viewer){var l=this.viewer.world.getItemCount();if(l>1)s.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(l===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageCoordinates(r,a,!0)}}return this._viewportToImageDelta(r-this._contentBoundsNoRotate.x,a-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(r,a){var l=this._contentBoundsNoRotate.width;return new s.Point(r/this._contentSizeNoRotate.x*l,a/this._contentSizeNoRotate.x*l)},imageToViewportCoordinates:function(r,a){if(r instanceof s.Point)return this.imageToViewportCoordinates(r.x,r.y);if(this.viewer){var l=this.viewer.world.getItemCount();if(l>1)s.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(l===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportCoordinates(r,a,!0)}}var u=this._imageToViewportDelta(r,a);return u.x+=this._contentBoundsNoRotate.x,u.y+=this._contentBoundsNoRotate.y,u},imageToViewportRectangle:function(r,a,l,c){var u=r;if(u instanceof s.Rect||(u=new s.Rect(r,a,l,c)),this.viewer){var g=this.viewer.world.getItemCount();if(g>1)s.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(g===1){var v=this.viewer.world.getItemAt(0);return v.imageToViewportRectangle(r,a,l,c,!0)}}var C=this.imageToViewportCoordinates(u.x,u.y),R=this._imageToViewportDelta(u.width,u.height);return new s.Rect(C.x,C.y,R.x,R.y,u.degrees)},viewportToImageRectangle:function(r,a,l,c){var u=r;if(u instanceof s.Rect||(u=new s.Rect(r,a,l,c)),this.viewer){var g=this.viewer.world.getItemCount();if(g>1)s.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(g===1){var v=this.viewer.world.getItemAt(0);return v.viewportToImageRectangle(r,a,l,c,!0)}}var C=this.viewportToImageCoordinates(u.x,u.y),R=this._viewportToImageDelta(u.width,u.height);return new s.Rect(C.x,C.y,R.x,R.y,u.degrees)},viewerElementToImageCoordinates:function(r){var a=this.pointFromPixel(r,!0);return this.viewportToImageCoordinates(a)},imageToViewerElementCoordinates:function(r){var a=this.imageToViewportCoordinates(r);return this.pixelFromPoint(a,!0)},windowToImageCoordinates:function(r){s.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var a=r.minus(s.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(a)},imageToWindowCoordinates:function(r){s.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var a=this.imageToViewerElementCoordinates(r);return a.plus(s.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(r){return this.pointFromPixel(r,!0)},viewportToViewerElementCoordinates:function(r){return this.pixelFromPoint(r,!0)},viewerElementToViewportRectangle:function(r){return s.Rect.fromSummits(this.pointFromPixel(r.getTopLeft(),!0),this.pointFromPixel(r.getTopRight(),!0),this.pointFromPixel(r.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(r){return s.Rect.fromSummits(this.pixelFromPoint(r.getTopLeft(),!0),this.pixelFromPoint(r.getTopRight(),!0),this.pixelFromPoint(r.getBottomLeft(),!0))},windowToViewportCoordinates:function(r){s.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var a=r.minus(s.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(a)},viewportToWindowCoordinates:function(r){s.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var a=this.viewportToViewerElementCoordinates(r);return a.plus(s.getElementPosition(this.viewer.element))},viewportToImageZoom:function(r){if(this.viewer){var a=this.viewer.world.getItemCount();if(a>1)s.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(a===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageZoom(r)}}var c=this._contentSizeNoRotate.x,u=this._containerInnerSize.x,g=this._contentBoundsNoRotate.width,v=u/c*g;return r*v},imageToViewportZoom:function(r){if(this.viewer){var a=this.viewer.world.getItemCount();if(a>1)s.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(a===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportZoom(r)}}var c=this._contentSizeNoRotate.x,u=this._containerInnerSize.x,g=this._contentBoundsNoRotate.width,v=c/u/g;return r*v},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(r){return this.flipped===r?this:(this.flipped=r,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:r}),this)}}}(OpenSeadragon),function(s){s.TiledImage=function(E){var M=this;s.console.assert(E.tileCache,"[TiledImage] options.tileCache is required"),s.console.assert(E.drawer,"[TiledImage] options.drawer is required"),s.console.assert(E.viewer,"[TiledImage] options.viewer is required"),s.console.assert(E.imageLoader,"[TiledImage] options.imageLoader is required"),s.console.assert(E.source,"[TiledImage] options.source is required"),s.console.assert(!E.clip||E.clip instanceof s.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),s.EventSource.call(this),this._tileCache=E.tileCache,delete E.tileCache,this._drawer=E.drawer,delete E.drawer,this._imageLoader=E.imageLoader,delete E.imageLoader,E.clip instanceof s.Rect&&(this._clip=E.clip.clone()),delete E.clip;var U=E.x||0;delete E.x;var W=E.y||0;delete E.y,this.normHeight=E.source.dimensions.y/E.source.dimensions.x,this.contentAspectX=E.source.dimensions.x/E.source.dimensions.y;var X=1;E.width?(X=E.width,delete E.width,E.height&&(s.console.error("specifying both width and height to a tiledImage is not supported"),delete E.height)):E.height&&(X=E.height/this.normHeight,delete E.height);var Y=E.fitBounds;delete E.fitBounds;var he=E.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete E.fitBoundsPlacement;var ie=E.degrees||0;delete E.degrees,s.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:s.DEFAULT_SETTINGS.springStiffness,animationTime:s.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:s.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:s.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:s.DEFAULT_SETTINGS.wrapVertical,immediateRender:s.DEFAULT_SETTINGS.immediateRender,blendTime:s.DEFAULT_SETTINGS.blendTime,alwaysBlend:s.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:s.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:s.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:s.DEFAULT_SETTINGS.iOSDevice,debugMode:s.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:s.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:s.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:s.DEFAULT_SETTINGS.placeholderFillStyle,opacity:s.DEFAULT_SETTINGS.opacity,preload:s.DEFAULT_SETTINGS.preload,compositeOperation:s.DEFAULT_SETTINGS.compositeOperation},E),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new s.Spring({initial:U,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new s.Spring({initial:W,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new s.Spring({initial:X,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new s.Spring({initial:ie,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),Y&&this.fitBounds(Y,he,!0),this._drawingHandler=function(we){M.viewer.raiseEvent("tile-drawing",s.extend({tiledImage:M},we))}},s.extend(s.TiledImage.prototype,s.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(E){E!==this._fullyLoaded&&(this._fullyLoaded=E,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=s.now(),this._needsDraw=!0},update:function(){var E=this._xSpring.update(),M=this._ySpring.update(),U=this._scaleSpring.update(),W=this._degreesSpring.update();return E||M||U||W?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(E){return this.getBoundsNoRotate(E).rotate(this.getRotation(E),this._getRotationPoint(E))},getBoundsNoRotate:function(E){return E?new s.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new s.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return s.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(E){var M=this.getBoundsNoRotate(E);if(this._clip){var U=E?this._worldWidthCurrent:this._worldWidthTarget,W=U/this.source.dimensions.x,X=this._clip.times(W);M=new s.Rect(M.x+X.x,M.y+X.y,X.width,X.height)}return M.rotate(this.getRotation(E),this._getRotationPoint(E))},getContentSize:function(){return new s.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(E,M,U){var W=U?this._scaleSpring.current.value:this._scaleSpring.target.value;return new s.Point(E*(this.source.dimensions.x/W),M*(this.source.dimensions.y*this.contentAspectX/W))},viewportToImageCoordinates:function(E,M,U){var W;return E instanceof s.Point?(U=M,W=E):W=new s.Point(E,M),W=W.rotate(-this.getRotation(U),this._getRotationPoint(U)),U?this._viewportToImageDelta(W.x-this._xSpring.current.value,W.y-this._ySpring.current.value):this._viewportToImageDelta(W.x-this._xSpring.target.value,W.y-this._ySpring.target.value)},_imageToViewportDelta:function(E,M,U){var W=U?this._scaleSpring.current.value:this._scaleSpring.target.value;return new s.Point(E/this.source.dimensions.x*W,M/this.source.dimensions.y/this.contentAspectX*W)},imageToViewportCoordinates:function(E,M,U){E instanceof s.Point&&(U=M,M=E.y,E=E.x);var W=this._imageToViewportDelta(E,M);return U?(W.x+=this._xSpring.current.value,W.y+=this._ySpring.current.value):(W.x+=this._xSpring.target.value,W.y+=this._ySpring.target.value),W.rotate(this.getRotation(U),this._getRotationPoint(U))},imageToViewportRectangle:function(E,M,U,W,X){var Y=E;Y instanceof s.Rect?X=M:Y=new s.Rect(E,M,U,W);var he=this.imageToViewportCoordinates(Y.getTopLeft(),X),ie=this._imageToViewportDelta(Y.width,Y.height,X);return new s.Rect(he.x,he.y,ie.x,ie.y,Y.degrees+this.getRotation(X))},viewportToImageRectangle:function(E,M,U,W,X){var Y=E;E instanceof s.Rect?X=M:Y=new s.Rect(E,M,U,W);var he=this.viewportToImageCoordinates(Y.getTopLeft(),X),ie=this._viewportToImageDelta(Y.width,Y.height,X);return new s.Rect(he.x,he.y,ie.x,ie.y,Y.degrees-this.getRotation(X))},viewerElementToImageCoordinates:function(E){var M=this.viewport.pointFromPixel(E,!0);return this.viewportToImageCoordinates(M)},imageToViewerElementCoordinates:function(E){var M=this.imageToViewportCoordinates(E);return this.viewport.pixelFromPoint(M,!0)},windowToImageCoordinates:function(E){var M=E.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(M)},imageToWindowCoordinates:function(E){var M=this.imageToViewerElementCoordinates(E);return M.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(E){var M=this._scaleSpring.current.value;return E=E.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new s.Rect((E.x-this._xSpring.current.value)/M,(E.y-this._ySpring.current.value)/M,E.width/M,E.height/M,E.degrees)},viewportToImageZoom:function(E){var M=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return M*E},imageToViewportZoom:function(E){var M=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return E/M},setPosition:function(E,M){var U=this._xSpring.target.value===E.x&&this._ySpring.target.value===E.y;if(M){if(U&&this._xSpring.current.value===E.x&&this._ySpring.current.value===E.y)return;this._xSpring.resetTo(E.x),this._ySpring.resetTo(E.y),this._needsDraw=!0}else{if(U)return;this._xSpring.springTo(E.x),this._ySpring.springTo(E.y),this._needsDraw=!0}U||this._raiseBoundsChange()},setWidth:function(E,M){this._setScale(E,M)},setHeight:function(E,M){this._setScale(E/this.normHeight,M)},setCroppingPolygons:function(E){var M=function(W){return W instanceof s.Point||typeof W.x=="number"&&typeof W.y=="number"},U=function(W){return W.map(function(X){try{if(M(X))return{x:X.x,y:X.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!s.isArray(E))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=E.map(function(W){return U(W)})}catch(W){s.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),s.console.error(W),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(E,M,U){M=M||s.Placement.CENTER;var W=s.Placement.properties[M],X=this.contentAspectX,Y=0,he=0,ie=1,we=1;if(this._clip&&(X=this._clip.getAspectRatio(),ie=this._clip.width/this.source.dimensions.x,we=this._clip.height/this.source.dimensions.y,E.getAspectRatio()>X?(Y=this._clip.x/this._clip.height*E.height,he=this._clip.y/this._clip.height*E.height):(Y=this._clip.x/this._clip.width*E.width,he=this._clip.y/this._clip.width*E.width)),E.getAspectRatio()>X){var Re=E.height/we,de=0;W.isHorizontallyCentered?de=(E.width-E.height*X)/2:W.isRight&&(de=E.width-E.height*X),this.setPosition(new s.Point(E.x-Y+de,E.y-he),U),this.setHeight(Re,U)}else{var He=E.width/ie,ye=0;W.isVerticallyCentered?ye=(E.height-E.width/X)/2:W.isBottom&&(ye=E.height-E.width/X),this.setPosition(new s.Point(E.x-Y,E.y-he+ye),U),this.setWidth(He,U)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(E){s.console.assert(!E||E instanceof s.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),E instanceof s.Rect?this._clip=E.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(E){E!==this.opacity&&(this.opacity=E,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(E){this._preload=!!E,this._needsDraw=!0},getRotation:function(E){return E?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(E,M){this._degreesSpring.target.value===E&&this._degreesSpring.isAtTargetValue()||(M?this._degreesSpring.resetTo(E):this._degreesSpring.springTo(E),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(E){return this.getBoundsNoRotate(E).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(E){E!==this.compositeOperation&&(this.compositeOperation=E,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(E,M){var U=this._scaleSpring.target.value===E;if(M){if(U&&this._scaleSpring.current.value===E)return;this._scaleSpring.resetTo(E),this._updateForScale(),this._needsDraw=!0}else{if(U)return;this._scaleSpring.springTo(E),this._updateForScale(),this._needsDraw=!0}U||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var E=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),M=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,U=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(M/this.minPixelRatio)/Math.log(2))));return U=Math.max(U,this.source.minLevel||0),E=Math.min(E,U),{lowestLevel:E,highestLevel:U}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var E=this.lastDrawn.pop();E.beingDrawn=!1}var M=this.viewport,U=this._viewportToTiledImageRectangle(M.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var W=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(U=U.intersection(W),U===null)return}for(var X=this._getLevelsInterval(),Y=X.lowestLevel,he=X.highestLevel,ie=null,we=!1,Re=s.now(),de=he;de>=Y;de--){var He=!1,ye=M.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(de),!0).x*this._scaleSpring.current.value;if(de===Y||!we&&ye>=this.minPixelRatio)He=!0,we=!0;else if(!we)continue;var Fe=M.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(de),!1).x*this._scaleSpring.current.value,ze=M.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,qe=this.immediateRender?1:ze,We=Math.min(1,(ye-.5)/.5),ge=qe/Math.abs(qe-Fe);if(ie=r(this,we,He,de,We,ge,U,Re,ie),R(this.coverage,de))break}q(this,this.lastDrawn),ie&&!ie.context2D?(c(this,ie,Re),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(E,M,U){var W,X;this.wrapHorizontal?(W=s.positiveModulo(M.x,1),X=s.positiveModulo(U.x,1)):(W=Math.max(0,M.x),X=Math.min(1,U.x));var Y,he,ie=1/this.source.aspectRatio;this.wrapVertical?(Y=s.positiveModulo(M.y,ie),he=s.positiveModulo(U.y,ie)):(Y=Math.max(0,M.y),he=Math.min(ie,U.y));var we=this.source.getTileAtPoint(E,new s.Point(W,Y)),Re=this.source.getTileAtPoint(E,new s.Point(X,he)),de=this.source.getNumTiles(E);return this.wrapHorizontal&&(we.x+=de.x*Math.floor(M.x),Re.x+=de.x*Math.floor(U.x)),this.wrapVertical&&(we.y+=de.y*Math.floor(M.y/ie),Re.y+=de.y*Math.floor(U.y/ie)),{topLeft:we,bottomRight:Re}}});function r(E,M,U,W,X,Y,he,ie,we){var Re=he.getBoundingBox().getTopLeft(),de=he.getBoundingBox().getBottomRight();E.viewer&&E.viewer.raiseEvent("update-level",{tiledImage:E,havedrawn:M,level:W,opacity:X,visibility:Y,drawArea:he,topleft:Re,bottomright:de,currenttime:ie,best:we}),V(E.coverage,W),V(E.loadingCoverage,W);for(var He=E._getCornerTiles(W,Re,de),ye=He.topLeft,Fe=He.bottomRight,ze=E.source.getNumTiles(W),qe=E.viewport.pixelFromPoint(E.viewport.getCenter()),We=ye.x;We<=Fe.x;We++)for(var ge=ye.y;ge<=Fe.y;ge++){if(!E.wrapHorizontal&&!E.wrapVertical){var Ye=E.source.getTileBounds(W,We,ge);if(he.intersection(Ye)===null)continue}we=a(E,U,M,We,ge,W,X,Y,qe,ze,ie,we)}return we}function a(E,M,U,W,X,Y,he,ie,we,Re,de,He){var ye=l(W,X,Y,E,E.source,E.tilesMatrix,de,Re,E._worldWidthCurrent,E._worldHeightCurrent),Fe=U;E.viewer&&E.viewer.raiseEvent("update-tile",{tiledImage:E,tile:ye}),L(E.coverage,Y,W,X,!1);var ze=ye.loaded||ye.loading||I(E.loadingCoverage,Y,W,X);if(L(E.loadingCoverage,Y,W,X,ze),!ye.exists||(M&&!Fe&&(I(E.coverage,Y,W,X)?L(E.coverage,Y,W,X,!0):Fe=!0),!Fe))return He;if(v(ye,E.source.tileOverlap,E.viewport,we,ie,E),!ye.loaded)if(ye.context2D)g(E,ye);else{var qe=E._tileCache.getImageRecord(ye.cacheKey);if(qe){var We=qe.getImage();g(E,ye,We)}}if(ye.loaded){var ge=C(E,ye,W,X,Y,he,de);ge&&(E._needsDraw=!0)}else ye.loading?E._tilesLoading++:ze||(He=j(He,ye));return He}function l(E,M,U,W,X,Y,he,ie,we,Re){var de,He,ye,Fe,ze,qe,We,ge,Ye;return Y[U]||(Y[U]={}),Y[U][E]||(Y[U][E]={}),Y[U][E][M]||(de=(ie.x+E%ie.x)%ie.x,He=(ie.y+M%ie.y)%ie.y,ye=X.getTileBounds(U,de,He),Fe=X.getTileBounds(U,de,He,!0),ze=X.tileExists(U,de,He),qe=X.getTileUrl(U,de,He),W.loadTilesWithAjax?(We=X.getTileAjaxHeaders(U,de,He),s.isPlainObject(W.ajaxHeaders)&&(We=s.extend({},W.ajaxHeaders,We))):We=null,ge=X.getContext2D?X.getContext2D(U,de,He):void 0,ye.x+=(E-de)/ie.x,ye.y+=Re/we*((M-He)/ie.y),Ye=new s.Tile(U,E,M,ye,ze,qe,ge,W.loadTilesWithAjax,We,Fe),de===ie.x-1&&(Ye.isRightMost=!0),He===ie.y-1&&(Ye.isBottomMost=!0),Y[U][E][M]=Ye),Ye=Y[U][E][M],Ye.lastTouchTime=he,Ye}function c(E,M,U){M.loading=!0,E._imageLoader.addJob({src:M.url,loadWithAjax:M.loadWithAjax,ajaxHeaders:M.ajaxHeaders,crossOriginPolicy:E.crossOriginPolicy,ajaxWithCredentials:E.ajaxWithCredentials,callback:function(W,X,Y){u(E,M,U,W,X,Y)},abort:function(){M.loading=!1}})}function u(E,M,U,W,X,Y){if(!W){s.console.log("Tile %s failed to load: %s - error: %s",M,M.url,X),E.viewer.raiseEvent("tile-load-failed",{tile:M,tiledImage:E,time:U,message:X,tileRequest:Y}),M.loading=!1,M.exists=!1;return}if(U<E.lastResetTime){s.console.log("Ignoring tile %s loaded before reset: %s",M,M.url),M.loading=!1;return}var he=function(){var ie=E.source.getClosestLevel();g(E,M,W,ie,Y)};E._midDraw?window.setTimeout(he,1):he()}function g(E,M,U,W,X){var Y=0;function he(){return Y++,ie}function ie(){Y--,Y===0&&(M.loading=!1,M.loaded=!0,M.context2D||E._tileCache.cacheTile({image:U,tile:M,cutoff:W,tiledImage:E}),E._needsDraw=!0)}E.viewer.raiseEvent("tile-loaded",{tile:M,tiledImage:E,tileRequest:X,image:U,getCompletionCallback:he}),he()()}function v(E,M,U,W,X,Y){var he=E.bounds.getTopLeft();he.x*=Y._scaleSpring.current.value,he.y*=Y._scaleSpring.current.value,he.x+=Y._xSpring.current.value,he.y+=Y._ySpring.current.value;var ie=E.bounds.getSize();ie.x*=Y._scaleSpring.current.value,ie.y*=Y._scaleSpring.current.value;var we=U.pixelFromPointNoRotate(he,!0),Re=U.pixelFromPointNoRotate(he,!1),de=U.deltaPixelsFromPointsNoRotate(ie,!0),He=U.deltaPixelsFromPointsNoRotate(ie,!1),ye=Re.plus(He.divide(2)),Fe=W.squaredDistanceTo(ye);M||(de=de.plus(new s.Point(1,1))),E.isRightMost&&Y.wrapHorizontal&&(de.x+=.75),E.isBottomMost&&Y.wrapVertical&&(de.y+=.75),E.position=we,E.size=de,E.squaredDistance=Fe,E.visibility=X}function C(E,M,U,W,X,Y,he){var ie=1e3*E.blendTime,we,Re;if(M.blendStart||(M.blendStart=he),we=he-M.blendStart,Re=ie?Math.min(1,we/ie):1,E.alwaysBlend&&(Re*=Y),M.opacity=Re,E.lastDrawn.push(M),Re===1)L(E.coverage,X,U,W,!0),E._hasOpaqueTile=!0;else if(we<ie)return!0;return!1}function R(E,M,U,W){var X,Y,he,ie;if(!E[M])return!1;if(U===void 0||W===void 0){X=E[M];for(he in X)if(Object.prototype.hasOwnProperty.call(X,he)){Y=X[he];for(ie in Y)if(Object.prototype.hasOwnProperty.call(Y,ie)&&!Y[ie])return!1}return!0}return E[M][U]===void 0||E[M][U][W]===void 0||E[M][U][W]===!0}function I(E,M,U,W){return U===void 0||W===void 0?R(E,M+1):R(E,M+1,2*U,2*W)&&R(E,M+1,2*U,2*W+1)&&R(E,M+1,2*U+1,2*W)&&R(E,M+1,2*U+1,2*W+1)}function L(E,M,U,W,X){if(!E[M]){s.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",M);return}E[M][U]||(E[M][U]={}),E[M][U][W]=X}function V(E,M){E[M]={}}function j(E,M){return!E||M.visibility>E.visibility||M.visibility==E.visibility&&M.squaredDistance<E.squaredDistance?M:E}function q(E,M){if(!(E.opacity===0||M.length===0&&!E.placeholderFillStyle)){var U=M[0],W;U&&(W=E.opacity<1||E.compositeOperation&&E.compositeOperation!=="source-over"||!E._isBottomItem()&&U._hasTransparencyChannel());var X,Y,he=E.viewport.getZoom(!0),ie=E.viewportToImageZoom(he);M.length>1&&ie>E.smoothTileEdgesMinZoom&&!E.iOSDevice&&E.getRotation(!0)%360==0&&s.supportsCanvas&&(W=!0,X=U.getScaleForEdgeSmoothing(),Y=U.getTranslationForEdgeSmoothing(X,E._drawer.getCanvasSize(!1),E._drawer.getCanvasSize(!0)));var we;W&&(X||(we=E.viewport.viewportToViewerElementRectangle(E.getClippedBounds(!0)).getIntegerBoundingBox(),E._drawer.viewer.viewport.getFlip()&&(E.viewport.degrees!==0||E.getRotation(!0)%360!=0)&&(we.x=E._drawer.viewer.container.clientWidth-(we.x+we.width)),we=we.times(s.pixelDensityRatio)),E._drawer._clear(!0,we)),X||(E.viewport.degrees!==0&&E._drawer._offsetForRotation({degrees:E.viewport.degrees,useSketch:W}),E.getRotation(!0)%360!=0&&E._drawer._offsetForRotation({degrees:E.getRotation(!0),point:E.viewport.pixelFromPointNoRotate(E._getRotationPoint(!0),!0),useSketch:W}),E.viewport.degrees===0&&E.getRotation(!0)%360==0&&E._drawer.viewer.viewport.getFlip()&&E._drawer._flip());var Re=!1;if(E._clip){E._drawer.saveContext(W);var de=E.imageToViewportRectangle(E._clip,!0);de=de.rotate(-E.getRotation(!0),E._getRotationPoint(!0));var He=E._drawer.viewportToDrawerRectangle(de);X&&(He=He.times(X)),Y&&(He=He.translate(Y)),E._drawer.setClip(He,W),Re=!0}if(E._croppingPolygons){E._drawer.saveContext(W);try{var ye=E._croppingPolygons.map(function(We){return We.map(function(ge){var Ye=E.imageToViewportCoordinates(ge.x,ge.y,!0).rotate(-E.getRotation(!0),E._getRotationPoint(!0)),et=E._drawer.viewportCoordToDrawerCoord(Ye);return X&&(et=et.times(X)),et})});E._drawer.clipWithPolygons(ye,W)}catch(We){s.console.error(We)}Re=!0}if(E.placeholderFillStyle&&E._hasOpaqueTile===!1){var Fe=E._drawer.viewportToDrawerRectangle(E.getBounds(!0));X&&(Fe=Fe.times(X)),Y&&(Fe=Fe.translate(Y));var ze=null;typeof E.placeholderFillStyle=="function"?ze=E.placeholderFillStyle(E,E._drawer.context):ze=E.placeholderFillStyle,E._drawer.drawRectangle(Fe,ze,W)}for(var qe=M.length-1;qe>=0;qe--)U=M[qe],E._drawer.drawTile(U,E._drawingHandler,W,X,Y),U.beingDrawn=!0,E.viewer&&E.viewer.raiseEvent("tile-drawn",{tiledImage:E,tile:U});Re&&E._drawer.restoreContext(W),X||(E.getRotation(!0)%360!=0&&E._drawer._restoreRotationChanges(W),E.viewport.degrees!==0&&E._drawer._restoreRotationChanges(W)),W&&(X&&(E.viewport.degrees!==0&&E._drawer._offsetForRotation({degrees:E.viewport.degrees,useSketch:!1}),E.getRotation(!0)%360!=0&&E._drawer._offsetForRotation({degrees:E.getRotation(!0),point:E.viewport.pixelFromPointNoRotate(E._getRotationPoint(!0),!0),useSketch:!1})),E._drawer.blendSketch({opacity:E.opacity,scale:X,translate:Y,compositeOperation:E.compositeOperation,bounds:we}),X&&(E.getRotation(!0)%360!=0&&E._drawer._restoreRotationChanges(!1),E.viewport.degrees!==0&&E._drawer._restoreRotationChanges(!1))),X||E.viewport.degrees===0&&E.getRotation(!0)%360==0&&E._drawer.viewer.viewport.getFlip()&&E._drawer._flip(),ae(E,M)}}function ae(E,M){if(E.debugMode)for(var U=M.length-1;U>=0;U--){var W=M[U];try{E._drawer.drawDebugInfo(W,M.length,U,E)}catch(X){s.console.error(X)}}}}(OpenSeadragon),function(s){var r=function(l){s.console.assert(l,"[TileCache.cacheTile] options is required"),s.console.assert(l.tile,"[TileCache.cacheTile] options.tile is required"),s.console.assert(l.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=l.tile,this.tiledImage=l.tiledImage},a=function(l){s.console.assert(l,"[ImageRecord] options is required"),s.console.assert(l.image,"[ImageRecord] options.image is required"),this._image=l.image,this._tiles=[]};a.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var l=document.createElement("canvas");l.width=this._image.width,l.height=this._image.height,this._renderedContext=l.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(l){s.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=l},addTile:function(l){s.console.assert(l,"[ImageRecord.addTile] tile is required"),this._tiles.push(l)},removeTile:function(l){for(var c=0;c<this._tiles.length;c++)if(this._tiles[c]===l){this._tiles.splice(c,1);return}s.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",l)},getTileCount:function(){return this._tiles.length}},s.TileCache=function(l){l=l||{},this._maxImageCacheCount=l.maxImageCacheCount||s.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},s.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(l){s.console.assert(l,"[TileCache.cacheTile] options is required"),s.console.assert(l.tile,"[TileCache.cacheTile] options.tile is required"),s.console.assert(l.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),s.console.assert(l.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var c=l.cutoff||0,u=this._tilesLoaded.length,g=this._imagesLoaded[l.tile.cacheKey];if(g||(s.console.assert(l.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),g=this._imagesLoaded[l.tile.cacheKey]=new a({image:l.image}),this._imagesLoadedCount++),g.addTile(l.tile),l.tile.cacheImageRecord=g,this._imagesLoadedCount>this._maxImageCacheCount){for(var v=null,C=-1,R=null,I,L,V,j,q,ae,E=this._tilesLoaded.length-1;E>=0;E--)if(ae=this._tilesLoaded[E],I=ae.tile,!(I.level<=c||I.beingDrawn)){if(!v){v=I,C=E,R=ae;continue}j=I.lastTouchTime,L=v.lastTouchTime,q=I.level,V=v.level,(j<L||j==L&&q>V)&&(v=I,C=E,R=ae)}v&&C>=0&&(this._unloadTile(R),u=C)}this._tilesLoaded[u]=new r({tile:l.tile,tiledImage:l.tiledImage})},clearTilesFor:function(l){s.console.assert(l,"[TileCache.clearTilesFor] tiledImage is required");for(var c,u=0;u<this._tilesLoaded.length;++u)c=this._tilesLoaded[u],c.tiledImage===l&&(this._unloadTile(c),this._tilesLoaded.splice(u,1),u--)},getImageRecord:function(l){return s.console.assert(l,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[l]},_unloadTile:function(l){s.console.assert(l,"[TileCache._unloadTile] tileRecord is required");var c=l.tile,u=l.tiledImage;c.unload(),c.cacheImageRecord=null;var g=this._imagesLoaded[c.cacheKey];g.removeTile(c),g.getTileCount()||(g.destroy(),delete this._imagesLoaded[c.cacheKey],this._imagesLoadedCount--),u.viewer.raiseEvent("tile-unloaded",{tile:c,tiledImage:u})}}}(OpenSeadragon),function(s){s.World=function(r){var a=this;s.console.assert(r.viewer,"[World] options.viewer is required"),s.EventSource.call(this),this.viewer=r.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(l){a._autoRefigureSizes?a._figureSizes():a._needsSizesFigured=!0},this._figureSizes()},s.extend(s.World.prototype,s.EventSource.prototype,{addItem:function(r,a){if(s.console.assert(r,"[World.addItem] item is required"),s.console.assert(r instanceof s.TiledImage,"[World.addItem] only TiledImages supported at this time"),a=a||{},a.index!==void 0){var l=Math.max(0,Math.min(this._items.length,a.index));this._items.splice(l,0,r)}else this._items.push(r);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,r.addHandler("bounds-change",this._delegatedFigureSizes),r.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:r})},getItemAt:function(r){return s.console.assert(r!==void 0,"[World.getItemAt] index is required"),this._items[r]},getIndexOfItem:function(r){return s.console.assert(r,"[World.getIndexOfItem] item is required"),s.indexOf(this._items,r)},getItemCount:function(){return this._items.length},setItemIndex:function(r,a){s.console.assert(r,"[World.setItemIndex] item is required"),s.console.assert(a!==void 0,"[World.setItemIndex] index is required");var l=this.getIndexOfItem(r);if(a>=this._items.length)throw new Error("Index bigger than number of layers.");a===l||l===-1||(this._items.splice(l,1),this._items.splice(a,0,r),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:r,previousIndex:l,newIndex:a}))},removeItem:function(r){s.console.assert(r,"[World.removeItem] item is required");var a=s.indexOf(this._items,r);a!==-1&&(r.removeHandler("bounds-change",this._delegatedFigureSizes),r.removeHandler("clip-change",this._delegatedFigureSizes),r.destroy(),this._items.splice(a,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(r))},removeAll:function(){this.viewer._cancelPendingImages();var r,a;for(a=0;a<this._items.length;a++)r=this._items[a],r.removeHandler("bounds-change",this._delegatedFigureSizes),r.removeHandler("clip-change",this._delegatedFigureSizes),r.destroy();var l=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,a=0;a<l.length;a++)r=l[a],this._raiseRemoveItem(r)},resetItems:function(){for(var r=0;r<this._items.length;r++)this._items[r].reset()},update:function(){for(var r=!1,a=0;a<this._items.length;a++)r=this._items[a].update()||r;return r},draw:function(){for(var r=0;r<this._items.length;r++)this._items[r].draw();this._needsDraw=!1},needsDraw:function(){for(var r=0;r<this._items.length;r++)if(this._items[r].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(r){this._autoRefigureSizes=r,r&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(r){r=r||{};var a=r.immediately||!1,l=r.layout||s.DEFAULT_SETTINGS.collectionLayout,c=r.rows||s.DEFAULT_SETTINGS.collectionRows,u=r.columns||s.DEFAULT_SETTINGS.collectionColumns,g=r.tileSize||s.DEFAULT_SETTINGS.collectionTileSize,v=r.tileMargin||s.DEFAULT_SETTINGS.collectionTileMargin,C=g+v,R;!r.rows&&u?R=u:R=Math.ceil(this._items.length/c);var I=0,L=0,V,j,q,ae,E;this.setAutoRefigureSizes(!1);for(var M=0;M<this._items.length;M++)M&&M%R==0&&(l==="horizontal"?(L+=C,I=0):(I+=C,L=0)),V=this._items[M],j=V.getBounds(),j.width>j.height?q=g:q=g*(j.width/j.height),ae=q*(j.height/j.width),E=new s.Point(I+(g-q)/2,L+(g-ae)/2),V.setPosition(E,a),V.setWidth(q,a),l==="horizontal"?I+=C:L+=C;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var r=this._homeBounds?this._homeBounds.clone():null,a=this._contentSize?this._contentSize.clone():null,l=this._contentFactor||0;if(!this._items.length)this._homeBounds=new s.Rect(0,0,1,1),this._contentSize=new s.Point(1,1),this._contentFactor=1;else{var c=this._items[0],u=c.getBounds();this._contentFactor=c.getContentSize().x/u.width;for(var g=c.getClippedBounds().getBoundingBox(),v=g.x,C=g.y,R=g.x+g.width,I=g.y+g.height,L=1;L<this._items.length;L++)c=this._items[L],u=c.getBounds(),this._contentFactor=Math.max(this._contentFactor,c.getContentSize().x/u.width),g=c.getClippedBounds().getBoundingBox(),v=Math.min(v,g.x),C=Math.min(C,g.y),R=Math.max(R,g.x+g.width),I=Math.max(I,g.y+g.height);this._homeBounds=new s.Rect(v,C,R-v,I-C),this._contentSize=new s.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==l||!this._homeBounds.equals(r)||!this._contentSize.equals(a))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(r){this.raiseEvent("remove-item",{item:r})}})}(OpenSeadragon)}),oi=n$1((s,r)=>{(function(a,l){typeof s=="object"&&typeof r=="object"?r.exports=l(Ke()):typeof define=="function"&&define.amd?define(["openseadragon"],l):typeof s=="object"?s["openseadragon-viewerinputhook"]=l(Ke()):a["openseadragon-viewerinputhook"]=l(a.openseadragon)})(window,function(a){return function(l){function c(g){if(u[g])return u[g].exports;var v=u[g]={i:g,l:!1,exports:{}};return l[g].call(v.exports,v,v.exports,c),v.l=!0,v.exports}var u={};return c.m=l,c.c=u,c.d=function(g,v,C){c.o(g,v)||Object.defineProperty(g,v,{enumerable:!0,get:C})},c.r=function(g){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},c.t=function(g,v){if(1&v&&(g=c(g)),8&v||4&v&&typeof g=="object"&&g&&g.__esModule)return g;var C=Object.create(null);if(c.r(C),Object.defineProperty(C,"default",{enumerable:!0,value:g}),2&v&&typeof g!="string")for(var R in g)c.d(C,R,function(I){return g[I]}.bind(null,R));return C},c.n=function(g){var v=g&&g.__esModule?function(){return g.default}:function(){return g};return c.d(v,"a",v),v},c.o=function(g,v){return Object.prototype.hasOwnProperty.call(g,v)},c.p="",c(c.s=1)}([function(l){l.exports=a},function(l,c,u){u.r(c);var g=u(0),v=u.n(g);c.default=function(C,R){if(!C.version||1>C.version.major)throw new Error("OpenSeadragonViewerInputHook requires OpenSeadragon version 1.0.0+");return C.Viewer.prototype.addViewerInputHook=function(I){return(I=I||{}).viewer=this,new R.ViewerInputHook(I)},R.ViewerInputHook=function(I){var L,V;for((I=I||{}).hooks=I.hooks||[],this.viewer=I.viewer||null,this.viewerTrackers={},this.hooks=[],this.viewer&&(this.viewerTrackers.viewer=this.viewer.innerTracker,this.viewerTrackers.viewer_outer=this.viewer.outerTracker),L=0;L<I.hooks.length;L++){if(typeof I.hooks[L].tracker=="string"){if(!this.viewer)throw new Error("A viewer must be specified.");if((V=this.viewerTrackers[I.hooks[L].tracker])===void 0)throw new Error("Unknown tracker specified: "+I.hooks[L].tracker)}else V=I.hooks[L].tracker;this.hooks.push({tracker:V,handlerName:I.hooks[L].handler,origHandler:V[I.hooks[L].handler],hookHandler:I.hooks[L].hookHandler}),function(j,q,ae,E){var M=q[ae];q[ae]=function(U){return j._callHandlers(E,M,U)}}(this,V,I.hooks[L].handler,I.hooks[L].hookHandler)}},R.ViewerInputHook.version={versionStr:"2.2.1",major:2,minor:2,revision:1},R.ViewerInputHook.prototype._callHandlers=function(I,L,V){var j=I(V);return L&&!V.stopHandlers&&(j=L(V)),!V.stopBubbling&&j},R.ViewerInputHook.prototype.destroy=function(){for(;0<this.hooks.length;){var I=this.hooks.pop();I.tracker[I.handlerName]=I.origHandler}this.viewer&&(delete this.viewerTrackers.viewer,delete this.viewerTrackers.viewer_outer,this.viewer=null)},R.ViewerInputHook}(v.a||window.OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{})}]).default})}),Se=class{constructor(s,r,a,l){this.x=s,this.y=r,this.w=a,this.h=l}toString(){return`${this.x},${this.y},${this.w},${this.h}`}static fromString(s){s=s.replace("xywh=","");let r=s.split(",");return new Se(Number(r[0]),Number(r[1]),Number(r[2]),Number(r[3]))}},Ge=class{constructor(s,r){this.x=s,this.y=r}},gt=class{constructor(){this.region=new f(0,0),this.regionPos=new Ge(0,0),this.size=new f(0,0)}},Ve=o(G()),fe=ia(),ft=class extends _{constructor(s){super(s)}create(){this.setConfig("downloadDialogue"),super.create(),this.$settingsButton=fe('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=fe('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=fe('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=fe("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=fe('<li class="option single"><input id="'+h.CURRENT_VIEW+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+h.CURRENT_VIEW+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=fe('<li class="option single"><input id="'+h.WHOLE_IMAGE_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+h.WHOLE_IMAGE_HIGH_RES+'label" for="'+h.WHOLE_IMAGE_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImagesHighResButton=fe('<li class="option multiple"><input id="'+h.WHOLE_IMAGES_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+h.WHOLE_IMAGES_HIGH_RES+'label" for="'+h.WHOLE_IMAGES_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImagesHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=fe('<li class="option single"><input id="'+h.WHOLE_IMAGE_LOW_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+h.WHOLE_IMAGE_LOW_RES+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=fe('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=fe("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=fe('<li class="group manifest"></li>'),this.$downloadOptions.append(this.$manifestOptionsContainer),this.$manifestOptions=fe("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions),this.$selectionButton=fe('<li class="option"><input id="'+h.SELECTION+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+h.SELECTION+'label" for="'+h.SELECTION+'"></label></li>'),this.$manifestOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$downloadButton=fe('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$explanatoryTextTemplate=fe('<span class="explanatory"></span>');let s=this;this.$downloadButton.on("click",r=>{r.preventDefault();let a=s.getSelectedOption(),l=a.attr("id"),c=a.attr("title"),u=a.data("mime"),g=h.UNKNOWN,v=this.extension.helper.getCurrentCanvas();if(this.renderingUrls[l])u&&(u.toLowerCase().indexOf("pdf")!==-1?g=h.ENTIRE_DOCUMENT_AS_PDF:u.toLowerCase().indexOf("txt")!==-1&&(g=h.ENTIRE_DOCUMENT_AS_TEXT)),(g=h.ENTIRE_DOCUMENT_AS_PDF)&&window.open(this.renderingUrls[l]);else switch(g=l,g){case h.CURRENT_VIEW:let C=s.extension.getViewer();window.open(s.extension.getCroppedImageUri(v,C));break;case h.SELECTION:d.waitFor(()=>!this.isActive,()=>{this.extensionHost.publish(e.SHOW_MULTISELECT_DIALOGUE)});break;case h.WHOLE_IMAGE_HIGH_RES:window.open(this.getCanvasHighResImageUri(this.extension.helper.getCurrentCanvas()));break;case h.WHOLE_IMAGES_HIGH_RES:let R=this.extension.getPagedIndices();for(let L=0;L<R.length;L++)window.open(this.getCanvasHighResImageUri(this.extension.helper.getCanvasByIndex(R[L])));break;case h.WHOLE_IMAGE_LOW_RES:let I=s.extension.getConfinedImageUri(v,s.options.confinedImageSize);I&&window.open(I);break}this.extensionHost.publish(e.DOWNLOAD,{type:g,label:c}),this.close()}),this.$settingsButton.onPressed(()=>{this.extensionHost.publish(e.HIDE_DOWNLOAD_DIALOGUE),this.extensionHost.publish(e.SHOW_SETTINGS_DIALOGUE)})}open(s){super.open(s);let r=this.extension.helper.getCurrentCanvas(),a=this.extension.getViewerRotation()%180==0;if(this.isDownloadOptionAvailable(h.CURRENT_VIEW)){let c=this.$currentViewAsJpgButton.find("input"),u=this.$currentViewAsJpgButton.find("label"),g=this.content.currentViewAsJpg,v=this.extension.getViewer(),C=this.extension.getCroppedImageDimensions(r,v);if(C?(g=a?P.format(g,C.size.width.toString(),C.size.height.toString()):P.format(g,C.size.height.toString(),C.size.width.toString()),u.text(g),c.prop("title",g),this.$currentViewAsJpgButton.data("width",C.size.width),this.$currentViewAsJpgButton.data("height",C.size.height),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide(),S.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let R=this.content.currentViewAsJpgExplanation;if(R){let I=this.$explanatoryTextTemplate.clone();I.text(R),u.append(I)}}}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(h.WHOLE_IMAGE_HIGH_RES)){let c=this.$wholeImageHighResButton.find("input"),u=this.$wholeImageHighResButton.find("label"),g=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());g?g=p.simplifyMimeType(g):g="?";let v=this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());if(v){let C=a?P.format(this.content.wholeImageHighRes,v.width.toString(),v.height.toString(),g):P.format(this.content.wholeImageHighRes,v.height.toString(),v.width.toString(),g);u.text(C),c.prop("title",C),this.$wholeImageHighResButton.data("width",v.width),this.$wholeImageHighResButton.data("height",v.height),this.$wholeImageHighResButton.show()}else if(r.externalResource&&!r.externalResource.hasServiceDescriptor()){let C=P.format(this.content.wholeImageHighRes,"?","?",g);u.text(C),c.prop("title",C),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(S.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let C=this.content.wholeImageHighResExplanation;if(C){let R=this.$explanatoryTextTemplate.clone();R.text(C),u.append(R)}}}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(h.WHOLE_IMAGES_HIGH_RES)){let c=this.$wholeImagesHighResButton.find("input"),u=this.$wholeImagesHighResButton.find("label"),g=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());g?g=p.simplifyMimeType(g):g="?";let v=P.format(this.content.wholeImagesHighRes,g);if(u.text(v),c.prop("title",v),this.$wholeImagesHighResButton.show(),S.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let C=this.content.wholeImagesHighResExplanation;if(C){let R=this.$explanatoryTextTemplate.clone();R.text(C),u.append(R)}}}else this.$wholeImagesHighResButton.hide();if(this.isDownloadOptionAvailable(h.WHOLE_IMAGE_LOW_RES)){let c=this.$wholeImageLowResAsJpgButton.find("input"),u=this.$wholeImageLowResAsJpgButton.find("label"),g=this.extension.getConfinedImageDimensions(r,this.options.confinedImageSize),v=a?P.format(this.content.wholeImageLowResAsJpg,g.width.toString(),g.height.toString()):P.format(this.content.wholeImageLowResAsJpg,g.height.toString(),g.width.toString());if(u.text(v),c.prop("title",v),this.$wholeImageLowResAsJpgButton.data("width",g.width),this.$wholeImageLowResAsJpgButton.data("height",g.height),this.$wholeImageLowResAsJpgButton.show(),S.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let C=this.content.wholeImageLowResAsJpgExplanation;if(C){let R=this.$explanatoryTextTemplate.clone();R.text(C),u.append(R)}}}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(h.SELECTION)){let c=this.$selectionButton.find("input"),u=this.$selectionButton.find("label");if(u.text(this.content.downloadSelection),c.prop("title",this.content.downloadSelection),this.$selectionButton.show(),S.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let g=this.content.selectionExplanation;if(g){let v=this.$explanatoryTextTemplate.clone();v.text(g),u.append(v)}}}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(h.RANGE_RENDERINGS)&&r.ranges&&r.ranges.length)for(let c=0;c<r.ranges.length;c++){let u=r.ranges[c],g=this.getDownloadOptionsForRenderings(u,this.content.entireFileAsOriginal,h.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(g)}if(this.isDownloadOptionAvailable(h.IMAGE_RENDERINGS)){let c=r.getImages();for(let u=0;u<c.length;u++){let g=this.getDownloadOptionsForRenderings(c[u].getResource(),this.content.entireFileAsOriginal,h.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(g)}}if(this.isDownloadOptionAvailable(h.CANVAS_RENDERINGS)){let c=this.getDownloadOptionsForRenderings(r,this.content.entireFileAsOriginal,h.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(c)}if(this.isDownloadOptionAvailable(h.MANIFEST_RENDERINGS)){let c=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,h.MANIFEST_RENDERINGS);!c.length&&this.extension.helper.manifest&&(c=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,h.MANIFEST_RENDERINGS)),this.addDownloadOptionsForRenderings(c)}if(this.isDownloadOptionAvailable(h.CURRENT_VIEW)){let c=parseInt(this.$currentViewAsJpgButton.data("width").toString()),u=parseInt(this.$currentViewAsJpgButton.data("height").toString()),g=parseInt(this.$wholeImageHighResButton.data("width").toString()),v=parseInt(this.$wholeImageHighResButton.data("height").toString()),C=c/g*100,R=u/v*100,I=this.options.currentViewDisabledPercentage;C>=I&&R>=I?this.$currentViewAsJpgButton.hide():this.$currentViewAsJpgButton.show()}let l=this.$imageOptions.find("li.single");l=l.sort((c,u)=>{let g=fe(c).data("width");g&&(g=parseInt(g.toString()));let v=fe(c).data("height");v&&(v=parseInt(v.toString()));let C=fe(u).data("width");C&&(C=parseInt(C.toString()));let R=fe(u).data("height");R&&(R=parseInt(R.toString()));let I=g*v,L=C*R;return I<L?-1:I>L?1:0}),l.detach().appendTo(this.$imageOptions),this.$downloadOptions.find("li.group").each((c,u)=>{let g=fe(u);g.show(),g.find("li.option:hidden").length===g.find("li.option").length&&g.hide()}),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.extension.isPagingSettingEnabled()&&this.config.options.downloadPagingNoteEnabled?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()}addDownloadOptionsForRenderings(s){s.forEach(r=>{switch(r.type){case h.IMAGE_RENDERINGS:this.$imageOptions.append(r.button);break;case h.CANVAS_RENDERINGS:this.$canvasOptions.append(r.button);break;case h.MANIFEST_RENDERINGS:this.$manifestOptions.append(r.button);break}})}getCanvasImageResource(s){let r=s.getImages();return r[0]?r[0].getResource():null}getCanvasHighResImageUri(s){let r=this.getCanvasComputedDimensions(s);if(r){let a=r.width,l=s.getCanonicalImageUri(a);if(s.externalResource&&s.externalResource.hasServiceDescriptor()){let c=l.split("/"),u=this.extension.getViewerRotation();c[c.length-2]=String(u),l=c.join("/")}return l}else if(s.externalResource&&!s.externalResource.hasServiceDescriptor())return s.externalResource.dataUri;return""}getCanvasMimeType(s){let r=this.getCanvasImageResource(s);if(r){let a=r.getFormat();if(a)return a.toString()}return null}getCanvasDimensions(s){if(s.externalResource.data){let r=s.externalResource.data.width,a=s.externalResource.data.height;if(r&&a)return new Ve.Size(r,a)}return null}getCanvasComputedDimensions(s){let r=this.getCanvasDimensions(s),a=s.getMaxDimensions();if(!r)return null;if(!a||r.width<=a.width&&r.height<=a.height)return r;let l=a.width/r.width,c=a.height/r.height,u=Math.min(l,c);return new Ve.Size(Math.floor(r.width*u),Math.floor(r.height*u))}_isLevel0(s){return!s||!s.length?!1:Ve.Utils.isLevel0ImageProfile(s[0])}isDownloadOptionAvailable(s){if(!this.extension.resources)return!1;let r=this.extension.helper.getCurrentCanvas();if(!r.externalResource.hasServiceDescriptor()||this._isLevel0(r.externalResource.data.profile))return!!(s===h.WHOLE_IMAGE_HIGH_RES&&(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length===1));switch(s){case h.CURRENT_VIEW:case h.CANVAS_RENDERINGS:case h.IMAGE_RENDERINGS:case h.WHOLE_IMAGE_HIGH_RES:if(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length===1){let l=r.getMaxDimensions();return l?l.width<=this.options.maxImageWidth:!0}return!1;case h.WHOLE_IMAGES_HIGH_RES:return!!(this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length>1);case h.WHOLE_IMAGE_LOW_RES:let a=this.getCanvasComputedDimensions(r);return a?!this.extension.isPagingSettingEnabled()&&a.width>this.options.confinedImageSize:!1;case h.SELECTION:return this.options.selectionEnabled;case h.RANGE_RENDERINGS:return r.ranges&&r.ranges.length?r.ranges[0].getRenderings().length>0:!1;default:return super.isDownloadOptionAvailable(s)}}},ci=ia(),mt=class extends k{constructor(s){super(s)}create(){this.setConfig("externalContentDialogue"),super.create(),this.openCommand=e.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=e.HIDE_EXTERNALCONTENT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,s=>{this.open(),this.$iframe.prop("src",s.uri)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$iframe=ci("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()}resize(){super.resize(),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())}},vt=ia(),wt=class extends Xt{constructor(s){super(s)}create(){this.setConfig("mobileFooterPanel"),super.create(),this.$rotateButton=vt(`
            <button class="btn imageBtn rotate" title="${this.content.rotateRight}">
                <i class="uv-icon-rotate" aria-hidden="true"></i>${this.content.rotateRight}
            </button>
        `),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=vt(`
            <button class="btn imageBtn zoomOut" title="${this.content.zoomOut}">
                <i class="uv-icon-zoom-out" aria-hidden="true"></i>${this.content.zoomOut}
            </button>
        `),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=vt(`
            <button class="btn imageBtn zoomIn" title="${this.content.zoomIn}">
                <i class="uv-icon-zoom-in" aria-hidden="true"></i>${this.content.zoomIn}
            </button>
        `),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed(()=>{this.extensionHost.publish(x.ZOOM_IN)}),this.$zoomOutButton.onPressed(()=>{this.extensionHost.publish(x.ZOOM_OUT)}),this.$rotateButton.onPressed(()=>{this.extensionHost.publish(x.ROTATE)})}resize(){super.resize(),setTimeout(()=>{this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},1)}},_e=ia(),Ue=class{constructor(s,r,a,l,c=300,u=2,g=!1,v=!1){this._$element=s,this._autoCompleteFunc=r,this._delay=c,this._minChars=u,this._onSelect=l,this._parseResultsFunc=a,this._positionAbove=g,this._allowWords=v,this._$searchResultsList=_e('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=_e('<li class="result"><a href="#" tabindex="-1"></a></li>');let C=function(){let I=0;return function(L,V){clearTimeout(I),I=setTimeout(L,V)}}(),R=this;this._$element.on("keydown",function(I){let L=I.originalEvent,V=N.getCharCode(L),j=!1;(V===F.LeftArrow||V===F.RightArrow)&&(j=!0),j&&(L.cancelBubble=!0,L.stopPropagation&&L.stopPropagation())}),this._$element.on("keyup",function(I){if(!R._getSelectedListItem().length&&I.keyCode===F.Enter){R._onSelect(R._getTerms());return}if(I.keyCode!==F.Tab){if(ao(R._$searchResultsList)&&R._results.length){if(I.keyCode===F.Enter)R._searchForItem(R._getSelectedListItem());else if(I.keyCode===F.DownArrow){R._setSelectedResultIndex(1);return}else if(I.keyCode===F.UpArrow){R._setSelectedResultIndex(-1);return}}I.keyCode!==F.Enter&&C(()=>{let L=R._getTerms();L&&L.length>R._minChars&&R._searchForWords(L)?R._search(L):(R._clearResults(),R._hideResults())},R._delay)}}),_e(document).on("mouseup",I=>{this._$searchResultsList.parent().has(_e(I.target)[0]).length===0&&(this._clearResults(),this._hideResults())}),_e(document).on("focusin",I=>{this._$searchResultsList.has(_e(I.target)[0]).length===0&&!this._$element.is(_e(I.target)[0])&&(this._clearResults(),this._hideResults())}),this._hideResults()}_searchForWords(s){return!!(this._allowWords||!s.includes(" "))}_getTerms(){return this._$element.val().trim()}_setSelectedResultIndex(s){let r;s===1?r=this._selectedResultIndex+1:r=this._selectedResultIndex-1;let a=this._$searchResultsList.find("li");r<0?r=a.length-1:r>a.length-1&&(r=0),this._selectedResultIndex=r,a.removeClass("selected");let l=a.eq(this._selectedResultIndex);l.addClass("selected");let c=l.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(c)}_search(s){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();let r=this;this._autoCompleteFunc(s,a=>{r._listResults(a)})}_clearResults(){this._$searchResultsList.empty()}_hideResults(){this._$searchResultsList.hide()}_showResults(){this._selectedResultIndex=-1,this._$searchResultsList.show()}_updateListPosition(){this._positionAbove?this._$searchResultsList.css({top:this._$searchResultsList.outerHeight(!0)*-1}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})}_listResults(s){if(this._results=this._parseResultsFunc(s),this._clearResults(),!this._results.length){this._hideResults();return}for(let a=0;a<this._results.length;a++){let l=this._results[a],c=this._$searchResultTemplate.clone();c.find("a").text(l),this._$searchResultsList.append(c)}this._updateListPosition();let r=this;this._$searchResultsList.find("li").each((a,l)=>{_e(l).on("click",function(c){c.preventDefault(),r._searchForItem(_e(this))})})}_searchForItem(s){let r=s.find("a").text();this._$element.val(r),this._hideResults(),this._onSelect(r),this._clearResults(),this._hideResults()}_getSelectedListItem(){return this._$searchResultsList.find("li.selected")}},xt=o(G()),oe=ia(),yt=class extends Xt{constructor(s){super(s),this.placemarkerTouched=!1}create(){this.setConfig("searchFooterPanel"),super.create(),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE,()=>{this.canvasIndexChanged(),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton()}),this.extensionHost.subscribe(e.CLEAR_ANNOTATIONS,()=>{this.clearSearchResults()}),this.extensionHost.subscribe(x.MODE_CHANGE,()=>{this.settingsChanged()}),this.extensionHost.subscribe(x.SEARCH,l=>{this.terms=l}),this.extensionHost.subscribe(e.ANNOTATIONS,l=>{l.annotations.length&&(this.displaySearchResults(l.annotations,l.terms),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton())}),this.extensionHost.subscribe(e.ANNOTATIONS_EMPTY,()=>{this.hideSearchSpinner()}),this.extensionHost.subscribe(e.ANNOTATION_CHANGE,()=>{this.updatePrevButton(),this.updateNextButton()}),this.$printButton=oe(`
          <button class="print btn imageBtn" title="${this.content.print}" tabindex="0">
            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>${this.content.print}
          </button>
        `),this.$options.prepend(this.$printButton),this.$searchContainer=oe('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=oe('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=oe('<label class="label" for="searchWithinInput">'+this.content.searchWithin+"</label>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=oe('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=oe('<input class="searchText" id="searchWithinInput" autocomplete="off" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=oe('<button class="imageButton searchButton"></button>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=oe('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=oe('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=oe('<button class="previousResult">'+this.content.previousResult+"</button>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=oe(`<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> '<span class="terms">y</span>'</span></div>`),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=oe('<button class="clearSearch">'+this.content.clearSearch+"</button>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=oe('<button class="nextResult">'+this.content.nextResult+"</button>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=oe('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=oe('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=oe('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=oe('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=oe('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=oe('<div role="heading" class="heading"></div>'),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=oe("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var s=this;this.$searchButton.on("click",l=>{l.preventDefault(),this.search(this.$searchText.val())}),this.$searchText.on("focus",()=>{this.$searchText.val()===this.content.enterKeyword&&this.$searchText.val("")}),this.$placemarkerDetails.on("mouseover",()=>{s.extensionHost.publish(x.SEARCH_PREVIEW_START,this.currentPlacemarkerIndex)}),this.$placemarkerDetails.on("mouseleave",function(){oe(this).hide(),s.extensionHost.publish(x.SEARCH_PREVIEW_FINISH);var l=s.getSearchResultPlacemarkers();l.removeClass("hover")}),this.onAccessibleClick(this.$placemarkerDetails,()=>{s.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex)}),this.$previousResultButton.on("click",l=>{l.preventDefault(),this.isPreviousButtonEnabled()&&s.extensionHost.publish(x.PREV_SEARCH_RESULT)}),this.$nextResultButton.on("click",l=>{l.preventDefault(),this.isNextButtonEnabled()&&s.extensionHost.publish(x.NEXT_SEARCH_RESULT)}),this.$clearSearchResultsButton.on("click",l=>{l.preventDefault(),s.extensionHost.publish(e.CLEAR_ANNOTATIONS)}),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),this.extension.helper.getTotalCanvases()===1&&this.$searchResultsContainer.hide();let r=this.extension.getAutoCompleteUri();r?new Ue(this.$searchText,(l,c)=>{fetch(P.format(r,l)).then(u=>u.json()).then(u=>{c(u)})},l=>oe.map(l.terms,c=>c.match),l=>{this.search(l)},300,2,!0,S.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",l=>{l.keyCode===F.Enter&&s.search(s.$searchText.val())}),this.$printButton.onPressed(()=>{s.extensionHost.publish(x.PRINT)}),this.updatePrintButton();var a=S.getBool(this.config.options.positionMarkerEnabled,!0);a||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())}isSearchEnabled(){return this.extension.isSearchEnabled()}isZoomToSearchResultEnabled(){return S.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}isPreviousButtonEnabled(){let s=this.extension.helper.canvasIndex,r=this.getFirstSearchResultCanvasIndex(),a=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?s<r?!1:!(s===r&&a===0):s>r}isNextButtonEnabled(){let s=this.extension.helper.canvasIndex,r=this.getLastSearchResultCanvasIndex(),a=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?s>r?!1:!(s===r&&a===this.getLastSearchResultRectIndex()):s<r}getSearchResults(){return this.extension.annotations}getCurrentSearchResultRectIndex(){return this.extension.getCurrentAnnotationRectIndex()}getFirstSearchResultCanvasIndex(){let s=this.getSearchResults();return!s||!s.length?-1:s[0].canvasIndex}getLastSearchResultCanvasIndex(){let s=this.getSearchResults();return!s||!s.length?-1:s[s.length-1].canvasIndex}getLastSearchResultRectIndex(){return this.extension.getLastAnnotationRectIndex()}updateNextButton(){let s=this.getSearchResults();s&&s.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))}updatePrevButton(){let s=this.getSearchResults();s&&s.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))}updatePrintButton(){S.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()}search(s){if(this.terms=s,this.terms===""||this.terms===this.content.enterKeyword){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,function(){this.$searchText.focus()});return}this.$searchText.blur(),this.showSearchSpinner(),this.extensionHost.publish(x.SEARCH,this.terms)}getSearchResultPlacemarkers(){return this.$searchResultsContainer.find(".searchResultPlacemarker")}setCurrentSearchResultPlacemarker(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),oe('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")}positionSearchResultPlacemarkers(){let s=this.getSearchResults();if(!s||!s.length)return;let r=this.getSearchResultPlacemarkers(),a=r.length===0;r.remove();let l=this.getPageLineRatio(),c=this.$line.position().top,u=this.$line.position().left,g=this;for(let v=0;v<s.length;v++){let C=s[v],R=C.canvasIndex*l,I=oe('<div class="searchResultPlacemarker" tabindex="0" data-index="'+C.canvasIndex+'"></div>');I[0].ontouchstart=function(j){g.onPlacemarkerTouchStart.call(this,g)},I.click(function(j){g.onPlacemarkerClick.call(this,g)}),I.mouseenter(function(j){g.onPlacemarkerMouseEnter.call(this,g)}),this.onAccessibleClick(I,j=>{g.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex),g.onPlacemarkerMouseLeave.call(this,j,g)},!1),I.mouseleave(function(j){g.onPlacemarkerMouseLeave.call(this,j,g)}),I.blur(function(j){g.onPlacemarkerMouseLeave.call(this,j,g)}),this.$searchResultsContainer.append(I);let L=c-I.height(),V=u+R-I.width()/2;I.css({top:L,left:V}),v===0&&a&&I.focus()}}onPlacemarkerTouchStart(s){s.placemarkerTouched=!0}onPlacemarkerClick(s){s.placemarkerTouched||(s.placemarkerTouched=!1)}onPlacemarkerMouseEnter(s){if(s.placemarkerTouched)return;let r=oe(this);r.addClass("hover");let a=parseInt(r.attr("data-index"));s.extensionHost.publish(x.SEARCH_PREVIEW_START,a);let l=s.getSearchResultPlacemarkers().index(r[0]);s.currentPlacemarkerIndex=a,s.$placemarkerDetails.show();let c="{0} {1}";if(s.isPageModeEnabled()){let R=s.extension.helper.getCanvasByIndex(a),I=xt.LanguageMap.getValue(R.getLabel());!I&&s.extension.helper.manifest&&(I=s.extension.helper.manifest.options.defaultLabel),I&&(c=P.format(c,s.content.pageCaps,I))}else c=P.format(c,s.content.imageCaps,String(a+1));s.$placemarkerDetailsTop.html(c);let u=s.getSearchResults();if(u){let R=u[l],I="";s.terms&&(I=P.ellipsis(s.terms,s.options.elideDetailsTermsCount));let L=s.content.instanceFound,V=s.content.instancesFound,j="";R.rects.length===1?(j=P.format(L,I),s.$placemarkerDetailsBottom.html(j)):(j=P.format(V,String(R.rects.length),I),s.$placemarkerDetailsBottom.html(j))}let g=r.position(),v=g.top-s.$placemarkerDetails.height(),C=g.left;C<s.$placemarkerDetails.width()/2?C=0-r.width()/2:C>s.$line.width()-s.$placemarkerDetails.width()/2?C=s.$line.width()-s.$placemarkerDetails.width()+r.width()/2:C-=s.$placemarkerDetails.width()/2,s.$placemarkerDetails.css({top:v,left:C})}onPlacemarkerMouseLeave(s,r){r.extensionHost.publish(x.SEARCH_PREVIEW_FINISH);let a=oe(this),l=s.toElement||s.relatedTarget,c=oe(l).closest(r.$placemarkerDetails).length;l!=r.$placemarkerDetails.get(0)&&c===0&&(r.$placemarkerDetails.hide(),a.removeClass("hover"))}setPageMarkerPosition(){if(this.extension.helper.canvasIndex===null)return;let s=this.getPageLineRatio(),r=this.$line.position().top,a=this.$line.position().left,l=this.extension.helper.canvasIndex*s,c=r,u=a+l;this.$pagePositionMarker.css({top:c,left:u});let g=this.$line.width();u+this.$pagePositionLabel.outerWidth(!0)>g?(u-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:c,left:u})}clearSearchResults(){!this.isSearchEnabled()||(this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus())}getPageLineRatio(){let s=this.$line.width();return this.extension.helper.getTotalCanvases()===1?0:s/(this.extension.helper.getTotalCanvases()-1)}canvasIndexChanged(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()}settingsChanged(){this.setPlacemarkerLabel()}setPlacemarkerLabel(){let s=this.content.displaying,r=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){let a=this.extension.helper.getCanvasByIndex(r),l=xt.LanguageMap.getValue(a.getLabel());l||(l=this.content.defaultLabel);let c=this.extension.helper.getLastCanvasLabel(!0);c&&this.$pagePositionLabel.html(P.format(s,this.content.page,ro(l),ro(c)))}else this.$pagePositionLabel.html(P.format(s,this.content.image,String(r+1),this.extension.helper.getTotalCanvases().toString()))}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===z.page.toString()&&!S.getBool(this.config.options.forceImageMode,!1)}showSearchSpinner(){this.$searchText.addClass("searching")}hideSearchSpinner(){this.$searchText.removeClass("searching")}displaySearchResults(s,r){if(!this.isSearchEnabled())return;this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});let a=this.$searchResultsInfo.find(".info"),l=a.find(".number"),c=a.find(".foundFor"),u=a.find(".terms");r?(a.show(),l.text(this.extension.getTotalAnnotationRects()),s.length===1?c.html(this.content.resultFoundFor):c.html(this.content.resultsFoundFor),u.html(P.ellipsis(r,this.options.elideResultsTermsCount)),u.prop("title",r)):a.hide(),this.$searchPagerContainer.show(),this.resize()}resize(){super.resize();let s=this.getSearchResults();s&&s.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());let r=this.$element.width()/2;this.$searchPagerControls.css({left:r-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:r-this.$searchOptions.outerWidth()/2})}},Qt=ia(),Et=class extends k{constructor(s){super(s)}create(){this.setConfig("multiSelectDialogue"),super.create();let s=this;this.openCommand=e.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=e.HIDE_MULTISELECT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,()=>{this.open(),this.extension.helper.getMultiSelectState().setEnabled(!0),this.galleryComponent.set(this.data)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close(),this.extension.helper.getMultiSelectState().setEnabled(!1)}),this.$title=Qt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=Qt('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new Le({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",r=>{this.extensionHost.publish(e.MULTISELECTION_MADE,r),s.close()},!1),this.$element.hide()}isPageModeEnabled(){return S.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===z.page.toString()}open(){super.open()}close(){super.close()}resize(){super.resize();let s=this.$gallery.find(".main"),r=this.$gallery.find(".header");s.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-r.height())}},Tt=class{},me=o(H()),Ne=o(G()),pe=ia(),bt=class extends Zt{constructor(s){super(s),this.firstButtonEnabled=!1,this.lastButtonEnabled=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}create(){if(this.setConfig("pagingHeaderPanel"),super.create(),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE,r=>{this.canvasIndexChanged(r)}),this.extensionHost.subscribe(e.SETTINGS_CHANGE,()=>{this.modeChanged(),this.updatePagingToggle()}),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE_FAILED,()=>{this.setSearchFieldValue(this.extension.helper.canvasIndex)}),this.extensionHost.subscribe(e.LEFTPANEL_EXPAND_FULL_START,()=>{this.openGallery()}),this.extensionHost.subscribe(e.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.closeGallery()}),this.$prevOptions=pe('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=pe(`
          <button class="btn imageBtn first" tabindex="0" title="${this.content.first}">
            <i class="uv-icon-first" aria-hidden="true"></i>
            <span class="sr-only">${this.content.first}</span>
          </button>
        `),this.$prevOptions.append(this.$firstButton),this.$prevButton=pe(`
          <button class="btn imageBtn prev" tabindex="0" title="${this.content.previous}">
            <i class="uv-icon-prev" aria-hidden="true"></i>
            <span class="sr-only">${this.content.previous}</span>
          </button>
        `),this.$prevOptions.append(this.$prevButton),this.$modeOptions=pe('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=pe('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=pe('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=pe('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=pe('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=pe('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=pe('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),S.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=pe('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new Ue(this.$autoCompleteBox,(r,a)=>{let l=[],c=this.extension.helper.getCanvases();if(this.isPageModeEnabled())for(let u=0;u<c.length;u++){let g=c[u],v=Ne.LanguageMap.getValue(g.getLabel());v&&v.startsWith(r)&&l.push(v)}else for(let u=0;u<c.length;u++){let g=c[u];g.index.toString().startsWith(r)&&l.push(g.index.toString())}a(l)},r=>r,r=>{this.search(r)},300,0,S.getBool(this.options.autocompleteAllowWords,!1));else if(S.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=pe('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=pe('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(let r=0;r<this.extension.helper.getTotalCanvases();r++){let a=this.extension.helper.getCanvasByIndex(r),l=ro(Ne.LanguageMap.getValue(a.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+r+">"+l+"</option>")}this.$imageSelectionBox.change(()=>{let r=parseInt(this.$imageSelectionBox.val());this.extensionHost.publish(x.IMAGE_SEARCH,r)})}this.$total=pe('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=pe(`<a class="go btn btn-primary" tabindex="0">${this.content.go}</a>`),this.$search.append(this.$searchButton),this.$nextOptions=pe('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=pe(`
          <button class="btn imageBtn next" tabindex="0" title="${this.content.next}">
            <i class="uv-icon-next" aria-hidden="true"></i>
            <span class="sr-only">${this.content.next}</span>
          </button>
        `),this.$nextOptions.append(this.$nextButton),this.$lastButton=pe(`
          <button class="btn imageBtn last" tabindex="0" title="${this.content.last}">
            <i class="uv-icon-last" aria-hidden="true"></i>
            <span class="sr-only">${this.content.last}</span>
          </button>
        `),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType()===Ne.ManifestType.MANUSCRIPT?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=pe(`
          <button class="btn imageBtn gallery" title="${this.content.gallery}">
            <i class="uv-icon-gallery" aria-hidden="true"></i>
            <span class="sr-only">${this.content.gallery}</span>
          </button>
        `),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=pe('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=pe(`
          <button class="btn imageBtn one-up" title="${this.content.oneUp}">
            <i class="uv-icon-one-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.oneUp}</span>
          </button>`),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=pe(`
          <button class="btn imageBtn two-up" title="${this.content.twoUp}">
            <i class="uv-icon-two-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.twoUp}</span>
          </button>
        `),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed(()=>{let r=!1;this.updateSettings({pagingEnabled:r}),this.extensionHost.publish(x.PAGING_TOGGLED,r)}),this.$twoUpButton.onPressed(()=>{let r=!0;this.updateSettings({pagingEnabled:r}),this.extensionHost.publish(x.PAGING_TOGGLED,r)}),this.$galleryButton.onPressed(()=>{this.extensionHost.publish(e.TOGGLE_EXPAND_LEFT_PANEL)}),this.setNavigationTitles(),this.setTotal();let s=this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT;this.extension.helper.getTotalCanvases()===1&&this.$centerOptions.hide(),this.$firstButton.onPressed(()=>{switch(s.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(e.FIRST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.LAST);break}}),this.$prevButton.onPressed(()=>{switch(s.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(e.PREV);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.NEXT);break}}),this.$nextButton.onPressed(()=>{switch(s.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(e.NEXT);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.PREV);break}}),this.$lastButton.onPressed(()=>{switch(s.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(e.LAST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.FIRST);break}}),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",()=>{this.extensionHost.publish(x.MODE_CHANGE,z.image.toString())}),this.$pageModeOption.on("click",()=>{this.extensionHost.publish(x.MODE_CHANGE,z.page.toString())})):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter(()=>{this.$searchText.blur(),this.search(this.$searchText.val())}),this.$searchText.click(function(){pe(this).select()}),this.$searchButton.onPressed(()=>{this.options.autoCompleteBoxEnabled?this.search(this.$autoCompleteBox.val()):this.search(this.$searchText.val())}),this.options.modeOptionsEnabled===!1&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$search.hide(),this.options.helpEnabled===!1&&this.$helpButton.hide(),S.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()}openGallery(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")}closeGallery(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===z.page.toString()}setNavigationTitles(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))}updatePagingToggle(){if(!this.pagingToggleIsVisible()){this.$pagingToggleButtons.hide();return}this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on"))}pagingToggleIsVisible(){return S.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()}updateGalleryButton(){this.galleryIsVisible()||this.$galleryButton.hide()}galleryIsVisible(){return S.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()}setTotal(){let s=this.content.of;this.isPageModeEnabled()?this.$total.html(P.format(s,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(P.format(s,this.extension.helper.getTotalCanvases().toString()))}setSearchFieldValue(s){let r=this.extension.helper.getCanvasByIndex(s),a=null;if(this.isPageModeEnabled()){let l=Ne.LanguageMap.getValue(r.getLabel());l==="-"?a="":a=l}else s+=1,a=s.toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(a):this.$searchText.val(a)}search(s){if(!s){this.extension.showMessage(this.content.emptyValue),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}if(this.isPageModeEnabled())this.extensionHost.publish(x.PAGE_SEARCH,s);else{let r;if(this.options.autoCompleteBoxEnabled?r=parseInt(this.$autoCompleteBox.val(),10):r=parseInt(this.$searchText.val(),10),r-=1,isNaN(r)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}if(!this.extension.helper.getCanvasByIndex(r)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}this.extensionHost.publish(x.IMAGE_SEARCH,r)}}canvasIndexChanged(s){this.setSearchFieldValue(s),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$imageSelectionBox.val(s),(this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT)===me.ViewingDirection.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))}disableFirstButton(){this.firstButtonEnabled=!1,this.$firstButton.disable()}enableFirstButton(){this.firstButtonEnabled=!0,this.$firstButton.enable()}disableLastButton(){this.lastButtonEnabled=!1,this.$lastButton.disable()}enableLastButton(){this.lastButtonEnabled=!0,this.$lastButton.enable()}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.disable()}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.enable()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.disable()}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.enable()}modeChanged(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()}resize(){super.resize(),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())}},Kt;(function(s){s.BOOKMARKING="oa:bookmarking",s.CLASSIFYING="oa:classifying",s.COMMENTING="oa:commenting",s.DESCRIBING="oa:describing",s.EDITING="oa:editing",s.HIGHLIGHTING="oa:highlighting",s.IDENTIFYING="oa:identifying",s.LINKING="oa:linking",s.MODERATING="oa:moderating",s.PAINTING="sc:painting",s.QUESTIONING="oa:questioning",s.REPLYING="oa:replying",s.TAGGING="oa:tagging",s.TRANSCRIBING="oad:transcribing"})(Kt||(Kt={}));var Yt;(function(s){s.AUTO_ADVANCE="auto-advance",s.CONTINUOUS="continuous",s.FACING_PAGES="facing-pages",s.HIDDEN="hidden",s.INDIVIDUALS="individuals",s.MULTI_PART="multi-part",s.NO_NAV="no-nav",s.NON_PAGED="non-paged",s.PAGED="paged",s.REPEAT="repeat",s.SEQUENCE="sequence",s.THUMBNAIL_NAV="thumbnail-nav",s.TOGETHER="together",s.UNORDERED="unordered"})(Yt||(Yt={}));var $t;(function(s){s.CANVAS="canvas",s.CHOICE="choice",s.OA_CHOICE="oa:choice",s.CONTENT_AS_TEXT="contentastext",s.DATASET="dataset",s.DOCUMENT="document",s.IMAGE="image",s.MODEL="model",s.MOVING_IMAGE="movingimage",s.PDF="pdf",s.PHYSICAL_OBJECT="physicalobject",s.SOUND="sound",s.TEXT="text",s.TEXTUALBODY="textualbody",s.VIDEO="video"})($t||($t={}));var ei;(function(s){s.ANNOTATION="annotation",s.CANVAS="canvas",s.COLLECTION="collection",s.MANIFEST="manifest",s.RANGE="range",s.SEQUENCE="sequence"})(ei||(ei={}));var ti;(function(s){s.AUDIO_MP4="audio/mp4",s.CORTO="application/corto",s.DICOM="application/dicom",s.DRACO="application/draco",s.EPUB="application/epub+zip",s.GIRDER="image/vnd.kitware.girder",s.GLB="model/gltf-binary",s.GLTF="model/gltf+json",s.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',s.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',s.JPG="image/jpeg",s.M3U8="application/vnd.apple.mpegurl",s.MP3="audio/mp3",s.MPEG_DASH="application/dash+xml",s.OBJ="text/plain",s.OPF="application/oebps-package+xml",s.PDF="application/pdf",s.PLY="application/ply",s.THREEJS="application/vnd.threejs+json",s.USDZ="model/vnd.usd+zip",s.VIDEO_MP4="video/mp4",s.WAV="audio/wav",s.WEBM="video/webm"})(ti||(ti={}));var ii;(function(s){s.DOC="application/msword",s.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",s.PDF="application/pdf"})(ii||(ii={}));var ni;(function(s){s.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",s.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",s.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",s.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",s.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",s.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",s.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",s.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",s.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",s.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",s.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",s.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",s.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",s.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",s.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",s.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",s.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",s.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",s.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",s.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",s.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",s.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",s.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",s.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",s.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",s.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",s.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",s.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",s.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",s.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",s.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",s.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",s.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",s.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",s.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",s.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",s.SEARCH_0="http://iiif.io/api/search/0/search",s.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",s.SEARCH_1="http://iiif.io/api/search/1/search",s.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",s.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",s.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",s.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",s.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",s.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",s.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"})(ni||(ni={}));var ve;(function(s){s.BOTTOM_TO_TOP="bottom-to-top",s.LEFT_TO_RIGHT="left-to-right",s.RIGHT_TO_LEFT="right-to-left",s.TOP_TO_BOTTOM="top-to-bottom"})(ve||(ve={}));var si;(function(s){s.CONTINUOUS="continuous",s.INDIVIDUALS="individuals",s.NON_PAGED="non-paged",s.PAGED="paged",s.TOP="top"})(si||(si={}));var Ae=o(Ke());o(oi());var ri=o(H()),Pe=ia(),Rt=class extends ee{constructor(s){super(s),this.controlsVisible=!1,this.isCreated=!1,this.isLoaded=!1,this.isFirstLoad=!0,this.navigatedFromSearch=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}create(){this.setConfig("openSeadragonCenterPanel"),super.create(),this.viewerId="osd"+new Date().getTime(),this.$viewer=Pe('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.extensionHost.subscribe(e.ANNOTATIONS,s=>{this.overlayAnnotations()}),this.extensionHost.subscribe(e.SETTINGS_CHANGE,s=>{this.viewer.gestureSettingsMouse.clickToZoom=s.clickToZoomEnabled}),this.extensionHost.subscribe(e.OPEN_EXTERNAL_RESOURCE,s=>{this.whenResized(async()=>{this.isCreated||this.createUI(),this.isLoaded=!1,await this.openMedia(s),this.isLoaded=!0,this.extensionHost.publish(t.EXTERNAL_RESOURCE_OPENED),this.extensionHost.publish(t.LOAD)})}),this.extensionHost.subscribe(e.CLEAR_ANNOTATIONS,()=>{this.whenCreated(()=>{this.extension.currentAnnotationRect=null,this.clearAnnotations()})}),this.extensionHost.subscribe(x.NEXT_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.nextAnnotation()})}),this.extensionHost.subscribe(x.PREV_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.prevAnnotation()})}),this.extensionHost.subscribe(x.ZOOM_IN,()=>{this.whenCreated(()=>{this.zoomIn()})}),this.extensionHost.subscribe(x.ZOOM_OUT,()=>{this.whenCreated(()=>{this.zoomOut()})}),this.extensionHost.subscribe(x.ROTATE,()=>{this.whenCreated(()=>{this.rotateRight()})}),this.extensionHost.subscribe(e.METRIC_CHANGE,()=>{this.whenCreated(()=>{this.updateResponsiveView()})}),this.extensionHost.subscribe(e.SET_TARGET,s=>{this.whenLoaded(()=>{this.fitToBounds(s,!1)})}),this.extensionHost.subscribe(e.SET_ROTATION,s=>{this.whenLoaded(()=>{this.viewer.viewport.setRotation(s)})})}whenCreated(s){d.waitFor(()=>this.isCreated,s)}whenLoaded(s){d.waitFor(()=>this.isLoaded,s)}zoomIn(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*2)}zoomOut(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*.5)}rotateRight(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)}updateResponsiveView(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?this.viewer.autoHideControls=!0:this.viewer.autoHideControls=!1}async createUI(){this.$spinner=Pe('<div class="spinner"></div>'),this.$content.append(this.$spinner);let s="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";this.viewer=(0,Ae.default)({element:this.$viewer[0],crossOriginPolicy:"Anonymous",showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:S.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",navigatorHeight:"100px",navigatorWidth:"100px",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:S.getBool(this.config.options.constrainDuringPan,!1),immediateRender:S.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:S.getBool(this.config.options.autoHideControls,!0),prefixUrl:null,gestureSettingsMouse:{clickToZoom:S.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:s,GROUP:s,HOVER:s,DOWN:s},zoomOut:{REST:s,GROUP:s,HOVER:s,DOWN:s},home:{REST:s,GROUP:s,HOVER:s,DOWN:s},rotateright:{REST:s,GROUP:s,HOVER:s,DOWN:s},rotateleft:{REST:s,GROUP:s,HOVER:s,DOWN:s},next:{REST:s,GROUP:s,HOVER:s,DOWN:s},previous:{REST:s,GROUP:s,HOVER:s,DOWN:s}}});let r=this,a=io(l=>{let c=r.extension.helper.getCurrentCanvas();var u=r.viewer.viewport.pointFromPixel(l.position),g=r.viewer.viewport.viewportToImageCoordinates(u.x,u.y);this.extensionHost.publish(x.DOUBLECLICK,{target:`${c.id}#xywh=${Math.round(g.x)},${Math.round(g.y)},1,1`})},100);this.viewer.addViewerInputHook({hooks:[{tracker:"viewer",handler:"dblClickHandler",hookHandler:l=>{let c=this.extension.getSettings(),u=this.extension.helper.isPagingAvailable();(u&&!c.pagingEnabled||!u)&&this.config.options.doubleClickAnnotationEnabled&&a(l)}}]}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.prop("aria-label",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.prop("aria-label",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.prop("aria-label",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.prop("aria-label",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=Pe(this.viewer.canvas),this.$canvas.on("contextmenu",()=>!1),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$element.on("mouseleave",()=>{!this.controlsVisible||(this.controlsVisible=!1,this.viewer.setControlsEnabled(!1))}),this.$element.on("mousemove",()=>{if(!this.$prevButton.ismouseover()&&!this.$nextButton.ismouseover()&&!this.$viewer.find(".navigator").ismouseover()){if(!this.controlsVisible)return;this.controlsVisible=!1,this.viewer.setControlsEnabled(!1)}},this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",()=>{this.$spinner.hide()}),this.viewer.addHandler("resize",l=>{this.extensionHost.publish(x.OPENSEADRAGON_RESIZE,l),this.viewerResize(l)}),this.viewer.addHandler("animation-start",l=>{this.extensionHost.publish(x.OPENSEADRAGON_ANIMATION_START,l)}),this.viewer.addHandler("animation",l=>{this.extensionHost.publish(x.OPENSEADRAGON_ANIMATION,l)}),this.viewer.addHandler("animation-finish",l=>{this.currentBounds=this.getViewportBounds(),this.updateVisibleAnnotationRects(),this.extensionHost.publish(x.OPENSEADRAGON_ANIMATION_FINISH,l)}),this.viewer.addHandler("rotate",l=>{this.extensionHost.publish(x.OPENSEADRAGON_ROTATION,l.degrees)}),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0}createNavigationButtons(){let s=this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT;switch(this.$prevButton=Pe('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=Pe('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:Ae.default.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:Ae.default.ControlAnchor.TOP_RIGHT}),s){case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical");break}let r=this;this.onAccessibleClick(this.$prevButton,a=>{if(a.preventDefault(),Ae.default.cancelEvent(a),!!r.prevButtonEnabled)switch(s){case ve.LEFT_TO_RIGHT:case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.extensionHost.publish(e.PREV);break;case ve.RIGHT_TO_LEFT:this.extensionHost.publish(e.NEXT);break}}),this.onAccessibleClick(this.$nextButton,a=>{if(a.preventDefault(),Ae.default.cancelEvent(a),!!r.nextButtonEnabled)switch(s){case ve.LEFT_TO_RIGHT:case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.extensionHost.publish(e.NEXT);break;case ve.RIGHT_TO_LEFT:this.extensionHost.publish(e.PREV);break}}),this.$prevButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$nextButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))})}async getGirderTileSource(){return new Promise(s=>{let r=this.extension.helper.getCurrentCanvas().getContent();if(r.length){let a=r[0].getBody();if(a.length){let l=a[0].getServices();if(l.length){let c=l[0].id,u=c;u.endsWith("/")||(u+="/"),u+="tiles",c.endsWith("/")&&(c=c.substr(0,c.length-1)),fetch(u).then(g=>g.json()).then(g=>{let v={height:g.sizeY,width:g.sizeX,tileWidth:g.tileWidth,tileHeight:g.tileHeight,minLevel:0,maxLevel:g.levels-1,units:"mm",spacing:[g.mm_x,g.mm_y],getTileUrl:function(C,R,I,L){var V=u+"/zxy/"+C+"/"+R+"/"+I;return L&&(V+="?"+Pe.param(L)),V}};g.mm_x||(v.units="pixels",v.spacing=[1,1]),s(v)})}}}})}async openMedia(s){if(!this.viewer)return;this.$spinner.show(),this.items=[];let r=await this.extension.getExternalResources(s),a=this.extension.format===ri.MediaType.GIRDER;try{this.viewer.close(),r=this.getPagePositions(r);for(let l=0;l<r.length;l++){let c=r[l],u;c.hasServiceDescriptor?u=c:a?u=await this.getGirderTileSource():u={type:"image",url:c.id,buildPyramid:!1},this.viewer.addTiledImage({tileSource:u,x:c.x,y:c.y,width:c.width,success:g=>{this.items.push(g),this.items.length===r.length&&this.openPagesHandler(),this.resize(),this.goHome()}})}}catch{}}getPagePositions(s){let r,a,l,c,u,g;if(s.length>1)if(s.length===2)this.extension.helper.isVerticallyAligned()?(l=s[0],l.y=0,c=s[1],c.y=l.height+this.config.options.pageGap):(r=s[0],r.x=0,a=s[1],a.x=r.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(let v=0;v<s.length-1;v++)u=s[v],g=s[v+1],g.y=(u.y||0)+u.height;else for(let v=s.length;v>0;v--)u=s[v],g=s[v-1],g.y=(u.y||0)-u.height;else if(this.extension.helper.isLeftToRight())for(let v=0;v<s.length-1;v++)u=s[v],g=s[v+1],g.x=(u.x||0)+u.width;else for(let v=s.length-1;v>0;v--)u=s[v],g=s[v-1],g.x=(u.x||0)-u.width;return s}openPagesHandler(){this.extensionHost.publish(x.OPENSEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous()&&(this.showPrevButton(),this.showNextButton(),Pe(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT)===ve.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton())),this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1}zoomToInitialAnnotation(){let s=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,s&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(s)}overlayAnnotations(){let s=this.getAnnotationsForCurrentImages();this.clearAnnotations();for(let r=0;r<s.length;r++){let a=s[r],l=this.getAnnotationOverlayRects(a);for(let c=0;c<l.length;c++){let u=l[c],g=document.createElement("DIV");if(g.id="annotation-"+u.canvasIndex+"-"+u.resultIndex,g.title=ro(u.chars),u.width===1&&u.height===1){g.className="annotationPin",g.onclick=C=>{C.preventDefault(),this.extensionHost.publish(e.PINPOINT_ANNOTATION_CLICKED,c)};let v=document.createElement("SPAN");v.innerText=String(c+1),g.appendChild(v)}else g.className="annotationRect";this.viewer.addOverlay(g,u)}}}updateBounds(){let s=this.extension.getSettings();if(this.isFirstLoad){this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation));let r=this.extension.data.xywh;r&&(this.initialBounds=Se.fromString(r),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))}else s.preserveViewport&&this.currentBounds?this.fitToBounds(this.currentBounds):this.goHome()}goHome(){this.viewer.viewport.goHome(!0)}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")}hidePrevButton(){this.disablePrevButton(),this.$prevButton.hide()}showPrevButton(){this.enablePrevButton(),this.$prevButton.show()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")}hideNextButton(){this.disableNextButton(),this.$nextButton.hide()}showNextButton(){this.enableNextButton(),this.$nextButton.show()}fitToBounds(s,r=!0){let a=new Ae.default.Rect;a.x=Number(s.x),a.y=Number(s.y),a.width=Number(s.w),a.height=Number(s.h),setTimeout(()=>{this.viewer.viewport.fitBoundsWithConstraints(a,r)},100)}getCroppedImageBounds(){if(!this.viewer||!this.viewer.viewport)return null;let s=this.extension.helper.getCurrentCanvas(),r=this.extension.getCroppedImageDimensions(s,this.viewer);return r?new Se(r.regionPos.x,r.regionPos.y,r.region.width,r.region.height).toString():null}getViewportBounds(){if(!this.viewer||!this.viewer.viewport)return null;let s=this.viewer.viewport.getBounds(!0);return new Se(Math.floor(s.x),Math.floor(s.y),Math.floor(s.width),Math.floor(s.height))}viewerResize(s){if(!s.viewport)return;let r=s.viewport.getCenter(!0);!r||setTimeout(function(){s.viewport.panTo(r,!0)},1)}clearAnnotations(){this.viewer.clearOverlays()}getAnnotationsForCurrentImages(){let s=[],r=this.extension.annotations;if(!r||!r.length)return s;let a=this.extension.getPagedIndices();for(let l=0;l<a.length;l++){let c=a[l];for(let u=0;u<r.length;u++)if(r[u].canvasIndex===c){s.push(r[u]);break}}return s}getAnnotationRectsForCurrentImages(){let s=this.getAnnotationsForCurrentImages();return s.length?s.map(r=>r.rects).reduce((r,a)=>r.concat(a)):[]}updateVisibleAnnotationRects(){let s=this.getAnnotationRectsForCurrentImages();for(let r=0;r<s.length;r++){let a=s[r],l=this.viewer.viewport.getBounds();a.isVisible=D.hitRect(l.x,l.y,l.width,l.height,a.viewportX,a.viewportY)}}getAnnotationRectIndex(s){return this.getAnnotationRectsForCurrentImages().indexOf(s)}isZoomToSearchResultEnabled(){return S.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}prevAnnotation(){let s=this.getAnnotationRectsForCurrentImages(),r=this.extension.currentAnnotationRect,a=r?this.getAnnotationRectIndex(r):s.length,l=null;for(let c=a-1;c>=0;c--){l=s[c];break}l&&this.isZoomToSearchResultEnabled()?l.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=l,this.navigatedFromSearch=!0,this.extensionHost.publish(e.ANNOTATION_CANVAS_CHANGE,[l])):this.zoomToAnnotation(l):(this.navigatedFromSearch=!0,this.extensionHost.publish(x.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))}nextAnnotation(){let s=this.getAnnotationRectsForCurrentImages(),r=this.extension.currentAnnotationRect,a=r?this.getAnnotationRectIndex(r):-1,l=null;for(let c=a+1;c<s.length;c++){l=s[c];break}l&&this.isZoomToSearchResultEnabled()?l.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=l,this.navigatedFromSearch=!0,this.extensionHost.publish(e.ANNOTATION_CANVAS_CHANGE,[l])):this.zoomToAnnotation(l):(this.navigatedFromSearch=!0,this.extensionHost.publish(x.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))}getAnnotationRectByIndex(s){let r=this.getAnnotationRectsForCurrentImages();return r.length?r[s]:null}getInitialAnnotationRect(){let s=this.getAnnotationRectsForCurrentImages();if(!s.length)return null;if(!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex){let r=s.filter(a=>a.canvasIndex===this.extension.helper.canvasIndex);return r[r.length-1]}return s.filter(r=>r.canvasIndex===this.extension.helper.canvasIndex)[0]}zoomToAnnotation(s){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||s,this.extension.currentAnnotationRect=s,S.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new Se(s.viewportX,s.viewportY,s.width,s.height),!1);else if(this.currentBounds){let r=s.viewportX-(this.currentBounds.w*.5-s.width*.5),a=s.viewportY-(this.currentBounds.h*.5-s.height*.5),l=this.currentBounds.w,c=this.currentBounds.h,u=new Se(r,a,l,c);this.fitToBounds(u)}this.highlightAnnotationRect(s),this.extensionHost.publish(e.ANNOTATION_CHANGE)}highlightAnnotationRect(s){let r=Pe("#annotation-"+s.canvasIndex+"-"+s.index);r.addClass("current"),Pe(".annotationRect").not(r).removeClass("current")}getAnnotationOverlayRects(s){let r=[];if(!this.extension.resources)return r;let a=this.extension.resources.filter(u=>u.index===s.canvasIndex)[0],l=this.extension.resources.indexOf(a),c=0;l>0&&(c=this.extension.resources[l-1].width);for(let u=0;u<s.rects.length;u++){let g=s.rects[u],v=g.x+c+(l>0?this.config.options.pageGap:0),C=g.y,R=g.width,I=g.height,L=new Ae.default.Rect(v,C,R,I);g.viewportX=v,g.viewportY=C,L.canvasIndex=g.canvasIndex,L.resultIndex=g.index,L.chars=g.chars,r.push(L)}return r}resize(){if(super.resize(),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),!this.isCreated)return;this.title&&this.$title.text(ro(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);let s=this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){let r=Math.floor(this.$content.width()/2);switch(s){case ve.BOTTOM_TO_TOP:this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",r-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",r*-1-this.$nextButton.outerWidth()/2);break;case ve.TOP_TO_BOTTOM:this.$prevButton.css("left",r-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",r*-1-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2);break}}setTimeout(()=>{if(this.extension.helper.isContinuous())if(this.extension.helper.isHorizontallyAligned()){let r=this.$viewer.width()-this.$viewer.rightMargin();this.$navigator.width(r)}else this.$navigator.height(this.$viewer.height())},100)}setFocus(){this.$canvas&&!this.$canvas.is(":focus")&&this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()}setNavigatorVisible(){let s=S.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer&&this.viewer.navigator&&(this.viewer.navigator.setVisible(s),s?this.$navigator.show():this.$navigator.hide())}},Ee=ia(),Ct=class extends ne{constructor(s){super(s)}create(){this.setConfig("settingsDialogue"),super.create(),this.$navigatorEnabled=Ee('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=Ee('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=Ee('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=Ee('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=Ee('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=Ee('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=Ee('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=Ee('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=Ee('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=Ee('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=Ee('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=Ee('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change(()=>{let s={};this.$navigatorEnabledCheckbox.is(":checked")?s.navigatorEnabled=!0:s.navigatorEnabled=!1,this.updateSettings(s)}),this.$clickToZoomEnabledCheckbox.change(()=>{let s={};this.$clickToZoomEnabledCheckbox.is(":checked")?s.clickToZoomEnabled=!0:s.clickToZoomEnabled=!1,this.updateSettings(s)}),this.$pagingEnabledCheckbox.change(()=>{let s={};this.$pagingEnabledCheckbox.is(":checked")?s.pagingEnabled=!0:s.pagingEnabled=!1,this.updateSettings(s)}),this.$preserveViewportCheckbox.change(()=>{let s={};this.$preserveViewportCheckbox.is(":checked")?s.preserveViewport=!0:s.preserveViewport=!1,this.updateSettings(s)})}open(){super.open();let s=this.getSettings();s.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),s.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?s.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),s.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")}},_t=class extends se{constructor(s){super(s),this.extensionHost.subscribe(x.OPENSEADRAGON_OPEN,()=>{this.update()}),this.extensionHost.subscribe(x.OPENSEADRAGON_ANIMATION_FINISH,()=>{this.update()})}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update();let s=this.extension.getViewportBounds(),r=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,s,r),this.$code.val(this.code)}resize(){super.resize()}},Be=o(H()),Te=o(G()),di={allowStealFocus:!1,authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,leftPanelEnabled:!0,limitLocales:!1,doubleClickAnnotationEnabled:!1,metrics:[{type:"sm",minWidth:0},{type:"md",minWidth:768},{type:"lg",minWidth:1024},{type:"xl",minWidth:1280}],multiSelectionMimeType:"application/zip",navigatorEnabled:!0,openTemplate:"http://universalviewer.io?manifest={0}",overrideFullScreen:!1,pagingEnabled:!0,pagingOptionEnabled:!0,pessimisticAccessControl:!1,preserveViewport:!1,rightPanelEnabled:!0,saveUserSettings:!1,clickToZoomEnabled:!0,searchWithinEnabled:!0,termsOfUseEnabled:!0,theme:"uv-en-GB-theme",tokenStorage:"session",useArrowKeysToNavigate:!1,zoomToSearchResultEnabled:!0,zoomToBoundsEnabled:!0},pi={contentLeftPanel:{options:{autoExpandTreeEnabled:!1,autoExpandTreeIfFewerThan:20,branchNodesExpandOnClick:!0,branchNodesSelectable:!1,defaultToTreeEnabled:!1,defaultToTreeIfGreaterThan:0,elideCount:40,expandFullEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,tabOrder:"",thumbsCacheInvalidation:{enabled:!0,paramType:"?"},thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90},content:{collapse:"Collapse Contents",collapseFull:"Collapse Gallery",date:"date",expand:"Expand Contents",expandFull:"Expand Gallery",index:"Index",manifestRanges:"Manifest Ranges",searchResult:"{0} search result",searchResults:"{0} search results",sortBy:"Sort By:",thumbnails:"Thumbnails",title:"Contents",volume:"volume"}},dialogue:{topCloseButtonEnabled:!1,content:{close:"Close"}},downloadDialogue:{options:{confinedImageSize:1e3,currentViewDisabledPercentage:90,maxImageWidth:5e3,optionsExplanatoryTextEnabled:!1,selectionEnabled:!1},content:{currentViewAsJpg:"Current view {0} x {1}px (jpg)",currentViewAsJpgExplanation:"Opens in a new window",download:"Download",downloadSelection:"Download Selection",downloadSelectionExplanation:"Opens a dialogue to select which pages to download.",editSettings:"Edit Settings",entireDocument:"Entire document ({0})",entireFileAsOriginal:"Entire file",noneAvailable:"No download options are available.",pagingNote:"Please turn off Two Page View for additional options.",preview:"Preview",title:"Download",wholeImageHighRes:"Whole image {0} x {1}px ({2})",wholeImageHighResExplanation:"Opens in a new window.",wholeImagesHighRes:"Whole images ({0})",wholeImagesHighResExplanation:"Opens in two new windows.",wholeImageLowResAsJpg:"Whole image {0} x {1}px (jpg)",wholeImageLowResAsJpgExplanation:"Opens in a new window."}},footerPanel:{options:{autocompleteAllowWords:!1,bookmarkEnabled:!1,downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,fullscreenEnabled:!0,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,printEnabled:!1,shareEnabled:!0},content:{bookmark:"Add to bookmarks",download:"Download",embed:"Embed",exitFullScreen:"Exit Full Screen",feedback:"Feedback",fullScreen:"Full Screen",moreInfo:"More Information",open:"Open",share:"Share"}},genericDialogue:{content:{emptyValue:"please enter a value.",invalidNumber:"Please enter a valid number.",noMatches:"No matches were found.",ok:"OK",pageNotFound:"This item does not contain a page with the number you entered. Try switching the numbering mode to 'image'.",refresh:"Refresh"}},headerPanel:{options:{centerOptionsEnabled:!0,localeToggleEnabled:!1,settingsButtonEnabled:!0}},helpDialogue:{content:{text:"placeholder text",title:"Help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines"},content:{attribution:"Attribution",canvasHeader:"About the image",collapse:"Collapse Information",collapseFull:"Collapse Gallery",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",expand:"Expand Information",expandFull:"Expand Gallery",holdingText:"Your module goes here!",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",page:"Page",rangeHeader:"About this section",title:"More Information"}},multiSelectDialogue:{options:{galleryThumbChunkedResizingEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,pageModeEnabled:!0},content:{select:"Download",selectAll:"Select All",title:"Select Pages for Download"}},pagingHeaderPanel:{options:{autoCompleteBoxEnabled:!0,autocompleteAllowWords:!1,galleryButtonEnabled:!0,imageSelectionBoxEnabled:!1,pageModeEnabled:!1,pagingToggleEnabled:!0},content:{close:"Close",emptyValue:"Please enter a value",first:"First",firstImage:"First Image",firstPage:"First Page",folio:"Folio",gallery:"Gallery",go:"Go",help:"Help",image:"Image",last:"Last",lastImage:"Last Image",lastPage:"Last Page",next:"Next",nextImage:"Next Image",nextPage:"Next Page",of:"of {0}",oneUp:"Single page view",page:"Page",pageSearchLabel:"Search by Page Number",previous:"Previous",previousImage:"Previous Image",previousPage:"Previous Page",settings:"Settings",twoUp:"Two page view"}},openSeadragonCenterPanel:{options:{animationTime:.15,autoHideControls:!0,requiredStatementEnabled:!0,blendTime:0,constrainDuringPan:!1,controlsFadeAfterInactive:1500,controlsFadeDelay:250,controlsFadeLength:250,defaultZoomLevel:0,immediateRender:!1,maxZoomPixelRatio:1.25,navigatorPosition:"BOTTOM_RIGHT",pageGap:50,showHomeControl:!1,trimAttributionCount:150,visibilityRatio:.5},content:{attribution:"Attribution",goHome:"Go Home",imageUnavailable:"Image Unavailable",next:"Next",previous:"Previous",rotateRight:"Rotate Right",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},searchFooterPanel:{options:{elideDetailsTermsCount:20,elideResultsTermsCount:10,forceImageMode:!1,pageModeEnabled:!0,positionMarkerEnabled:!0},content:{clearSearch:"Clear",defaultLabel:"-",displaying:"{0} {1} of {2}",enterKeyword:"Enter Keyword",image:"image",imageCaps:"Image",instanceFound:"1 instance of '{0}' found",instancesFound:"{0} instances of '{1}' found",nextResult:"Next Result",page:"page",pageCaps:"Page",previousResult:"Previous Result",print:"Print",resultFoundFor:"result found for",resultsFoundFor:"results found for",searchWithin:"Search within this item:"}},settingsDialogue:{content:{locale:"Locale",navigatorEnabled:"Navigator Enabled",clickToZoomEnabled:"Mouse Click To Zoom",pagingEnabled:"Two Page View",reducedMotion:"Reduce motion (disables animations)",preserveViewport:"Preserve Zoom",title:"Settings",website:"<a href='https://github.com/universalviewer/universalviewer#contributors'>more info</a>"}},shareDialogue:{options:{embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>',instructionsEnabled:!1,shareFrameEnabled:!0,shareManifestsEnabled:!0},content:{customSize:"custom",embed:"Embed",embedInstructions:"To embed this item in your own website, copy and paste the code below.",height:"Height",iiif:"IIIF Manifest",share:"Share",shareInstructions:"To share this item, copy the URL below.",size:"Size:",width:"Width"}},authDialogue:{content:{cancel:"Cancel",confirm:"Confirm"}},clickThroughDialogue:{content:{viewTerms:"Read Full Terms and Conditions"}},loginDialogue:{content:{login:"Login",logout:"Logout",cancel:"Cancel"}},mobileFooterPanel:{content:{rotateRight:"Rotate Right",moreInfo:"More Information",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},restrictedDialogue:{content:{cancel:"Cancel"}}},gi={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xE7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},fi={authCORSError:"Your browser does not support CORS, please upgrade to view this content.",authorisationFailedMessage:"Your log-in attempt did not appear to be successful. Please try again.",canvasIndexOutOfRange:"Canvas index out of range.",fallbackDegradedLabel:"Login",fallbackDegradedMessage:"Please log in to view this content at full resolution.",forbiddenResourceMessage:"Your current access rights are insufficient to view this image",mediaViewer:"Media Viewer",skipToDownload:"Skip to downloads and alternative formats",termsOfUse:"Terms of Use"},Pt={options:di,modules:pi,localisation:gi,content:fi},ai=class extends Yt$1{constructor(){super(...arguments),this.currentRotation=0,this.isAnnotating=!1,this.defaultConfig=Pt,this.locales={"en-GB":Pt,"cy-GB":()=>__vitePreload(()=>import("./cy-GB-I34VTGO4-e8f18196.mjs"),["cy-GB-I34VTGO4-e8f18196.mjs","entry-c293202b.mjs","entry.20e32d7f.css"]),"fr-FR":()=>__vitePreload(()=>import("./fr-FR-ZJUT377C-9f3c54ce.mjs"),["fr-FR-ZJUT377C-9f3c54ce.mjs","entry-c293202b.mjs","entry.20e32d7f.css"]),"pl-PL":()=>__vitePreload(()=>import("./pl-PL-HBH3J3FL-fe20dbc7.mjs"),["pl-PL-HBH3J3FL-fe20dbc7.mjs","entry-c293202b.mjs","entry.20e32d7f.css"]),"sv-SE":()=>__vitePreload(()=>import("./sv-SE-FBZMG7HD-d042db42.mjs"),["sv-SE-FBZMG7HD-d042db42.mjs","entry-c293202b.mjs","entry.20e32d7f.css"])}}create(){super.create(),this.extensionHost.subscribe(e.METRIC_CHANGE,()=>{if(!this.isDesktopMetric()){let s={};s.pagingEnabled=!1,this.updateSettings(s),this.extensionHost.publish(e.UPDATE_SETTINGS)}}),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE,s=>{this.previousAnnotationRect=null,this.currentAnnotationRect=null,this.changeCanvas(s)}),this.extensionHost.subscribe(e.CLEAR_ANNOTATIONS,()=>{this.clearAnnotations(),this.extensionHost.publish(e.ANNOTATIONS_CLEARED),this.fire(e.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(e.DOWN_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.END,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(e.FIRST,()=>{this.fire(e.FIRST),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(e.GALLERY_DECREASE_SIZE,()=>{this.fire(e.GALLERY_DECREASE_SIZE)}),this.extensionHost.subscribe(e.GALLERY_INCREASE_SIZE,()=>{this.fire(e.GALLERY_INCREASE_SIZE)}),this.extensionHost.subscribe(e.GALLERY_THUMB_SELECTED,()=>{this.fire(e.GALLERY_THUMB_SELECTED)}),this.extensionHost.subscribe(e.HOME,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(x.IMAGE_SEARCH,s=>{this.fire(x.IMAGE_SEARCH,s),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,s)}),this.extensionHost.subscribe(e.LAST,()=>{this.fire(e.LAST),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(e.LEFT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getPrevPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.isDesktopMetric()&&this.shell.$rightPanel.show()}),this.extensionHost.subscribe(e.LEFTPANEL_COLLAPSE_FULL_FINISH,()=>{this.shell.$centerPanel.show(),this.resize()}),this.extensionHost.subscribe(e.LEFTPANEL_EXPAND_FULL_START,()=>{this.shell.$centerPanel.hide(),this.shell.$rightPanel.hide()}),this.extensionHost.subscribe(e.MINUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(x.MODE_CHANGE,s=>{this.fire(x.MODE_CHANGE,s),this.mode=new z(s);let r=this.getSettings();this.extensionHost.publish(e.SETTINGS_CHANGE,r)}),this.extensionHost.subscribe(e.MULTISELECTION_MADE,s=>{let r=new Tt;r.manifestUri=this.helper.manifestUri,r.allCanvases=s.length===this.helper.getCanvases().length,r.canvases=s,r.format=this.data.config.options.multiSelectionMimeType,r.sequence=this.helper.getCurrentSequence().id,this.fire(e.MULTISELECTION_MADE,r)}),this.extensionHost.subscribe(e.NEXT,()=>{this.fire(e.NEXT),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(x.NEXT_SEARCH_RESULT,()=>{this.fire(x.NEXT_SEARCH_RESULT)}),this.extensionHost.subscribe(x.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(x.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.nextSearchResult()}),this.extensionHost.subscribe(x.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(x.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.prevSearchResult()}),this.extensionHost.subscribe(e.OPEN_THUMBS_VIEW,()=>{this.fire(e.OPEN_THUMBS_VIEW)}),this.extensionHost.subscribe(e.OPEN_TREE_VIEW,()=>{this.fire(e.OPEN_TREE_VIEW)}),this.extensionHost.subscribe(e.PAGE_DOWN,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(x.PAGE_SEARCH,s=>{this.fire(x.PAGE_SEARCH,s),this.viewLabel(s)}),this.extensionHost.subscribe(e.PAGE_UP,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(x.PAGING_TOGGLED,s=>{this.fire(x.PAGING_TOGGLED,s)}),this.extensionHost.subscribe(e.PLUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.PREV,()=>{this.fire(e.PREV),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(x.PREV_SEARCH_RESULT,()=>{this.fire(x.PREV_SEARCH_RESULT)}),this.extensionHost.subscribe(x.PRINT,()=>{this.print()}),this.extensionHost.subscribe(t.RELOAD,()=>{this.extensionHost.publish(e.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(e.RIGHT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getNextPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(x.OPENSEADRAGON_ANIMATION,()=>{this.fire(x.OPENSEADRAGON_ANIMATION)}),this.extensionHost.subscribe(x.OPENSEADRAGON_ROTATION,s=>{this.fire(x.OPENSEADRAGON_ROTATION,s)}),this.extensionHost.subscribe(x.OPENSEADRAGON_ANIMATION_FINISH,s=>{let r=this.centerPanel.getViewportBounds(),a=this.helper.getCurrentCanvas();this.centerPanel&&r&&a&&(this.extensionHost.publish(x.XYWH_CHANGE,r.toString()),this.data.target=a.id+"#xywh="+r.toString(),this.fire(e.TARGET_CHANGE,this.data.target)),this.fire(x.CURRENT_VIEW_URI,{cropUri:this.getCroppedImageUri(a,this.getViewer()),fullUri:this.getConfinedImageUri(a,a.getWidth())})}),this.extensionHost.subscribe(x.OPENSEADRAGON_ANIMATION_START,()=>{this.fire(x.OPENSEADRAGON_ANIMATION_START)}),this.extensionHost.subscribe(x.OPENSEADRAGON_OPEN,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus(),this.fire(x.OPENSEADRAGON_OPEN)}),this.extensionHost.subscribe(x.OPENSEADRAGON_RESIZE,()=>{this.fire(x.OPENSEADRAGON_RESIZE)}),this.extensionHost.subscribe(x.OPENSEADRAGON_ROTATION,s=>{this.data.rotation=s,this.fire(x.OPENSEADRAGON_ROTATION,this.data.rotation),this.currentRotation=s}),this.extensionHost.subscribe(x.SEARCH,s=>{this.fire(x.SEARCH,s),this.search(s)}),this.extensionHost.subscribe(x.SEARCH_PREVIEW_FINISH,()=>{this.fire(x.SEARCH_PREVIEW_FINISH)}),this.extensionHost.subscribe(x.SEARCH_PREVIEW_START,()=>{this.fire(x.SEARCH_PREVIEW_START)}),this.extensionHost.subscribe(e.ANNOTATIONS,s=>{this.fire(e.ANNOTATIONS,s)}),this.extensionHost.subscribe(e.ANNOTATION_CANVAS_CHANGE,s=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,s[0].canvasIndex)}),this.extensionHost.subscribe(e.ANNOTATIONS_EMPTY,()=>{this.fire(e.ANNOTATIONS_EMPTY)}),this.extensionHost.subscribe(e.THUMB_SELECTED,s=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,s.index)}),this.extensionHost.subscribe(e.TREE_NODE_SELECTED,s=>{this.fire(e.TREE_NODE_SELECTED,s.data.path),this.treeNodeSelected(s)}),this.extensionHost.subscribe(e.UP_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.UPDATE_SETTINGS,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.canvasIndex);let s=this.getSettings();this.extensionHost.publish(e.SETTINGS_CHANGE,s)})}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new bt(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new Ve$1(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new Rt(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new te(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new yt(this.shell.$footerPanel),this.mobileFooterPanel=new wt(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new n(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new m(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new Et(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new _t(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new ft(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new Ct(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new mt(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()}render(){super.render(),this.checkForTarget(),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()}checkForTarget(){if(this.data.target){let s=this.data.target.split("#"),r=s[0],a=this.helper.getCanvasIndexById(r);a!==null&&this.helper.canvasIndex!==a&&this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,a);let l=s[1];this.extensionHost.publish(e.SET_TARGET,Se.fromString(l))}}checkForAnnotations(){if(this.data.annotations){let s=[],r=this.data.annotations;Array.isArray(r)?s=this.groupWebAnnotationsByTarget(this.data.annotations):r.resources.length&&(s=this.groupOpenAnnotationsByTarget(this.data.annotations),this.extensionHost.publish(e.CLEAR_ANNOTATIONS)),this.annotate(s)}}annotate(s,r){this.annotations=s,this.annotations=s.sort((l,c)=>l.canvasIndex-c.canvasIndex);let a=new o$1;a.terms=r,a.annotations=this.annotations,this.extensionHost.publish(e.ANNOTATIONS,a)}groupWebAnnotationsByTarget(s){let r=[];for(let a=0;a<s.length;a++){let l=s[a],c=l.target.match(/(.*)#/)[1],u=this.helper.getCanvasIndexById(c),g=new gt$1(c);g.canvasIndex=u;let v=r.filter(C=>C.canvasId===g.canvasId)[0];v?v.addRect(l):(g.addRect(l),r.push(g))}return r}groupOpenAnnotationsByTarget(s){let r=[];for(let a=0;a<s.resources.length;a++){let l=s.resources[a],c=l.on.match(/(.*)#/)[1],u=this.helper.getCanvasIndexById(c),g=new gt$1(c);g.canvasIndex=u;let v=r.filter(C=>C.canvasId===g.canvasId)[0];v?v.addRect(l):(g.addRect(l),r.push(g))}return r.sort((a,l)=>a.canvasIndex-l.canvasIndex),r}checkForSearchParam(){let s=this.data.highlight;s&&(s.replace(/\+/g," ").replace(/"/g,""),this.extensionHost.publish(x.SEARCH,s))}checkForRotationParam(){let s=this.data.rotation;s&&this.extensionHost.publish(e.SET_ROTATION,s)}changeCanvas(s){if(s===-1)return;let r=!1;if(s===this.helper.canvasIndex&&(r=!0),this.helper.isCanvasIndexOutOfRange(s)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),s=0),this.isPagingSettingEnabled()&&!r&&this.getPagedIndices(s).includes(this.helper.canvasIndex)){this.viewCanvas(s);return}this.viewCanvas(s)}getViewer(){return this.centerPanel.viewer}getMode(){if(this.mode)return this.mode;switch(this.helper.getManifestType()){case Te.ManifestType.MONOGRAPH:return z.page;case Te.ManifestType.MANUSCRIPT:return z.page;default:return z.image}}getViewportBounds(){if(!this.centerPanel)return null;let s=this.centerPanel.getViewportBounds();return s?s.toString():null}getViewerRotation(){return this.centerPanel?this.currentRotation:null}viewRange(s){let r=this.helper.getRangeByPath(s);if(!r)return;let a=r.getCanvasIds()[0],l=this.helper.getCanvasIndexById(a);this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,l),this.extensionHost.publish(e.RANGE_CHANGE,r)}viewLabel(s){if(!s){this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}let r=this.helper.getCanvasIndexByLabel(s);r!=-1?this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,r):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED))}treeNodeSelected(s){let r=s.data;if(r.type)switch(r.type){case Be.IIIFResourceType.MANIFEST:this.viewManifest(r);break;case Be.IIIFResourceType.COLLECTION:this.viewCollection(r);break;default:this.viewRange(r.path);break}}clearAnnotations(){this.annotations=[],this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.canvasIndex)}prevSearchResult(){let s;if(this.annotations)for(let r=this.annotations.length-1;r>=0;r--){let a=this.annotations[r];if(a.canvasIndex<=this.getPrevPageIndex()){s=a,this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,s.canvasIndex);break}}}nextSearchResult(){if(this.annotations)for(let s=0;s<this.annotations.length;s++){let r=this.annotations[s];if(r&&r.canvasIndex>=this.getNextPageIndex()){this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,r.canvasIndex);break}}}bookmark(){super.bookmark();let s=this.helper.getCurrentCanvas(),r=new i;r.index=this.helper.canvasIndex,r.label=Te.LanguageMap.getValue(s.getLabel()),r.path=this.getCroppedImageUri(s,this.getViewer()),r.thumb=s.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),r.title=this.helper.getLabel(),r.trackingLabel=window.trackingLabel,r.type=Be.ExternalResourceType.IMAGE,this.fire(e.BOOKMARK,r)}print(){window.print(),this.fire(x.PRINT)}getCroppedImageDimensions(s,r){if(!r||!r.viewport)return null;let a,l;if(s.getWidth()?a=s.getWidth():a=s.externalResource.width,s.getHeight()?l=s.getHeight():l=s.externalResource.height,!a||!l)return null;let c=r.viewport.getBounds(!0),u=new gt,g=Math.floor(c.width),v=Math.floor(c.height),C=Math.floor(c.x),R=Math.floor(c.y);C+g>a?g=a-C:C<0&&(g=g+C),C<0&&(C=0),R+v>l?v=l-R:R<0&&(v=v+R),R<0&&(R=0),g=Math.min(g,a),v=Math.min(v,l);let I=g,L=v,V=s.getMaxDimensions();if(V){if(g>V.width){let j=V.width;v=Math.round(j*(v/g)),g=j}if(v>V.height){let j=V.height;g=Math.round(g/v*j),v=j}}return u.region=new Te.Size(I,L),u.regionPos=new Ge(C,R),u.size=new Te.Size(g,v),u}getCroppedImageUri(s,r){if(!r||!r.viewport)return null;let a=this.getCroppedImageDimensions(s,r);if(!a)return null;let l=this.getImageBaseUri(s),c=this.getImageId(s);if(!c)return null;let u=a.regionPos.x+","+a.regionPos.y+","+a.region.width+","+a.region.height,g=a.size.width+","+a.size.height,v=this.getViewerRotation();return`${l}/${c}/${u}/${g}/${v}/default.jpg`}getConfinedImageDimensions(s,r){let a=s.getWidth();a||(a=s.externalResource.width);let l=s.getHeight();l||(l=s.externalResource.height);let c=new Te.Size(0,0);c.width=r;let u=T.normalise(r,0,a);return c.height=Math.floor(l*u),c}getConfinedImageUri(s,r){let a=this.getImageBaseUri(s),l=this.getImageId(s);if(!l)return null;let c="full",u=this.getConfinedImageDimensions(s,r),g=u.width+","+u.height,v=this.getViewerRotation();return`${a}/${l}/${c}/${g}/${v}/default.jpg`}getImageId(s){if(s.externalResource){let r=s.externalResource.data["@id"];if(r)return r.substr(r.lastIndexOf("/")+1)}return null}getImageBaseUri(s){let r=this.getInfoUri(s);return r=r.substr(0,r.lastIndexOf("/")),r.substr(0,r.lastIndexOf("/"))}getInfoUri(s){let r=null,a=s.getImages();if(a&&a.length){let l=a[0].getResource().getServices();for(let c=0;c<l.length;c++){let u=l[c],g=u.id;g.endsWith("/")||(g+="/"),Te.Utils.isImageProfile(u.getProfile())&&(r=g+"info.json")}}else{a=s.getContent();let l=a[0].getBody();if(l.length){let c=l[0].getServices();for(let u=0;u<c.length;u++){let g=c[u],v=g.id;v.endsWith("/")||(v+="/"),Te.Utils.isImageProfile(g.getProfile())&&(r=v+"info.json")}}}return r||(r="lib/imageunavailable.json"),r}getEmbedScript(s,r,a,l,c){let u=this.data.config.uri||"",g=this.getSerializedLocales(),v=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}&config=${u}&locales=${g}&xywh=${l}&r=${c}`;return P.format(s,v,r.toString(),a.toString())}getPrevPageIndex(s=this.helper.canvasIndex){let r;if(this.isPagingSettingEnabled()){let a=this.getPagedIndices(s);this.helper.isRightToLeft()?r=a[a.length-1]-1:r=a[0]-1}else r=s-1;return r}isSearchEnabled(){return!(!S.getBool(this.data.config.options.searchWithinEnabled,!1)||!this.helper.getSearchService())}isPagingSettingEnabled(){return this.helper.isPagingAvailable()?this.getSettings().pagingEnabled:!1}getNextPageIndex(s=this.helper.canvasIndex){let r;if(this.isPagingSettingEnabled()){let a=this.getPagedIndices(s);this.helper.isRightToLeft()?r=a[0]+1:r=a[a.length-1]+1}else r=s+1;return r>this.helper.getTotalCanvases()-1?-1:r}getAutoCompleteService(){let s=this.helper.getSearchService();return s?s.getService(Be.ServiceProfile.SEARCH_0_AUTO_COMPLETE)||s.getService(Be.ServiceProfile.SEARCH_1_AUTO_COMPLETE):null}getAutoCompleteUri(){let s=this.getAutoCompleteService();return s?s.id+"?q={0}":null}getSearchServiceUri(){let s=this.helper.getSearchService();if(!s)return null;let r=s.id;return r=r+"?q={0}",r}search(s){if(this.isAnnotating)return;this.isAnnotating=!0,this.annotations=[];let r=this,a=this.getSearchServiceUri();!a||(a=P.format(a,encodeURIComponent(s)),this.getSearchResults(a,s,this.annotations,l=>{r.isAnnotating=!1,l.length?r.annotate(l,s):r.showMessage(r.data.config.modules.genericDialogue.content.noMatches,()=>{this.extensionHost.publish(e.ANNOTATIONS_EMPTY)})}))}getSearchResults(s,r,a,l){fetch(s).then(c=>c.json()).then(c=>{c.resources&&c.resources.length&&(a=a.concat(this.groupOpenAnnotationsByTarget(c))),c.next?this.getSearchResults(c.next,r,a,l):l(a)})}getAnnotationRects(){return this.annotations.length?this.annotations.map(s=>s.rects).reduce((s,r)=>s.concat(r)):[]}getCurrentAnnotationRectIndex(){let s=this.getAnnotationRects();return this.currentAnnotationRect?s.indexOf(this.currentAnnotationRect):-1}getTotalAnnotationRects(){return this.getAnnotationRects().length}isFirstAnnotationRect(){return this.getCurrentAnnotationRectIndex()===0}getLastAnnotationRectIndex(){return this.getTotalAnnotationRects()-1}getPagedIndices(s=this.helper.canvasIndex){let r=[];return this.helper.isContinuous()?r=$.map(this.helper.getCanvases(),(a,l)=>l):this.isPagingSettingEnabled()?(this.helper.isFirstCanvas(s)||this.helper.isLastCanvas(s)&&this.helper.isTotalCanvasesEven()?r=[s]:s%2?r=[s,s+1]:r=[s-1,s],this.helper.isRightToLeft()&&(r=r.reverse())):r.push(this.helper.canvasIndex),r}};/*! @openseadragon-imaging/openseadragon-viewerinputhook 2.2.1 ab9b394 (clean)  @license MIT *///! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! License: http://openseadragon.github.io/license/
//! http://openseadragon.github.io
//! openseadragon 2.4.2
export{ai as default};
