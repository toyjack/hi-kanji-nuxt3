import{E as ye}from"./chunk-VVWTEMUP-9eb3ed02.mjs";import{i as me,D as Ee}from"./chunk-P2U3GQ3L-2d793356.mjs";import{G as Ie,H as ve,j as J}from"./IIIFContentHandler-2D2CUZM6-76bcbaed.mjs";import{P as le,T as re,G as ie,D as Te,E as Oe,M as B,S as z,O as Ne}from"./entry-cf55a5cd.mjs";var Ae=Oe((c,A)=>{(function(O,N){typeof c=="object"&&typeof A=="object"?A.exports=N():typeof define=="function"&&define.amd?define("IIIFTreeComponent",[],N):typeof c=="object"?c.IIIFTreeComponent=N():O.IIIFTreeComponent=N()})(typeof self!="undefined"?self:c,function(){return function(O){var N={};function m(T){if(N[T])return N[T].exports;var h=N[T]={i:T,l:!1,exports:{}};return O[T].call(h.exports,h,h.exports,m),h.l=!0,h.exports}return m.m=O,m.c=N,m.d=function(T,h,_){m.o(T,h)||Object.defineProperty(T,h,{enumerable:!0,get:_})},m.r=function(T){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},m.t=function(T,h){if(1&h&&(T=m(T)),8&h||4&h&&typeof T=="object"&&T&&T.__esModule)return T;var _=Object.create(null);if(m.r(_),Object.defineProperty(_,"default",{enumerable:!0,value:T}),2&h&&typeof T!="string")for(var i in T)m.d(_,i,function(d){return T[d]}.bind(null,i));return _},m.n=function(T){var h=T&&T.__esModule?function(){return T.default}:function(){return T};return m.d(h,"a",h),h},m.o=function(T,h){return Object.prototype.hasOwnProperty.call(T,h)},m.p="",m(m.s=2)}([function(O,N,m){O.exports=function(T){var h={};function _(i){if(h[i])return h[i].exports;var d=h[i]={i,l:!1,exports:{}};return T[i].call(d.exports,d,d.exports,_),d.l=!0,d.exports}return _.m=T,_.c=h,_.d=function(i,d,f){_.o(i,d)||Object.defineProperty(i,d,{enumerable:!0,get:f})},_.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},_.t=function(i,d){if(1&d&&(i=_(i)),8&d||4&d&&typeof i=="object"&&i&&i.__esModule)return i;var f=Object.create(null);if(_.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:i}),2&d&&typeof i!="string")for(var a in i)_.d(f,a,function(l){return i[l]}.bind(null,a));return f},_.n=function(i){var d=i&&i.__esModule?function(){return i.default}:function(){return i};return _.d(d,"a",d),d},_.o=function(i,d){return Object.prototype.hasOwnProperty.call(i,d)},_.p="",_(_.s=4)}([function(T,h,_){function i(d){for(var f in d)h.hasOwnProperty(f)||(h[f]=d[f])}Object.defineProperty(h,"__esModule",{value:!0}),i(_(6)),i(_(7)),i(_(8)),i(_(9)),i(_(10)),i(_(11)),i(_(12)),i(_(13)),i(_(14)),i(_(15)),i(_(16)),i(_(17)),i(_(18)),i(_(19)),i(_(20)),i(_(21)),i(_(22)),i(_(23)),i(_(24)),i(_(25)),i(_(26)),i(_(27)),i(_(28)),i(_(29)),i(_(30)),i(_(31)),i(_(32)),i(_(2))},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),function(i){i.BOOKMARKING="oa:bookmarking",i.CLASSIFYING="oa:classifying",i.COMMENTING="oa:commenting",i.DESCRIBING="oa:describing",i.EDITING="oa:editing",i.HIGHLIGHTING="oa:highlighting",i.IDENTIFYING="oa:identifying",i.LINKING="oa:linking",i.MODERATING="oa:moderating",i.PAINTING="sc:painting",i.QUESTIONING="oa:questioning",i.REPLYING="oa:replying",i.TAGGING="oa:tagging",i.TRANSCRIBING="oad:transcribing"}(h.AnnotationMotivation||(h.AnnotationMotivation={})),function(i){i.AUTO_ADVANCE="auto-advance",i.CONTINUOUS="continuous",i.FACING_PAGES="facing-pages",i.HIDDEN="hidden",i.INDIVIDUALS="individuals",i.MULTI_PART="multi-part",i.NO_NAV="no-nav",i.NON_PAGED="non-paged",i.PAGED="paged",i.REPEAT="repeat",i.SEQUENCE="sequence",i.THUMBNAIL_NAV="thumbnail-nav",i.TOGETHER="together",i.UNORDERED="unordered"}(h.Behavior||(h.Behavior={})),function(i){i.CANVAS="canvas",i.CHOICE="choice",i.CONTENT_AS_TEXT="contentastext",i.DOCUMENT="document",i.IMAGE="image",i.MOVING_IMAGE="movingimage",i.PDF="pdf",i.PHYSICAL_OBJECT="physicalobject",i.SOUND="sound",i.TEXTUALBODY="textualbody",i.VIDEO="video"}(h.ExternalResourceType||(h.ExternalResourceType={})),function(i){i.ANNOTATION="annotation",i.CANVAS="canvas",i.COLLECTION="collection",i.MANIFEST="manifest",i.RANGE="range",i.SEQUENCE="sequence"}(h.IIIFResourceType||(h.IIIFResourceType={})),function(i){i.AUDIO_MP4="audio/mp4",i.CORTO="application/corto",i.DRACO="application/draco",i.GLTF="model/gltf+json",i.JPG="image/jpeg",i.M3U8="application/vnd.apple.mpegurl",i.MP3="audio/mp3",i.MPEG_DASH="application/dash+xml",i.OBJ="text/plain",i.PDF="application/pdf",i.PLY="application/ply",i.THREEJS="application/vnd.threejs+json",i.VIDEO_MP4="video/mp4",i.WEBM="video/webm"}(h.MediaType||(h.MediaType={})),function(i){i.DOC="application/msword",i.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",i.PDF="application/pdf"}(h.RenderingFormat||(h.RenderingFormat={})),function(i){i.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",i.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",i.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",i.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",i.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",i.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",i.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",i.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",i.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",i.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",i.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",i.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",i.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",i.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",i.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",i.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",i.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",i.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",i.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",i.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",i.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",i.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",i.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",i.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",i.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",i.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",i.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",i.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",i.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",i.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",i.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",i.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",i.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",i.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",i.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",i.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",i.SEARCH_0="http://iiif.io/api/search/0/search",i.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",i.SEARCH_1="http://iiif.io/api/search/1/search",i.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",i.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",i.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",i.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",i.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",i.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",i.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(h.ServiceProfile||(h.ServiceProfile={})),function(i){i.BOTTOM_TO_TOP="bottom-to-top",i.LEFT_TO_RIGHT="left-to-right",i.RIGHT_TO_LEFT="right-to-left",i.TOP_TO_BOTTOM="top-to-bottom"}(h.ViewingDirection||(h.ViewingDirection={})),function(i){i.CONTINUOUS="continuous",i.INDIVIDUALS="individuals",i.NON_PAGED="non-paged",i.PAGED="paged",i.TOP="top"}(h.ViewingHint||(h.ViewingHint={}))},function(T,h,_){var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(p,v){function y(C){try{P(r.next(C))}catch(L){v(L)}}function b(C){try{P(r.throw(C))}catch(L){v(L)}}function P(C){var L;C.done?p(C.value):(L=C.value,L instanceof n?L:new n(function(D){D(L)})).then(y,b)}P((r=r.apply(t,e||[])).next())})},d=this&&this.__generator||function(t,e){var n,r,p,v,y={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return v={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function b(P){return function(C){return function(L){if(n)throw new TypeError("Generator is already executing.");for(;y;)try{if(n=1,r&&(p=2&L[0]?r.return:L[0]?r.throw||((p=r.return)&&p.call(r),0):r.next)&&!(p=p.call(r,L[1])).done)return p;switch(r=0,p&&(L=[2&L[0],p.value]),L[0]){case 0:case 1:p=L;break;case 4:return y.label++,{value:L[1],done:!1};case 5:y.label++,r=L[1],L=[0];continue;case 7:L=y.ops.pop(),y.trys.pop();continue;default:if(!(p=(p=y.trys).length>0&&p[p.length-1])&&(L[0]===6||L[0]===2)){y=0;continue}if(L[0]===3&&(!p||L[1]>p[0]&&L[1]<p[3])){y.label=L[1];break}if(L[0]===6&&y.label<p[1]){y.label=p[1],p=L;break}if(p&&y.label<p[2]){y.label=p[2],y.ops.push(L);break}p[2]&&y.ops.pop(),y.trys.pop();continue}L=e.call(t,y)}catch(D){L=[6,D],r=0}finally{n=p=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}([P,C])}}};Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=_(1),l=_(33);_(34);var o=function(){function t(){}return t.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},t.getImageQuality=function(e){return e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_LEVEL_1||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_LEVEL_2||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},t.getInexactLocale=function(e){return e.indexOf("-")!==-1?e.substr(0,e.indexOf("-")):e},t.getLocalisedValue=function(e,n){if(!Array.isArray(e))return e;for(var r=0;r<e.length;r++){var p=e[r];if(n===p["@language"])return p["@value"]}var v=n.substr(0,n.indexOf("-"));for(r=0;r<e.length;r++){var y=e[r];if(y["@language"]===v)return y["@value"]}return null},t.generateTreeNodeIds=function(e,n){var r;n===void 0&&(n=0),r=e.parentNode?e.parentNode.id+"-"+n:"0",e.id=r;for(var p=0;p<e.nodes.length;p++){var v=e.nodes[p];t.generateTreeNodeIds(v,p)}},t.normaliseType=function(e){return(e=e.toLowerCase()).indexOf(":")!==-1?e.split(":")[1]:e},t.normaliseUrl=function(e){return(e=e.substr(e.indexOf("://"))).indexOf("#")!==-1&&(e=e.split("#")[0]),e},t.normalisedUrlsMatch=function(e,n){return t.normaliseUrl(e)===t.normaliseUrl(n)},t.isImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.isLevel0ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},t.isLevel1ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},t.isLevel2ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.parseManifest=function(e,n){return f.Deserialiser.parse(e,n)},t.checkStatus=function(e){if(e.ok)return e;var n=new Error(e.statusText);return n.response=e,Promise.reject(n)},t.loadManifest=function(e){return new Promise(function(n){fetch(e).then(t.checkStatus).then(function(r){return r.json()}).then(function(r){n(r)})})},t.loadExternalResourcesAuth1=function(e,n,r,p,v,y,b,P){return new Promise(function(C,L){var D=e.map(function(x){return t.loadExternalResourceAuth1(x,n,r,p,v,y,b,P)});Promise.all(D).then(function(){C(e)}).catch(function(x){L(x)})})},t.loadExternalResourceAuth1=function(e,n,r,p,v,y,b,P){return i(this,void 0,void 0,function(){var C;return d(this,function(L){switch(L.label){case 0:return[4,p(e)];case 1:return(C=L.sent())?[4,e.getData(C)]:[3,6];case 2:return L.sent(),e.status!==l.OK?[3,3]:[2,e];case 3:return[4,t.doAuthChain(e,n,r,v,y,b,P)];case 4:L.sent(),L.label=5;case 5:if(e.status===l.OK||e.status===l.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError();case 6:return[4,e.getData()];case 7:return L.sent(),e.status!==l.MOVED_TEMPORARILY&&e.status!==l.UNAUTHORIZED?[3,9]:[4,t.doAuthChain(e,n,r,v,y,b,P)];case 8:L.sent(),L.label=9;case 9:if(e.status===l.OK||e.status===l.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError()}})})},t.doAuthChain=function(e,n,r,p,v,y,b){return i(this,void 0,void 0,function(){var P,C,L,D,x,U,k,K;return d(this,function(u){switch(u.label){case 0:return e.isAccessControlled()?((P=e.externalService)&&(P.options=e.options),(C=e.kioskService)&&(C.options=e.options),(L=e.clickThroughService)&&(L.options=e.options),(D=e.loginService)&&(D.options=e.options),e.isResponseHandled||e.status!==l.MOVED_TEMPORARILY?[3,2]:[4,y(e)]):[2,e];case 1:return u.sent(),[2,e];case 2:return x=null,U=null,(x=P)?(U=x,[4,t.attemptResourceWithToken(e,r,x)]):[3,4];case 3:return u.sent(),[2,e];case 4:return(x=C)?(U=x,(k=n(x))?[4,p(k)]:[3,7]):[3,7];case 5:return u.sent(),[4,t.attemptResourceWithToken(e,r,x)];case 6:return u.sent(),[2,e];case 7:return(x=L)?(U=x,[4,v(e,x)]):[3,11];case 8:return(K=u.sent())?[4,p(K)]:[3,11];case 9:return u.sent(),[4,t.attemptResourceWithToken(e,r,x)];case 10:return u.sent(),[2,e];case 11:return(x=D)?(U=x,[4,v(e,x)]):[3,15];case 12:return(K=u.sent())?[4,p(K)]:[3,15];case 13:return u.sent(),[4,t.attemptResourceWithToken(e,r,x)];case 14:return u.sent(),[2,e];case 15:return U&&b(e,U),[2]}})})},t.attemptResourceWithToken=function(e,n,r){return i(this,void 0,void 0,function(){var p,v;return d(this,function(y){switch(y.label){case 0:return(p=r.getService(a.ServiceProfile.AUTH_1_TOKEN))?[4,n(e,p)]:[3,3];case 1:return(v=y.sent())&&v.accessToken?[4,e.getData(v)]:[3,3];case 2:return y.sent(),[2,e];case 3:return[2]}})})},t.loadExternalResourcesAuth09=function(e,n,r,p,v,y,b,P,C,L){return new Promise(function(D,x){var U=e.map(function(k){return t.loadExternalResourceAuth09(k,n,r,p,v,y,b,P,C,L)});Promise.all(U).then(function(){D(e)}).catch(function(k){x(k)})})},t.loadExternalResourceAuth09=function(e,n,r,p,v,y,b,P,C,L){return new Promise(function(D,x){L&&L.pessimisticAccessControl?e.getData().then(function(){e.isAccessControlled()?e.clickThroughService?(D(r(e)),D(p(e))):v(e).then(function(){y(e,!0).then(function(U){e.getData(U).then(function(){D(C(e))}).catch(function(k){x(t.createInternalServerError(k))})}).catch(function(U){x(t.createInternalServerError(U))})}).catch(function(U){x(t.createInternalServerError(U))}):D(e)}).catch(function(U){x(t.createInternalServerError(U))}):P(e,n).then(function(U){U?e.getData(U).then(function(){e.status===l.OK?D(C(e)):t.authorize(e,n,r,p,v,y,b,P).then(function(){D(C(e))}).catch(function(k){x(t.createAuthorizationFailedError())})}).catch(function(k){x(t.createAuthorizationFailedError())}):t.authorize(e,n,r,p,v,y,b,P).then(function(){D(C(e))}).catch(function(k){x(t.createAuthorizationFailedError())})}).catch(function(U){x(t.createAuthorizationFailedError())})})},t.createError=function(e,n){var r=new Error;return r.message=n,r.name=String(e),r},t.createAuthorizationFailedError=function(){return t.createError(f.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},t.createRestrictedError=function(){return t.createError(f.StatusCode.RESTRICTED,"Restricted")},t.createInternalServerError=function(e){return t.createError(f.StatusCode.INTERNAL_SERVER_ERROR,e)},t.authorize=function(e,n,r,p,v,y,b,P){return new Promise(function(C,L){e.getData().then(function(){e.isAccessControlled()?P(e,n).then(function(D){D?e.getData(D).then(function(){e.status===l.OK?C(e):t.showAuthInteraction(e,n,r,p,v,y,b,C,L)}).catch(function(x){L(t.createInternalServerError(x))}):y(e,!1).then(function(x){x?b(e,x,n).then(function(){e.getData(x).then(function(){e.status===l.OK?C(e):t.showAuthInteraction(e,n,r,p,v,y,b,C,L)}).catch(function(U){L(t.createInternalServerError(U))})}).catch(function(U){L(t.createInternalServerError(U))}):t.showAuthInteraction(e,n,r,p,v,y,b,C,L)})}).catch(function(D){L(t.createInternalServerError(D))}):C(e)})})},t.showAuthInteraction=function(e,n,r,p,v,y,b,P,C){e.status!==l.MOVED_TEMPORARILY||e.isResponseHandled?e.clickThroughService&&!e.isResponseHandled?r(e).then(function(){y(e,!0).then(function(L){b(e,L,n).then(function(){e.getData(L).then(function(){P(e)}).catch(function(D){C(t.createInternalServerError(D))})}).catch(function(D){C(t.createInternalServerError(D))})}).catch(function(L){C(t.createInternalServerError(L))})}):v(e).then(function(){y(e,!0).then(function(L){b(e,L,n).then(function(){e.getData(L).then(function(){P(e)}).catch(function(D){C(t.createInternalServerError(D))})}).catch(function(D){C(t.createInternalServerError(D))})}).catch(function(L){C(t.createInternalServerError(L))})}):P(e)},t.getService=function(e,n){for(var r=this.getServices(e),p=0;p<r.length;p++){var v=r[p];if(v.getProfile()===n)return v}return null},t.getResourceById=function(e,n){return t.traverseAndFind(e.__jsonld,"@id",n)},t.traverseAndFind=function(e,n,r){if(e.hasOwnProperty(n)&&e[n]===r)return e;for(var p=0;p<Object.keys(e).length;p++)if(typeof e[Object.keys(e)[p]]=="object"){var v=t.traverseAndFind(e[Object.keys(e)[p]],n,r);if(v!=null)return v}},t.getServices=function(e){var n,r=[];if(!(n=e.__jsonld?e.__jsonld.service:e.service))return r;Array.isArray(n)||(n=[n]);for(var p=0;p<n.length;p++){var v=n[p];if(typeof v=="string"){var y=this.getResourceById(e.options.resource,v);y&&r.push(new f.Service(y.__jsonld||y,e.options))}else r.push(new f.Service(v,e.options))}return r},t.getTemporalComponent=function(e){var n=/t=([^&]+)/g.exec(e),r=null;return n&&n[1]&&(r=n[1].split(",")),r},t}();h.Utils=o},function(T,h,_){_.r(h),h.default=function(i,d){return d=d||{},new Promise(function(f,a){var l=new XMLHttpRequest,o=[],t=[],e={},n=function(){return{ok:(l.status/100|0)==2,statusText:l.statusText,status:l.status,url:l.responseURL,text:function(){return Promise.resolve(l.responseText)},json:function(){return Promise.resolve(JSON.parse(l.responseText))},blob:function(){return Promise.resolve(new Blob([l.response]))},clone:n,headers:{keys:function(){return o},entries:function(){return t},get:function(p){return e[p.toLowerCase()]},has:function(p){return p.toLowerCase()in e}}}};for(var r in l.open(d.method||"get",i,!0),l.onload=function(){l.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(p,v,y){o.push(v=v.toLowerCase()),t.push([v,y]),e[v]=e[v]?e[v]+","+y:y}),f(n())},l.onerror=a,l.withCredentials=d.credentials=="include",d.headers)l.setRequestHeader(r,d.headers[r]);l.send(d.body||null)})}},function(T,h,_){T.exports=_(5)},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),function(d){for(var f in d)h.hasOwnProperty(f)||(h[f]=d[f])}(_(0));var i=_(2);h.loadManifest=function(d){return i.Utils.loadManifest(d)},h.parseManifest=function(d,f){return i.Utils.parseManifest(d,f)}},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0});var i=function(){function d(f){this.__jsonld=f,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return d.prototype.getProperty=function(f){var a=null;return this.__jsonld&&((a=this.__jsonld[f])||(a=this.__jsonld["@"+f])),a},d}();h.JSONLDResource=i},function(T,h,_){var i,d=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=_(1),l=function(o){function t(e,n){var r=o.call(this,e)||this;return r.options=n,r}return d(t,o),t.prototype.getIIIFResourceType=function(){return f.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?f.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDefaultLabel=function(){return f.LanguageMap.getValue(this.getLabel())},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),n=[];if(!e)return n;for(var r=0;r<e.length;r++){var p=e[r],v=new f.LabelValuePair(this.options.locale);v.parse(p),n.push(v)}return n},t.prototype.getRendering=function(e){for(var n=this.getRenderings(),r=0;r<n.length;r++){var p=n[r];if(p.getFormat()===e)return p}return null},t.prototype.getRenderings=function(){var e,n=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++){var p=e[r];n.push(new f.Rendering(p,this.options))}return n},t.prototype.getService=function(e){return f.Utils.getService(this,e)},t.prototype.getServices=function(){return f.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new f.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===a.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===a.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===a.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===a.IIIFResourceType.SEQUENCE},t}(f.JSONLDResource);h.ManifestResource=l},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return d(o,l),o.prototype.getFormat=function(){var t=this.getProperty("format");return t?t.toLowerCase():null},o.prototype.getResources=function(){var t=[];if(!this.__jsonld.resources)return t;for(var e=0;e<this.__jsonld.resources.length;e++){var n=this.__jsonld.resources[e],r=new f.Annotation(n,this.options);t.push(r)}return t},o.prototype.getType=function(){var t=this.getProperty("type");return t?f.Utils.normaliseType(t):null},o.prototype.getWidth=function(){return this.getProperty("width")},o.prototype.getHeight=function(){return this.getProperty("height")},o.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},o.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},o}(f.ManifestResource);h.Resource=a},function(T,h,_){var i,d=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=_(1),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;r.index=-1,r.isLoaded=!1;var p={defaultLabel:"-",locale:"en-GB",resource:r,pessimisticAccessControl:!1};return r.options=Object.assign(p,n),r}return d(t,o),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?f.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?f.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getIIIFResourceType=function(){return f.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?typeof e=="string"?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return f.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(a.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new f.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,n=this.getProperty("requiredStatement");if(n)(e=new f.LabelValuePair(this.options.locale)).parse(n);else{var r=this.getAttribution();r&&((e=new f.LabelValuePair(this.options.locale)).value=r)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(n){if(e.isLoaded)n(e);else{var r=e.options;r.navDate=e.getNavDate();var p=e.__jsonld.id;p||(p=e.__jsonld["@id"]),f.Utils.loadManifest(p).then(function(v){e.parentLabel=f.LanguageMap.getValue(e.getLabel(),r.locale);var y=f.Deserialiser.parse(v,r);(e=Object.assign(e,y)).index=r.index,n(e)})}})},t}(f.ManifestResource);h.IIIFResource=l},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return d(o,l),o.prototype.getBody=function(){var t=[],e=this.getProperty("body");if(e)if(Array.isArray(e))for(var n=0;n<e.length;n++)if((v=e[n]).items)for(var r=0;r<v.items.length;r++){var p=v.items[r];t.push(new f.AnnotationBody(p,this.options))}else t.push(new f.AnnotationBody(v,this.options));else if(e.items)for(n=0;n<e.items.length;n++){var v=e.items[n];t.push(new f.AnnotationBody(v,this.options))}else t.push(new f.AnnotationBody(e,this.options));return t},o.prototype.getMotivation=function(){return this.getProperty("motivation")||null},o.prototype.getOn=function(){return this.getProperty("on")},o.prototype.getTarget=function(){return this.getProperty("target")},o.prototype.getResource=function(){return new f.Resource(this.getProperty("resource"),this.options)},o}(f.ManifestResource);h.Annotation=a},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return d(o,l),o.prototype.getFormat=function(){var t=this.getProperty("format");return t?f.Utils.getMediaType(t):null},o.prototype.getType=function(){return this.getProperty("type")?f.Utils.normaliseType(this.getProperty("type")):null},o.prototype.getWidth=function(){return this.getProperty("width")},o.prototype.getHeight=function(){return this.getProperty("height")},o}(f.ManifestResource);h.AnnotationBody=a},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(t,e,n){var r=l.call(this,e)||this;return r.label=t,r.options=n,r}return d(o,l),o.prototype.getIIIFResourceType=function(){return f.Utils.normaliseType(this.getProperty("type"))},o.prototype.getLabel=function(){return this.label},o.prototype.getResources=function(){var t=this;return this.getProperty("resources").map(function(e){return new f.Annotation(e,t.options)})},o.prototype.load=function(){var t=this;return new Promise(function(e,n){if(t.isLoaded)e(t);else{var r=t.__jsonld.id;r||(r=t.__jsonld["@id"]),f.Utils.loadManifest(r).then(function(p){t.__jsonld=p,t.context=t.getProperty("context"),t.id=t.getProperty("id"),t.isLoaded=!0,e(t)}).catch(n)}})},o}(f.JSONLDResource);h.AnnotationList=a},function(T,h,_){var i,d=this&&this.__extends||(i=function(a,l){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}i(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(h,"__esModule",{value:!0});var f=function(a){function l(o,t){return a.call(this,o,t)||this}return d(l,a),l.prototype.getItems=function(){return this.getProperty("items")},l}(_(0).ManifestResource);h.AnnotationPage=f},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return d(o,l),o.prototype.getCanonicalImageUri=function(t){var e,n=null,r="default",p=t;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],p||(p=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(r="native");else{var v=this.getImages();if(v&&v.length){var y=v[0].getResource(),b=y.getServices();if(p||(p=y.getWidth()),b.length){var P=b[0];n=P.id,r=f.Utils.getImageQuality(P.getProfile())}else if(p===y.getWidth())return y.id}if(!n){var C=this.getProperty("thumbnail");if(C){if(typeof C=="string")return C;if(C["@id"])return C["@id"];if(C.length)return C[0].id}}}return e=p+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",e,0,r+".jpg"].join("/")},o.prototype.getMaxDimensions=function(){var t,e=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(t=this.externalResource.data.profile,Array.isArray(t)&&(t=t.filter(function(n){return n.maxWidth})[0])&&(e=new f.Size(t.maxWidth,t.maxHeight?t.maxHeight:t.maxWidth))),e},o.prototype.getContent=function(){var t=[],e=this.__jsonld.items||this.__jsonld.content;if(!e)return t;var n=null;if(e.length&&(n=new f.AnnotationPage(e[0],this.options)),!n)return t;for(var r=n.getItems(),p=0;p<r.length;p++){var v=r[p],y=new f.Annotation(v,this.options);t.push(y)}return t},o.prototype.getDuration=function(){return this.getProperty("duration")},o.prototype.getImages=function(){var t=[];if(!this.__jsonld.images)return t;for(var e=0;e<this.__jsonld.images.length;e++){var n=this.__jsonld.images[e],r=new f.Annotation(n,this.options);t.push(r)}return t},o.prototype.getIndex=function(){return this.getProperty("index")},o.prototype.getOtherContent=function(){var t=this,e=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(n){return n&&typeof(r=n["@type"])=="string"&&r.toLowerCase()==r.toLowerCase();var r}).map(function(n,r){return new f.AnnotationList(n.label||"Annotation list "+r,n,t.options)}).map(function(n){return n.load()});return Promise.all(e)},o.prototype.getWidth=function(){return this.getProperty("width")},o.prototype.getHeight=function(){return this.getProperty("height")},o}(f.Resource);h.Canvas=a},function(T,h,_){var i,d=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(1),a=_(0),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r.items=[],r._collections=null,r._manifests=null,e.__collection=r,r}return d(t,o),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var n,r=this.getCollections(),p=0;p<r.length;p++){var v=r[p];v.index===e&&(n=v)}if(n)return n.options.index=e,n.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var n,r=this.getManifests(),p=0;p<r.length;p++){var v=r[p];v.index===e&&(n=v)}if(n)return n.options.index=e,n.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):f.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getDefaultTree=function(){return o.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var n=0;n<e.getManifests().length;n++){var r=e.getManifests()[n],p=r.getDefaultTree();p.label=r.parentLabel||a.LanguageMap.getValue(r.getLabel(),this.options.locale)||"manifest "+(n+1),p.navDate=r.getNavDate(),p.data.id=r.id,p.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),e.defaultTree.addNode(p)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var n=0;n<e.getCollections().length;n++){var r=e.getCollections()[n],p=r.getDefaultTree();p.label=r.parentLabel||a.LanguageMap.getValue(r.getLabel(),this.options.locale)||"collection "+(n+1),p.navDate=r.getNavDate(),p.data.id=r.id,p.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),e.defaultTree.addNode(p)}},t}(a.IIIFResource);h.Collection=l},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0});var i=function(){function d(f,a){this.start=f,this.end=a}return d.prototype.getLength=function(){return this.end-this.start},d}();h.Duration=i},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0});var i=_(0),d=function(){function f(a){this.defaultLocale=a}return f.prototype.parse=function(a){this.resource=a,this.label=i.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=i.LanguageMap.parse(this.resource.value,this.defaultLocale)},f.prototype.getLabel=function(){return this.label?i.LanguageMap.getValue(this.label,this.defaultLocale):null},f.prototype.setLabel=function(a){var l=this;if(this.label&&this.label.length){var o=this.label.filter(function(t){return t.locale===l.defaultLocale||t.locale===i.Utils.getInexactLocale(l.defaultLocale)})[0];o&&(o.value=a)}},f.prototype.getValue=function(){if(this.value){var a=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(a=this.label[0].locale),i.LanguageMap.getValue(this.value,a)}return null},f.prototype.setValue=function(a){var l=this;if(this.value&&this.value.length){var o=this.value.filter(function(t){return t.locale===l.defaultLocale||t.locale===i.Utils.getInexactLocale(l.defaultLocale)})[0];o&&(o.value=a)}},f}();h.LabelValuePair=d},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),h.Language=function(i,d){Array.isArray(i)?i.length===1?this.value=i[0]:this.value=i.join("<br/>"):this.value=i,this.locale=d}},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(){return l!==null&&l.apply(this,arguments)||this}return d(o,l),o.parse=function(t,e){var n,r=[];if(!t)return r;if(Array.isArray(t))for(var p=0;p<t.length;p++){var v=t[p];n=typeof v=="string"?new f.Language(v,e):new f.Language(v["@value"],v["@language"]||e),r.push(n)}else{if(typeof t=="string")return n=new f.Language(t,e),r.push(n),r;t["@value"]?(n=new f.Language(t["@value"],t["@language"]||e),r.push(n)):Object.keys(t).forEach(function(y){if(!t[y].length)throw new Error("language must have a value");n=new f.Language(t[y],y),r.push(n)})}return r},o.getValue=function(t,e){if(t.length){if(e){var n=t.filter(function(r){return r.locale===e||f.Utils.getInexactLocale(r.locale)===f.Utils.getInexactLocale(e)})[0];if(n)return n.value}return t[0].value}return null},o}(Array);h.LanguageMap=a},function(T,h,_){var i,d=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(1),a=_(0),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;if(r.index=0,r._allRanges=null,r.items=[],r._topRanges=[],r.__jsonld.structures&&r.__jsonld.structures.length)for(var p=r._getTopRanges(),v=0;v<p.length;v++){var y=p[v];r._parseRanges(y,String(v))}return r}return d(t,o),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new a.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(o.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var e=this.getTopRanges();return e.length&&e[0].getTree(this.defaultTree),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];r.viewingHint===f.ViewingHint.TOP&&e.push(r)}if(!e.length){var p={};p.ranges=this.__jsonld.structures,e.push(p)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];if(r["@id"]===e||r.id===e)return r}return null},t.prototype._parseRanges=function(e,n,r){var p,v=null;if(typeof e=="string"&&(v=e,e=this._getRangeById(v)),e){(p=new a.Range(e,this.options)).parentRange=r,p.path=n,r?r.items.push(p):this._topRanges.push(p);var y=e.items||e.members;if(y)for(var b=0;b<y.length;b++){var P=y[b];if(P["@type"]&&P["@type"].toLowerCase()==="sc:range"||P.type&&P.type.toLowerCase()==="range")this._parseRanges(P,n+"/"+b,p);else if(P["@type"]&&P["@type"].toLowerCase()==="sc:canvas"||P.type&&P.type.toLowerCase()==="canvas"){p.canvases||(p.canvases=[]);var C=P.id||P["@id"];p.canvases.push(C)}}else if(e.ranges)for(b=0;b<e.ranges.length;b++)this._parseRanges(e.ranges[b],n+"/"+b,p)}else console.warn("Range:",v,"does not exist")},t.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),n=function(v){var y=e[v];y.id&&r._allRanges.push(y);var b=function(C,L){C.add(L);var D=L.getRanges();return D.length?D.reduce(b,C):C},P=Array.from(y.getRanges().reduce(b,new Set));r._allRanges=r._allRanges.concat(P)},r=this,p=0;p<e.length;p++)n(p);return this._allRanges},t.prototype.getRangeById=function(e){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var p=n[r];if(p.id===e)return p}return null},t.prototype.getRangeByPath=function(e){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var p=n[r];if(p.path===e)return p}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var n=0;n<e.length;n++){var r=e[n],p=new a.Sequence(r,this.options);this.items.push(p)}else this.__jsonld.items&&(p=new a.Sequence(this.__jsonld.items,this.options),this.items.push(p));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(f.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):a.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===f.ViewingHint.PAGED;var n=this.getBehavior();return!!n&&n===f.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(a.IIIFResource);h.Manifest=l},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),function(i){i.EMPTY="",i.MANUSCRIPT="manuscript",i.MONOGRAPH="monograph"}(h.ManifestType||(h.ManifestType={}))},function(T,h,_){var i,d=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=_(1),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r._ranges=null,r.canvases=null,r.items=[],r}return d(t,o),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){var e,n;if(this.canvases&&this.canvases.length)for(var r=0;r<this.canvases.length;r++){var p=this.canvases[r],v=f.Utils.getTemporalComponent(p);v&&v.length>1&&(r===0&&(e=Number(v[0])),r===this.canvases.length-1&&(n=Number(v[1])))}else{var y=this.getRanges();for(r=0;r<y.length;r++){var b=y[r].getDuration();b&&(r===0&&(e=b.start),r===y.length-1&&(n=b.end))}}if(e!==void 0&&n!==void 0)return new f.Duration(e,n)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var n=this.getRanges();if(n&&n.length)for(var r=0;r<n.length;r++){var p=n[r],v=new f.TreeNode;e.addNode(v),this._parseTreeNode(v,p)}return f.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var n=this.getDuration();return!!(n&&e>=n.start&&e<=n.end)},t.prototype._parseTreeNode=function(e,n){e.label=f.LanguageMap.getValue(n.getLabel(),this.options.locale),e.data=n,e.data.type=f.Utils.normaliseType(f.TreeNodeType.RANGE),n.treeNode=e;var r=n.getRanges();if(r&&r.length)for(var p=0;p<r.length;p++){var v=r[p];if(v.getBehavior()!==a.Behavior.NO_NAV){var y=new f.TreeNode;e.addNode(y),this._parseTreeNode(y,v)}}},t}(f.ManifestResource);h.Range=l},function(T,h,_){var i,d=this&&this.__extends||(i=function(a,l){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}i(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(h,"__esModule",{value:!0});var f=function(a){function l(o,t){return a.call(this,o,t)||this}return d(l,a),l.prototype.getFormat=function(){return this.getProperty("format")},l}(_(0).ManifestResource);h.Rendering=f},function(T,h,_){var i,d=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(1),a=_(0),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r.items=[],r._thumbnails=null,r}return d(t,o),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var n=0;n<e.length;n++){var r=e[n];(p=new a.Canvas(r,this.options)).index=n,this.items.push(p)}else if(this.__jsonld)for(n=0;n<this.__jsonld.length;n++){var p;r=this.__jsonld[n],(p=new a.Canvas(r,this.options)).index=n,this.items.push(p)}return this.items},t.prototype.getCanvasById=function(e){for(var n=0;n<this.getTotalCanvases();n++){var r=this.getCanvasByIndex(n),p=a.Utils.normaliseUrl(r.id);if(a.Utils.normaliseUrl(e)===p)return r}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===e)return n;return null},t.prototype.getCanvasIndexByLabel=function(e,n){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),n&&(e+="r"));for(var r,p,v,y=/(\d*)\D+(\d*)/,b=0;b<this.getTotalCanvases();b++){var P=this.getCanvasByIndex(b);if(a.LanguageMap.getValue(P.getLabel(),this.options.locale)===e||(r=y.exec(e))&&(p=r[1],(v=r[2])&&new RegExp("^"+p+"\\D+"+v+"$").test(P.getLabel().toString())))return b}return-1},t.prototype.getLastCanvasLabel=function(e){for(var n=this.getTotalCanvases()-1;n>=0;n--){var r=this.getCanvasByIndex(n),p=a.LanguageMap.getValue(r.getLabel(),this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(p))return p}else if(p)return p}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,n){var r;if(n){var p=this.getPagedIndices(e),v=this.getViewingDirection();r=v&&v===f.ViewingDirection.RIGHT_TO_LEFT?p[0]+1:p[p.length-1]+1}else r=e+1;return r>this.getLastPageIndex()?-1:r},t.prototype.getPagedIndices=function(e,n){var r=[];if(n){r=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var p=this.getViewingDirection();p&&p===f.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(e);return r},t.prototype.getPrevPageIndex=function(e,n){var r;if(n){var p=this.getPagedIndices(e),v=this.getViewingDirection();r=v&&v===f.ViewingDirection.RIGHT_TO_LEFT?p[p.length-1]-1:p[0]-1}else r=e-1;return r},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===e)return n}return 0},t.prototype.getThumbs=function(e,n){for(var r=[],p=this.getTotalCanvases(),v=0;v<p;v++){var y=this.getCanvasByIndex(v),b=new a.Thumb(e,y);r.push(b)}return r},t.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),n=0;n<e.length;n++){var r=e[n].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return e===0},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===f.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(a.ManifestResource);h.Sequence=l},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0});var i=_(0),d=function(){function f(){}return f.parse=function(a,l){return typeof a=="string"&&(a=JSON.parse(a)),this.parseJson(a,l)},f.parseJson=function(a,l){var o;if(l&&l.navDate&&!isNaN(l.navDate.getTime())&&(a.navDate=l.navDate.toString()),a["@type"])switch(a["@type"]){case"sc:Collection":o=this.parseCollection(a,l);break;case"sc:Manifest":o=this.parseManifest(a,l);break;default:return null}else switch(a.type){case"Collection":o=this.parseCollection(a,l);break;case"Manifest":o=this.parseManifest(a,l);break;default:return null}return o.isLoaded=!0,o},f.parseCollection=function(a,l){var o=new i.Collection(a,l);return l?(o.index=l.index||0,l.resource&&(o.parentCollection=l.resource.parentCollection)):o.index=0,this.parseCollections(o,l),this.parseManifests(o,l),this.parseItems(o,l),o},f.parseCollections=function(a,l){var o;if(a.__jsonld.collections?o=a.__jsonld.collections:a.__jsonld.items&&(o=a.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="collection"})),o)for(var t=0;t<o.length;t++){l&&(l.index=t);var e=this.parseCollection(o[t],l);e.index=t,e.parentCollection=a,a.items.push(e)}},f.parseManifest=function(a,l){return new i.Manifest(a,l)},f.parseManifests=function(a,l){var o;if(a.__jsonld.manifests?o=a.__jsonld.manifests:a.__jsonld.items&&(o=a.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="manifest"})),o)for(var t=0;t<o.length;t++){var e=this.parseManifest(o[t],l);e.index=t,e.parentCollection=a,a.items.push(e)}},f.parseItem=function(a,l){if(a["@type"]){if(a["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(a,l);if(a["@type"].toLowerCase()==="sc:collection")return this.parseCollection(a,l)}else if(a.type){if(a.type.toLowerCase()==="manifest")return this.parseManifest(a,l);if(a.type.toLowerCase()==="collection")return this.parseCollection(a,l)}return null},f.parseItems=function(a,l){var o=a.__jsonld.members||a.__jsonld.items;if(o)for(var t=function(p){l&&(l.index=p);var v=e.parseItem(o[p],l);return v?a.items.filter(function(y){return y.id===v.id})[0]?"continue":(v.index=p,v.parentCollection=a,void a.items.push(v)):{value:void 0}},e=this,n=0;n<o.length;n++){var r=t(n);if(typeof r=="object")return r.value}},f}();h.Deserialiser=d},function(T,h,_){var i,d=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(h,"__esModule",{value:!0});var f=_(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return d(o,l),o.prototype.getProfile=function(){var t=this.getProperty("profile");return t||(t=this.getProperty("dcterms:conformsTo")),Array.isArray(t)?t[0]:t},o.prototype.getConfirmLabel=function(){return f.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},o.prototype.getDescription=function(){return f.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},o.prototype.getFailureDescription=function(){return f.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},o.prototype.getFailureHeader=function(){return f.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},o.prototype.getHeader=function(){return f.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},o.prototype.getServiceLabel=function(){return f.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},o.prototype.getInfoUri=function(){var t=this.id;return t.endsWith("/")||(t+="/"),t+"info.json"},o}(f.ManifestResource);h.Service=a},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),h.Size=function(i,d){this.width=i,this.height=d}},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),function(i){i[i.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",i[i.FORBIDDEN=2]="FORBIDDEN",i[i.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",i[i.RESTRICTED=4]="RESTRICTED"}(h.StatusCode||(h.StatusCode={}))},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0});var i=_(0);h.Thumb=function(d,f){this.data=f,this.index=f.index,this.width=d;var a=f.getHeight()/f.getWidth();this.height=a?Math.floor(this.width*a):d,this.uri=f.getCanonicalImageUri(d),this.label=i.LanguageMap.getValue(f.getLabel())}},function(T,h,_){var i,d=this&&this.__extends||(i=function(a,l){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}i(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(h,"__esModule",{value:!0});var f=function(a){function l(o,t){return a.call(this,o,t)||this}return d(l,a),l}(_(0).Resource);h.Thumbnail=f},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0});var i=_(0),d=function(){function f(a,l){this.label=a,this.data=l||{},this.nodes=[]}return f.prototype.addNode=function(a){this.nodes.push(a),a.parentNode=this},f.prototype.isCollection=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.COLLECTION)},f.prototype.isManifest=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.MANIFEST)},f.prototype.isRange=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.RANGE)},f}();h.TreeNode=d},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),function(i){i.COLLECTION="collection",i.MANIFEST="manifest",i.RANGE="range"}(h.TreeNodeType||(h.TreeNodeType={}))},function(T,h,_){T.exports=function(i){var d={};function f(a){if(d[a])return d[a].exports;var l=d[a]={i:a,l:!1,exports:{}};return i[a].call(l.exports,l,l.exports,f),l.l=!0,l.exports}return f.m=i,f.c=d,f.d=function(a,l,o){f.o(a,l)||Object.defineProperty(a,l,{enumerable:!0,get:o})},f.r=function(a){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},f.t=function(a,l){if(1&l&&(a=f(a)),8&l||4&l&&typeof a=="object"&&a&&a.__esModule)return a;var o=Object.create(null);if(f.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:a}),2&l&&typeof a!="string")for(var t in a)f.d(o,t,function(e){return a[e]}.bind(null,t));return o},f.n=function(a){var l=a&&a.__esModule?function(){return a.default}:function(){return a};return f.d(l,"a",l),l},f.o=function(a,l){return Object.prototype.hasOwnProperty.call(a,l)},f.p="",f(f.s=0)}([function(i,d,f){i.exports=f(1)},function(i,d,f){Object.defineProperty(d,"__esModule",{value:!0}),d.CONTINUE=100,d.SWITCHING_PROTOCOLS=101,d.PROCESSING=102,d.OK=200,d.CREATED=201,d.ACCEPTED=202,d.NON_AUTHORITATIVE_INFORMATION=203,d.NO_CONTENT=204,d.RESET_CONTENT=205,d.PARTIAL_CONTENT=206,d.MULTI_STATUS=207,d.MULTIPLE_CHOICES=300,d.MOVED_PERMANENTLY=301,d.MOVED_TEMPORARILY=302,d.SEE_OTHER=303,d.NOT_MODIFIED=304,d.USE_PROXY=305,d.TEMPORARY_REDIRECT=307,d.BAD_REQUEST=400,d.UNAUTHORIZED=401,d.PAYMENT_REQUIRED=402,d.FORBIDDEN=403,d.NOT_FOUND=404,d.METHOD_NOT_ALLOWED=405,d.NOT_ACCEPTABLE=406,d.PROXY_AUTHENTICATION_REQUIRED=407,d.REQUEST_TIME_OUT=408,d.CONFLICT=409,d.GONE=410,d.LENGTH_REQUIRED=411,d.PRECONDITION_FAILED=412,d.REQUEST_ENTITY_TOO_LARGE=413,d.REQUEST_URI_TOO_LARGE=414,d.UNSUPPORTED_MEDIA_TYPE=415,d.REQUESTED_RANGE_NOT_SATISFIABLE=416,d.EXPECTATION_FAILED=417,d.IM_A_TEAPOT=418,d.UNPROCESSABLE_ENTITY=422,d.LOCKED=423,d.FAILED_DEPENDENCY=424,d.UNORDERED_COLLECTION=425,d.UPGRADE_REQUIRED=426,d.PRECONDITION_REQUIRED=428,d.TOO_MANY_REQUESTS=429,d.REQUEST_HEADER_FIELDS_TOO_LARGE=431,d.INTERNAL_SERVER_ERROR=500,d.NOT_IMPLEMENTED=501,d.BAD_GATEWAY=502,d.SERVICE_UNAVAILABLE=503,d.GATEWAY_TIME_OUT=504,d.HTTP_VERSION_NOT_SUPPORTED=505,d.VARIANT_ALSO_NEGOTIATES=506,d.INSUFFICIENT_STORAGE=507,d.BANDWIDTH_LIMIT_EXCEEDED=509,d.NOT_EXTENDED=510,d.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(T,h,_){T.exports=window.fetch||(window.fetch=_(3).default||_(3))}])},function(O,N,m){O.exports=function(T){var h={};function _(i){if(h[i])return h[i].exports;var d=h[i]={i,l:!1,exports:{}};return T[i].call(d.exports,d,d.exports,_),d.l=!0,d.exports}return _.m=T,_.c=h,_.d=function(i,d,f){_.o(i,d)||Object.defineProperty(i,d,{enumerable:!0,get:f})},_.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},_.t=function(i,d){if(1&d&&(i=_(i)),8&d||4&d&&typeof i=="object"&&i&&i.__esModule)return i;var f=Object.create(null);if(_.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:i}),2&d&&typeof i!="string")for(var a in i)_.d(f,a,function(l){return i[l]}.bind(null,a));return f},_.n=function(i){var d=i&&i.__esModule?function(){return i.default}:function(){return i};return _.d(d,"a",d),d},_.o=function(i,d){return Object.prototype.hasOwnProperty.call(i,d)},_.p="",_(_.s=0)}([function(T,h,_){T.exports=_(1)},function(T,h,_){Object.defineProperty(h,"__esModule",{value:!0}),h.CONTINUE=100,h.SWITCHING_PROTOCOLS=101,h.PROCESSING=102,h.OK=200,h.CREATED=201,h.ACCEPTED=202,h.NON_AUTHORITATIVE_INFORMATION=203,h.NO_CONTENT=204,h.RESET_CONTENT=205,h.PARTIAL_CONTENT=206,h.MULTI_STATUS=207,h.MULTIPLE_CHOICES=300,h.MOVED_PERMANENTLY=301,h.MOVED_TEMPORARILY=302,h.SEE_OTHER=303,h.NOT_MODIFIED=304,h.USE_PROXY=305,h.TEMPORARY_REDIRECT=307,h.BAD_REQUEST=400,h.UNAUTHORIZED=401,h.PAYMENT_REQUIRED=402,h.FORBIDDEN=403,h.NOT_FOUND=404,h.METHOD_NOT_ALLOWED=405,h.NOT_ACCEPTABLE=406,h.PROXY_AUTHENTICATION_REQUIRED=407,h.REQUEST_TIME_OUT=408,h.CONFLICT=409,h.GONE=410,h.LENGTH_REQUIRED=411,h.PRECONDITION_FAILED=412,h.REQUEST_ENTITY_TOO_LARGE=413,h.REQUEST_URI_TOO_LARGE=414,h.UNSUPPORTED_MEDIA_TYPE=415,h.REQUESTED_RANGE_NOT_SATISFIABLE=416,h.EXPECTATION_FAILED=417,h.IM_A_TEAPOT=418,h.UNPROCESSABLE_ENTITY=422,h.LOCKED=423,h.FAILED_DEPENDENCY=424,h.UNORDERED_COLLECTION=425,h.UPGRADE_REQUIRED=426,h.PRECONDITION_REQUIRED=428,h.TOO_MANY_REQUESTS=429,h.REQUEST_HEADER_FIELDS_TOO_LARGE=431,h.INTERNAL_SERVER_ERROR=500,h.NOT_IMPLEMENTED=501,h.BAD_GATEWAY=502,h.SERVICE_UNAVAILABLE=503,h.GATEWAY_TIME_OUT=504,h.HTTP_VERSION_NOT_SUPPORTED=505,h.VARIANT_ALSO_NEGOTIATES=506,h.INSUFFICIENT_STORAGE=507,h.BANDWIDTH_LIMIT_EXCEEDED=509,h.NOT_EXTENDED=510,h.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(O,N,m){O.exports=m(3)},function(O,N,m){var T,h=this&&this.__extends||(T=function(a,l){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}T(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(N,"__esModule",{value:!0});var _=m(0),i=m(5),d=function(a){function l(o){var t=a.call(this,o)||this;return t._data=t.data(),t._data=t.options.data,t._init(),t._resize(),t}return h(l,a),l.prototype._init=function(){a.prototype._init.call(this),this._$element=$(this.el);var o=this;return this._$tree=$('<ul class="tree"></ul>'),this._$element.append(this._$tree),$.templates({pageTemplate:"{^{for nodes}}					{^{tree/}}				{{/for}}",treeTemplate:`<li>						{^{if nodes && nodes.length}}							<div class="toggle" data-link="class{merge:expanded toggle='expanded'}"></div>						{{else}}						<div class="spacer"></div>						{{/if}}						{^{if multiSelectEnabled}}							<input id="tree-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? 'checked' : ''}" class="multiSelect" />						{{/if}}						{^{if selected}}							<a id="tree-link-{{>id}}" href="#" title="{{>label}}" class="selected">{{>label}}</a>						{{else}}							<a id="tree-link-{{>id}}" href="#" title="{{>label}}">{{>label}}</a>						{{/if}}				</li>				{^{if expanded}}					<li>							<ul>									{^{for nodes}}										{^{tree/}}									{{/for}}							</ul>					</li>				{{/if}}`}),$.views.tags({tree:{toggleExpanded:function(){var t=this.data;o._setNodeExpanded(t,!t.expanded)},toggleMultiSelect:function(){var t=this.data;if(o._setNodeMultiSelected(t,!t.multiSelected),t.isRange()){var e=o._getMultiSelectState();e&&e.selectRange(t.data,t.multiSelected)}o.fire(f.TREE_NODE_MULTISELECTED,t)},init:function(t,e,n){this.data=t.view.data},onAfterLink:function(){var t=this;t.contents("li").first().on("click",".toggle",function(){t.toggleExpanded()}).on("click","a",function(e){e.preventDefault();var n=t.data;n.nodes.length&&o._data.branchNodesExpandOnClick&&t.toggleExpanded(),n.multiSelectEnabled?t.toggleMultiSelect():n.nodes.length?o._data.branchNodesSelectable&&(o.fire(f.TREE_NODE_SELECTED,n),o.selectNode(n)):(o.fire(f.TREE_NODE_SELECTED,n),o.selectNode(n))}).on("click","input.multiSelect",function(e){t.toggleMultiSelect()})},template:$.templates.treeTemplate}}),!0},l.prototype.set=function(o){var t=this;if(this._data=Object.assign(this._data,o),this._data.helper){this._rootNode=this._data.helper.getTree(this._data.topRangeIndex,this._data.treeSortType),this._flattenedTree=null,this._multiSelectableNodes=null,this._$tree.link($.templates.pageTemplate,this._rootNode);var e=this._getMultiSelectState();if(e)for(var n=function(v){var y=e.ranges[v],b=r._getMultiSelectableNodes().filter(function(P){return P.data.id===y.id})[0];b&&(r._setNodeMultiSelectEnabled(b,y.multiSelectEnabled),r._setNodeMultiSelected(b,y.multiSelected))},r=this,p=0;p<e.ranges.length;p++)n(p);this._data.autoExpand&&this.getAllNodes().forEach(function(v,y){t._setNodeExpanded(v,!0)})}},l.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},l.prototype.data=function(){return{autoExpand:!1,branchNodesExpandOnClick:!0,branchNodesSelectable:!0,helper:null,topRangeIndex:0,treeSortType:i.TreeSortType.NONE}},l.prototype.allNodesSelected=function(){var o=this._getMultiSelectableNodes(),t=this.getMultiSelectedNodes();return o.length===t.length},l.prototype._getMultiSelectableNodes=function(){var o=this;if(this._multiSelectableNodes)return this._multiSelectableNodes;var t=this.getAllNodes();return t?this._multiSelectableNodes=t.filter(function(e){return o._nodeIsMultiSelectable(e)}):[]},l.prototype._nodeIsMultiSelectable=function(o){return!!(o.data.type===_.TreeNodeType.MANIFEST&&o.nodes&&o.nodes.length>0||o.data.type===_.TreeNodeType.RANGE)},l.prototype.getAllNodes=function(){return this._flattenedTree?this._flattenedTree:this._data.helper?this._flattenedTree=this._data.helper.getFlattenedTree(this._rootNode):[]},l.prototype.getMultiSelectedNodes=function(){var o=this;return this.getAllNodes().filter(function(t){return o._nodeIsMultiSelectable(t)&&t.multiSelected})},l.prototype.getNodeById=function(o){return this.getAllNodes().filter(function(t){return t.id===o})[0]},l.prototype.expandParents=function(o,t){o&&o.parentNode&&(this._setNodeExpanded(o.parentNode,t),this.expandParents(o.parentNode,t))},l.prototype._setNodeSelected=function(o,t){$.observable(o).setProperty("selected",t)},l.prototype._setNodeExpanded=function(o,t){$.observable(o).setProperty("expanded",t)},l.prototype._setNodeMultiSelected=function(o,t){$.observable(o).setProperty("multiSelected",t)},l.prototype._setNodeMultiSelectEnabled=function(o,t){$.observable(o).setProperty("multiSelectEnabled",t)},l.prototype.selectPath=function(o){if(this._rootNode){var t=o.split("/");t.length>=1&&t.shift();var e=this.getNodeByPath(this._rootNode,t);this.selectNode(e)}},l.prototype.deselectCurrentNode=function(){this.selectedNode&&this._setNodeSelected(this.selectedNode,!1)},l.prototype.selectNode=function(o){this._rootNode&&(this.deselectCurrentNode(),this.selectedNode=o,this._setNodeSelected(this.selectedNode,!0))},l.prototype.expandNode=function(o,t){this._rootNode&&this._setNodeExpanded(o,t)},l.prototype.getNodeByPath=function(o,t){if(t.length===0)return o;var e=Number(t.shift()),n=o.nodes[e];return this.getNodeByPath(n,t)},l.prototype.show=function(){this._$element.show()},l.prototype.hide=function(){this._$element.hide()},l.prototype._resize=function(){},l}(m(4).BaseComponent);N.TreeComponent=d;var f=function(){function a(){}return a.TREE_NODE_MULTISELECTED="treeNodeMultiSelected",a.TREE_NODE_SELECTED="treeNodeSelected",a}();N.Events=f},function(O,N,m){m.r(N),m.d(N,"BaseComponent",function(){return T});var T=function(){function h(_){this.options=_,this.options.data=Object.assign({},this.data(),_.data)}return h.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},h.prototype.data=function(){return{}},h.prototype.on=function(_,i,d){var f=this._e||(this._e={});(f[_]||(f[_]=[])).push({fn:i,ctx:d})},h.prototype.fire=function(_){for(var i=[],d=1;d<arguments.length;d++)i[d-1]=arguments[d];for(var f=[].slice.call(arguments,1),a=((this._e||(this._e={}))[_]||[]).slice(),l=0,o=a.length;l<o;l++)a[l].fn.apply(a[l].ctx,f)},h.prototype._resize=function(){},h.prototype.set=function(_){},h}()},function(O,N,m){m.r(N);var T,h,_,i,d,f,a,l,o,t,e=function(u){this.isVisible=!0;var s=u.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/);this.x=Number(s[1]),this.y=Number(s[2]),this.width=Number(s[3]),this.height=Number(s[4]),this.chars=u.resource.chars},n=function(){function u(s,g){this.rects=[],this.canvasIndex=g,this.addRect(s)}return u.prototype.addRect=function(s){var g=new e(s);g.canvasIndex=this.canvasIndex,g.index=this.rects.length,this.rects.push(g),this.rects.sort(function(E,I){return E.index-I.index})},u}(),r=m(0),p=function(){function u(){this.isEnabled=!1,this.ranges=[],this.canvases=[]}return u.prototype.allCanvasesSelected=function(){return this.canvases.length>0&&this.getAllSelectedCanvases().length===this.canvases.length},u.prototype.allRangesSelected=function(){return this.ranges.length>0&&this.getAllSelectedRanges().length===this.ranges.length},u.prototype.allSelected=function(){return this.allRangesSelected()&&this.allCanvasesSelected()},u.prototype.getAll=function(){return this.canvases.concat(this.ranges)},u.prototype.getAllSelectedCanvases=function(){return this.canvases.filter(function(s){return s.multiSelected})},u.prototype.getAllSelectedRanges=function(){return this.ranges.filter(function(s){return s.multiSelected})},u.prototype.getCanvasById=function(s){return this.canvases.filter(function(g){return r.Utils.normaliseUrl(g.id)===r.Utils.normaliseUrl(s)})[0]},u.prototype.getCanvasesByIds=function(s){for(var g=[],E=0;E<s.length;E++){var I=s[E];g.push(this.getCanvasById(I))}return g},u.prototype.getRangeCanvases=function(s){var g=s.getCanvasIds();return this.getCanvasesByIds(g)},u.prototype.selectAll=function(s){this.selectRanges(this.ranges,s),this.selectCanvases(this.canvases,s)},u.prototype.selectCanvas=function(s,g){this.canvases.filter(function(E){return E.id===s.id})[0].multiSelected=g},u.prototype.selectAllCanvases=function(s){this.selectCanvases(this.canvases,s)},u.prototype.selectCanvases=function(s,g){for(var E=0;E<s.length;E++)s[E].multiSelected=g},u.prototype.selectRange=function(s,g){var E=this.ranges.filter(function(S){return S.id===s.id})[0];E.multiSelected=g;var I=this.getRangeCanvases(E);this.selectCanvases(I,g)},u.prototype.selectAllRanges=function(s){this.selectRanges(this.ranges,s)},u.prototype.selectRanges=function(s,g){for(var E=0;E<s.length;E++){var I=s[E];I.multiSelected=g;var S=this.getCanvasesByIds(I.getCanvasIds());this.selectCanvases(S,g)}},u.prototype.setEnabled=function(s){this.isEnabled=s;for(var g=this.getAll(),E=0;E<g.length;E++){var I=g[E];I.multiSelectEnabled=this.isEnabled,s||(I.multiSelected=!1)}},u}(),v=function(){function u(s,g){this.items=[],this.resource=s,this.label=g}return u.prototype.addItem=function(s){this.items.push(s)},u.prototype.addMetadata=function(s,g){g===void 0&&(g=!1);for(var E=0;E<s.length;E++){var I=s[E];I.isRootLevel=g,this.addItem(I)}},u}();(function(u){u.DATE="date",u.NONE="none"})(T||(T={})),function(u){u.BOOKMARKING="oa:bookmarking",u.CLASSIFYING="oa:classifying",u.COMMENTING="oa:commenting",u.DESCRIBING="oa:describing",u.EDITING="oa:editing",u.HIGHLIGHTING="oa:highlighting",u.IDENTIFYING="oa:identifying",u.LINKING="oa:linking",u.MODERATING="oa:moderating",u.PAINTING="sc:painting",u.QUESTIONING="oa:questioning",u.REPLYING="oa:replying",u.TAGGING="oa:tagging",u.TRANSCRIBING="oad:transcribing"}(h||(h={})),function(u){u.AUTO_ADVANCE="auto-advance",u.CONTINUOUS="continuous",u.FACING_PAGES="facing-pages",u.HIDDEN="hidden",u.INDIVIDUALS="individuals",u.MULTI_PART="multi-part",u.NO_NAV="no-nav",u.NON_PAGED="non-paged",u.PAGED="paged",u.REPEAT="repeat",u.SEQUENCE="sequence",u.THUMBNAIL_NAV="thumbnail-nav",u.TOGETHER="together",u.UNORDERED="unordered"}(_||(_={})),function(u){u.CANVAS="canvas",u.CHOICE="choice",u.CONTENT_AS_TEXT="contentastext",u.DATASET="dataset",u.DOCUMENT="document",u.IMAGE="image",u.MODEL="model",u.MOVING_IMAGE="movingimage",u.PDF="pdf",u.PHYSICAL_OBJECT="physicalobject",u.SOUND="sound",u.TEXT="text",u.TEXTUALBODY="textualbody",u.VIDEO="video"}(i||(i={})),function(u){u.ANNOTATION="annotation",u.CANVAS="canvas",u.COLLECTION="collection",u.MANIFEST="manifest",u.RANGE="range",u.SEQUENCE="sequence"}(d||(d={})),function(u){u.AUDIO_MP4="audio/mp4",u.CORTO="application/corto",u.DRACO="application/draco",u.EPUB="application/epub+zip",u.GLTF="model/gltf+json",u.JPG="image/jpeg",u.M3U8="application/vnd.apple.mpegurl",u.MP3="audio/mp3",u.MPEG_DASH="application/dash+xml",u.OBJ="text/plain",u.OPF="application/oebps-package+xml",u.PDF="application/pdf",u.PLY="application/ply",u.THREEJS="application/vnd.threejs+json",u.VIDEO_MP4="video/mp4",u.WEBM="video/webm"}(f||(f={})),function(u){u.DOC="application/msword",u.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",u.PDF="application/pdf"}(a||(a={})),function(u){u.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",u.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",u.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",u.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",u.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",u.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",u.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",u.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",u.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",u.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",u.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",u.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",u.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",u.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",u.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",u.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",u.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",u.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",u.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",u.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",u.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",u.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",u.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",u.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",u.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",u.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",u.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",u.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",u.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",u.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",u.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",u.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",u.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",u.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",u.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",u.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",u.SEARCH_0="http://iiif.io/api/search/0/search",u.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",u.SEARCH_1="http://iiif.io/api/search/1/search",u.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",u.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",u.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",u.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",u.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",u.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",u.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(l||(l={})),function(u){u.BOTTOM_TO_TOP="bottom-to-top",u.LEFT_TO_RIGHT="left-to-right",u.RIGHT_TO_LEFT="right-to-left",u.TOP_TO_BOTTOM="top-to-bottom"}(o||(o={})),function(u){u.CONTINUOUS="continuous",u.INDIVIDUALS="individuals",u.NON_PAGED="non-paged",u.PAGED="paged",u.TOP="top"}(t||(t={}));var y=function(){function u(){}return u.manifestNotLoaded="Manifest has not loaded yet",u}(),b=function(){function u(s){this.options=s,this.iiifResource=this.options.iiifResource,this.manifestUri=this.options.manifestUri,this.manifest=this.options.manifest,this.collectionIndex=this.options.collectionIndex||0,this.manifestIndex=this.options.manifestIndex||0,this.sequenceIndex=this.options.sequenceIndex||0,this.canvasIndex=this.options.canvasIndex||0}return u.prototype.getAutoCompleteService=function(){var s=this.getSearchService(),g=null;return s&&((g=s.getService(l.SEARCH_0_AUTO_COMPLETE))||(g=s.getService(l.SEARCH_1_AUTO_COMPLETE))),g},u.prototype.getAttribution=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.manifest.getAttribution();return s?r.LanguageMap.getValue(s,this.options.locale):null},u.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},u.prototype.getCanvasById=function(s){return this.getCurrentSequence().getCanvasById(s)},u.prototype.getCanvasesById=function(s){for(var g=[],E=0;E<s.length;E++){var I=s[E],S=this.getCanvasById(I);S&&g.push(S)}return g},u.prototype.getCanvasByIndex=function(s){return this.getCurrentSequence().getCanvasByIndex(s)},u.prototype.getCanvasIndexById=function(s){return this.getCurrentSequence().getCanvasIndexById(s)},u.prototype.getCanvasIndexByLabel=function(s){var g=this.getManifestType()===r.ManifestType.MANUSCRIPT;return this.getCurrentSequence().getCanvasIndexByLabel(s,g)},u.prototype.getCanvasRange=function(s,g){var E=this.getCanvasRanges(s);if(g){for(var I=0;I<E.length;I++){var S=E[I];if(S.path===g)return S}return null}return E[0]},u.prototype.getCanvasRanges=function(s){if(!this.manifest)throw new Error(y.manifestNotLoaded);return s.ranges||(s.ranges=this.manifest.getAllRanges().filter(function(g){return g.getCanvasIds().some(function(E){return r.Utils.normaliseUrl(E)===r.Utils.normaliseUrl(s.id)})})),s.ranges},u.prototype.getCollectionIndex=function(s){if(!s.parentCollection||s.parentCollection.parentCollection)return s.parentCollection?s.parentCollection.index:void 0},u.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},u.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},u.prototype.getDescription=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.manifest.getDescription();return s?r.LanguageMap.getValue(s,this.options.locale):null},u.prototype.getLabel=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.manifest.getLabel();return s?r.LanguageMap.getValue(s,this.options.locale):null},u.prototype.getLastCanvasLabel=function(s){return this.getCurrentSequence().getLastCanvasLabel(s)},u.prototype.getFirstPageIndex=function(){return 0},u.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},u.prototype.getLicense=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getLicense()},u.prototype.getLogo=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getLogo()},u.prototype.getManifestType=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.manifest.getManifestType();return s===r.ManifestType.EMPTY&&(s=r.ManifestType.MONOGRAPH),s},u.prototype.getMetadata=function(s){if(!this.manifest)throw new Error(y.manifestNotLoaded);var g=[],E=this.manifest.getMetadata(),I=new v(this.manifest),S=this.options.locale;E&&E.length&&I.addMetadata(E,!0),this.manifest.getDescription().length&&((w=new r.LabelValuePair(S)).label=[new r.Language("description",S)],w.value=this.manifest.getDescription(),w.isRootLevel=!0,I.addItem(w)),this.manifest.getAttribution().length&&((w=new r.LabelValuePair(S)).label=[new r.Language("attribution",S)],w.value=this.manifest.getAttribution(),w.isRootLevel=!0,I.addItem(w));var R=this.manifest.getLicense();if(R){var M={label:"license",value:s&&s.licenseFormatter?s.licenseFormatter.format(R):R};(w=new r.LabelValuePair(S)).parse(M),w.isRootLevel=!0,I.addItem(w)}if(this.manifest.getLogo()){var w;M={label:"logo",value:'<img src="'+this.manifest.getLogo()+'"/>'},(w=new r.LabelValuePair(S)).parse(M),w.isRootLevel=!0,I.addItem(w)}return g.push(I),s?this._parseMetadataOptions(s,g):g},u.prototype.getRequiredStatement=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.manifest.getRequiredStatement();return s?{label:s.getLabel(),value:s.getValue()}:null},u.prototype._parseMetadataOptions=function(s,g){var E=this.getCurrentSequence(),I=E.getMetadata();if(I&&I.length){var S=new v(E);S.addMetadata(I),g.push(S)}if(s.range){var R=this._getRangeMetadata([],s.range);R=R.reverse(),g=g.concat(R)}if(s.canvases&&s.canvases.length)for(var M=0;M<s.canvases.length;M++){var w=s.canvases[M],H=w.getMetadata();if(H&&H.length){var j=new v(w);j.addMetadata(w.getMetadata()),g.push(j)}for(var Y=w.getImages(),W=0;W<Y.length;W++){var Q=Y[W],ne=Q.getMetadata();if(ne&&ne.length){var ae=new v(Q);ae.addMetadata(ne),g.push(ae)}}}return g},u.prototype._getRangeMetadata=function(s,g){var E=g.getMetadata();if(E&&E.length){var I=new v(g);I.addMetadata(E),s.push(I)}else if(g.parentRange)return this._getRangeMetadata(s,g.parentRange);return s},u.prototype.getMultiSelectState=function(){return this._multiSelectState||(this._multiSelectState=new p,this._multiSelectState.ranges=this.getRanges().slice(0),this._multiSelectState.canvases=this.getCurrentSequence().getCanvases().slice(0)),this._multiSelectState},u.prototype.getCurrentRange=function(){return this.rangeId?this.getRangeById(this.rangeId):null},u.prototype.getPosterCanvas=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getPosterCanvas()},u.prototype.getPosterImage=function(){var s=this.getPosterCanvas();if(s){var g=s.getContent();if(g&&g.length)return g[0].getBody()[0].id}return null},u.prototype.getPreviousRange=function(s){var g=null;if(g=s||this.getCurrentRange()){var E=this.getFlattenedTree();if(E)for(var I=0;I<E.length;I++){var S=E[I];if(S&&S.data.id===g.id){for(;I>0;)return E[--I].data;break}}}return null},u.prototype.getNextRange=function(s){var g=null;if(g=s||this.getCurrentRange()){var E=this.getFlattenedTree();if(E)for(var I=0;I<E.length;I++){var S=E[I];if(S&&S.data.id===g.id){for(;I<E.length-1;){var R=E[++I];if(R.data.canvases&&R.data.canvases.length)return R.data}break}}}return null},u.prototype.getFlattenedTree=function(s){var g=null;return(g=s||this.getTree())?this._flattenTree(g,"nodes"):null},u.prototype._flattenTree=function(s,g){var E=this,I=[s];return s[g]&&s[g].length>0?I.concat(s[g].map(function(S){return E._flattenTree(S,g)}).reduce(function(S,R){return S.concat(R)},[])):I},u.prototype.getRanges=function(){return this.manifest.getAllRanges()},u.prototype.getRangeByPath=function(s){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getRangeByPath(s)},u.prototype.getRangeById=function(s){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getRangeById(s)},u.prototype.getRangeCanvases=function(s){var g=s.getCanvasIds();return this.getCanvasesById(g)},u.prototype.getRelated=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getRelated()},u.prototype.getSearchService=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.manifest.getService(l.SEARCH_0);return s||(s=this.manifest.getService(l.SEARCH_1)),s},u.prototype.getSeeAlso=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getSeeAlso()},u.prototype.getSequenceByIndex=function(s){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getSequenceByIndex(s)},u.prototype.getShareServiceUrl=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=null,g=this.manifest.getService(l.SHARE_EXTENSIONS);return g&&(g.length&&(g=g[0]),s=g.__jsonld.shareUrl),s},u.prototype._getSortedTreeNodesByDate=function(s,g){var E=this.getFlattenedTree(g);if(E){var I=E.filter(function(S){return S.data.type===r.TreeNodeType.MANIFEST});this.createDecadeNodes(s,E),this.sortDecadeNodes(s),this.createYearNodes(s,E),this.sortYearNodes(s),this.createMonthNodes(s,I),this.sortMonthNodes(s),this.createDateNodes(s,I),this.pruneDecadeNodes(s)}},u.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},u.prototype.getThumbs=function(s,g){return this.getCurrentSequence().getThumbs(s,g)},u.prototype.getTopRanges=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getTopRanges()},u.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},u.prototype.getTrackingLabel=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.getTrackingLabel()},u.prototype._getTopRanges=function(){return this.iiifResource.getTopRanges()},u.prototype.getTree=function(s,g){if(s===void 0&&(s=0),g===void 0&&(g=T.NONE),!this.iiifResource)return null;var E;if(this.iiifResource.isCollection())E=this.iiifResource.getDefaultTree();else{var I=this._getTopRanges(),S=new r.TreeNode;if(S.label="root",S.data=this.iiifResource,!I.length)return S;E=I[s].getTree(S)}var R=new r.TreeNode;switch(g.toString()){case T.DATE.toString():if(this.treeHasNavDates(E)){this._getSortedTreeNodesByDate(R,E);break}default:R=E}return R},u.prototype.treeHasNavDates=function(s){var g=this.getFlattenedTree(s);return!!g&&g.some(function(E){return!isNaN(E.navDate)})},u.prototype.getViewingDirection=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.getCurrentSequence().getViewingDirection();return s||(s=this.manifest.getViewingDirection()),s},u.prototype.getViewingHint=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.getCurrentSequence().getViewingHint();return s||(s=this.manifest.getViewingHint()),s},u.prototype.hasParentCollection=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return!!this.manifest.parentCollection},u.prototype.hasRelatedPage=function(){var s=this.getRelated();return!!s&&(s.length&&(s=s[0]),s.format==="text/html")},u.prototype.hasResources=function(){return this.getCurrentCanvas().getResources().length>0},u.prototype.isBottomToTop=function(){var s=this.getViewingDirection();return!!s&&s===o.BOTTOM_TO_TOP},u.prototype.isCanvasIndexOutOfRange=function(s){return this.getCurrentSequence().isCanvasIndexOutOfRange(s)},u.prototype.isContinuous=function(){var s=this.getViewingHint();return!!s&&s===t.CONTINUOUS},u.prototype.isFirstCanvas=function(s){return s!==void 0?this.getCurrentSequence().isFirstCanvas(s):this.getCurrentSequence().isFirstCanvas(this.canvasIndex)},u.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},u.prototype.isLastCanvas=function(s){return s!==void 0?this.getCurrentSequence().isLastCanvas(s):this.getCurrentSequence().isLastCanvas(this.canvasIndex)},u.prototype.isLeftToRight=function(){var s=this.getViewingDirection();return!!s&&s===o.LEFT_TO_RIGHT},u.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},u.prototype.isMultiSequence=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.isMultiSequence()},u.prototype.isPaged=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);var s=this.getViewingHint();return s?s===t.PAGED:this.manifest.isPagingEnabled()},u.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},u.prototype.isPagingEnabled=function(){if(!this.manifest)throw new Error(y.manifestNotLoaded);return this.manifest.isPagingEnabled()||this.getCurrentSequence().isPagingEnabled()},u.prototype.isRightToLeft=function(){var s=this.getViewingDirection();return!!s&&s===o.RIGHT_TO_LEFT},u.prototype.isTopToBottom=function(){var s=this.getViewingDirection();return!!s&&s===o.TOP_TO_BOTTOM},u.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},u.prototype.isUIEnabled=function(s){if(!this.manifest)throw new Error(y.manifestNotLoaded);var g=this.manifest.getService(l.UI_EXTENSIONS);if(g){var E=g.getProperty("disableUI");if(E&&(E.indexOf(s)!==-1||E.indexOf(s.toLowerCase())!==-1))return!1}return!0},u.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},u.prototype.createDateNodes=function(s,g){for(var E=0;E<g.length;E++){var I=g[E],S=this.getNodeYear(I),R=this.getNodeMonth(I),M=new r.TreeNode;M.id=I.id,M.label=this.getNodeDisplayDate(I),M.data=I.data,M.data.type=r.TreeNodeType.MANIFEST,M.data.year=S,M.data.month=R;var w=this.getDecadeNode(s,S);if(w){var H=this.getYearNode(w,S);if(H){var j=this.getMonthNode(H,R);j&&j.addNode(M)}}}},u.prototype.createDecadeNodes=function(s,g){for(var E=0;E<g.length;E++){var I=g[E];if(I.navDate){var S=this.getNodeYear(I),R=Number(S.toString().substr(0,3)+"9");if(!this.getDecadeNode(s,S)){var M=new r.TreeNode;M.label=S+" - "+R,M.navDate=I.navDate,M.data.startYear=S,M.data.endYear=R,s.addNode(M)}}}},u.prototype.createMonthNodes=function(s,g){for(var E=0;E<g.length;E++){var I=g[E];if(I.navDate){var S=this.getNodeYear(I),R=this.getNodeMonth(I),M=this.getDecadeNode(s,S),w=null;if(M&&(w=this.getYearNode(M,S)),M&&w&&!this.getMonthNode(w,R)){var H=new r.TreeNode;H.label=this.getNodeDisplayMonth(I),H.navDate=I.navDate,H.data.year=S,H.data.month=R,w.addNode(H)}}}},u.prototype.createYearNodes=function(s,g){for(var E=0;E<g.length;E++){var I=g[E];if(I.navDate){var S=this.getNodeYear(I),R=this.getDecadeNode(s,S);if(R&&!this.getYearNode(R,S)){var M=new r.TreeNode;M.label=S.toString(),M.navDate=I.navDate,M.data.year=S,R.addNode(M)}}}},u.prototype.getDecadeNode=function(s,g){for(var E=0;E<s.nodes.length;E++){var I=s.nodes[E];if(g>=I.data.startYear&&g<=I.data.endYear)return I}return null},u.prototype.getMonthNode=function(s,g){for(var E=0;E<s.nodes.length;E++){var I=s.nodes[E];if(g===this.getNodeMonth(I))return I}return null},u.prototype.getNodeDisplayDate=function(s){return s.navDate.toDateString()},u.prototype.getNodeDisplayMonth=function(s){return["January","February","March","April","May","June","July","August","September","October","November","December"][s.navDate.getMonth()]},u.prototype.getNodeMonth=function(s){return s.navDate.getMonth()},u.prototype.getNodeYear=function(s){return s.navDate.getFullYear()},u.prototype.getYearNode=function(s,g){for(var E=0;E<s.nodes.length;E++){var I=s.nodes[E];if(g===this.getNodeYear(I))return I}return null},u.prototype.pruneDecadeNodes=function(s){for(var g=[],E=0;E<s.nodes.length;E++){var I=s.nodes[E];I.nodes.length||g.push(I)}for(var S=0;S<g.length;S++){var R=g[S],M=s.nodes.indexOf(R);M>-1&&s.nodes.splice(M,1)}},u.prototype.sortDecadeNodes=function(s){s.nodes=s.nodes.sort(function(g,E){return g.data.startYear-E.data.startYear})},u.prototype.sortMonthNodes=function(s){for(var g=this,E=0;E<s.nodes.length;E++)for(var I=s.nodes[E],S=0;S<I.nodes.length;S++){var R=I.nodes[S];R.nodes=R.nodes.sort(function(M,w){return g.getNodeMonth(M)-g.getNodeMonth(w)})}},u.prototype.sortYearNodes=function(s){for(var g=this,E=0;E<s.nodes.length;E++){var I=s.nodes[E];I.nodes=I.nodes.sort(function(S,R){return g.getNodeYear(S)-g.getNodeYear(R)})}},u}(),P=function(){function u(s){this._options=s,this._options.locale=this._options.locale||"en-GB"}return u.prototype.bootstrap=function(s,g){var E=this;return new Promise(function(I,S){s&&g&&(I=s,S=g),r.Utils.loadManifest(E._options.manifestUri).then(function(R){E._loaded(E,R,I,S)})})},u.prototype._loaded=function(s,g,E,I){var S=r.Utils.parseManifest(g,{locale:s._options.locale});if(S){s._options.iiifResource||(s._options.iiifResource=S);var R=s._options.collectionIndex,M=s._options.manifestIndex;if(S.getIIIFResourceType()===d.COLLECTION){var w=S.getManifests(),H=S.getCollections();w.length||R!==void 0||(R=0),R!==void 0&&H&&H.length?S.getCollectionByIndex(R).then(function(Y){Y||I("Collection index not found"),Y.getTotalManifests()===0&&M===0&&Y.getTotalCollections()>0?(s._options.collectionIndex=0,s._options.manifestUri=Y.id,s.bootstrap(E,I)):M!==void 0&&Y.getManifestByIndex(M).then(function(W){s._options.manifest=W;var Q=new b(s._options);E(Q)})}):S.getManifestByIndex(s._options.manifestIndex).then(function(Y){s._options.manifest=Y;var W=new b(s._options);E(W)})}else{s._options.manifest=S;var j=new b(s._options);E(j)}}else console.error("Unable to load IIIF resource")},u}(),C=m(1),L=function(){function u(s,g){this.authHoldingPage=null,this.clickThroughService=null,this.externalService=null,this.isProbed=!1,this.isResponseHandled=!1,this.kioskService=null,this.loginService=null,this.logoutService=null,this.probeService=null,this.restrictedService=null,this.tokenService=null,s.externalResource=this,this.dataUri=this._getDataUri(s),this.index=s.index,this.authAPIVersion=g.authApiVersion,this._parseAuthServices(s),this._parseCanvasDimensions(s)}return u.prototype._getImageServiceDescriptor=function(s){for(var g=null,E=0;E<s.length;E++){var I=s[E],S=I.id;S.endsWith("/")||(S+="/"),r.Utils.isImageProfile(I.getProfile())&&(g=S+"info.json")}return g},u.prototype._getDataUri=function(s){var g=s.getContent(),E=s.getImages(),I=null;if(g&&g.length){var S=g[0].getBody();return S.length?(R=S[0].getServices()).length&&(I=this._getImageServiceDescriptor(R))?I:S[0].id:null}if(E&&E.length){var R,M=E[0].getResource();return(R=M.getServices()).length&&(I=this._getImageServiceDescriptor(R))?I:M.id}var w=s.getService(l.IXIF);return w?w.getInfoUri():s.id},u.prototype._parseAuthServices=function(s){if(this.authAPIVersion===.9)this.clickThroughService=r.Utils.getService(s,l.AUTH_0_CLICK_THROUGH),this.loginService=r.Utils.getService(s,l.AUTH_0_LOGIN),this.restrictedService=r.Utils.getService(s,l.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(l.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(l.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(l.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(l.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(l.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(l.AUTH_0_TOKEN));else{if(s.isCanvas!==void 0&&s.isCanvas()){var g=s.getContent();if(g&&g.length){var E=g[0].getBody();E&&E.length&&(s=E[0])}}this.clickThroughService=r.Utils.getService(s,l.AUTH_1_CLICK_THROUGH),this.loginService=r.Utils.getService(s,l.AUTH_1_LOGIN),this.externalService=r.Utils.getService(s,l.AUTH_1_EXTERNAL),this.kioskService=r.Utils.getService(s,l.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(l.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(l.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(l.AUTH_1_TOKEN),this.probeService=this.loginService.getService(l.AUTH_1_PROBE)):this.externalService?(this.logoutService=this.externalService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(l.AUTH_1_TOKEN),this.probeService=this.externalService.getService(l.AUTH_1_PROBE)):this.kioskService&&(this.logoutService=this.kioskService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(l.AUTH_1_TOKEN),this.probeService=this.kioskService.getService(l.AUTH_1_PROBE))}},u.prototype._parseCanvasDimensions=function(s){var g=s.getImages();if(g&&g.length){var E=g[0].getResource();this.width=E.getWidth(),this.height=E.getHeight()}else if((g=s.getContent()).length){var I=g[0].getBody();I.length&&(this.width=I[0].getWidth(),this.height=I[0].getHeight())}},u.prototype._parseDescriptorDimensions=function(s){s.width!==void 0&&(this.width=s.width),s.height!==void 0&&(this.height=s.height)},u.prototype.isAccessControlled=function(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)},u.prototype.hasServiceDescriptor=function(){return!!this.dataUri&&this.dataUri.endsWith("info.json")},u.prototype.getData=function(s){var g=this;return g.data={},new Promise(function(E,I){if(g.dataUri)if(g.probeService){g.isProbed=!0;var S=new XMLHttpRequest;S.open("GET",g.probeService.id,!0),S.withCredentials=!0,S.onload=function(){var w=JSON.parse(S.responseText);unescape(w.contentLocation)!==g.dataUri?g.status=C.MOVED_TEMPORARILY:g.status=C.OK,E(g)},S.onerror=function(){g.status=S.status,E(g)},S.send()}else{var R="GET";if(!g.hasServiceDescriptor()){if(!g.isAccessControlled())return g.status=C.OK,void E(g);R="HEAD"}var M=new XMLHttpRequest;M.open(R,g.dataUri,!0),s&&M.setRequestHeader("Authorization","Bearer "+s.accessToken),M.onload=function(){var w=JSON.parse(M.responseText);if(w){var H=unescape(w["@id"]);g.data=w,g._parseAuthServices(g.data),g._parseDescriptorDimensions(g.data),H.endsWith("/info.json")&&(H=H.substr(0,H.lastIndexOf("/")));var j=g.dataUri;j&&j.endsWith("/info.json")&&(j=j.substr(0,j.lastIndexOf("/"))),H!==j&&g.loginService?g.status=C.MOVED_TEMPORARILY:g.status=C.OK,E(g)}else g.status=C.OK,E(g)},M.onerror=function(){g.status=M.status,M.responseText&&g._parseAuthServices(JSON.parse(M.responseText)),E(g)},M.send()}else I("There is no dataUri to fetch")})},u}(),D=function(){},x=function(){},U=function(u,s){this.value=u,this.locale=s},k=function(){function u(s){this.labels=s}return u.prototype.format=function(s){return s.indexOf("<a")!=-1?s:'<a href="'+s+'">'+(this.labels[s]?this.labels[s]:s)+"</a>"},u}();m.d(N,"loadManifest",function(){return K}),m.d(N,"AnnotationGroup",function(){return n}),m.d(N,"AnnotationRect",function(){return e}),m.d(N,"Bootstrapper",function(){return P}),m.d(N,"ExternalResource",function(){return L}),m.d(N,"Helper",function(){return b}),m.d(N,"ILabelValuePair",function(){return D}),m.d(N,"MetadataGroup",function(){return v}),m.d(N,"MetadataOptions",function(){return x}),m.d(N,"MultiSelectState",function(){return p}),m.d(N,"Translation",function(){return U}),m.d(N,"TreeSortType",function(){return T}),m.d(N,"UriLabeller",function(){return k});var K=function(u){return new P(u).bootstrap()}}])})}),se=class{constructor(c){this.value=c}toString(){return this.value}},ee=se;ee.image=new se("image"),ee.page=new se("page");var G=class{},V=G;V.namespace="openseadragonExtension.",V.CURRENT_VIEW_URI=G.namespace+"currentViewUri",V.DOUBLECLICK=G.namespace+"doubleClick",V.IMAGE_SEARCH=G.namespace+"imageSearch",V.MODE_CHANGE=G.namespace+"modeChange",V.NEXT_SEARCH_RESULT=G.namespace+"nextSearchResult",V.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=G.namespace+"nextImagesSearchResultUnavailable",V.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=G.namespace+"prevImagesSearchResultUnavailable",V.PAGE_SEARCH=G.namespace+"pageSearch",V.PAGING_TOGGLED=G.namespace+"pagingToggled",V.PREV_SEARCH_RESULT=G.namespace+"prevSearchResult",V.PRINT=G.namespace+"print",V.ROTATE=G.namespace+"rotate",V.OPENSEADRAGON_ANIMATION_FINISH=G.namespace+"animationFinish",V.OPENSEADRAGON_ANIMATION_START=G.namespace+"animationStart",V.OPENSEADRAGON_ANIMATION=G.namespace+"animation",V.OPENSEADRAGON_OPEN=G.namespace+"open",V.OPENSEADRAGON_RESIZE=G.namespace+"resize",V.OPENSEADRAGON_ROTATION=G.namespace+"rotationChange",V.SEARCH_PREVIEW_FINISH=G.namespace+"searchPreviewFinish",V.SEARCH_PREVIEW_START=G.namespace+"searchPreviewStart",V.SEARCH=G.namespace+"search",V.XYWH_CHANGE=G.namespace+"xywhChange",V.ZOOM_IN=G.namespace+"zoomIn",V.ZOOM_OUT=G.namespace+"zoomOut";var ue;(function(c){c.BOOKMARKING="oa:bookmarking",c.CLASSIFYING="oa:classifying",c.COMMENTING="oa:commenting",c.DESCRIBING="oa:describing",c.EDITING="oa:editing",c.HIGHLIGHTING="oa:highlighting",c.IDENTIFYING="oa:identifying",c.LINKING="oa:linking",c.MODERATING="oa:moderating",c.PAINTING="sc:painting",c.QUESTIONING="oa:questioning",c.REPLYING="oa:replying",c.TAGGING="oa:tagging",c.TRANSCRIBING="oad:transcribing"})(ue||(ue={}));var he;(function(c){c.AUTO_ADVANCE="auto-advance",c.CONTINUOUS="continuous",c.FACING_PAGES="facing-pages",c.HIDDEN="hidden",c.INDIVIDUALS="individuals",c.MULTI_PART="multi-part",c.NO_NAV="no-nav",c.NON_PAGED="non-paged",c.PAGED="paged",c.REPEAT="repeat",c.SEQUENCE="sequence",c.THUMBNAIL_NAV="thumbnail-nav",c.TOGETHER="together",c.UNORDERED="unordered"})(he||(he={}));var ce;(function(c){c.CANVAS="canvas",c.CHOICE="choice",c.CONTENT_AS_TEXT="contentastext",c.DOCUMENT="document",c.IMAGE="image",c.MOVING_IMAGE="movingimage",c.PDF="pdf",c.PHYSICAL_OBJECT="physicalobject",c.SOUND="sound",c.TEXTUALBODY="textualbody",c.VIDEO="video"})(ce||(ce={}));var pe;(function(c){c.ANNOTATION="annotation",c.CANVAS="canvas",c.COLLECTION="collection",c.MANIFEST="manifest",c.RANGE="range",c.SEQUENCE="sequence"})(pe||(pe={}));var de;(function(c){c.AUDIO_MP4="audio/mp4",c.CORTO="application/corto",c.DRACO="application/draco",c.GLTF="model/gltf+json",c.JPG="image/jpeg",c.M3U8="application/vnd.apple.mpegurl",c.MP3="audio/mp3",c.MPEG_DASH="application/dash+xml",c.OBJ="text/plain",c.PDF="application/pdf",c.PLY="application/ply",c.THREEJS="application/vnd.threejs+json",c.VIDEO_MP4="video/mp4",c.WEBM="video/webm"})(de||(de={}));var fe;(function(c){c.DOC="application/msword",c.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",c.PDF="application/pdf"})(fe||(fe={}));var ge;(function(c){c.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",c.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",c.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",c.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",c.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",c.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",c.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",c.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",c.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",c.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",c.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",c.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",c.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",c.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",c.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",c.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",c.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",c.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",c.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",c.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",c.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",c.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",c.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",c.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",c.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",c.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",c.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",c.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",c.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",c.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",c.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",c.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",c.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",c.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",c.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",c.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",c.SEARCH_0="http://iiif.io/api/search/0/search",c.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",c.SEARCH_1="http://iiif.io/api/search/1/search",c.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",c.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",c.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",c.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",c.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",c.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",c.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"})(ge||(ge={}));var te;(function(c){c.BOTTOM_TO_TOP="bottom-to-top",c.LEFT_TO_RIGHT="left-to-right",c.RIGHT_TO_LEFT="right-to-left",c.TOP_TO_BOTTOM="top-to-bottom"})(te||(te={}));var _e;(function(c){c.CONTINUOUS="continuous",c.INDIVIDUALS="individuals",c.NON_PAGED="non-paged",c.PAGED="paged",c.TOP="top"})(_e||(_e={}));var Se=function(){function c(A){this.options=A,this.options.data=Object.assign({},this.data(),A.data)}return c.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},c.prototype.data=function(){return{}},c.prototype.on=function(A,O,N){var m=this._e||(this._e={});(m[A]||(m[A]=[])).push({fn:O,ctx:N})},c.prototype.fire=function(A){for(var O=[],N=1;N<arguments.length;N++)O[N-1]=arguments[N];var m=[].slice.call(arguments,1),T=((this._e||(this._e={}))[A]||[]).slice(),h=0,_=T.length;for(h;h<_;h++)T[h].fn.apply(T[h].ctx,m)},c.prototype._resize=function(){},c.prototype.set=function(A){},c}(),Le=function(){var c=function(A,O){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,m){N.__proto__=m}||function(N,m){for(var T in m)m.hasOwnProperty(T)&&(N[T]=m[T])},c(A,O)};return function(A,O){c(A,O);function N(){this.constructor=A}A.prototype=O===null?Object.create(O):(N.prototype=O.prototype,new N)}}(),be=function(c){Le(A,c);function A(O){var N=c.call(this,O)||this;return N._data=N.data(),N._data=N.options.data,N._init(),N._resize(),N}return A.prototype._init=function(){var O=this;c.prototype._init.call(this),this._$element=$(this.el),this._$header=$('<div class="header"></div>'),this._$element.append(this._$header),this._$leftOptions=$('<div class="left"></div>'),this._$header.append(this._$leftOptions),this._$rightOptions=$('<div class="right"></div>'),this._$header.append(this._$rightOptions),this._$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this._$leftOptions.append(this._$sizeDownButton),this._$sizeRange=$('<input type="range" name="size" min="1" max="10" value="'+this.options.data.initialZoom+'" />'),this._$leftOptions.append(this._$sizeRange),this._$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this._$leftOptions.append(this._$sizeUpButton),this._$multiSelectOptions=$('<div class="multiSelectOptions"></div>'),this._$rightOptions.append(this._$multiSelectOptions),this._$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" tabindex="0" /><label for="multiSelectAll">'+this.options.data.content.selectAll+"</label></div>"),this._$multiSelectOptions.append(this._$selectAllButton),this._$selectAllButtonCheckbox=$(this._$selectAllButton.find("input:checkbox")),this._$selectButton=$('<a class="select" href="#">'+this.options.data.content.select+"</a>"),this._$multiSelectOptions.append(this._$selectButton),this._$main=$('<div class="main"></div>'),this._$element.append(this._$main),this._$thumbs=$('<div class="thumbs"></div>'),this._$main.append(this._$thumbs),this._$sizeDownButton.on("click",function(){var m=Number(O._$sizeRange.val())-1;m>=Number(O._$sizeRange.attr("min"))&&(O._$sizeRange.val(m.toString()),O._$sizeRange.trigger("change"),O.fire(X.DECREASE_SIZE))}),this._$sizeUpButton.on("click",function(){var m=Number(O._$sizeRange.val())+1;m<=Number(O._$sizeRange.attr("max"))&&(O._$sizeRange.val(m.toString()),O._$sizeRange.trigger("change"),O.fire(X.INCREASE_SIZE))}),this._$sizeRange.on("change",function(){O._updateThumbs(),O._scrollToThumb(O._getSelectedThumbIndex())}),this._$selectAllButton.checkboxButton(function(m){var T=O._getMultiSelectState();T&&(m?T.selectAll(!0):T.selectAll(!1)),O.set(O.options.data)}),this._$selectButton.on("click",function(){var m=O._getMultiSelectState();if(m){var T=m.getAllSelectedCanvases().map(function(h){return h.id});O.fire(X.MULTISELECTION_MADE,T)}}),this._setRange(),$.templates({galleryThumbsTemplate:`				<div class="{{:~galleryThumbClassName()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">						<div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle='multiSelected'}">						{^{if multiSelectEnabled}}								<input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? 'checked' : ''}" class="multiSelect" />						{{/if}}						</div>						<div class="info">								<span class="index" style="width:{{>initialWidth}}px">{{:#index + 1}}</span>								<span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>								<span class="searchResults" title="{{:~galleryThumbSearchResultsTitle()}}">{{>data.searchResults}}</span>						</div>				</div>`});var N=this;return $.views.helpers({galleryThumbClassName:function(){var m="thumb preLoad";return this.data.index===0&&(m+=" first"),this.data.uri||(m+=" placeholder"),m},galleryThumbSearchResultsTitle:function(){var m=Number(this.data.data.searchResults);return m?m>1?le.format(N.options.data.content.searchResults,m.toString()):le.format(N.options.data.content.searchResult,m.toString()):null}}),this._$main.on("scroll",function(){O._updateThumbs()},this.options.data.scrollStopDuration),this.options.data.sizingEnabled||this._$sizeRange.hide(),!0},A.prototype.data=function(){return{chunkedResizingThreshold:400,content:{searchResult:"{0} search result",searchResults:"{0} search results",select:"Select",selectAll:"Select All"},debug:!1,helper:null,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:!1,scrollStopDuration:100,searchResults:[],sizingEnabled:!0,thumbHeight:320,thumbLoadPadding:3,thumbWidth:200,viewingDirection:te.LEFT_TO_RIGHT}},A.prototype.set=function(O){if(this._data=Object.assign(this._data,O),this._data.helper&&this._data.thumbWidth!==void 0&&this._data.thumbHeight!==void 0&&(this._thumbs=this._data.helper.getThumbs(this._data.thumbWidth,this._data.thumbHeight)),this._data.viewingDirection&&(this._data.viewingDirection===te.BOTTOM_TO_TOP&&this._thumbs.reverse(),this._$thumbs.addClass(this._data.viewingDirection)),this._data.searchResults&&this._data.searchResults.length)for(var N=0;N<this._data.searchResults.length;N++){var m=this._data.searchResults[N],T=this._thumbs.filter(function(l){return l.index===m.canvasIndex})[0],h=$.extend(!0,{},T.data);h.searchResults=m.rects.length,T.data=h}this._thumbsCache=null,this._createThumbs(),this._data.helper&&this.selectIndex(this._data.helper.canvasIndex);var _=this._getMultiSelectState();if(_&&_.isEnabled){this._$multiSelectOptions.show(),this._$thumbs.addClass("multiSelect");for(var N=0;N<_.canvases.length;N++){var i=_.canvases[N],T=this._getThumbByCanvas(i);this._setThumbMultiSelected(T,i.multiSelected)}for(var N=0;N<_.ranges.length;N++)for(var d=_.ranges[N],f=this._getThumbsByRange(d),a=0;a<f.length;a++){var T=f[a];this._setThumbMultiSelected(T,d.multiSelected)}}else this._$multiSelectOptions.hide(),this._$thumbs.removeClass("multiSelect");this._update()},A.prototype._update=function(){var O=this._getMultiSelectState();if(O&&O.isEnabled){this._$selectAllButtonCheckbox.prop("checked",O.allSelected());var N=O.getAll().filter(function(m){return m.multiSelected}).length>0;N?this._$selectButton.show():this._$selectButton.hide()}},A.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},A.prototype._createThumbs=function(){var O=this;if(this._thumbs){this._$thumbs.undelegate(".thumb","click"),this._$thumbs.empty();for(var N=this._getMultiSelectState(),m=[],T=0;T<this._thumbs.length;T++){var h=this._thumbs[T],_=h.width,i=h.height;h.initialWidth=_,m.push(i),h.multiSelectEnabled=N?N.isEnabled:!1}for(var d=re.median(m),f=0;f<this._thumbs.length;f++){var h=this._thumbs[f];h.initialHeight=d}if(this._$thumbs.link($.templates.galleryThumbsTemplate,this._thumbs),N&&!N.isEnabled)this._$thumbs.delegate(".thumb","click",function(e){e.preventDefault();var n=$.view(this).data;O.fire(X.THUMB_SELECTED,n)});else for(var a=this._$thumbs.find(".thumb"),l=function(){var e=o,n=$(a[t]);n.checkboxButton(function(r){var p=$.view(this).data;e._setThumbMultiSelected(p,!p.multiSelected);var v=e.options.data.helper.getCanvasRange(p.data),y=e._getMultiSelectState();y&&(v?y.selectRange(v,p.multiSelected):y.selectCanvas(p.data,p.multiSelected)),e._update(),e.fire(X.THUMB_MULTISELECTED,p)})},o=this,t=0;t<a.length;t++)l()}},A.prototype._getThumbByCanvas=function(O){return this._thumbs.filter(function(N){return N.data.id===O.id})[0]},A.prototype._sizeThumb=function(O){var N=O.data().initialwidth,m=O.data().initialheight,T=Number(N),h=Number(m),_=Math.floor(T*this._range),i=Math.floor(h*this._range),d=O.find(".wrap"),f=O.find(".label"),a=O.find(".index"),l=O.find(".searchResults"),o=_;this._data.searchResults&&this._data.searchResults.length&&(l.show(),o=_-l.outerWidth(),this._data.minLabelWidth!==void 0&&o<this._data.minLabelWidth?(l.hide(),o=_):l.show()),this._data.pageModeEnabled?(a.hide(),f.show()):(a.show(),f.hide()),d.outerWidth(_),d.outerHeight(i),a.outerWidth(o),f.outerWidth(o)},A.prototype._loadThumb=function(O,N){var m=O.find(".wrap");if(!(m.hasClass("loading")||m.hasClass("loaded"))){O.removeClass("preLoad");var T=O.attr("data-visible"),h=this._data.imageFadeInDuration||0;if(T!=="false"){m.addClass("loading");var _=O.attr("data-src"),i=$('<img class="thumbImage" src="'+_+'" />');i.hide(),i.on("load",function(){$(this).fadeIn(h,function(){$(this).parent().switchClass("loading","loaded")})}),m.prepend(i),N&&N(i)}else m.addClass("hidden")}},A.prototype._getThumbsByRange=function(O){var N=[];if(!this._data.helper)return N;for(var m=0;m<this._thumbs.length;m++){var T=this._thumbs[m],h=T.data,_=this._data.helper.getCanvasRange(h,O.path);_&&_.id===O.id&&N.push(T)}return N},A.prototype._updateThumbs=function(){var O=!!this._data.debug;this._setRange();var N=this._$main.scrollTop(),m=this._$main.height(),T=N+m;O&&console.log("scrollTop %s, scrollBottom %s",N,T);for(var h=this._getAllThumbs(),_=0,i=0;i<h.length;i++){var d=$(h[i]),f=d.position().top,a=d.outerHeight(),l=f+a,o=a*this._data.thumbLoadPadding;f<=T+o&&l>=N-o?(_+=1,this._sizeThumb(d),d.addClass("insideScrollArea"),this._loadThumb(d)):d.removeClass("insideScrollArea")}O&&console.log("number of thumbs to update: "+_)},A.prototype._getSelectedThumbIndex=function(){return Number(this._$selectedThumb.data("index"))},A.prototype._getAllThumbs=function(){return this._thumbsCache||(this._thumbsCache=this._$thumbs.find(".thumb")),this._thumbsCache},A.prototype._getThumbByIndex=function(O){return this._$thumbs.find('[data-index="'+O+'"]')},A.prototype._scrollToThumb=function(O){var N=this._getThumbByIndex(O);this._$main.scrollTop(N.position().top)},A.prototype.selectIndex=function(O){!this._thumbs||!this._thumbs.length||(this._getAllThumbs().removeClass("selected"),this._$selectedThumb=this._getThumbByIndex(O),this._$selectedThumb.addClass("selected"),this._scrollToThumb(O),this._updateThumbs())},A.prototype._setRange=function(){var O=re.normalise(Number(this._$sizeRange.val()),0,10);this._range=re.clamp(O,.05,1)},A.prototype._setThumbMultiSelected=function(O,N){$.observable(O).setProperty("multiSelected",N)},A.prototype._resize=function(){},A}(Se),X=function(){function c(){}return c.DECREASE_SIZE="decreaseSize",c.INCREASE_SIZE="increaseSize",c.MULTISELECTION_MADE="multiSelectionMade",c.THUMB_SELECTED="thumbSelected",c.THUMB_MULTISELECTED="thumbMultiSelected",c}(),Ce=ie(),Re=class extends Ee{constructor(c){super(c,!0,!0),this.isOpen=!1}create(){this.setConfig("contentLeftPanel"),super.create(),this.$gallery=Ce('<div class="iiif-gallery-component"></div>'),this.$element.append(this.$gallery)}setup(){let c=this;this.galleryComponent=new be({target:this.$gallery[0]}),this.galleryComponent.on("thumbSelected",function(A){c.extensionHost.publish(B.GALLERY_THUMB_SELECTED,A),c.extensionHost.publish(B.THUMB_SELECTED,A)},!1),this.galleryComponent.on("decreaseSize",function(){c.extensionHost.publish(B.GALLERY_DECREASE_SIZE)},!1),this.galleryComponent.on("increaseSize",function(){c.extensionHost.publish(B.GALLERY_INCREASE_SIZE)},!1)}databind(){this.galleryComponent.options.data=this.galleryData,this.galleryComponent.set(this.galleryData),this.resize()}show(){this.isOpen=!0,this.$element.show(),setTimeout(()=>{this.galleryComponent.selectIndex(this.extension.helper.canvasIndex)},10)}hide(){this.isOpen=!1,this.$element.hide()}resize(){super.resize();let c=this.$gallery.find(".main"),A=this.$gallery.find(".header");c.height(this.$element.height()-A.height())}},q=ie(),Me=class extends ye{create(){this.setConfig("contentLeftPanel"),super.create(),this.extensionHost.subscribe(V.MODE_CHANGE,()=>{this.setLabel()}),this.extensionHost.subscribe(V.SEARCH_PREVIEW_START,A=>{this.searchPreviewStart(A)}),this.extensionHost.subscribe(V.SEARCH_PREVIEW_FINISH,()=>{this.searchPreviewFinish()}),this.extension.helper.isPaged()&&this.$thumbs.addClass("paged");var c=this;q.views.helpers({separator:function(){return c.extension.helper.isPaged()?(this.data.index-1)%2!=0:!0}})}addSelectedClassToThumbs(c){let A=this.extension.getPagedIndices(c);for(let O=0;O<A.length;O++)this.getThumbByIndex(A[O]).addClass("selected")}isPageModeEnabled(){return typeof this.extension.getMode=="function"?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===ee.page.toString():this.config.options.pageModeEnabled}searchPreviewStart(c){this.scrollToThumb(c),this.getThumbByIndex(c).addClass("searchpreview")}searchPreviewFinish(){this.scrollToThumb(this.extension.helper.canvasIndex),this.getAllThumbs().removeClass("searchpreview")}setLabel(){this.isPDF()?(q(this.$thumbs).find("span.index").hide(),q(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?(q(this.$thumbs).find("span.index").hide(),q(this.$thumbs).find("span.label").show()):(q(this.$thumbs).find("span.index").show(),q(this.$thumbs).find("span.label").hide())}},Pe=Te(Ae()),we=ie(),xe=class extends Ee{constructor(c){super(c,!0,!0),this.isOpen=!1}create(){this.setConfig("contentLeftPanel"),super.create(),this.$tree=we('<div class="iiif-tree-component"></div>'),this.$element.append(this.$tree)}setup(){let c=this;this.treeComponent=new Pe.TreeComponent({target:this.$tree[0],data:this.treeData}),this.treeComponent.on("treeNodeSelected",function(A){c.extensionHost.publish(B.TREE_NODE_SELECTED,A)},!1),this.treeComponent.on("treeNodeMultiSelected",function(A){c.extensionHost.publish(B.TREE_NODE_MULTISELECTED,A)},!1)}databind(){this.treeComponent.set(this.treeData),this.resize()}show(){this.isOpen=!0,this.$element.show()}hide(){this.isOpen=!1,this.$element.hide()}selectNode(c){if(!this.treeComponent.selectedNode){this.treeComponent.expandParents(c,!0);let A=this.$tree.find("#tree-link-"+c.id)[0];A&&A.scrollIntoView()}this.treeComponent.selectNode(c)}expandNode(c,A){this.treeComponent.expandNode(c,A)}getAllNodes(){return this.treeComponent.getAllNodes()}deselectCurrentNode(){this.treeComponent.deselectCurrentNode()}getNodeById(c){return this.treeComponent.getNodeById(c)}resize(){super.resize()}},Z=Te(Ie()),F=ie(),oe=ve().ViewingDirection,De=ve().ViewingHint,Fe=class extends me{constructor(c){super(c),this.expandFullEnabled=!1,this.isThumbsViewOpen=!1,this.isTreeViewOpen=!1,this.treeSortType=J.NONE}create(){this.setConfig("contentLeftPanel"),super.create(),this.extensionHost.subscribe(B.SETTINGS_CHANGE,()=>{this.databind()}),this.extensionHost.subscribe(B.GALLERY_THUMB_SELECTED,()=>{this.collapseFull()}),this.extensionHost.subscribe(B.METRIC_CHANGE,()=>{this.extension.isDesktopMetric()||this.isFullyExpanded&&this.collapseFull()}),this.extensionHost.subscribe(B.ANNOTATIONS,()=>{this.databindThumbsView(),this.databindGalleryView()}),this.extensionHost.subscribe(B.ANNOTATIONS_CLEARED,()=>{this.databindThumbsView(),this.databindGalleryView()}),this.extensionHost.subscribe(B.ANNOTATIONS_EMPTY,()=>{this.databindThumbsView(),this.databindGalleryView()}),this.extensionHost.subscribe(B.CANVAS_INDEX_CHANGE,()=>{this.isFullyExpanded&&this.collapseFull(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()}),this.extensionHost.subscribe(B.RANGE_CHANGE,()=>{this.isFullyExpanded&&this.collapseFull(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()}),this.$tabs=F('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=F('<a class="index tab" tabindex="0">'+this.content.index+"</a>"),this.$tabs.append(this.$treeButton),this.$thumbsButton=F('<a class="thumbs tab" tabindex="0">'+this.content.thumbnails+"</a>"),this.$tabs.append(this.$thumbsButton),this.$tabsContent=F('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=F('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$topOptions=F('<div class="top"></div>'),this.$options.append(this.$topOptions),this.$treeSelect=F('<select aria-label="'+this.content.manifestRanges+'"></select>'),this.$topOptions.append(this.$treeSelect),this.$bottomOptions=F('<div class="bottom"></div>'),this.$options.append(this.$bottomOptions),this.$leftOptions=F('<div class="left"></div>'),this.$bottomOptions.append(this.$leftOptions),this.$rightOptions=F('<div class="right"></div>'),this.$bottomOptions.append(this.$rightOptions),this.$treeViewOptions=F('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=F('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=F('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=F('<button class="btn" tabindex="0">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=F('<button class="btn" tabindex="0">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$views=F('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=F('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=F('<div class="thumbsView" tabindex="-1"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=F('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$treeSelect.hide(),this.$treeSelect.change(()=>{this.databindTreeView(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()}),this.$sortByDateButton.on("click",()=>{this.sortByDate()}),this.$sortByVolumeButton.on("click",()=>{this.sortByVolume()}),this.$treeViewOptions.hide(),this.onAccessibleClick(this.$treeButton,()=>{this.openTreeView()}),this.onAccessibleClick(this.$thumbsButton,()=>{this.openThumbsView()}),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var c=this.options.tabOrder;if(c){c=c.toLowerCase(),c=c.replace(/ /g,"");var A=c.split(",");A[0]==="thumbs"?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first")}}createTreeView(){this.treeView=new xe(this.$treeView),this.treeView.treeData=this.getTreeData(),this.treeView.setup(),this.databindTreeView();let c=this.extension.helper.getTopRanges();if(c.length>1)for(let A=0;A<c.length;A++){let O=c[A];this.$treeSelect.append('<option value="'+O.id+'">'+Z.LanguageMap.getValue(O.getLabel())+"</option>")}this.updateTreeViewOptions()}databind(){this.databindThumbsView(),this.databindTreeView(),this.databindGalleryView()}updateTreeViewOptions(){let c=this.getTree();!c||(this.isCollection()&&this.extension.helper.treeHasNavDates(c)?this.$treeViewOptions.show():this.$treeViewOptions.hide(),this.$treeSelect.find("option").length?this.$treeSelect.show():this.$treeSelect.hide())}sortByDate(){this.treeSortType=J.DATE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()}sortByVolume(){this.treeSortType=J.NONE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()}isCollection(){var c=this.getTree();if(c)return c.data.type===Z.TreeNodeType.COLLECTION;throw new Error("Tree not available")}databindTreeView(){!this.treeView||(this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode())}getTreeData(){return{autoExpand:this._isTreeAutoExpanded(),branchNodesExpandOnClick:z.getBool(this.config.options.branchNodesExpandOnClick,!0),branchNodesSelectable:z.getBool(this.config.options.branchNodesSelectable,!1),helper:this.extension.helper,topRangeIndex:this.getSelectedTopRangeIndex(),treeSortType:this.treeSortType}}_isTreeAutoExpanded(){let c=z.getBool(this.config.options.autoExpandTreeEnabled,!1),A=this.config.options.autoExpandTreeIfFewerThan||0;if(c){let O=this.extension.helper.getFlattenedTree();if(O&&O.length<A)return!0}return!1}updateTreeTabByCanvasIndex(){let c=this.extension.helper.getTopRanges();if(c.length>1){let A=this.getCurrentCanvasTopRangeIndex();if(A===-1)return;let O=c[A];this.setTreeTabTitle(Z.LanguageMap.getValue(O.getLabel()))}else this.setTreeTabTitle(this.content.index)}setTreeTabTitle(c){this.$treeButton.text(c)}updateTreeTabBySelection(){let c=null,A=this.extension.helper.getTopRanges();A.length>1&&(this.treeView?c=this.getSelectedTree().text():c=Z.LanguageMap.getValue(A[0].getLabel())),c?this.setTreeTabTitle(c):this.setTreeTabTitle(this.content.index)}getViewingHint(){return this.extension.helper.getViewingHint()}getViewingDirection(){return this.extension.helper.getViewingDirection()}createThumbsView(){this.thumbsView=new Me(this.$thumbsView),this.databindThumbsView()}databindThumbsView(){if(!this.thumbsView)return;let c,A,O=this.getViewingHint(),N=this.getViewingDirection();N&&(N===oe.LEFT_TO_RIGHT||N===oe.RIGHT_TO_LEFT)?(c=this.config.options.twoColThumbWidth,A=this.config.options.twoColThumbHeight):O&&O===De.PAGED?(c=this.config.options.twoColThumbWidth,A=this.config.options.twoColThumbHeight):(c=this.config.options.oneColThumbWidth,A=this.config.options.oneColThumbHeight);let m=this.extension.helper.getThumbs(c,A);N&&N===oe.BOTTOM_TO_TOP&&m.reverse();let T=this.extension.annotations;if(T&&T.length)for(let h=0;h<T.length;h++){let _=T[h],i=m.filter(d=>d.index===_.canvasIndex)[0];if(i){let d=F.extend(!0,{},i.data);d.searchResults=_.rects.length,i.data=d}}this.thumbsView.thumbs=m,this.thumbsView.databind()}createGalleryView(){this.galleryView=new Re(this.$galleryView),this.galleryView.galleryData=this.getGalleryData(),this.galleryView.setup(),this.databindGalleryView()}databindGalleryView(){!this.galleryView||(this.galleryView.galleryData=this.getGalleryData(),this.galleryView.databind())}getGalleryData(){return{helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),scrollStopDuration:100,searchResults:this.extension.annotations,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.getViewingDirection()}}isPageModeEnabled(){return typeof this.extension.getMode=="function"?z.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===ee.page.toString():z.getBool(this.config.options.pageModeEnabled,!0)}getSelectedTree(){return this.$treeSelect.find(":selected")}getSelectedTopRangeIndex(){let c=this.getSelectedTree().index();return c===-1&&(c=0),c}getTree(){let c=this.getSelectedTopRangeIndex();return this.extension.helper.getTree(c,J.NONE)}toggleFinish(){if(super.toggleFinish(),this.isUnopened){let c=z.getBool(this.config.options.treeEnabled,!0),A=z.getBool(this.config.options.thumbsEnabled,!0),O=this.getTree();(!O||!O.nodes.length)&&(c=!1),(!c||!A)&&this.$tabs.hide(),A&&this.defaultToThumbsView()?this.openThumbsView():c&&this.openTreeView()}}defaultToThumbsView(){let c=z.getBool(this.config.options.defaultToTreeEnabled,!1),A=this.config.options.defaultToTreeIfGreaterThan||0,O=this.getTree();return!(c&&O&&O.nodes.length>A)}expandFullStart(){super.expandFullStart(),this.extensionHost.publish(B.LEFTPANEL_EXPAND_FULL_START)}expandFullFinish(){super.expandFullFinish(),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.extensionHost.publish(B.LEFTPANEL_EXPAND_FULL_FINISH)}collapseFullStart(){super.collapseFullStart(),this.extensionHost.publish(B.LEFTPANEL_COLLAPSE_FULL_START)}collapseFullFinish(){super.collapseFullFinish(),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.extensionHost.publish(B.LEFTPANEL_COLLAPSE_FULL_FINISH)}openTreeView(){this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize(),this.extensionHost.publish(B.OPEN_TREE_VIEW)}openThumbsView(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeSelect.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize()),this.extensionHost.publish(B.OPEN_THUMBS_VIEW)}selectTopRangeIndex(c){this.$treeSelect.prop("selectedIndex",c)}getCurrentCanvasTopRangeIndex(){let c=-1,A=this.extension.getCurrentCanvasRange();return A&&(c=Number(A.path.split("/")[0])),c}selectCurrentTreeNode(){var c;((c=this.extension.type)==null?void 0:c.name)==="uv-openseadragon-extension"?this.selectCurrentTreeNodeByCanvas():this.selectCurrentTreeNodeByRange()}selectCurrentTreeNodeByRange(){if(this.treeView){let c=this.extension.helper.getCurrentRange(),A=null;c&&c.treeNode&&(A=this.treeView.getNodeById(c.treeNode.id)),A?this.treeView.selectNode(A):this.selectTreeNodeByManifest()}}selectCurrentTreeNodeByCanvas(){if(this.treeView){let c=null,A=this.getCurrentCanvasTopRangeIndex(),O=this.getSelectedTopRangeIndex(),N=A===O,m=null;A!==-1&&(m=this.extension.getCurrentCanvasRange(),m&&m.treeNode&&(c=this.treeView.getNodeById(m.treeNode.id))),c&&N?this.treeView.selectNode(c):(m=this.extension.helper.getCurrentRange(),m&&m.treeNode&&(c=this.treeView.getNodeById(m.treeNode.id)),c?this.treeView.selectNode(c):this.selectTreeNodeByManifest())}}selectTreeNodeByManifest(){let c=this.extension.helper.collectionIndex,A=this.extension.helper.manifestIndex,O=this.treeView.getAllNodes(),N=!1;O.map(m=>{m.isCollection()&&m.data.index===c&&(this.treeView.selectNode(m),this.treeView.expandNode(m,!0),N=!0),m.isManifest()&&m.data.index===A&&(this.treeView.selectNode(m),N=!0)}),N||this.treeView.deselectCurrentNode()}resize(){super.resize(),this.$tabsContent.height(this.$main.height()-(Ne(this.$tabs)?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())}};export{be as L,Fe as V,V as x,ee as z};
