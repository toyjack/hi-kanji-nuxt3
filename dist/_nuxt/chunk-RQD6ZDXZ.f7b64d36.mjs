import{E as g}from"./chunk-2SUYJOML.5227eb76.mjs";import{k as O}from"./chunk-7YKIH5A2.1bf302a1.mjs";import{G as f}from"./IIIFContentHandler-JCX6SYFT.5a124759.mjs";import{O as $,Q as b,Z as h,a5 as u,a0 as w,$ as E}from"./entry.cc194de1.mjs";var m=$(f()),r=b(),U=class extends O{constructor(e){super(e)}create(){this.setConfig("downloadDialogue"),super.create(),this.$element.attr("role","region"),this.$element.attr("aria-label",this.content.title),this.openCommand=h.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=h.HIDE_DOWNLOAD_DIALOGUE;let e;this.extensionHost.subscribe(this.openCommand,t=>{e=t,this.open(t)}),this.extensionHost.subscribe(this.closeCommand,()=>{e&&e.focus(),this.close()}),this.$title=r(`<div role="heading" class="heading">${this.content.title}</div>`),this.$content.append(this.$title),this.$noneAvailable=r('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=r('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$footer=r('<div class="footer"></div>'),this.$content.append(this.$footer),this.$termsOfUseButton=r('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$termsOfUseButton.onPressed(()=>{this.extensionHost.publish(h.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.updateTermsOfUseButton()}addEntireFileDownloadOptions(){if(this.isDownloadOptionAvailable(g.ENTIRE_FILE_AS_ORIGINAL)){this.$downloadOptions.empty();let e=this.extension.helper.getCurrentCanvas(),t=!1,a=e.getRenderings();for(let i=0;i<a.length;i++){let l=a[i],o=l.getFormat(),n="";o&&(n=o.toString()),this.addEntireFileDownloadOption(l.id,m.LanguageMap.getValue(l.getLabel()),n),t=!0}if(!t){let i=!1,l=e.getContent();for(let o=0;o<l.length;o++){let n=l[o].getBody();if(n.length){let s=n[0].getFormat();s&&(this.addEntireFileDownloadOption(n[0].id,"",s.toString()),i=!0)}}i||this.addEntireFileDownloadOption(e.id,"","")}}}addEntireFileDownloadOption(e,t,a){let i;a?i=u.simplifyMimeType(a):i=this.getFileExtension(e),t||(t=this.content.entireFileAsOriginal),i&&(t+=" ("+i+")"),this.$downloadOptions.append('<li><a href="'+e+'" target="_blank" download tabindex="0">'+t+"</li>")}resetDynamicDownloadOptions(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()}getDownloadOptionsForRenderings(e,t,a){let i=e.getRenderings(),l=[];for(let o=0;o<i.length;o++){let n=i[o];if(n){let s=m.LanguageMap.getValue(n.getLabel(),this.extension.getLocale()),d="downloadOption"+ ++this.renderingUrlsCount;s?s+=" ({0})":s=t;let p=u.simplifyMimeType(n.getFormat().toString());s=w.format(s,p),this.renderingUrls[d]=n.id;let c=r('<li class="option dynamic"><input id="'+d+'" data-mime="'+p+'" title="'+s+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+d+'">'+s+"</label></li>");l.push({type:a,button:c})}}return l}getSelectedOption(){return this.$downloadOptions.find("li.option input:checked")}getCurrentResourceId(){return this.extension.helper.getCurrentCanvas().externalResource.data.id}getCurrentResourceFormat(){let e=this.getCurrentResourceId();return e.substr(e.lastIndexOf(".")+1).toLowerCase()}updateNoneAvailable(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()}updateTermsOfUseButton(){let e=this.extension.helper.getRequiredStatement();E.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&e&&e.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}getFileExtension(e){let t=e.split(".").pop();return t.length>5||t.indexOf("/")!==-1?null:t}isMediaDownloadEnabled(){return this.extension.helper.isUIEnabled("mediaDownload")}isDownloadOptionAvailable(e){switch(e){case g.ENTIRE_FILE_AS_ORIGINAL:return this.isMediaDownloadEnabled()}return!0}close(){super.close()}resize(){this.setDockedPosition()}};export{U as y};
