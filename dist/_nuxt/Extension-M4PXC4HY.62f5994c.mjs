import{O as o,Q as ir,_ as __vitePreload,Z as e,S as x,ah as _g,a3 as T,a0 as P,$ as S,P as n$1,a2 as yg,ac as d,af as D,ad as N,a4 as Tg,ag as xg,ai as f,a5 as p}from"./entry.cc194de1.mjs";import{o as o$1}from"./chunk-3UUJB7QR.fd324b08.mjs";import{m}from"./chunk-CWH7BDTG.62c8833d.mjs";import{i}from"./chunk-CHPN5XCG.c959e8fd.mjs";import{n}from"./chunk-3KBBTTEN.ae32ee6e.mjs";import{q as qt,x as xf,_ as _f,N as Nr,I as Ih,$ as $f,X as Xt$1}from"./chunk-6K2XYBUM.dc3647c3.mjs";import{E}from"./chunk-2SUYJOML.5227eb76.mjs";import{Y as Yt$1,t as te,k,X as Xt,F,Z as Zt,e as ee,n as ne,a as se}from"./chunk-7YKIH5A2.1bf302a1.mjs";import{G,H,g as gt}from"./IIIFContentHandler-JCX6SYFT.5a124759.mjs";var at=n$1((exports,module)=>{function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}(function(t){t.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var s={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,a=Object.prototype.hasOwnProperty;t.isFunction=function(l){return t.type(l)==="function"},t.isArray=Array.isArray||function(l){return t.type(l)==="array"},t.isWindow=function(l){return l&&typeof l=="object"&&"setInterval"in l},t.type=function(l){return l==null?String(l):s[r.call(l)]||"object"},t.isPlainObject=function(l){if(!l||OpenSeadragon.type(l)!=="object"||l.nodeType||t.isWindow(l)||l.constructor&&!a.call(l,"constructor")&&!a.call(l.constructor.prototype,"isPrototypeOf"))return!1;var h;for(var u in l)h=u;return h===void 0||a.call(l,h)},t.isEmptyObject=function(l){for(var h in l)return!1;return!0},t.freezeObject=function(l){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(h){return h},t.freezeObject(l)},t.supportsCanvas=function(){var l=document.createElement("canvas");return!!(t.isFunction(l.getContext)&&l.getContext("2d"))}(),t.isCanvasTainted=function(l){var h=!1;try{l.getContext("2d").getImageData(0,0,1,1)}catch{h=!0}return h},t.pixelDensityRatio=function(){if(t.supportsCanvas){var l=document.createElement("canvas").getContext("2d"),h=window.devicePixelRatio||1,u=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1;return Math.max(h,1)/u}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var t,s,r,a,l,h,u=arguments[0]||{},c=arguments.length,R=!1,b=1;for(typeof u=="boolean"&&(R=u,u=arguments[1]||{},b=2),typeof u!="object"&&!OpenSeadragon.isFunction(u)&&(u={}),c===b&&(u=this,--b);b<c;b++)if(t=arguments[b],t!==null||t!==void 0)for(s in t)r=u[s],a=t[s],u!==a&&(R&&a&&(OpenSeadragon.isPlainObject(a)||(l=OpenSeadragon.isArray(a)))?(l?(l=!1,h=r&&OpenSeadragon.isArray(r)?r:[]):h=r&&OpenSeadragon.isPlainObject(r)?r:{},u[s]=OpenSeadragon.extend(R,h,a)):a!==void 0&&(u[s]=a));return u};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var t=navigator.userAgent;return typeof t!="string"?!1:t.indexOf("iPhone")!==-1||t.indexOf("iPad")!==-1||t.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(t,s){return function(){var r=arguments;return r===void 0&&(r=[]),s.apply(t,r)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(t){return typeof t=="string"&&(t=document.getElementById(t)),t},getElementPosition:function(t){var s=new $.Point,r,a;for(t=$.getElement(t),r=$.getElementStyle(t).position=="fixed",a=getOffsetParent(t,r);a;)s.x+=t.offsetLeft,s.y+=t.offsetTop,r&&(s=s.plus($.getPageScroll())),t=a,r=$.getElementStyle(t).position=="fixed",a=getOffsetParent(t,r);return s},getElementOffset:function(t){t=$.getElement(t);var s=t&&t.ownerDocument,r,a,l={top:0,left:0};return s?(r=s.documentElement,typeof t.getBoundingClientRect<"u"&&(l=t.getBoundingClientRect()),a=s==s.window?s:s.nodeType===9?s.defaultView||s.parentWindow:!1,new $.Point(l.left+(a.pageXOffset||r.scrollLeft)-(r.clientLeft||0),l.top+(a.pageYOffset||r.scrollTop)-(r.clientTop||0))):new $.Point},getElementSize:function(t){return t=$.getElement(t),new $.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=$.getElement(t),t.currentStyle}:function(t){return t=$.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var s={};return $.getCssPropertyWithVendorPrefix=function(r){if(s[r]!==void 0)return s[r];var a=document.createElement("div").style,l=null;if(a[r]!==void 0)l=r;else for(var h=["Webkit","Moz","MS","O","webkit","moz","ms","o"],u=$.capitalizeFirstLetter(r),c=0;c<h.length;c++){var R=h[c]+u;if(a[R]!==void 0){l=R;break}}return s[r]=l,l},$.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},positiveModulo:function(t,s){var r=t%s;return r<0&&(r+=s),r},pointInElement:function(t,s){t=$.getElement(t);var r=$.getElementOffset(t),a=$.getElementSize(t);return s.x>=r.x&&s.x<r.x+a.x&&s.y<r.y+a.y&&s.y>=r.y},getEvent:function(t){return t?$.getEvent=function(s){return s}:$.getEvent=function(){return window.event},$.getEvent(t)},getMousePosition:function(t){if(typeof t.pageX=="number")$.getMousePosition=function(s){var r=new $.Point;return s=$.getEvent(s),r.x=s.pageX,r.y=s.pageY,r};else if(typeof t.clientX=="number")$.getMousePosition=function(s){var r=new $.Point;return s=$.getEvent(s),r.x=s.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r.y=s.clientY+document.body.scrollTop+document.documentElement.scrollTop,r};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},s=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(s.scrollLeft||s.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(t){if(typeof window.scrollTo<"u")$.setPageScroll=function(a){window.scrollTo(a.x,a.y)};else{var s=$.getPageScroll();if(s.x===t.x&&s.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var r=$.getPageScroll();if(r.x!==s.x&&r.y!==s.y){$.setPageScroll=function(a){document.body.scrollLeft=a.x,document.body.scrollTop=a.y};return}if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,r=$.getPageScroll(),r.x!==s.x&&r.y!==s.y){$.setPageScroll=function(a){document.documentElement.scrollLeft=a.x,document.documentElement.scrollTop=a.y};return}$.setPageScroll=function(a){}}return $.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},s=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(s.clientWidth||s.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(t){t=$.getElement(t);var s=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(s[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(s[1].style,{display:"table-row"}),$.extend(s[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),s[0].appendChild(s[1]),s[1].appendChild(s[2]),s[2].appendChild(t),s[0]},makeNeutralElement:function(t){var s=document.createElement(t),r=s.style;return r.background="transparent none",r.border="none",r.margin="0px",r.padding="0px",r.position="static",s},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(t){return $.makeTransparentImage=function(s){var r=$.makeNeutralElement("img");return r.src=s,r},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(s){var r=$.makeNeutralElement("img"),a=null;return a=$.makeNeutralElement("span"),a.style.display="inline-block",r.onload=function(){a.style.width=a.style.width||r.width+"px",a.style.height=a.style.height||r.height+"px",r.onload=null,r=null},r.src=s,a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+s+"', sizingMethod='scale')",a}),$.makeTransparentImage(t)},setElementOpacity:function(t,s,r){var a,l;t=$.getElement(t),r&&!$.Browser.alpha&&(s=Math.round(s)),$.Browser.opacity?t.style.opacity=s<1?s:"":s<1?(a=Math.round(100*s),l="alpha(opacity="+a+")",t.style.filter=l):t.style.filter=""},setElementTouchActionNone:function(t){t=$.getElement(t),typeof t.style.touchAction<"u"?t.style.touchAction="none":typeof t.style.msTouchAction<"u"&&(t.style.msTouchAction="none")},addClass:function(t,s){t=$.getElement(t),t.className?(" "+t.className+" ").indexOf(" "+s+" ")===-1&&(t.className+=" "+s):t.className=s},indexOf:function(t,s,r){return Array.prototype.indexOf?this.indexOf=function(a,l,h){return a.indexOf(l,h)}:this.indexOf=function(a,l,h){var u,c=h||0,R;if(!a)throw new TypeError;if(R=a.length,R===0||c>=R)return-1;for(c<0&&(c=R-Math.abs(c)),u=c;u<R;u++)if(a[u]===l)return u;return-1},this.indexOf(t,s,r)},removeClass:function(t,s){var r,a=[],l;for(t=$.getElement(t),r=t.className.split(/\s+/),l=0;l<r.length;l++)r[l]&&r[l]!==s&&a.push(r[l]);t.className=a.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,s,r,a){t=$.getElement(t),t.addEventListener(s,r,a)};if(window.attachEvent)return function(t,s,r,a){t=$.getElement(t),t.attachEvent("on"+s,r)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,s,r,a){t=$.getElement(t),t.removeEventListener(s,r,a)};if(window.detachEvent)return function(t,s,r,a){t=$.getElement(t),t.detachEvent("on"+s,r)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=$.getEvent(t),t.preventDefault?$.cancelEvent=function(s){s.preventDefault()}:$.cancelEvent=function(s){s=$.getEvent(s),s.cancel=!0,s.returnValue=!1},$.cancelEvent(t)},stopEvent:function(t){t=$.getEvent(t),t.stopPropagation?$.stopEvent=function(s){s.stopPropagation()}:$.stopEvent=function(s){s=$.getEvent(s),s.cancelBubble=!0},$.stopEvent(t)},createCallback:function(t,s){var r=[],a;for(a=2;a<arguments.length;a++)r.push(arguments[a]);return function(){var l=r.concat([]),h;for(h=0;h<arguments.length;h++)l.push(arguments[h]);return s.apply(t,l)}},getUrlParameter:function(t){var s=URLPARAMS[t];return s||null},getUrlProtocol:function(t){var s=t.match(/^([a-z]+:)\/\//i);return s===null?window.location.protocol:s[1].toLowerCase()},createAjaxRequest:function(t){var s;try{s=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{s=!1}if(s)window.XMLHttpRequest?$.createAjaxRequest=function(r){return r?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(t)},makeAjaxRequest:function(t,s,r){var a,l,h;$.isPlainObject(t)&&(s=t.success,r=t.error,a=t.withCredentials,l=t.headers,h=t.responseType||null,t=t.url);var u=$.getUrlProtocol(t),c=$.createAjaxRequest(u==="file:");if(!$.isFunction(s))throw new Error("makeAjaxRequest requires a success callback");c.onreadystatechange=function(){c.readyState==4&&(c.onreadystatechange=function(){},c.status>=200&&c.status<300||c.status===0&&u!=="http:"&&u!=="https:"?s(c):($.console.log("AJAX request returned %d: %s",c.status,t),$.isFunction(r)&&r(c)))};try{if(c.open("GET",t,!0),h&&(c.responseType=h),l)for(var R in l)Object.prototype.hasOwnProperty.call(l,R)&&l[R]&&c.setRequestHeader(R,l[R]);a&&(c.withCredentials=!0),c.send(null)}catch(z){var b=z.message,_=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(_&&typeof z.number<"u"&&z.number==-2147024891&&(b+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",z.name,b),c.onreadystatechange=function(){},window.XDomainRequest){var L=new window.XDomainRequest;if(L){L.onload=function(Z){$.isFunction(s)&&s({responseText:L.responseText,status:200,statusText:"OK"})},L.onerror=function(Z){$.isFunction(r)&&r({responseText:L.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{L.open("GET",t),L.send()}catch{$.isFunction(r)&&r(c,z)}}}else $.isFunction(r)&&r(c,z)}return c},jsonp:function(t){var s,r=t.url,a=document.head||document.getElementsByTagName("head")[0]||document.documentElement,l=t.callbackName||"openseadragon"+$.now(),h=window[l],u="$1"+l+"$2",c=t.param||"callback",R=t.callback;r=r.replace(/(\=)\?(&|$)|\?\?/i,u),r+=(/\?/.test(r)?"&":"?")+c+"="+l,window[l]=function(b){if(h)window[l]=h;else try{delete window[l]}catch{}R&&$.isFunction(R)&&R(b)},s=document.createElement("script"),(t.async!==void 0||t.async!==!1)&&(s.async="async"),t.scriptCharset&&(s.charset=t.scriptCharset),s.src=r,s.onload=s.onreadystatechange=function(b,_){(_||!s.readyState||/loaded|complete/.test(s.readyState))&&(s.onload=s.onreadystatechange=null,a&&s.parentNode&&a.removeChild(s),s=void 0)},a.insertBefore(s,a.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)$.parseXml=function(s){var r=null,a;return a=new DOMParser,r=a.parseFromString(s,"text/xml"),r};else if(window.ActiveXObject)$.parseXml=function(s){var r=null;return r=new ActiveXObject("Microsoft.XMLDOM"),r.async=!1,r.loadXML(s),r};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(t)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(t){return t=t||"",!!FILEFORMATS[t.toLowerCase()]}});var nullfunction=function(t){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var t=navigator.appVersion,s=navigator.userAgent,r;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(s.substring(s.indexOf("MSIE")+5,s.indexOf(";",s.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(s.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(s.substring(s.indexOf("Firefox")+8))):s.indexOf("Safari")>=0?($.Browser.vendor=s.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(s.substring(s.substring(0,s.indexOf("Safari")).lastIndexOf("/")+1,s.indexOf("Safari")))):(r=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),r.exec(s)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(t);break}var a=window.location.search.substring(1),l=a.split("&"),h,u,c;for(c=0;c<l.length;c++)if(h=l[c],u=h.indexOf("="),u>0){var R=h.substring(0,u),b=h.substring(u+1);try{URLPARAMS[R]=decodeURIComponent(b)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",R,b)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(t){var s=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,r=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(s&&r)$.requestAnimationFrame=function(){return s.apply(t,arguments)},$.cancelAnimationFrame=function(){return r.apply(t,arguments)};else{var a=[],l=[],h=0,u;$.requestAnimationFrame=function(c){return a.push([++h,c]),u||(u=setInterval(function(){if(a.length){var R=$.now(),b=l;for(l=a,a=b;l.length;)l.shift()[1](R)}else clearInterval(u),u=void 0},1e3/50)),h},$.cancelAnimationFrame=function(c){var R,b;for(R=0,b=a.length;R<b;R+=1)if(a[R][0]===c){a.splice(R,1);return}for(R=0,b=l.length;R<b;R+=1)if(l[R][0]===c){l.splice(R,1);return}}}}(window);function getOffsetParent(t,s){return s&&t!=document.body?document.body:t.offsetParent}}(OpenSeadragon),function(t,s){typeof define=="function"&&define.amd?define([],s):typeof module=="object"&&module.exports?module.exports=s():t.OpenSeadragon=s()}(exports,function(){return OpenSeadragon}),function(t){var s={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(s.supportsFullScreen=!0,s.getFullScreenElement=function(){return document.fullscreenElement},s.requestFullScreen=function(r){return r.requestFullscreen()},s.exitFullScreen=function(){document.exitFullscreen()},s.fullScreenEventName="fullscreenchange",s.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(s.supportsFullScreen=!0,s.getFullScreenElement=function(){return document.msFullscreenElement},s.requestFullScreen=function(r){return r.msRequestFullscreen()},s.exitFullScreen=function(){document.msExitFullscreen()},s.fullScreenEventName="MSFullscreenChange",s.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(s.supportsFullScreen=!0,s.getFullScreenElement=function(){return document.webkitFullscreenElement},s.requestFullScreen=function(r){return r.webkitRequestFullscreen()},s.exitFullScreen=function(){document.webkitExitFullscreen()},s.fullScreenEventName="webkitfullscreenchange",s.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(s.supportsFullScreen=!0,s.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},s.requestFullScreen=function(r){return r.webkitRequestFullScreen()},s.exitFullScreen=function(){document.webkitCancelFullScreen()},s.fullScreenEventName="webkitfullscreenchange",s.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(s.supportsFullScreen=!0,s.getFullScreenElement=function(){return document.mozFullScreenElement},s.requestFullScreen=function(r){return r.mozRequestFullScreen()},s.exitFullScreen=function(){document.mozCancelFullScreen()},s.fullScreenEventName="mozfullscreenchange",s.fullScreenErrorEventName="mozfullscreenerror"),s.isFullScreen=function(){return s.getFullScreenElement()!==null},s.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),s.exitFullScreen()},t.extend(t,s)}(OpenSeadragon),function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(s,r,a,l){var h=this;l=l||1;var u=0,c=function(R){u++,u===l&&h.removeHandler(s,c),r(R)};this.addHandler(s,c,a)},addHandler:function(s,r,a){var l=this.events[s];l||(this.events[s]=l=[]),r&&t.isFunction(r)&&(l[l.length]={handler:r,userData:a||null})},removeHandler:function(s,r){var a=this.events[s],l=[],h;if(!!a&&t.isArray(a)){for(h=0;h<a.length;h++)a[h].handler!==r&&l.push(a[h]);this.events[s]=l}},removeAllHandlers:function(s){if(s)this.events[s]=[];else for(var r in this.events)this.events[r]=[]},getHandler:function(s){var r=this.events[s];return!r||!r.length?null:(r=r.length===1?[r[0]]:Array.apply(null,r),function(a,l){var h,u=r.length;for(h=0;h<u;h++)r[h]&&(l.eventSource=a,l.userData=r[h].userData,r[h].handler(l))})},raiseEvent:function(s,r){var a=this.getHandler(s);a&&(r||(r={}),a(this,r))}}}(OpenSeadragon),function(t){var s=[],r={};t.MouseTracker=function(y){s.push(this);var w=arguments;t.isPlainObject(y)||(y={element:w[0],clickTimeThreshold:w[1],clickDistThreshold:w[2]}),this.hash=Math.random(),this.element=t.getElement(y.element),this.clickTimeThreshold=y.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=y.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=y.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=y.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=y.userData||null,this.stopDelay=y.stopDelay||50,this.enterHandler=y.enterHandler||null,this.exitHandler=y.exitHandler||null,this.pressHandler=y.pressHandler||null,this.nonPrimaryPressHandler=y.nonPrimaryPressHandler||null,this.releaseHandler=y.releaseHandler||null,this.nonPrimaryReleaseHandler=y.nonPrimaryReleaseHandler||null,this.moveHandler=y.moveHandler||null,this.scrollHandler=y.scrollHandler||null,this.clickHandler=y.clickHandler||null,this.dblClickHandler=y.dblClickHandler||null,this.dragHandler=y.dragHandler||null,this.dragEndHandler=y.dragEndHandler||null,this.pinchHandler=y.pinchHandler||null,this.stopHandler=y.stopHandler||null,this.keyDownHandler=y.keyDownHandler||null,this.keyUpHandler=y.keyUpHandler||null,this.keyHandler=y.keyHandler||null,this.focusHandler=y.focusHandler||null,this.blurHandler=y.blurHandler||null;var I=this;r[this.hash]={click:function(A){X(I,A)},dblclick:function(A){oe(I,A)},keydown:function(A){v(I,A)},keyup:function(A){B(I,A)},keypress:function(A){U(I,A)},focus:function(A){j(I,A)},blur:function(A){Y(I,A)},wheel:function(A){K(I,A)},mousewheel:function(A){ae(I,A)},DOMMouseScroll:function(A){ae(I,A)},MozMousePixelScroll:function(A){ae(I,A)},mouseenter:function(A){ye(I,A)},mouseleave:function(A){we(I,A)},mouseover:function(A){ve(I,A)},mouseout:function(A){ke(I,A)},mousedown:function(A){ze(I,A)},mouseup:function(A){ce(I,A)},mouseupcaptured:function(A){je(I,A)},mousemove:function(A){st(I,A)},mousemovecaptured:function(A){Xe(I,A)},touchstart:function(A){ot(I,A)},touchend:function(A){rt(I,A)},touchendcaptured:function(A){lt(I,A)},touchmove:function(A){Je(I,A)},touchmovecaptured:function(A){ht(I,A)},touchcancel:function(A){ct(I,A)},gesturestart:function(A){ut(I,A)},gesturechange:function(A){g(I,A)},pointerover:function(A){C(I,A)},MSPointerOver:function(A){C(I,A)},pointerout:function(A){M(I,A)},MSPointerOut:function(A){M(I,A)},pointerdown:function(A){V(I,A)},MSPointerDown:function(A){V(I,A)},pointerup:function(A){q(I,A)},MSPointerUp:function(A){q(I,A)},pointermove:function(A){Pe(I,A)},MSPointerMove:function(A){Pe(I,A)},pointercancel:function(A){Ee(I,A)},MSPointerCancel:function(A){Ee(I,A)},pointerupcaptured:function(A){de(I,A)},pointermovecaptured:function(A){Ve(I,A)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},y.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var y;for(h(this),this.element=null,y=0;y<s.length;y++)if(s[y]===this){s.splice(y,1);break}r[this.hash]=null,delete r[this.hash]},isTracking:function(){return r[this.hash].tracking},setTracking:function(y){return y?l(this):h(this),this},getActivePointersListsExceptType:function(y){for(var w=r[this.hash],I=[],A=0;A<w.activePointersLists.length;++A)w.activePointersLists[A].type!==y&&I.push(w.activePointersLists[A]);return I},getActivePointersListByType:function(y){var w=r[this.hash],I,A=w.activePointersLists.length,J;for(I=0;I<A;I++)if(w.activePointersLists[I].type===y)return w.activePointersLists[I];return J=new t.MouseTracker.GesturePointList(y),w.activePointersLists.push(J),J},getActivePointerCount:function(){var y=r[this.hash],w,I=y.activePointersLists.length,A=0;for(w=0;w<I;w++)A+=y.activePointersLists[w].getLength();return A},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},t.MouseTracker.resetAllMouseTrackers=function(){for(var y=0;y<s.length;y++)s[y].isTracking()&&(s[y].setTracking(!1),s[y].setTracking(!0))},t.MouseTracker.gesturePointVelocityTracker=function(){var y=[],w=0,I=0,A=function(re,xe){return re.hash.toString()+xe.type+xe.id.toString()},J=function(){var re,xe=y.length,_e,Oe,We=t.now(),Se,pt,mt;for(Se=We-I,I=We,re=0;re<xe;re++)_e=y[re],Oe=_e.gPoint,Oe.direction=Math.atan2(Oe.currentPos.y-_e.lastPos.y,Oe.currentPos.x-_e.lastPos.x),pt=_e.lastPos.distanceTo(Oe.currentPos),_e.lastPos=Oe.currentPos,mt=1e3*pt/(Se+1),Oe.speed=.75*mt+.25*Oe.speed},fe=function(re,xe){var _e=A(re,xe);y.push({guid:_e,gPoint:xe,lastPos:xe.currentPos}),y.length===1&&(I=t.now(),w=window.setInterval(J,50))},he=function(re,xe){var _e=A(re,xe),Oe,We=y.length;for(Oe=0;Oe<We;Oe++)if(y[Oe].guid===_e){y.splice(Oe,1),We--,We===0&&window.clearInterval(w);break}};return{addPoint:fe,removePoint:he}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor==t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.supportsMouseCapture=function(){var y=document.createElement("div");return t.isFunction(y.setCapture)&&t.isFunction(y.releaseCapture)}(),t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName=="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||t.Browser.vendor!==t.BROWSERS.IE)?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),t.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):(t.MouseTracker.havePointerEvents=!1,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?(t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),t.MouseTracker.haveMouseEnter=!0):(t.MouseTracker.subscribeEvents.push("mouseover","mouseout"),t.MouseTracker.haveMouseEnter=!1),t.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.maxTouchPoints=10),t.MouseTracker.GesturePointList=function(y){this._gPoints=[],this.type=y,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(y){return this._gPoints.push(y)},removeById:function(y){var w,I=this._gPoints.length;for(w=0;w<I;w++)if(this._gPoints[w].id===y){this._gPoints.splice(w,1);break}return this._gPoints.length},getByIndex:function(y){return y<this._gPoints.length?this._gPoints[y]:null},getById:function(y){var w,I=this._gPoints.length;for(w=0;w<I;w++)if(this._gPoints[w].id===y)return this._gPoints[w];return null},getPrimary:function(y){var w,I=this._gPoints.length;for(w=0;w<I;w++)if(this._gPoints[w].isPrimary)return this._gPoints[w];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function a(y){var w=r[y.hash],I,A=w.activePointersLists.length;for(I=0;I<A;I++)w.activePointersLists[I].captureCount>0&&(t.removeEvent(t.MouseTracker.captureElement,"mousemove",w.mousemovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"mouseup",w.mouseupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",w.pointermovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",w.pointerupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchmove",w.touchmovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchend",w.touchendcaptured,!0),w.activePointersLists[I].captureCount=0);for(I=0;I<A;I++)w.activePointersLists.pop()}function l(y){var w=r[y.hash],I,A;if(!w.tracking){for(A=0;A<t.MouseTracker.subscribeEvents.length;A++)I=t.MouseTracker.subscribeEvents[A],t.addEvent(y.element,I,w[I],!1);a(y),w.tracking=!0}}function h(y){var w=r[y.hash],I,A;if(w.tracking){for(A=0;A<t.MouseTracker.subscribeEvents.length;A++)I=t.MouseTracker.subscribeEvents[A],t.removeEvent(y.element,I,w[I],!1);a(y),w.tracking=!1}}function u(y,w){var I=r[y.hash];if(w==="pointerevent")return{upName:t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:I.pointerupcaptured,moveName:t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:I.pointermovecaptured};if(w==="mouse")return{upName:"mouseup",upHandler:I.mouseupcaptured,moveName:"mousemove",moveHandler:I.mousemovecaptured};if(w==="touch")return{upName:"touchend",upHandler:I.touchendcaptured,moveName:"touchmove",moveHandler:I.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function c(y,w,I){var A=y.getActivePointersListByType(w),J;A.captureCount+=I||1,A.captureCount===1&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?y.element.setCapture(!0):(J=u(y,t.MouseTracker.havePointerEvents?"pointerevent":w),Bt&&Ht(window.top)&&t.addEvent(window.top,J.upName,J.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,J.upName,J.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,J.moveName,J.moveHandler,!0)))}function R(y,w,I){var A=y.getActivePointersListByType(w),J;A.captureCount-=I||1,A.captureCount===0&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?y.element.releaseCapture():(J=u(y,t.MouseTracker.havePointerEvents?"pointerevent":w),Bt&&Ht(window.top)&&t.removeEvent(window.top,J.upName,J.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,J.moveName,J.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,J.upName,J.upHandler,!0)))}function b(y){var w;if(t.MouseTracker.unprefixedPointerEvents)w=y.pointerType;else switch(y.pointerType){case 2:w="touch";break;case 3:w="pen";break;case 4:w="mouse";break;default:w=""}return w}function _(y){return t.getMousePosition(y)}function L(y,w){return z(_(y),w)}function z(y,w){var I=t.getElementOffset(w);return y.minus(I)}function Z(y,w){return new t.Point((y.x+w.x)/2,(y.y+w.y)/2)}function X(y,w){y.clickHandler&&t.cancelEvent(w)}function oe(y,w){y.dblClickHandler&&t.cancelEvent(w)}function v(y,w){var I;y.keyDownHandler&&(w=t.getEvent(w),I=y.keyDownHandler({eventSource:y,keyCode:w.keyCode?w.keyCode:w.charCode,ctrl:w.ctrlKey,shift:w.shiftKey,alt:w.altKey,meta:w.metaKey,originalEvent:w,preventDefaultAction:!1,userData:y.userData}),I||t.cancelEvent(w))}function B(y,w){var I;y.keyUpHandler&&(w=t.getEvent(w),I=y.keyUpHandler({eventSource:y,keyCode:w.keyCode?w.keyCode:w.charCode,ctrl:w.ctrlKey,shift:w.shiftKey,alt:w.altKey,meta:w.metaKey,originalEvent:w,preventDefaultAction:!1,userData:y.userData}),I||t.cancelEvent(w))}function U(y,w){var I;y.keyHandler&&(w=t.getEvent(w),I=y.keyHandler({eventSource:y,keyCode:w.keyCode?w.keyCode:w.charCode,ctrl:w.ctrlKey,shift:w.shiftKey,alt:w.altKey,meta:w.metaKey,originalEvent:w,preventDefaultAction:!1,userData:y.userData}),I||t.cancelEvent(w))}function j(y,w){var I;y.focusHandler&&(w=t.getEvent(w),I=y.focusHandler({eventSource:y,originalEvent:w,preventDefaultAction:!1,userData:y.userData}),I===!1&&t.cancelEvent(w))}function Y(y,w){var I;y.blurHandler&&(w=t.getEvent(w),I=y.blurHandler({eventSource:y,originalEvent:w,preventDefaultAction:!1,userData:y.userData}),I===!1&&t.cancelEvent(w))}function K(y,w){ie(y,w,w)}function ae(y,w){w=t.getEvent(w);var I={target:w.target||w.srcElement,type:"wheel",shiftKey:w.shiftKey||!1,clientX:w.clientX,clientY:w.clientY,pageX:w.pageX?w.pageX:w.clientX,pageY:w.pageY?w.pageY:w.clientY,deltaMode:w.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName=="mousewheel"?I.deltaY=-w.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:I.deltaY=w.detail,ie(y,I,w)}function ie(y,w,I){var A=0,J;A=w.deltaY<0?1:-1,y.scrollHandler&&(J=y.scrollHandler({eventSource:y,pointerType:"mouse",position:L(w,y.element),scroll:A,shift:w.shiftKey,isTouchEvent:!1,originalEvent:I,preventDefaultAction:!1,userData:y.userData}),J===!1&&t.cancelEvent(I))}function ge(y,w){if(y===w)return!1;for(;w&&w!==y;)w=w.parentNode;return w===y}function ye(y,w){w=t.getEvent(w),be(y,w)}function ve(y,w){w=t.getEvent(w),!(w.currentTarget===w.relatedTarget||ge(w.currentTarget,w.relatedTarget))&&be(y,w)}function be(y,w){var I={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:_(w),currentTime:t.now()};qe(y,w,[I])}function we(y,w){w=t.getEvent(w),De(y,w)}function ke(y,w){w=t.getEvent(w),!(w.currentTarget===w.relatedTarget||ge(w.currentTarget,w.relatedTarget))&&De(y,w)}function De(y,w){var I={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:_(w),currentTime:t.now()};Ye(y,w,[I])}function Fe(y){return t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?y===1?0:y===2?2:y===4?1:-1:y}function ze(y,w){var I;w=t.getEvent(w),I={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:_(w),currentTime:t.now()},ft(y,w,[I],Fe(w.button))&&(t.stopEvent(w),c(y,"mouse")),(y.clickHandler||y.dblClickHandler||y.pressHandler||y.dragHandler||y.dragEndHandler)&&t.cancelEvent(w)}function ce(y,w){Ze(y,w)}function je(y,w){Ze(y,w),t.stopEvent(w)}function Ze(y,w){var I;w=t.getEvent(w),I={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:_(w),currentTime:t.now()},dt(y,w,[I],Fe(w.button))&&R(y,"mouse")}function st(y,w){Qe(y,w)}function Xe(y,w){Qe(y,w),t.stopEvent(w)}function Qe(y,w){var I;w=t.getEvent(w),I={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:_(w),currentTime:t.now()},Rt(y,w,[I])}function Ke(y,w,I){var A,J=I.getLength(),fe=[];if(I.type==="touch"||I.contacts>0){for(A=0;A<J;A++)fe.push(I.getByIndex(A));fe.length>0&&(dt(y,w,fe,0),I.captureCount=1,R(y,I.type),Ye(y,w,fe))}}function ot(y,w){var I,A,J,fe=w.changedTouches.length,he=[],re,xe=y.getActivePointersListByType("touch");for(I=t.now(),xe.getLength()>w.touches.length-fe&&(t.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Ke(y,w,xe)),A=0;A<fe;A++)he.push({id:w.changedTouches[A].identifier,type:"touch",currentPos:_(w.changedTouches[A]),currentTime:I});for(qe(y,w,he),A=0;A<s.length;A++)if(s[A]!==y&&s[A].isTracking()&&ge(s[A].element,y.element)){for(re=[],J=0;J<fe;J++)re.push({id:w.changedTouches[J].identifier,type:"touch",currentPos:_(w.changedTouches[J]),currentTime:I});qe(s[A],w,re)}ft(y,w,he,0)&&(t.stopEvent(w),c(y,"touch",fe)),t.cancelEvent(w)}function rt(y,w){it(y,w)}function lt(y,w){it(y,w),t.stopEvent(w)}function it(y,w){var I,A,J,fe=w.changedTouches.length,he=[],re;for(I=t.now(),A=0;A<fe;A++)he.push({id:w.changedTouches[A].identifier,type:"touch",currentPos:_(w.changedTouches[A]),currentTime:I});for(dt(y,w,he,0)&&R(y,"touch",fe),Ye(y,w,he),A=0;A<s.length;A++)if(s[A]!==y&&s[A].isTracking()&&ge(s[A].element,y.element)){for(re=[],J=0;J<fe;J++)re.push({id:w.changedTouches[J].identifier,type:"touch",currentPos:_(w.changedTouches[J]),currentTime:I});Ye(s[A],w,re)}t.cancelEvent(w)}function Je(y,w){nt(y,w)}function ht(y,w){nt(y,w),t.stopEvent(w)}function nt(y,w){var I,A=w.changedTouches.length,J=[];for(I=0;I<A;I++)J.push({id:w.changedTouches[I].identifier,type:"touch",currentPos:_(w.changedTouches[I]),currentTime:t.now()});Rt(y,w,J),t.cancelEvent(w)}function ct(y,w){var I=y.getActivePointersListByType("touch");Ke(y,w,I)}function ut(y,w){return w.stopPropagation(),w.preventDefault(),!1}function g(y,w){return w.stopPropagation(),w.preventDefault(),!1}function C(y,w){var I;w.currentTarget===w.relatedTarget||ge(w.currentTarget,w.relatedTarget)||(I={id:w.pointerId,type:b(w),isPrimary:w.isPrimary,currentPos:_(w),currentTime:t.now()},qe(y,w,[I]))}function M(y,w){var I;w.currentTarget===w.relatedTarget||ge(w.currentTarget,w.relatedTarget)||(I={id:w.pointerId,type:b(w),isPrimary:w.isPrimary,currentPos:_(w),currentTime:t.now()},Ye(y,w,[I]))}function V(y,w){var I;I={id:w.pointerId,type:b(w),isPrimary:w.isPrimary,currentPos:_(w),currentTime:t.now()},ft(y,w,[I],w.button)&&(t.stopEvent(w),c(y,I.type)),(y.clickHandler||y.dblClickHandler||y.pressHandler||y.dragHandler||y.dragEndHandler||y.pinchHandler)&&t.cancelEvent(w)}function q(y,w){Q(y,w)}function de(y,w){var I=y.getActivePointersListByType(b(w));I.getById(w.pointerId)&&Q(y,w),t.stopEvent(w)}function Q(y,w){var I;I={id:w.pointerId,type:b(w),isPrimary:w.isPrimary,currentPos:_(w),currentTime:t.now()},dt(y,w,[I],w.button)&&R(y,I.type)}function Pe(y,w){Ne(y,w)}function Ve(y,w){var I=y.getActivePointersListByType(b(w));I.getById(w.pointerId)&&Ne(y,w),t.stopEvent(w)}function Ne(y,w){var I;I={id:w.pointerId,type:b(w),isPrimary:w.isPrimary,currentPos:_(w),currentTime:t.now()},Rt(y,w,[I])}function Ee(y,w){var I;I={id:w.pointerId,type:b(w)},Nt(y,w,[I])}function Ue(y,w){return Object.prototype.hasOwnProperty.call(w,"isPrimary")||(y.getLength()===0?w.isPrimary=!0:w.isPrimary=!1),w.speed=0,w.direction=0,w.contactPos=w.currentPos,w.contactTime=w.currentTime,w.lastPos=w.currentPos,w.lastTime=w.currentTime,y.add(w)}function Ae(y,w){var I,A;return y.getById(w.id)?(I=y.removeById(w.id),Object.prototype.hasOwnProperty.call(w,"isPrimary")||(A=y.getPrimary(),A||(A=y.getByIndex(0),A&&(A.isPrimary=!0)))):I=y.getLength(),I}function qe(y,w,I){var A=y.getActivePointersListByType(I[0].type),J,fe=I.length,he,re,xe;for(J=0;J<fe;J++)he=I[J],re=A.getById(he.id),re?(re.insideElement=!0,re.lastPos=re.currentPos,re.lastTime=re.currentTime,re.currentPos=he.currentPos,re.currentTime=he.currentTime,he=re):(he.captured=!1,he.insideElementPressed=!1,he.insideElement=!0,Ue(A,he)),y.enterHandler&&(xe=y.enterHandler({eventSource:y,pointerType:he.type,position:z(he.currentPos,y.element),buttons:A.buttons,pointers:y.getActivePointerCount(),insideElementPressed:he.insideElementPressed,buttonDownAny:A.buttons!==0,isTouchEvent:he.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),xe===!1&&t.cancelEvent(w))}function Ye(y,w,I){var A=y.getActivePointersListByType(I[0].type),J,fe=I.length,he,re,xe;for(J=0;J<fe;J++)he=I[J],re=A.getById(he.id),re&&(re.captured?(re.insideElement=!1,re.lastPos=re.currentPos,re.lastTime=re.currentTime,re.currentPos=he.currentPos,re.currentTime=he.currentTime):Ae(A,re),he=re),y.exitHandler&&(xe=y.exitHandler({eventSource:y,pointerType:he.type,position:he.currentPos&&z(he.currentPos,y.element),buttons:A.buttons,pointers:y.getActivePointerCount(),insideElementPressed:re?re.insideElementPressed:!1,buttonDownAny:A.buttons!==0,isTouchEvent:he.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),xe===!1&&t.cancelEvent(w))}function ft(y,w,I,A){var J=r[y.hash],fe,he=y.getActivePointersListByType(I[0].type),re,xe=I.length,_e,Oe;typeof w.buttons<"u"?he.buttons=w.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?A===0?he.buttons+=1:A===1?he.buttons+=4:A===2?he.buttons+=2:A===3?he.buttons+=8:A===4?he.buttons+=16:A===5&&(he.buttons+=32):A===0?he.buttons|=1:A===1?he.buttons|=4:A===2?he.buttons|=2:A===3?he.buttons|=8:A===4?he.buttons|=16:A===5&&(he.buttons|=32);var We=y.getActivePointersListsExceptType(I[0].type);for(re=0;re<We.length;re++)Ke(y,w,We[re]);if(A!==0)return y.nonPrimaryPressHandler&&(fe=y.nonPrimaryPressHandler({eventSource:y,pointerType:I[0].type,position:z(I[0].currentPos,y.element),button:A,buttons:he.buttons,isTouchEvent:I[0].type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),fe===!1&&t.cancelEvent(w)),!1;for(re=0;re<xe;re++)_e=I[re],Oe=he.getById(_e.id),Oe?(Oe.captured=!0,Oe.insideElementPressed=!0,Oe.insideElement=!0,Oe.contactPos=_e.currentPos,Oe.contactTime=_e.currentTime,Oe.lastPos=Oe.currentPos,Oe.lastTime=Oe.currentTime,Oe.currentPos=_e.currentPos,Oe.currentTime=_e.currentTime,_e=Oe):(_e.captured=!0,_e.insideElementPressed=!0,_e.insideElement=!0,Ue(he,_e)),he.addContact(),(y.dragHandler||y.dragEndHandler||y.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(y,_e),he.contacts===1?y.pressHandler&&(fe=y.pressHandler({eventSource:y,pointerType:_e.type,position:z(_e.contactPos,y.element),buttons:he.buttons,isTouchEvent:_e.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),fe===!1&&t.cancelEvent(w)):he.contacts===2&&y.pinchHandler&&_e.type==="touch"&&(J.pinchGPoints=he.asArray(),J.lastPinchDist=J.currentPinchDist=J.pinchGPoints[0].currentPos.distanceTo(J.pinchGPoints[1].currentPos),J.lastPinchCenter=J.currentPinchCenter=Z(J.pinchGPoints[0].currentPos,J.pinchGPoints[1].currentPos));return!0}function dt(y,w,I,A){var J=r[y.hash],fe=y.getActivePointersListByType(I[0].type),he,re,xe,_e,Oe=I.length,We,Se,pt=!1,mt=!1,At;if(typeof w.buttons<"u"?fe.buttons=w.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?A===0?fe.buttons-=1:A===1?fe.buttons-=4:A===2?fe.buttons-=2:A===3?fe.buttons-=8:A===4?fe.buttons-=16:A===5&&(fe.buttons-=32):A===0?fe.buttons^=-2:A===1?fe.buttons^=-5:A===2?fe.buttons^=-3:A===3?fe.buttons^=-9:A===4?fe.buttons^=-17:A===5&&(fe.buttons^=-33),A!==0){y.nonPrimaryReleaseHandler&&(he=y.nonPrimaryReleaseHandler({eventSource:y,pointerType:I[0].type,position:z(I[0].currentPos,y.element),button:A,buttons:fe.buttons,isTouchEvent:I[0].type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),he===!1&&t.cancelEvent(w));var Dt=y.getActivePointersListByType("mouse");return Ke(y,w,Dt),!1}if(typeof I[0].currentPos>"u")return Ke(y,w,fe),!1;for(_e=0;_e<Oe;_e++)We=I[_e],Se=fe.getById(We.id),Se&&(Se.captured&&(Se.captured=!1,pt=!0,mt=!0),Se.lastPos=Se.currentPos,Se.lastTime=Se.currentTime,Se.currentPos=We.currentPos,Se.currentTime=We.currentTime,Se.insideElement||Ae(fe,Se),re=Se.currentPos,xe=Se.currentTime,mt?(fe.removeContact(),(y.dragHandler||y.dragEndHandler||y.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(y,Se),fe.contacts===0?(y.releaseHandler&&(he=y.releaseHandler({eventSource:y,pointerType:Se.type,position:z(re,y.element),buttons:fe.buttons,insideElementPressed:Se.insideElementPressed,insideElementReleased:Se.insideElement,isTouchEvent:Se.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),he===!1&&t.cancelEvent(w)),y.dragEndHandler&&!Se.currentPos.equals(Se.contactPos)&&(he=y.dragEndHandler({eventSource:y,pointerType:Se.type,position:z(Se.currentPos,y.element),speed:Se.speed,direction:Se.direction,shift:w.shiftKey,isTouchEvent:Se.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),he===!1&&t.cancelEvent(w)),(y.clickHandler||y.dblClickHandler)&&Se.insideElement&&(At=xe-Se.contactTime<=y.clickTimeThreshold&&Se.contactPos.distanceTo(re)<=y.clickDistThreshold,y.clickHandler&&(he=y.clickHandler({eventSource:y,pointerType:Se.type,position:z(Se.currentPos,y.element),quick:At,shift:w.shiftKey,isTouchEvent:Se.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),he===!1&&t.cancelEvent(w)),y.dblClickHandler&&At&&(fe.clicks++,fe.clicks===1?(J.lastClickPos=re,J.dblClickTimeOut=setTimeout(function(){fe.clicks=0},y.dblClickTimeThreshold)):fe.clicks===2&&(clearTimeout(J.dblClickTimeOut),fe.clicks=0,J.lastClickPos.distanceTo(re)<=y.dblClickDistThreshold&&(he=y.dblClickHandler({eventSource:y,pointerType:Se.type,position:z(Se.currentPos,y.element),shift:w.shiftKey,isTouchEvent:Se.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),he===!1&&t.cancelEvent(w)),J.lastClickPos=null)))):fe.contacts===2&&y.pinchHandler&&Se.type==="touch"&&(J.pinchGPoints=fe.asArray(),J.lastPinchDist=J.currentPinchDist=J.pinchGPoints[0].currentPos.distanceTo(J.pinchGPoints[1].currentPos),J.lastPinchCenter=J.currentPinchCenter=Z(J.pinchGPoints[0].currentPos,J.pinchGPoints[1].currentPos))):y.releaseHandler&&(he=y.releaseHandler({eventSource:y,pointerType:Se.type,position:z(re,y.element),buttons:fe.buttons,insideElementPressed:Se.insideElementPressed,insideElementReleased:Se.insideElement,isTouchEvent:Se.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),he===!1&&t.cancelEvent(w)));return pt}function Rt(y,w,I){var A=r[y.hash],J=y.getActivePointersListByType(I[0].type),fe,he=I.length,re,xe,_e,Oe,We;for(typeof w.buttons<"u"&&(J.buttons=w.buttons),fe=0;fe<he;fe++)re=I[fe],xe=J.getById(re.id),xe?(Object.prototype.hasOwnProperty.call(re,"isPrimary")&&(xe.isPrimary=re.isPrimary),xe.lastPos=xe.currentPos,xe.lastTime=xe.currentTime,xe.currentPos=re.currentPos,xe.currentTime=re.currentTime):(re.captured=!1,re.insideElementPressed=!1,re.insideElement=!0,Ue(J,re));y.stopHandler&&I[0].type==="mouse"&&(clearTimeout(y.stopTimeOut),y.stopTimeOut=setTimeout(function(){kt(y,w,I[0].type)},y.stopDelay)),J.contacts===0?y.moveHandler&&(We=y.moveHandler({eventSource:y,pointerType:I[0].type,position:z(I[0].currentPos,y.element),buttons:J.buttons,isTouchEvent:I[0].type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),We===!1&&t.cancelEvent(w)):J.contacts===1?(y.moveHandler&&(xe=J.asArray()[0],We=y.moveHandler({eventSource:y,pointerType:xe.type,position:z(xe.currentPos,y.element),buttons:J.buttons,isTouchEvent:xe.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),We===!1&&t.cancelEvent(w)),y.dragHandler&&(xe=J.asArray()[0],Oe=xe.currentPos.minus(xe.lastPos),We=y.dragHandler({eventSource:y,pointerType:xe.type,position:z(xe.currentPos,y.element),buttons:J.buttons,delta:Oe,speed:xe.speed,direction:xe.direction,shift:w.shiftKey,isTouchEvent:xe.type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),We===!1&&t.cancelEvent(w))):J.contacts===2&&(y.moveHandler&&(_e=J.asArray(),We=y.moveHandler({eventSource:y,pointerType:_e[0].type,position:z(Z(_e[0].currentPos,_e[1].currentPos),y.element),buttons:J.buttons,isTouchEvent:_e[0].type==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData}),We===!1&&t.cancelEvent(w)),y.pinchHandler&&I[0].type==="touch"&&(Oe=A.pinchGPoints[0].currentPos.distanceTo(A.pinchGPoints[1].currentPos),Oe!=A.currentPinchDist&&(A.lastPinchDist=A.currentPinchDist,A.currentPinchDist=Oe,A.lastPinchCenter=A.currentPinchCenter,A.currentPinchCenter=Z(A.pinchGPoints[0].currentPos,A.pinchGPoints[1].currentPos),We=y.pinchHandler({eventSource:y,pointerType:"touch",gesturePoints:A.pinchGPoints,lastCenter:z(A.lastPinchCenter,y.element),center:z(A.currentPinchCenter,y.element),lastDistance:A.lastPinchDist,distance:A.currentPinchDist,shift:w.shiftKey,originalEvent:w,preventDefaultAction:!1,userData:y.userData}),We===!1&&t.cancelEvent(w))))}function Nt(y,w,I){dt(y,w,I,0),Ye(y,w,I)}function kt(y,w,I){y.stopHandler&&y.stopHandler({eventSource:y,pointerType:I,position:L(w,y.element),buttons:y.getActivePointersListByType(I).buttons,isTouchEvent:I==="touch",originalEvent:w,preventDefaultAction:!1,userData:y.userData})}var Bt=function(){try{return window.self!==window.top}catch{return!0}}();function Ht(y){try{return y.addEventListener&&y.removeEventListener}catch{return!1}}}(OpenSeadragon),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(s,r,a){var l=s.parentNode;typeof r=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),r={anchor:r}),r.attachToViewer=typeof r.attachToViewer>"u"?!0:r.attachToViewer,this.autoFade=typeof r.autoFade>"u"?!0:r.autoFade,this.element=s,this.anchor=r.anchor,this.container=a,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof r.top=="number"?r.top+"px":r.top,this.wrapper.style.left=typeof r.left=="number"?r.left+"px":r.left,this.wrapper.style.height=typeof r.height=="number"?r.height+"px":r.height,this.wrapper.style.width=typeof r.width=="number"?r.width+"px":r.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),r.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):l.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(s){this.wrapper.style.display=s?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(s){this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?t.setElementOpacity(this.element,s,!0):t.setElementOpacity(this.wrapper,s,!0)}}}(OpenSeadragon),function(t){t.ControlDock=function(r){var a=["topleft","topright","bottomright","bottomleft"],l,h;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},r),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),h=0;h<a.length;h++)l=a[h],this.controls[l]=t.makeNeutralElement("div"),this.controls[l].style.position="absolute",l.match("left")&&(this.controls[l].style.left="0px"),l.match("right")&&(this.controls[l].style.right="0px"),l.match("top")&&(this.controls[l].style.top="0px"),l.match("bottom")&&(this.controls[l].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(r,a){r=t.getElement(r);var l=null;if(!(s(this,r)>=0)){switch(a.anchor){case t.ControlAnchor.TOP_RIGHT:l=this.controls.topright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:l=this.controls.bottomright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:l=this.controls.bottomleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:l=this.controls.topleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:l=this.container,r.style.margin="0px",r.style.padding="0px";break;default:case t.ControlAnchor.NONE:l=this.container,r.style.margin="0px",r.style.padding="0px";break}this.controls.push(new t.Control(r,a,l)),r.style.display="inline-block"}},removeControl:function(r){r=t.getElement(r);var a=s(this,r);return a>=0&&(this.controls[a].destroy(),this.controls.splice(a,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var r;for(r=this.controls.length-1;r>=0;r--)if(this.controls[r].isVisible())return!0;return!1},setControlsEnabled:function(r){var a;for(a=this.controls.length-1;a>=0;a--)this.controls[a].setVisible(r);return this}};function s(r,a){var l=r.controls,h;for(h=l.length-1;h>=0;h--)if(l[h].element==a)return h;return-1}}(OpenSeadragon),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(t){var s={},r=1;t.Viewer=function(g){var C=arguments,M=this,V;if(t.isPlainObject(g)||(g={id:C[0],xmlPath:C.length>1?C[1]:void 0,prefixUrl:C.length>2?C[2]:void 0,controls:C.length>3?C[3]:void 0,overlays:C.length>4?C[4]:void 0}),g.config&&(t.extend(!0,g,g.config),delete g.config),t.extend(!0,this,{id:g.id,hash:g.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},t.DEFAULT_SETTINGS,g),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof s[this.hash]<"u"&&t.console.warn("Hash "+this.hash+" has already been used."),s[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(q){var de=t.getString("Errors.OpenFailed",q.eventSource,q.message);M._showMessage(de)}),t.ControlDock.call(this,g),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(q){q.width="100%",q.height="100%",q.overflow="hidden",q.position="absolute",q.top="0px",q.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),g.tabIndex!==""&&(this.canvas.tabIndex=g.tabIndex===void 0?0:g.tabIndex),this.container.className="openseadragon-container",function(q){q.width="100%",q.height="100%",q.position="relative",q.overflow="hidden",q.left="0px",q.top="0px",q.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:t.delegate(this,X),keyHandler:t.delegate(this,oe),clickHandler:t.delegate(this,v),dblClickHandler:t.delegate(this,B),dragHandler:t.delegate(this,U),dragEndHandler:t.delegate(this,j),enterHandler:t.delegate(this,Y),exitHandler:t.delegate(this,K),pressHandler:t.delegate(this,ae),releaseHandler:t.delegate(this,ie),nonPrimaryPressHandler:t.delegate(this,ge),nonPrimaryReleaseHandler:t.delegate(this,ye),scrollHandler:t.delegate(this,be),pinchHandler:t.delegate(this,ve)}),this.outerTracker=new t.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,we),exitHandler:t.delegate(this,ke)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),s[this.hash].prevContainerSize=a(this.container),this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(q){M.source=M.world.getItemAt(0).source,s[M.hash].forceRedraw=!0,M._updateRequestId||(M._updateRequestId=c(M,De))}),this.world.addHandler("remove-item",function(q){M.world.getItemCount()?M.source=M.world.getItemAt(0).source:M.source=null,s[M.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(q){M.viewport&&M.viewport._setContentBounds(M.world.getHomeBounds(),M.world.getContentFactor())}),this.world.addHandler("item-index-change",function(q){M.source=M.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:s[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:g.timeout}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(V=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(V,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(V=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(V,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new t.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),V=0;V<this.customControls.length;V++)this.addControl(this.customControls[V].id,{anchor:this.customControls[V].anchor});t.requestAnimationFrame(function(){b(M)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(g){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(g)},openTileSource:function(g){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(g)},open:function(g,C){var M=this;if(this.close(),!!g){if(this.sequenceMode&&t.isArray(g)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof C<"u"&&!isNaN(C)&&(this.initialPage=C),this.tileSources=g,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(t.isArray(g)||(g=[g]),!!g.length){this._opening=!0;for(var V=g.length,q=0,de=0,Q,Pe=function(){if(q+de===V)if(q){(M._firstOpen||!M.preserveViewport)&&(M.viewport.goHome(!0),M.viewport.update()),M._firstOpen=!1;var Ee=g[0];if(Ee.tileSource&&(Ee=Ee.tileSource),M.overlays&&!M.preserveOverlays)for(var Ue=0;Ue<M.overlays.length;Ue++)M.currentOverlays[Ue]=h(M,M.overlays[Ue]);M._drawOverlays(),M._opening=!1,M.raiseEvent("open",{source:Ee})}else M._opening=!1,M.raiseEvent("open-failed",Q)},Ve=function(Ee){(!t.isPlainObject(Ee)||!Ee.tileSource)&&(Ee={tileSource:Ee}),Ee.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Ee.index),Ee.collectionImmediately===void 0&&(Ee.collectionImmediately=!0);var Ue=Ee.success;Ee.success=function(qe){if(q++,Ee.tileSource.overlays)for(var Ye=0;Ye<Ee.tileSource.overlays.length;Ye++)M.addOverlay(Ee.tileSource.overlays[Ye]);Ue&&Ue(qe),Pe()};var Ae=Ee.error;Ee.error=function(qe){de++,Q||(Q=qe),Ae&&Ae(qe),Pe()},M.addTiledImage(Ee)},Ne=0;Ne<g.length;Ne++)Ve(g[Ne]);return this}}},close:function(){return s[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),s[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(s[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),s[this.hash]=null,delete s[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(g){return this.innerTracker.setTracking(g),this.outerTracker.setTracking(g),this.raiseEvent("mouse-enabled",{enabled:g}),this},areControlsEnabled:function(){var g=this.controls.length,C;for(C=0;C<this.controls.length;C++)g=g&&this.controls[C].isVisible();return g},setControlsEnabled:function(g){return g?L(this):b(this),this.raiseEvent("controls-enabled",{enabled:g}),this},setDebugMode:function(g){for(var C=0;C<this.world.getItemCount();C++)this.world.getItemAt(C).debugMode=g;this.debugMode=g,this.forceRedraw()},isFullPage:function(){return s[this.hash].fullPage},setFullPage:function(g){var C=document.body,M=C.style,V=document.documentElement.style,q=this,de,Q;if(g==this.isFullPage())return this;var Pe={fullPage:g,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",Pe),Pe.preventDefaultAction)return this;if(g){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=M.margin,this.docMargin=V.margin,M.margin="0",V.margin="0",this.bodyPadding=M.padding,this.docPadding=V.padding,M.padding="0",V.padding="0",this.bodyWidth=M.width,this.docWidth=V.width,M.width="100%",V.width="100%",this.bodyHeight=M.height,this.docHeight=V.height,M.height="100%",V.height="100%",this.previousBody=[],s[this.hash].prevElementParent=this.element.parentNode,s[this.hash].prevNextSibling=this.element.nextSibling,s[this.hash].prevElementWidth=this.element.style.width,s[this.hash].prevElementHeight=this.element.style.height,de=C.childNodes.length,Q=0;Q<de;Q++)this.previousBody.push(C.childNodes[0]),C.removeChild(C.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,C.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),C.appendChild(this.element),this.element.style.height=t.getWindowSize().y+"px",this.element.style.width=t.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),s[this.hash].fullPage=!0,t.delegate(this,we)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,M.margin=this.bodyMargin,V.margin=this.docMargin,M.padding=this.bodyPadding,V.padding=this.docPadding,M.width=this.bodyWidth,V.width=this.docWidth,M.height=this.bodyHeight,V.height=this.docHeight,C.removeChild(this.element),de=this.previousBody.length,Q=0;Q<de;Q++)C.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),s[this.hash].prevElementParent.insertBefore(this.element,s[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(C.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=s[this.hash].prevElementWidth,this.element.style.height=s[this.hash].prevElementHeight;var Ve=0,Ne=function(){t.setPageScroll(q.pageScroll);var Ee=t.getPageScroll();Ve++,Ve<10&&(Ee.x!==q.pageScroll.x||Ee.y!==q.pageScroll.y)&&t.requestAnimationFrame(Ne)};t.requestAnimationFrame(Ne),s[this.hash].fullPage=!1,t.delegate(this,ke)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:g}),this},setFullScreen:function(g){var C=this;if(!t.supportsFullScreen)return this.setFullPage(g);if(t.isFullScreen()===g)return this;var M={fullScreen:g,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",M),M.preventDefaultAction)return this;if(g){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var V=function(){var q=t.isFullScreen();q||(t.removeEvent(document,t.fullScreenEventName,V),t.removeEvent(document,t.fullScreenErrorEventName,V),C.setFullPage(!1),C.isFullPage()&&(C.element.style.width=C.fullPageStyleWidth,C.element.style.height=C.fullPageStyleHeight)),C.navigator&&C.viewport&&setTimeout(function(){C.navigator.update(C.viewport)}),C.raiseEvent("full-screen",{fullScreen:q})};t.addEvent(document,t.fullScreenEventName,V),t.addEvent(document,t.fullScreenErrorEventName,V),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(g){return this.container.style.visibility=g?"":"hidden",this.raiseEvent("visible",{visible:g}),this},addTiledImage:function(g){t.console.assert(g,"[Viewer.addTiledImage] options is required"),t.console.assert(g.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!g.replace||g.index>-1&&g.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var C=this;g.replace&&(g.replaceItem=C.world.getItemAt(g.index)),this._hideMessage(),g.placeholderFillStyle===void 0&&(g.placeholderFillStyle=this.placeholderFillStyle),g.opacity===void 0&&(g.opacity=this.opacity),g.preload===void 0&&(g.preload=this.preload),g.compositeOperation===void 0&&(g.compositeOperation=this.compositeOperation),g.crossOriginPolicy===void 0&&(g.crossOriginPolicy=g.tileSource.crossOriginPolicy!==void 0?g.tileSource.crossOriginPolicy:this.crossOriginPolicy),g.ajaxWithCredentials===void 0&&(g.ajaxWithCredentials=this.ajaxWithCredentials),g.loadTilesWithAjax===void 0&&(g.loadTilesWithAjax=this.loadTilesWithAjax),g.ajaxHeaders===void 0||g.ajaxHeaders===null?g.ajaxHeaders=this.ajaxHeaders:t.isPlainObject(g.ajaxHeaders)&&t.isPlainObject(this.ajaxHeaders)&&(g.ajaxHeaders=t.extend({},this.ajaxHeaders,g.ajaxHeaders));var M={options:g};function V(Q){for(var Pe=0;Pe<C._loadQueue.length;Pe++)if(C._loadQueue[Pe]===M){C._loadQueue.splice(Pe,1);break}C._loadQueue.length===0&&q(M),C.raiseEvent("add-item-failed",Q),g.error&&g.error(Q)}function q(Q){C.collectionMode&&(C.world.arrange({immediately:Q.options.collectionImmediately,rows:C.collectionRows,columns:C.collectionColumns,layout:C.collectionLayout,tileSize:C.collectionTileSize,tileMargin:C.collectionTileMargin}),C.world.setAutoRefigureSizes(!0))}if(t.isArray(g.tileSource)){setTimeout(function(){V({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:g.tileSource,options:g})});return}this._loadQueue.push(M);function de(){for(var Q,Pe,Ve;C._loadQueue.length&&(Q=C._loadQueue[0],!!Q.tileSource);){if(C._loadQueue.splice(0,1),Q.options.replace){var Ne=C.world.getIndexOfItem(Q.options.replaceItem);Ne!=-1&&(Q.options.index=Ne),C.world.removeItem(Q.options.replaceItem)}Pe=new t.TiledImage({viewer:C,source:Q.tileSource,viewport:C.viewport,drawer:C.drawer,tileCache:C.tileCache,imageLoader:C.imageLoader,x:Q.options.x,y:Q.options.y,width:Q.options.width,height:Q.options.height,fitBounds:Q.options.fitBounds,fitBoundsPlacement:Q.options.fitBoundsPlacement,clip:Q.options.clip,placeholderFillStyle:Q.options.placeholderFillStyle,opacity:Q.options.opacity,preload:Q.options.preload,degrees:Q.options.degrees,compositeOperation:Q.options.compositeOperation,springStiffness:C.springStiffness,animationTime:C.animationTime,minZoomImageRatio:C.minZoomImageRatio,wrapHorizontal:C.wrapHorizontal,wrapVertical:C.wrapVertical,immediateRender:C.immediateRender,blendTime:C.blendTime,alwaysBlend:C.alwaysBlend,minPixelRatio:C.minPixelRatio,smoothTileEdgesMinZoom:C.smoothTileEdgesMinZoom,iOSDevice:C.iOSDevice,crossOriginPolicy:Q.options.crossOriginPolicy,ajaxWithCredentials:Q.options.ajaxWithCredentials,loadTilesWithAjax:Q.options.loadTilesWithAjax,ajaxHeaders:Q.options.ajaxHeaders,debugMode:C.debugMode}),C.collectionMode&&C.world.setAutoRefigureSizes(!1),C.world.addItem(Pe,{index:Q.options.index}),C._loadQueue.length===0&&q(Q),C.world.getItemCount()===1&&!C.preserveViewport&&C.viewport.goHome(!0),C.navigator&&(Ve=t.extend({},Q.options,{replace:!1,originalTiledImage:Pe,tileSource:Q.tileSource}),C.navigator.addTiledImage(Ve)),Q.options.success&&Q.options.success({item:Pe})}}l(this,g.tileSource,g,function(Q){M.tileSource=Q,de()},function(Q){Q.options=g,V(Q),de()})},addSimpleImage:function(g){t.console.assert(g,"[Viewer.addSimpleImage] options is required"),t.console.assert(g.url,"[Viewer.addSimpleImage] options.url is required");var C=t.extend({},g,{tileSource:{type:"image",url:g.url}});delete C.url,this.addTiledImage(C)},addLayer:function(g){var C=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var M=t.extend({},g,{success:function(V){C.raiseEvent("add-layer",{options:g,drawer:V.item})},error:function(V){C.raiseEvent("add-layer-failed",V)}});return this.addTiledImage(M),this},getLayerAtLevel:function(g){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(g)},getLevelOfLayer:function(g){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(g)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(g,C){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(g,C)},removeLayer:function(g){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(g)},forceRedraw:function(){return s[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var g=t.delegate(this,z),C=t.delegate(this,Z),M=t.delegate(this,ut),V=t.delegate(this,ct),q=this.navImages,de=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(de=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:ce(this.prefixUrl,q.previous.REST),srcGroup:ce(this.prefixUrl,q.previous.GROUP),srcHover:ce(this.prefixUrl,q.previous.HOVER),srcDown:ce(this.prefixUrl,q.previous.DOWN),onRelease:V,onFocus:g,onBlur:C}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:ce(this.prefixUrl,q.next.REST),srcGroup:ce(this.prefixUrl,q.next.GROUP),srcHover:ce(this.prefixUrl,q.next.HOVER),srcDown:ce(this.prefixUrl,q.next.DOWN),onRelease:M,onFocus:g,onBlur:C}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),de&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var g=t.delegate(this,je),C=t.delegate(this,st),M=t.delegate(this,Ke),V=t.delegate(this,Ze),q=t.delegate(this,ot),de=t.delegate(this,lt),Q=t.delegate(this,it),Pe=t.delegate(this,Je),Ve=t.delegate(this,ht),Ne=t.delegate(this,nt),Ee=t.delegate(this,z),Ue=t.delegate(this,Z),Ae=this.navImages,qe=[],Ye=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Ye=!1),this.showZoomControl&&(qe.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:ce(this.prefixUrl,Ae.zoomIn.REST),srcGroup:ce(this.prefixUrl,Ae.zoomIn.GROUP),srcHover:ce(this.prefixUrl,Ae.zoomIn.HOVER),srcDown:ce(this.prefixUrl,Ae.zoomIn.DOWN),onPress:g,onRelease:C,onClick:M,onEnter:g,onExit:C,onFocus:Ee,onBlur:Ue})),qe.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:ce(this.prefixUrl,Ae.zoomOut.REST),srcGroup:ce(this.prefixUrl,Ae.zoomOut.GROUP),srcHover:ce(this.prefixUrl,Ae.zoomOut.HOVER),srcDown:ce(this.prefixUrl,Ae.zoomOut.DOWN),onPress:V,onRelease:C,onClick:q,onEnter:V,onExit:C,onFocus:Ee,onBlur:Ue}))),this.showHomeControl&&qe.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:ce(this.prefixUrl,Ae.home.REST),srcGroup:ce(this.prefixUrl,Ae.home.GROUP),srcHover:ce(this.prefixUrl,Ae.home.HOVER),srcDown:ce(this.prefixUrl,Ae.home.DOWN),onRelease:de,onFocus:Ee,onBlur:Ue})),this.showFullPageControl&&qe.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:ce(this.prefixUrl,Ae.fullpage.REST),srcGroup:ce(this.prefixUrl,Ae.fullpage.GROUP),srcHover:ce(this.prefixUrl,Ae.fullpage.HOVER),srcDown:ce(this.prefixUrl,Ae.fullpage.DOWN),onRelease:Q,onFocus:Ee,onBlur:Ue})),this.showRotationControl&&(qe.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:ce(this.prefixUrl,Ae.rotateleft.REST),srcGroup:ce(this.prefixUrl,Ae.rotateleft.GROUP),srcHover:ce(this.prefixUrl,Ae.rotateleft.HOVER),srcDown:ce(this.prefixUrl,Ae.rotateleft.DOWN),onRelease:Pe,onFocus:Ee,onBlur:Ue})),qe.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:ce(this.prefixUrl,Ae.rotateright.REST),srcGroup:ce(this.prefixUrl,Ae.rotateright.GROUP),srcHover:ce(this.prefixUrl,Ae.rotateright.HOVER),srcDown:ce(this.prefixUrl,Ae.rotateright.DOWN),onRelease:Ve,onFocus:Ee,onBlur:Ue}))),this.showFlipControl&&qe.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:ce(this.prefixUrl,Ae.flip.REST),srcGroup:ce(this.prefixUrl,Ae.flip.GROUP),srcHover:ce(this.prefixUrl,Ae.flip.HOVER),srcDown:ce(this.prefixUrl,Ae.flip.DOWN),onRelease:Ne,onFocus:Ee,onBlur:Ue})),Ye&&(this.buttons=new t.ButtonGroup({buttons:qe,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",t.delegate(this,rt)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(g){return this.tileSources&&g>=0&&g<this.tileSources.length&&(this._sequenceIndex=g,this._updateSequenceButtons(g),this.open(this.tileSources[g]),this.referenceStrip&&this.referenceStrip.setFocus(g),this.raiseEvent("page",{page:g})),this},addOverlay:function(g,C,M,V){var q;if(t.isPlainObject(g)?q=g:q={element:g,location:C,placement:M,onDraw:V},g=t.getElement(q.element),u(this.currentOverlays,g)>=0)return this;var de=h(this,q);return this.currentOverlays.push(de),de.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:g,location:q.location,placement:q.placement}),this},updateOverlay:function(g,C,M){var V;return g=t.getElement(g),V=u(this.currentOverlays,g),V>=0&&(this.currentOverlays[V].update(C,M),s[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:g,location:C,placement:M})),this},removeOverlay:function(g){var C;return g=t.getElement(g),C=u(this.currentOverlays,g),C>=0&&(this.currentOverlays[C].destroy(),this.currentOverlays.splice(C,1),s[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:g})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return s[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(g){var C;return g=t.getElement(g),C=u(this.currentOverlays,g),C>=0?this.currentOverlays[C]:null},_updateSequenceButtons:function(g){this.nextButton&&(!this.tileSources||this.tileSources.length-1===g?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(g>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(g){this._hideMessage();var C=t.makeNeutralElement("div");C.appendChild(document.createTextNode(g)),this.messageDiv=t.makeCenteredNode(C),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var g=this.messageDiv;g&&(g.parentNode.removeChild(g),delete this.messageDiv)},gestureSettingsByDeviceType:function(g){switch(g){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var g,C=this.currentOverlays.length;for(g=0;g<C;g++)this.currentOverlays[g].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function a(g){return g=t.getElement(g),new t.Point(g.clientWidth===0?1:g.clientWidth,g.clientHeight===0?1:g.clientHeight)}function l(g,C,M,V,q){var de=g;if(t.type(C)=="string"){if(C.match(/^\s*<.*>\s*$/))C=t.parseXml(C);else if(C.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var Q=t.parseJSON(C);C=Q}catch{}}function Pe(Ve,Ne){Ve.ready?V(Ve):(Ve.addHandler("ready",function(){V(Ve)}),Ve.addHandler("open-failed",function(Ee){q({message:Ee.message,source:Ne})}))}setTimeout(function(){if(t.type(C)=="string")C=new t.TileSource({url:C,crossOriginPolicy:M.crossOriginPolicy!==void 0?M.crossOriginPolicy:g.crossOriginPolicy,ajaxWithCredentials:g.ajaxWithCredentials,ajaxHeaders:g.ajaxHeaders,useCanvas:g.useCanvas,success:function(Ue){V(Ue.tileSource)}}),C.addHandler("open-failed",function(Ue){q(Ue)});else if(t.isPlainObject(C)||C.nodeType)if(C.crossOriginPolicy===void 0&&(M.crossOriginPolicy!==void 0||g.crossOriginPolicy!==void 0)&&(C.crossOriginPolicy=M.crossOriginPolicy!==void 0?M.crossOriginPolicy:g.crossOriginPolicy),C.ajaxWithCredentials===void 0&&(C.ajaxWithCredentials=g.ajaxWithCredentials),C.useCanvas===void 0&&(C.useCanvas=g.useCanvas),t.isFunction(C.getTileUrl)){var Ve=new t.TileSource(C);Ve.getTileUrl=C.getTileUrl,V(Ve)}else{var Ne=t.TileSource.determineType(de,C);if(!Ne){q({message:"Unable to load TileSource",source:C});return}var Ee=Ne.prototype.configure.apply(de,[C]);Pe(new Ne(Ee),C)}else Pe(C,C)})}function h(g,C){if(C instanceof t.Overlay)return C;var M=null;if(C.element)M=t.getElement(C.element);else{var V=C.id?C.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);M=t.getElement(C.id),M||(M=document.createElement("a"),M.href="#/overlay/"+V),M.id=V,t.addClass(M,C.className?C.className:"openseadragon-overlay")}var q=C.location,de=C.width,Q=C.height;if(!q){var Pe=C.x,Ve=C.y;if(C.px!==void 0){var Ne=g.viewport.imageToViewportRectangle(new t.Rect(C.px,C.py,de||0,Q||0));Pe=Ne.x,Ve=Ne.y,de=de!==void 0?Ne.width:void 0,Q=Q!==void 0?Ne.height:void 0}q=new t.Point(Pe,Ve)}var Ee=C.placement;return Ee&&t.type(Ee)==="string"&&(Ee=t.Placement[C.placement.toUpperCase()]),new t.Overlay({element:M,location:q,placement:Ee,onDraw:C.onDraw,checkResize:C.checkResize,width:de,height:Q,rotationMode:C.rotationMode})}function u(g,C){var M;for(M=g.length-1;M>=0;M--)if(g[M].element===C)return M;return-1}function c(g,C){return t.requestAnimationFrame(function(){C(g)})}function R(g){t.requestAnimationFrame(function(){_(g)})}function b(g){!g.autoHideControls||(g.controlsShouldFade=!0,g.controlsFadeBeginTime=t.now()+g.controlsFadeDelay,window.setTimeout(function(){R(g)},g.controlsFadeDelay))}function _(g){var C,M,V,q;if(g.controlsShouldFade){for(C=t.now(),M=C-g.controlsFadeBeginTime,V=1-M/g.controlsFadeLength,V=Math.min(1,V),V=Math.max(0,V),q=g.controls.length-1;q>=0;q--)g.controls[q].autoFade&&g.controls[q].setOpacity(V);V>0&&R(g)}}function L(g){var C;for(g.controlsShouldFade=!1,C=g.controls.length-1;C>=0;C--)g.controls[C].setOpacity(1)}function z(){L(this)}function Z(){b(this)}function X(g){var C={originalEvent:g.originalEvent,preventDefaultAction:g.preventDefaultAction,preventVerticalPan:g.preventVerticalPan,preventHorizontalPan:g.preventHorizontalPan};if(this.raiseEvent("canvas-key",C),!C.preventDefaultAction&&!g.ctrl&&!g.alt&&!g.meta)switch(g.keyCode){case 38:return C.preventVerticalPan||(g.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return C.preventVerticalPan||(g.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return C.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return C.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function oe(g){var C={originalEvent:g.originalEvent,preventDefaultAction:g.preventDefaultAction,preventVerticalPan:g.preventVerticalPan,preventHorizontalPan:g.preventHorizontalPan};if(this.raiseEvent("canvas-key",C),!C.preventDefaultAction&&!g.ctrl&&!g.alt&&!g.meta)switch(g.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return C.preventVerticalPan||(g.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return C.preventVerticalPan||(g.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return C.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return C.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(t.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(t.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(t.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(t.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function v(g){var C,M=document.activeElement==this.canvas;M||this.canvas.focus(),this.viewport.flipped&&(g.position.x=this.viewport.getContainerSize().x-g.position.x);var V={tracker:g.eventSource,position:g.position,quick:g.quick,shift:g.shift,originalEvent:g.originalEvent,preventDefaultAction:g.preventDefaultAction};this.raiseEvent("canvas-click",V),!V.preventDefaultAction&&this.viewport&&g.quick&&(C=this.gestureSettingsByDeviceType(g.pointerType),C.clickToZoom&&(this.viewport.zoomBy(g.shift?1/this.zoomPerClick:this.zoomPerClick,C.zoomToRefPoint?this.viewport.pointFromPixel(g.position,!0):null),this.viewport.applyConstraints()))}function B(g){var C,M={tracker:g.eventSource,position:g.position,shift:g.shift,originalEvent:g.originalEvent,preventDefaultAction:g.preventDefaultAction};this.raiseEvent("canvas-double-click",M),!M.preventDefaultAction&&this.viewport&&(C=this.gestureSettingsByDeviceType(g.pointerType),C.dblClickToZoom&&(this.viewport.zoomBy(g.shift?1/this.zoomPerClick:this.zoomPerClick,C.zoomToRefPoint?this.viewport.pointFromPixel(g.position,!0):null),this.viewport.applyConstraints()))}function U(g){var C,M={tracker:g.eventSource,position:g.position,delta:g.delta,speed:g.speed,direction:g.direction,shift:g.shift,originalEvent:g.originalEvent,preventDefaultAction:g.preventDefaultAction};if(this.raiseEvent("canvas-drag",M),!M.preventDefaultAction&&this.viewport){if(C=this.gestureSettingsByDeviceType(g.pointerType),this.panHorizontal||(g.delta.x=0),this.panVertical||(g.delta.y=0),this.viewport.flipped&&(g.delta.x=-g.delta.x),this.constrainDuringPan){var V=this.viewport.deltaPointsFromPixels(g.delta.negate());this.viewport.centerSpringX.target.value+=V.x,this.viewport.centerSpringY.target.value+=V.y;var q=this.viewport.getBounds(),de=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=V.x,this.viewport.centerSpringY.target.value-=V.y,q.x!=de.x&&(g.delta.x=0),q.y!=de.y&&(g.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(g.delta.negate()),C.flickEnabled&&!this.constrainDuringPan)}}function j(g){if(!g.preventDefaultAction&&this.viewport){var C=this.gestureSettingsByDeviceType(g.pointerType);if(C.flickEnabled&&g.speed>=C.flickMinSpeed){var M=0;this.panHorizontal&&(M=C.flickMomentum*g.speed*Math.cos(g.direction));var V=0;this.panVertical&&(V=C.flickMomentum*g.speed*Math.sin(g.direction));var q=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),de=this.viewport.pointFromPixel(new t.Point(q.x-M,q.y-V));this.viewport.panTo(de,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:g.eventSource,position:g.position,speed:g.speed,direction:g.direction,shift:g.shift,originalEvent:g.originalEvent})}function Y(g){this.raiseEvent("canvas-enter",{tracker:g.eventSource,pointerType:g.pointerType,position:g.position,buttons:g.buttons,pointers:g.pointers,insideElementPressed:g.insideElementPressed,buttonDownAny:g.buttonDownAny,originalEvent:g.originalEvent})}function K(g){window.location!=window.parent.location&&t.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:g.eventSource,pointerType:g.pointerType,position:g.position,buttons:g.buttons,pointers:g.pointers,insideElementPressed:g.insideElementPressed,buttonDownAny:g.buttonDownAny,originalEvent:g.originalEvent})}function ae(g){this.raiseEvent("canvas-press",{tracker:g.eventSource,pointerType:g.pointerType,position:g.position,insideElementPressed:g.insideElementPressed,insideElementReleased:g.insideElementReleased,originalEvent:g.originalEvent})}function ie(g){this.raiseEvent("canvas-release",{tracker:g.eventSource,pointerType:g.pointerType,position:g.position,insideElementPressed:g.insideElementPressed,insideElementReleased:g.insideElementReleased,originalEvent:g.originalEvent})}function ge(g){this.raiseEvent("canvas-nonprimary-press",{tracker:g.eventSource,position:g.position,pointerType:g.pointerType,button:g.button,buttons:g.buttons,originalEvent:g.originalEvent})}function ye(g){this.raiseEvent("canvas-nonprimary-release",{tracker:g.eventSource,position:g.position,pointerType:g.pointerType,button:g.button,buttons:g.buttons,originalEvent:g.originalEvent})}function ve(g){var C,M,V,q;if(!g.preventDefaultAction&&this.viewport&&(C=this.gestureSettingsByDeviceType(g.pointerType),C.pinchToZoom&&(M=this.viewport.pointFromPixel(g.center,!0),V=this.viewport.pointFromPixel(g.lastCenter,!0),q=V.minus(M),this.panHorizontal||(q.x=0),this.panVertical||(q.y=0),this.viewport.zoomBy(g.distance/g.lastDistance,M,!0),C.zoomToRefPoint&&this.viewport.panBy(q,!0),this.viewport.applyConstraints()),C.pinchRotate)){var de=Math.atan2(g.gesturePoints[0].currentPos.y-g.gesturePoints[1].currentPos.y,g.gesturePoints[0].currentPos.x-g.gesturePoints[1].currentPos.x),Q=Math.atan2(g.gesturePoints[0].lastPos.y-g.gesturePoints[1].lastPos.y,g.gesturePoints[0].lastPos.x-g.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(de-Q)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:g.eventSource,gesturePoints:g.gesturePoints,lastCenter:g.lastCenter,center:g.center,lastDistance:g.lastDistance,distance:g.distance,shift:g.shift,originalEvent:g.originalEvent}),!1}function be(g){var C,M,V,q;if(V=t.now(),q=V-this._lastScrollTime,q>this.minScrollDeltaTime){if(this._lastScrollTime=V,this.viewport.flipped&&(g.position.x=this.viewport.getContainerSize().x-g.position.x),!g.preventDefaultAction&&this.viewport&&(C=this.gestureSettingsByDeviceType(g.pointerType),C.scrollToZoom&&(M=Math.pow(this.zoomPerScroll,g.scroll),this.viewport.zoomBy(M,C.zoomToRefPoint?this.viewport.pointFromPixel(g.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:g.eventSource,position:g.position,scroll:g.scroll,shift:g.shift,originalEvent:g.originalEvent}),C&&C.scrollToZoom)return!1}else if(C=this.gestureSettingsByDeviceType(g.pointerType),C&&C.scrollToZoom)return!1}function we(g){s[this.hash].mouseInside=!0,L(this),this.raiseEvent("container-enter",{tracker:g.eventSource,position:g.position,buttons:g.buttons,pointers:g.pointers,insideElementPressed:g.insideElementPressed,buttonDownAny:g.buttonDownAny,originalEvent:g.originalEvent})}function ke(g){g.pointers<1&&(s[this.hash].mouseInside=!1,s[this.hash].animating||b(this)),this.raiseEvent("container-exit",{tracker:g.eventSource,position:g.position,buttons:g.buttons,pointers:g.pointers,insideElementPressed:g.insideElementPressed,buttonDownAny:g.buttonDownAny,originalEvent:g.originalEvent})}function De(g){Fe(g),g.isOpen()?g._updateRequestId=c(g,De):g._updateRequestId=!1}function Fe(g){if(!g._opening){if(g.autoResize){var C=a(g.container),M=s[g.hash].prevContainerSize;if(!C.equals(M)){var V=g.viewport;if(g.preserveImageSizeOnResize){var q=M.x/C.x,de=V.getZoom()*q,Q=V.getCenter();V.resize(C,!1),V.zoomTo(de,null,!0),V.panTo(Q,!0)}else{var Pe=V.getBounds();V.resize(C,!0),V.fitBoundsWithConstraints(Pe,!0)}s[g.hash].prevContainerSize=C,s[g.hash].forceRedraw=!0}}var Ve=g.viewport.update(),Ne=g.world.update()||Ve;Ve&&g.raiseEvent("viewport-change"),g.referenceStrip&&(Ne=g.referenceStrip.update(g.viewport)||Ne),!s[g.hash].animating&&Ne&&(g.raiseEvent("animation-start"),L(g)),(Ne||s[g.hash].forceRedraw||g.world.needsDraw())&&(ze(g),g._drawOverlays(),g.navigator&&g.navigator.update(g.viewport),s[g.hash].forceRedraw=!1,Ne&&g.raiseEvent("animation")),s[g.hash].animating&&!Ne&&(g.raiseEvent("animation-finish"),s[g.hash].mouseInside||b(g)),s[g.hash].animating=Ne}}function ze(g){g.imageLoader.clear(),g.drawer.clear(),g.world.draw(),g.raiseEvent("update-viewport",{})}function ce(g,C){return g?g+C:C}function je(){s[this.hash].lastZoomTime=t.now(),s[this.hash].zoomFactor=this.zoomPerSecond,s[this.hash].zooming=!0,Xe(this)}function Ze(){s[this.hash].lastZoomTime=t.now(),s[this.hash].zoomFactor=1/this.zoomPerSecond,s[this.hash].zooming=!0,Xe(this)}function st(){s[this.hash].zooming=!1}function Xe(g){t.requestAnimationFrame(t.delegate(g,Qe))}function Qe(){var g,C,M;s[this.hash].zooming&&this.viewport&&(g=t.now(),C=g-s[this.hash].lastZoomTime,M=Math.pow(s[this.hash].zoomFactor,C/1e3),this.viewport.zoomBy(M),this.viewport.applyConstraints(),s[this.hash].lastZoomTime=g,Xe(this))}function Ke(){this.viewport&&(s[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function ot(){this.viewport&&(s[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function rt(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function lt(){this.viewport&&this.viewport.goHome()}function it(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Je(){if(this.viewport){var g=this.viewport.getRotation();this.viewport.flipped?g=t.positiveModulo(g+this.rotationIncrement,360):g=t.positiveModulo(g-this.rotationIncrement,360),this.viewport.setRotation(g)}}function ht(){if(this.viewport){var g=this.viewport.getRotation();this.viewport.flipped?g=t.positiveModulo(g-this.rotationIncrement,360):g=t.positiveModulo(g+this.rotationIncrement,360),this.viewport.setRotation(g)}}function nt(){this.viewport.toggleFlip()}function ct(){var g=this._sequenceIndex-1;this.navPrevNextWrap&&g<0&&(g+=this.tileSources.length),this.goToPage(g)}function ut(){var g=this._sequenceIndex+1;this.navPrevNextWrap&&g>=this.tileSources.length&&(g=0),this.goToPage(g)}}(OpenSeadragon),function(t){t.Navigator=function(c){var R=c.viewer,b=this,_,L;c.id?(this.element=document.getElementById(c.id),c.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(c.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),c.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:c.autoFade},c.position&&(c.position=="BOTTOM_RIGHT"?c.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:c.position=="BOTTOM_LEFT"?c.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:c.position=="TOP_RIGHT"?c.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:c.position=="TOP_LEFT"?c.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:c.position=="ABSOLUTE"&&(c.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,c.controlOptions.top=c.top,c.controlOptions.left=c.left,c.controlOptions.height=c.height,c.controlOptions.width=c.width))),this.element.id=c.id,this.element.className+=" navigator",c=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},c,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:c.autoResize,minZoomImageRatio:1,background:c.background,opacity:c.opacity,borderColor:c.borderColor,displayRegionColor:c.displayRegionColor}),c.minPixelRatio=this.minPixelRatio=R.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),c.controlOptions.anchor!=t.ControlAnchor.NONE&&function(X,oe){X.margin="0px",X.border=oe+"px solid "+c.borderColor,X.padding="0px",X.background=c.background,X.opacity=c.opacity,X.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(X,oe){X.position="relative",X.top="0px",X.left="0px",X.fontSize="0px",X.overflow="hidden",X.border=oe+"px solid "+c.displayRegionColor,X.margin="0px",X.padding="0px",X.background="transparent",X.float="left",X.cssFloat="left",X.styleFloat="left",X.zIndex=999999999,X.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",R.addControl(this.element,c.controlOptions),this._resizeWithViewer=c.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&c.controlOptions.anchor!=t.ControlAnchor.NONE,c.width&&c.height?(this.setWidth(c.width),this.setHeight(c.height)):this._resizeWithViewer&&(_=t.getElementSize(R.element),this.element.style.height=Math.round(_.y*c.sizeRatio)+"px",this.element.style.width=Math.round(_.x*c.sizeRatio)+"px",this.oldViewerSize=_,L=t.getElementSize(this.element),this.elementArea=L.x*L.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[c]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function z(X){h(b.displayRegionContainer,X),h(b.displayRegion,-X),b.viewport.setRotation(X)}if(c.navigatorRotate){var Z=c.viewer.viewport?c.viewer.viewport.getRotation():c.viewer.degrees||0;z(Z),c.viewer.addHandler("rotate",function(X){z(X.degrees)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,r),clickHandler:t.delegate(this,s),releaseHandler:t.delegate(this,a),scrollHandler:t.delegate(this,l)}),this.addHandler("reset-size",function(){b.viewport&&b.viewport.goHome(!0)}),R.world.addHandler("item-index-change",function(X){window.setTimeout(function(){var oe=b.world.getItemAt(X.previousIndex);b.world.setItemIndex(oe,X.newIndex)},1)}),R.world.addHandler("remove-item",function(X){var oe=X.item,v=b._getMatchingItem(oe);v&&b.world.removeItem(v)}),this.update(R.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var c=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);c.equals(this.oldContainerSize)||(this.viewport.resize(c,!0),this.viewport.goHome(!0),this.oldContainerSize=c,this.drawer.clear(),this.world.draw())}},setWidth:function(c){this.width=c,this.element.style.width=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1},setHeight:function(c){this.height=c,this.element.style.height=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1},setFlip:function(c){return this.viewport.setFlip(c),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(c){u(this.displayRegion,c),u(this.canvas,c),u(this.element,c)},update:function(c){var R,b,_,L,z,Z;if(R=t.getElementSize(this.viewer.element),this._resizeWithViewer&&R.x&&R.y&&!R.equals(this.oldViewerSize)&&(this.oldViewerSize=R,this.maintainSizeRatio||!this.elementArea?(b=R.x*this.sizeRatio,_=R.y*this.sizeRatio):(b=Math.sqrt(this.elementArea*(R.x/R.y)),_=this.elementArea/b),this.element.style.width=Math.round(b)+"px",this.element.style.height=Math.round(_)+"px",this.elementArea||(this.elementArea=b*_),this.updateSize()),c&&this.viewport){L=c.getBoundsNoRotate(!0),z=this.viewport.pixelFromPointNoRotate(L.getTopLeft(),!1),Z=this.viewport.pixelFromPointNoRotate(L.getBottomRight(),!1).minus(this.totalBorderWidths);var X=this.displayRegion.style;X.display=this.world.getItemCount()?"block":"none",X.top=Math.round(z.y)+"px",X.left=Math.round(z.x)+"px";var oe=Math.abs(z.x-Z.x),v=Math.abs(z.y-Z.y);X.width=Math.round(Math.max(oe,0))+"px",X.height=Math.round(Math.max(v,0))+"px"}},addTiledImage:function(c){var R=this,b=c.originalTiledImage;delete c.original;var _=t.extend({},c,{success:function(L){var z=L.item;z._originalForNavigator=b,R._matchBounds(z,b,!0);function Z(){R._matchBounds(z,b)}function X(){R._matchOpacity(z,b)}function oe(){R._matchCompositeOperation(z,b)}b.addHandler("bounds-change",Z),b.addHandler("clip-change",Z),b.addHandler("opacity-change",X),b.addHandler("composite-operation-change",oe)}});return t.Viewer.prototype.addTiledImage.apply(this,[_])},_getMatchingItem:function(c){for(var R=this.world.getItemCount(),b,_=0;_<R;_++)if(b=this.world.getItemAt(_),b._originalForNavigator===c)return b;return null},_matchBounds:function(c,R,b){var _=R.getBoundsNoRotate();c.setPosition(_.getTopLeft(),b),c.setWidth(_.width,b),c.setRotation(R.getRotation(),b),c.setClip(R.getClip())},_matchOpacity:function(c,R){c.setOpacity(R.opacity)},_matchCompositeOperation:function(c,R){c.setCompositeOperation(R.compositeOperation)}});function s(c){var R={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:c.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",R),!R.preventDefaultAction&&c.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var b=this.viewport.pointFromPixel(c.position);this.panVertical?this.panHorizontal||(b.x=this.viewer.viewport.getCenter(!0).x):b.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(b),this.viewer.viewport.applyConstraints()}}function r(c){var R={tracker:c.eventSource,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:c.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",R),!R.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewer.viewport.flipped&&(c.delta.x=-c.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function a(c){c.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function l(c){return this.viewer.raiseEvent("navigator-scroll",{tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent}),!1}function h(c,R){u(c,"rotate("+R+"deg)")}function u(c,R){c.style.webkitTransform=R,c.style.mozTransform=R,c.style.msTransform=R,c.style.oTransform=R,c.style.transform=R}}(OpenSeadragon),function(t){var s={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(r){var a=r.split("."),l=null,h=arguments,u=s,c;for(c=0;c<a.length-1;c++)u=u[a[c]]||{};return l=u[a[c]],typeof l!="string"&&(t.console.log("Untranslated source string:",r),l=""),l.replace(/\{\d+\}/g,function(R){var b=parseInt(R.match(/\d+/),10)+1;return b<h.length?h[b]:""})},setString:function(r,a){var l=r.split("."),h=s,u;for(u=0;u<l.length-1;u++)h[l[u]]||(h[l[u]]={}),h=h[l[u]];h[l[u]]=a}})}(OpenSeadragon),function(t){t.Point=function(s,r){this.x=typeof s=="number"?s:0,this.y=typeof r=="number"?r:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(s){return new t.Point(this.x+s.x,this.y+s.y)},minus:function(s){return new t.Point(this.x-s.x,this.y-s.y)},times:function(s){return new t.Point(this.x*s,this.y*s)},divide:function(s){return new t.Point(this.x/s,this.y/s)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(s){return Math.sqrt(Math.pow(this.x-s.x,2)+Math.pow(this.y-s.y,2))},squaredDistanceTo:function(s){return Math.pow(this.x-s.x,2)+Math.pow(this.y-s.y,2)},apply:function(s){return new t.Point(s(this.x),s(this.y))},equals:function(s){return s instanceof t.Point&&this.x===s.x&&this.y===s.y},rotate:function(s,r){r=r||new t.Point(0,0);var a,l;if(s%90==0){var h=t.positiveModulo(s,360);switch(h){case 0:a=1,l=0;break;case 90:a=0,l=1;break;case 180:a=-1,l=0;break;case 270:a=0,l=-1;break}}else{var u=s*Math.PI/180;a=Math.cos(u),l=Math.sin(u)}var c=a*(this.x-r.x)-l*(this.y-r.y)+r.x,R=l*(this.x-r.x)+a*(this.y-r.y)+r.y;return new t.Point(c,R)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(t){t.TileSource=function(r,a,l,h,u,c){var R=this,b=arguments,_,L;if(t.isPlainObject(r)?_=r:_={width:b[0],height:b[1],tileSize:b[2],tileOverlap:b[3],minLevel:b[4],maxLevel:b[5]},t.EventSource.call(this),t.extend(!0,this,_),!this.success){for(L=0;L<arguments.length;L++)if(t.isFunction(arguments[L])){this.success=arguments[L];break}}this.success&&this.addHandler("ready",function(z){R.success(z)}),t.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=_.width&&_.height?_.width/_.height:1,this.dimensions=new t.Point(_.width,_.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=_.tileOverlap?_.tileOverlap:0,this.minLevel=_.minLevel?_.minLevel:0,this.maxLevel=_.maxLevel!==void 0&&_.maxLevel!==null?_.maxLevel:_.width&&_.height?Math.ceil(Math.log(Math.max(_.width,_.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(r){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(r){return this._tileWidth?this._tileWidth:this.getTileSize(r)},getTileHeight:function(r){return this._tileHeight?this._tileHeight:this.getTileSize(r)},getLevelScale:function(r){var a={},l;for(l=0;l<=this.maxLevel;l++)a[l]=1/Math.pow(2,this.maxLevel-l);return this.getLevelScale=function(h){return a[h]},this.getLevelScale(r)},getNumTiles:function(r){var a=this.getLevelScale(r),l=Math.ceil(a*this.dimensions.x/this.getTileWidth(r)),h=Math.ceil(a*this.dimensions.y/this.getTileHeight(r));return new t.Point(l,h)},getPixelRatio:function(r){var a=this.dimensions.times(this.getLevelScale(r)),l=1/a.x,h=1/a.y;return new t.Point(l,h)},getClosestLevel:function(){var r,a;for(r=this.minLevel+1;r<=this.maxLevel&&(a=this.getNumTiles(r),!(a.x>1||a.y>1));r++);return r-1},getTileAtPoint:function(r,a){var l=a.x>=0&&a.x<=1&&a.y>=0&&a.y<=1/this.aspectRatio;t.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point.");var h=this.dimensions.x*this.getLevelScale(r),u=a.x*h,c=a.y*h,R=Math.floor(u/this.getTileWidth(r)),b=Math.floor(c/this.getTileHeight(r));a.x>=1&&(R=this.getNumTiles(r).x-1);var _=1e-15;return a.y>=1/this.aspectRatio-_&&(b=this.getNumTiles(r).y-1),new t.Point(R,b)},getTileBounds:function(r,a,l,h){var u=this.dimensions.times(this.getLevelScale(r)),c=this.getTileWidth(r),R=this.getTileHeight(r),b=a===0?0:c*a-this.tileOverlap,_=l===0?0:R*l-this.tileOverlap,L=c+(a===0?1:2)*this.tileOverlap,z=R+(l===0?1:2)*this.tileOverlap,Z=1/u.x;return L=Math.min(L,u.x-b),z=Math.min(z,u.y-_),h?new t.Rect(0,0,L,z):new t.Rect(b*Z,_*Z,L*Z,z*Z)},getImageInfo:function(r){var a=this,l,h,u,c,R,b,_;r&&(R=r.split("/"),b=R[R.length-1],_=b.lastIndexOf("."),_>-1&&(R[R.length-1]=b.slice(0,_))),h=function(L){typeof L=="string"&&(L=t.parseXml(L));var z=t.TileSource.determineType(a,L,r);if(!z){a.raiseEvent("open-failed",{message:"Unable to load TileSource",source:r});return}c=z.prototype.configure.apply(a,[L,r]),c.ajaxWithCredentials===void 0&&(c.ajaxWithCredentials=a.ajaxWithCredentials),u=new z(c),a.ready=!0,a.raiseEvent("ready",{tileSource:u})},r.match(/\.js$/)?(l=r.split("/").pop().replace(".js",""),t.jsonp({url:r,async:!1,callbackName:l,callback:h})):t.makeAjaxRequest({url:r,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(L){var z=s(L);h(z)},error:function(L,z){var Z;try{Z="HTTP "+L.status+" attempting to load TileSource"}catch{var X;typeof z>"u"||!z.toString?X="Unknown error":X=z.toString(),Z=X+" attempting to load TileSource"}a.raiseEvent("open-failed",{message:Z,source:r})}})},supports:function(r,a){return!1},configure:function(r,a){throw new Error("Method not implemented.")},getTileUrl:function(r,a,l){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(r,a,l){return{}},tileExists:function(r,a,l){var h=this.getNumTiles(r);return r>=this.minLevel&&r<=this.maxLevel&&a>=0&&l>=0&&a<h.x&&l<h.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function s(r){var a=r.responseText,l=r.status,h,u;if(r){if(r.status!==200&&r.status!==0)throw l=r.status,h=l==404?"Not Found":r.statusText,new Error(t.getString("Errors.Status",l,h))}else throw new Error(t.getString("Errors.Security"));if(a.match(/\s*<.*/))try{u=r.responseXML&&r.responseXML.documentElement?r.responseXML:t.parseXml(a)}catch{u=r.responseText}else if(a.match(/\s*[\{\[].*/))try{u=t.parseJSON(a)}catch{u=a}else u=a;return u}t.TileSource.determineType=function(r,a,l){var h;for(h in OpenSeadragon)if(h.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[h])&&t.isFunction(OpenSeadragon[h].prototype.supports)&&OpenSeadragon[h].prototype.supports.call(r,a,l))return OpenSeadragon[h];t.console.error("No TileSource was able to open %s %s",l,a)}}(OpenSeadragon),function(t){t.DziTileSource=function(a,l,h,u,c,R,b,_,L){var z,Z,X,oe;if(t.isPlainObject(a)?oe=a:oe={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=oe.tilesUrl,this.fileFormat=oe.fileFormat,this.displayRects=oe.displayRects,this.displayRects)for(z=this.displayRects.length-1;z>=0;z--)for(Z=this.displayRects[z],X=Z.minLevel;X<=Z.maxLevel;X++)this._levelRects[X]||(this._levelRects[X]=[]),this._levelRects[X].push(Z);t.TileSource.apply(this,[oe])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(a,l){var h;return a.Image?h=a.Image.xmlns:a.documentElement&&(a.documentElement.localName=="Image"||a.documentElement.tagName=="Image")&&(h=a.documentElement.namespaceURI),h=(h||"").toLowerCase(),h.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||h.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(a,l){var h;return t.isPlainObject(a)?h=r(this,a):h=s(this,a),l&&!h.tilesUrl&&(h.tilesUrl=l.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),l.search(/\.(dzi|xml|js)\?/)!=-1?h.queryParams=l.match(/\?.*/):h.queryParams=""),h},getTileUrl:function(a,l,h){return[this.tilesUrl,a,"/",l,"_",h,".",this.fileFormat,this.queryParams].join("")},tileExists:function(a,l,h){var u=this._levelRects[a],c,R,b,_,L,z,Z;if(this.minLevel&&a<this.minLevel||this.maxLevel&&a>this.maxLevel)return!1;if(!u||!u.length)return!0;for(Z=u.length-1;Z>=0;Z--)if(c=u[Z],!(a<c.minLevel||a>c.maxLevel)&&(R=this.getLevelScale(a),b=c.x*R,_=c.y*R,L=b+c.width*R,z=_+c.height*R,b=Math.floor(b/this._tileWidth),_=Math.floor(_/this._tileWidth),L=Math.ceil(L/this._tileWidth),z=Math.ceil(z/this._tileWidth),b<=l&&l<L&&_<=h&&h<z))return!0;return!1}});function s(a,l){if(!l||!l.documentElement)throw new Error(t.getString("Errors.Xml"));var h=l.documentElement,u=h.localName||h.tagName,c=l.documentElement.namespaceURI,R=null,b=[],_,L,z,Z,X;if(u=="Image")try{if(Z=h.getElementsByTagName("Size")[0],Z===void 0&&(Z=h.getElementsByTagNameNS(c,"Size")[0]),R={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(Z.getAttribute("Height"),10),Width:parseInt(Z.getAttribute("Width"),10)}}},!t.imageFormatSupported(R.Image.Format))throw new Error(t.getString("Errors.ImageFormat",R.Image.Format.toUpperCase()));for(_=h.getElementsByTagName("DisplayRect"),_===void 0&&(_=h.getElementsByTagNameNS(c,"DisplayRect")[0]),X=0;X<_.length;X++)L=_[X],z=L.getElementsByTagName("Rect")[0],z===void 0&&(z=L.getElementsByTagNameNS(c,"Rect")[0]),b.push({Rect:{X:parseInt(z.getAttribute("X"),10),Y:parseInt(z.getAttribute("Y"),10),Width:parseInt(z.getAttribute("Width"),10),Height:parseInt(z.getAttribute("Height"),10),MinLevel:parseInt(L.getAttribute("MinLevel"),10),MaxLevel:parseInt(L.getAttribute("MaxLevel"),10)}});return b.length&&(R.Image.DisplayRect=b),r(a,R)}catch(B){throw B instanceof Error?B:new Error(t.getString("Errors.Dzi"))}else{if(u=="Collection")throw new Error(t.getString("Errors.Dzc"));if(u=="Error"){var oe=h.getElementsByTagName("Message")[0],v=oe.firstChild.nodeValue;throw new Error(v)}}throw new Error(t.getString("Errors.Dzi"))}function r(a,l){var h=l.Image,u=h.Url,c=h.Format,R=h.Size,b=h.DisplayRect||[],_=parseInt(R.Width,10),L=parseInt(R.Height,10),z=parseInt(h.TileSize,10),Z=parseInt(h.Overlap,10),X=[],oe,v;for(v=0;v<b.length;v++)oe=b[v].Rect,X.push(new t.DisplayRect(parseInt(oe.X,10),parseInt(oe.Y,10),parseInt(oe.Width,10),parseInt(oe.Height,10),parseInt(oe.MinLevel,10),parseInt(oe.MaxLevel,10)));return t.extend(!0,{width:_,height:L,tileSize:z,tileOverlap:Z,minLevel:null,maxLevel:null,tilesUrl:u,fileFormat:c,displayRects:X},l)}}(OpenSeadragon),function(t){t.IIIFTileSource=function(h){if(t.extend(!0,this,h),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(h.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=h.version,this.tile_width&&this.tile_height)h.tileWidth=this.tile_width,h.tileHeight=this.tile_height;else if(this.tile_width)h.tileSize=this.tile_width;else if(this.tile_height)h.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)h.tileWidth=this.tiles[0].width,h.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var u=0;u<this.tiles.length;u++)for(var c=0;c<this.tiles[u].scaleFactors.length;c++){var R=this.tiles[u].scaleFactors[c];this.scale_factors.push(R),h.tileSizePerScaleFactor[R]={width:this.tiles[u].width,height:this.tiles[u].height||this.tiles[u].width}}}else if(s(h)){for(var b=Math.min(this.height,this.width),_=[256,512,1024],L=[],z=0;z<_.length;z++)_[z]<=b&&L.push(_[z]);L.length>0?h.tileSize=Math.max.apply(null,L):h.tileSize=b}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,h.levels=r(this),t.extend(!0,h,{width:h.levels[h.levels.length-1].width,height:h.levels[h.levels.length-1].height,tileSize:Math.max(h.height,h.width),tileOverlap:0,minLevel:0,maxLevel:h.levels.length-1}),this.levels=h.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!h.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)h.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var Z=Math.max.apply(null,this.scale_factors);h.maxLevel=Math.round(Math.log(Z)*Math.LOG2E)}t.TileSource.apply(this,[h])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(h,u){return h.protocol&&h.protocol=="http://iiif.io/api/image"||h["@context"]&&(h["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||h["@context"]=="http://iiif.io/api/image/1/context.json")||h.profile&&h.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||h.identifier&&h.width&&h.height?!0:!!(h.documentElement&&h.documentElement.tagName=="info"&&h.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(h,u){if(t.isPlainObject(h)){if(!h["@context"])h["@context"]="http://iiif.io/api/image/1.0/context.json",h["@id"]=u.replace("/info.json",""),h.version=1;else{var c=h["@context"];if(Array.isArray(c)){for(var R=0;R<c.length;R++)if(typeof c[R]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(c[R])||c[R]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){c=c[R];break}}switch(c){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":h.version=1;break;case"http://iiif.io/api/image/2/context.json":h.version=2;break;case"http://iiif.io/api/image/3/context.json":h.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!h["@id"]&&h.id&&(h["@id"]=h.id),h.preferredFormats){for(var b=0;b<h.preferredFormats.length;b++)if(OpenSeadragon.imageFormatSupported(h.preferredFormats[b])){h.tileFormat=h.preferredFormats[b];break}}return h}else{var _=a(h);return _["@context"]="http://iiif.io/api/image/1.0/context.json",_["@id"]=u.replace("/info.xml",""),_.version=1,_}},getTileWidth:function(h){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,h);var u=Math.pow(2,this.maxLevel-h);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[u]?this.tileSizePerScaleFactor[u].width:this._tileWidth},getTileHeight:function(h){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,h);var u=Math.pow(2,this.maxLevel-h);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[u]?this.tileSizePerScaleFactor[u].height:this._tileHeight},getLevelScale:function(h){if(this.emulateLegacyImagePyramid){var u=NaN;return this.levels.length>0&&h>=this.minLevel&&h<=this.maxLevel&&(u=this.levels[h].width/this.levels[this.maxLevel].width),u}return t.TileSource.prototype.getLevelScale.call(this,h)},getNumTiles:function(h){if(this.emulateLegacyImagePyramid){var u=this.getLevelScale(h);return u?new t.Point(1,1):new t.Point(0,0)}return t.TileSource.prototype.getNumTiles.call(this,h)},getTileAtPoint:function(h,u){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,h,u)},getTileUrl:function(h,u,c){if(this.emulateLegacyImagePyramid){var R=null;return this.levels.length>0&&h>=this.minLevel&&h<=this.maxLevel&&(R=this.levels[h].url),R}var b="0",_=Math.pow(.5,this.maxLevel-h),L=Math.ceil(this.width*_),z=Math.ceil(this.height*_),Z,X,oe,v,B,U,j,Y,K,ae,ie,ge,ye,ve;return Z=this.getTileWidth(h),X=this.getTileHeight(h),oe=Math.ceil(Z/_),v=Math.ceil(X/_),this.version===1?ye="native."+this.tileFormat:ye="default."+this.tileFormat,L<Z&&z<X?(this.version===2&&L===this.width||this.version===3&&L===this.width&&z===this.height?ae="max":this.version===3?ae=L+","+z:ae=L+",",B="full"):(U=u*oe,j=c*v,Y=Math.min(oe,this.width-U),K=Math.min(v,this.height-j),u===0&&c===0&&Y===this.width&&K===this.height?B="full":B=[U,j,Y,K].join(","),ie=Math.ceil(Y*_),ge=Math.ceil(K*_),this.version===2&&ie===this.width||this.version===3&&ie===this.width&&ge===this.height?ae="max":this.version===3?ae=ie+","+ge:ae=ie+","),ve=[this["@id"],B,ae,b,ye].join("/"),ve},__testonly__:{canBeTiled:s,constructLevels:r}});function s(h){var u=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],c=Array.isArray(h.profile)?h.profile[0]:h.profile,R=u.indexOf(c)!==-1,b=!1;return h.version===2&&h.profile.length>1&&h.profile[1].supports&&(b=h.profile[1].supports.indexOf("sizeByW")!==-1),h.version===3&&h.extraFeatures&&(b=h.extraFeatures.indexOf("sizeByWh")!==-1),!R||b}function r(h){for(var u=[],c=0;c<h.sizes.length;c++)u.push({url:h["@id"]+"/full/"+h.sizes[c].width+","+(h.version===3?h.sizes[c].height:"")+"/0/default."+h.tileFormat,width:h.sizes[c].width,height:h.sizes[c].height});return u.sort(function(R,b){return R.width-b.width})}function a(h){if(!h||!h.documentElement)throw new Error(t.getString("Errors.Xml"));var u=h.documentElement,c=u.tagName,R=null;if(c=="info")try{return R={},l(u,R),R}catch(b){throw b instanceof Error?b:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function l(h,u,c){var R,b;if(h.nodeType==3&&c)b=h.nodeValue.trim(),b.match(/^\d*$/)&&(b=Number(b)),u[c]?(t.isArray(u[c])||(u[c]=[u[c]]),u[c].push(b)):u[c]=b;else if(h.nodeType==1)for(R=0;R<h.childNodes.length;R++)l(h.childNodes[R],u,h.nodeName)}}(OpenSeadragon),function(t){t.OsmTileSource=function(s,r,a,l,h){var u;t.isPlainObject(s)?u=s:u={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!u.width||!u.height)&&(u.width=65572864,u.height=65572864),u.tileSize||(u.tileSize=256,u.tileOverlap=0),u.tilesUrl||(u.tilesUrl="http://tile.openstreetmap.org/"),u.minLevel=8,t.TileSource.apply(this,[u])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(s,r){return s.type&&s.type=="openstreetmaps"},configure:function(s,r){return s},getTileUrl:function(s,r,a){return this.tilesUrl+(s-8)+"/"+r+"/"+a+".png"}})}(OpenSeadragon),function(t){t.TmsTileSource=function(s,r,a,l,h){var u;t.isPlainObject(s)?u=s:u={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var c=Math.ceil(u.width/256)*256,R=Math.ceil(u.height/256)*256,b;c>R?b=c/256:b=R/256,u.maxLevel=Math.ceil(Math.log(b)/Math.log(2))-1,u.tileSize=256,u.width=c,u.height=R,t.TileSource.apply(this,[u])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(s,r){return s.type&&s.type=="tiledmapservice"},configure:function(s,r){return s},getTileUrl:function(s,r,a){var l=this.getNumTiles(s).y-1;return this.tilesUrl+s+"/"+r+"/"+(l-a)+".png"}})}(OpenSeadragon),function(t){t.ZoomifyTileSource=function(s){s.tileSize=256;var r={x:s.width,y:s.height};for(s.imageSizes=[{x:s.width,y:s.height}],s.gridSize=[this._getGridSize(s.width,s.height,s.tileSize)];parseInt(r.x,10)>s.tileSize||parseInt(r.y,10)>s.tileSize;)r.x=Math.floor(r.x/2),r.y=Math.floor(r.y/2),s.imageSizes.push({x:r.x,y:r.y}),s.gridSize.push(this._getGridSize(r.x,r.y,s.tileSize));s.imageSizes.reverse(),s.gridSize.reverse(),s.minLevel=0,s.maxLevel=s.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[s])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(s,r,a){return{x:Math.ceil(s/a),y:Math.ceil(r/a)}},_calculateAbsoluteTileNumber:function(s,r,a){for(var l=0,h={},u=0;u<s;u++)h=this.gridSize[u],l+=h.x*h.y;return h=this.gridSize[s],l+=h.x*a+r,l},supports:function(s,r){return s.type&&s.type=="zoomifytileservice"},configure:function(s,r){return s},getTileUrl:function(s,r,a){var l=0,h=this._calculateAbsoluteTileNumber(s,r,a);return l=Math.floor(h/256),this.tilesUrl+"TileGroup"+l+"/"+s+"-"+r+"-"+a+".jpg"}})}(OpenSeadragon),function(t){t.LegacyTileSource=function(l){var h,u,c;t.isArray(l)&&(h={type:"legacy-image-pyramid",levels:l}),h.levels=s(h.levels),h.levels.length>0?(u=h.levels[h.levels.length-1].width,c=h.levels[h.levels.length-1].height):(u=0,c=0,t.console.error("No supported image formats found")),t.extend(!0,h,{width:u,height:c,tileSize:Math.max(c,u),tileOverlap:0,minLevel:0,maxLevel:h.levels.length>0?h.levels.length-1:0}),t.TileSource.apply(this,[h]),this.levels=h.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(l,h){return l.type&&l.type=="legacy-image-pyramid"||l.documentElement&&l.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(l,h){var u;return t.isPlainObject(l)?u=a(this,l):u=r(this,l),u},getLevelScale:function(l){var h=NaN;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(h=this.levels[l].width/this.levels[this.maxLevel].width),h},getNumTiles:function(l){var h=this.getLevelScale(l);return h?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(l,h,u){var c=null;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(c=this.levels[l].url),c}});function s(l){var h=[],u,c;for(c=0;c<l.length;c++)u=l[c],u.height&&u.width&&u.url?h.push({url:u.url,width:Number(u.width),height:Number(u.height)}):t.console.error("Unsupported image format: %s",u.url?u.url:"<no URL>");return h.sort(function(R,b){return R.height-b.height})}function r(l,h){if(!h||!h.documentElement)throw new Error(t.getString("Errors.Xml"));var u=h.documentElement,c=u.tagName,R=null,b=[],_,L;if(c=="image")try{for(R={type:u.getAttribute("type"),levels:[]},b=u.getElementsByTagName("level"),L=0;L<b.length;L++)_=b[L],R.levels.push({url:_.getAttribute("url"),width:parseInt(_.getAttribute("width"),10),height:parseInt(_.getAttribute("height"),10)});return a(l,R)}catch(z){throw z instanceof Error?z:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(c=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(c=="error")throw new Error("Error: "+h)}throw new Error("Unknown element "+c)}function a(l,h){return h.levels}}(OpenSeadragon),function(t){t.ImageTileSource=function(s){s=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},s),t.TileSource.apply(this,[s])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(s,r){return s.type&&s.type==="image"},configure:function(s,r){return s},getImageInfo:function(s){var r=this._image=new Image,a=this;this.crossOriginPolicy&&(r.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(r.useCredentials=this.ajaxWithCredentials),t.addEvent(r,"load",function(){a.width=Object.prototype.hasOwnProperty.call(r,"naturalWidth")?r.naturalWidth:r.width,a.height=Object.prototype.hasOwnProperty.call(r,"naturalHeight")?r.naturalHeight:r.height,a.aspectRatio=a.width/a.height,a.dimensions=new t.Point(a.width,a.height),a._tileWidth=a.width,a._tileHeight=a.height,a.tileOverlap=0,a.minLevel=0,a.levels=a._buildLevels(),a.maxLevel=a.levels.length-1,a.ready=!0,a.raiseEvent("ready",{tileSource:a})}),t.addEvent(r,"error",function(){a.raiseEvent("open-failed",{message:"Error loading image at "+s,source:s})}),r.src=s},getLevelScale:function(s){var r=NaN;return s>=this.minLevel&&s<=this.maxLevel&&(r=this.levels[s].width/this.levels[this.maxLevel].width),r},getNumTiles:function(s){var r=this.getLevelScale(s);return r?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(s,r,a){var l=null;return s>=this.minLevel&&s<=this.maxLevel&&(l=this.levels[s].url),l},getContext2D:function(s,r,a){var l=null;return s>=this.minLevel&&s<=this.maxLevel&&(l=this.levels[s].context2D),l},_buildLevels:function(){var s=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,s;var r=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,a=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,l=document.createElement("canvas"),h=l.getContext("2d");if(l.width=r,l.height=a,h.drawImage(this._image,0,0,r,a),s[0].context2D=h,delete this._image,t.isCanvasTainted(l))return s;for(;r>=2&&a>=2;){r=Math.floor(r/2),a=Math.floor(a/2);var u=document.createElement("canvas"),c=u.getContext("2d");u.width=r,u.height=a,c.drawImage(l,0,0,r,a),s.splice(0,0,{context2D:c,width:r,height:a}),l=u,h=c}return s}})}(OpenSeadragon),function(t){t.TileSourceCollection=function(s,r,a,l){t.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(c){var R=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},c),this.element=c.element||t.makeNeutralElement("div"),c.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(b){b.insideElementPressed?(h(R,t.ButtonState.DOWN),R.raiseEvent("enter",{originalEvent:b.originalEvent})):b.buttonDownAny||h(R,t.ButtonState.HOVER)},focusHandler:function(b){this.enterHandler(b),R.raiseEvent("focus",{originalEvent:b.originalEvent})},exitHandler:function(b){u(R,t.ButtonState.GROUP),b.insideElementPressed&&R.raiseEvent("exit",{originalEvent:b.originalEvent})},blurHandler:function(b){this.exitHandler(b),R.raiseEvent("blur",{originalEvent:b.originalEvent})},pressHandler:function(b){h(R,t.ButtonState.DOWN),R.raiseEvent("press",{originalEvent:b.originalEvent})},releaseHandler:function(b){b.insideElementPressed&&b.insideElementReleased?(u(R,t.ButtonState.HOVER),R.raiseEvent("release",{originalEvent:b.originalEvent})):b.insideElementPressed?u(R,t.ButtonState.GROUP):h(R,t.ButtonState.HOVER)},clickHandler:function(b){b.quick&&R.raiseEvent("click",{originalEvent:b.originalEvent})},keyHandler:function(b){return b.keyCode===13?(R.raiseEvent("click",{originalEvent:b.originalEvent}),R.raiseEvent("release",{originalEvent:b.originalEvent}),!1):!0}}),u(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){h(this,t.ButtonState.GROUP)},notifyGroupExit:function(){u(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function s(c){t.requestAnimationFrame(function(){r(c)})}function r(c){var R,b,_;c.shouldFade&&(R=t.now(),b=R-c.fadeBeginTime,_=1-b/c.fadeLength,_=Math.min(1,_),_=Math.max(0,_),c.imgGroup&&t.setElementOpacity(c.imgGroup,_,!0),_>0&&s(c))}function a(c){c.shouldFade=!0,c.fadeBeginTime=t.now()+c.fadeDelay,window.setTimeout(function(){s(c)},c.fadeDelay)}function l(c){c.shouldFade=!1,c.imgGroup&&t.setElementOpacity(c.imgGroup,1,!0)}function h(c,R){c.element.disabled||(R>=t.ButtonState.GROUP&&c.currentState==t.ButtonState.REST&&(l(c),c.currentState=t.ButtonState.GROUP),R>=t.ButtonState.HOVER&&c.currentState==t.ButtonState.GROUP&&(c.imgHover&&(c.imgHover.style.visibility=""),c.currentState=t.ButtonState.HOVER),R>=t.ButtonState.DOWN&&c.currentState==t.ButtonState.HOVER&&(c.imgDown&&(c.imgDown.style.visibility=""),c.currentState=t.ButtonState.DOWN))}function u(c,R){c.element.disabled||(R<=t.ButtonState.HOVER&&c.currentState==t.ButtonState.DOWN&&(c.imgDown&&(c.imgDown.style.visibility="hidden"),c.currentState=t.ButtonState.HOVER),R<=t.ButtonState.GROUP&&c.currentState==t.ButtonState.HOVER&&(c.imgHover&&(c.imgHover.style.visibility="hidden"),c.currentState=t.ButtonState.GROUP),R<=t.ButtonState.REST&&c.currentState==t.ButtonState.GROUP&&(a(c),c.currentState=t.ButtonState.REST))}}(OpenSeadragon),function(t){t.ButtonGroup=function(s){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},s);var r=this.buttons.concat([]),a=this,l;if(this.element=s.element||t.makeNeutralElement("div"),!s.group)for(this.element.style.display="inline-block",l=0;l<r.length;l++)this.element.appendChild(r[l].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(h){var u;for(u=0;u<a.buttons.length;u++)a.buttons[u].notifyGroupEnter()},exitHandler:function(h){var u;if(!h.insideElementPressed)for(u=0;u<a.buttons.length;u++)a.buttons[u].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(t){t.Rect=function(s,r,a,l,h){this.x=typeof s=="number"?s:0,this.y=typeof r=="number"?r:0,this.width=typeof a=="number"?a:0,this.height=typeof l=="number"?l:0,this.degrees=typeof h=="number"?h:0,this.degrees=t.positiveModulo(this.degrees,360);var u,c;this.degrees>=270?(u=this.getTopRight(),this.x=u.x,this.y=u.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):this.degrees>=180?(u=this.getBottomRight(),this.x=u.x,this.y=u.y,this.degrees-=180):this.degrees>=90&&(u=this.getBottomLeft(),this.x=u.x,this.y=u.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},t.Rect.fromSummits=function(s,r,a){var l=s.distanceTo(r),h=s.distanceTo(a),u=r.minus(s),c=Math.atan(u.y/u.x);return u.x<0?c+=Math.PI:u.y<0&&(c+=2*Math.PI),new t.Rect(s.x,s.y,l,h,c/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(s){return s instanceof t.Rect&&this.x===s.x&&this.y===s.y&&this.width===s.width&&this.height===s.height&&this.degrees===s.degrees},times:function(s){return new t.Rect(this.x*s,this.y*s,this.width*s,this.height*s,this.degrees)},translate:function(s){return new t.Rect(this.x+s.x,this.y+s.y,this.width,this.height,this.degrees)},union:function(s){var r=this.getBoundingBox(),a=s.getBoundingBox(),l=Math.min(r.x,a.x),h=Math.min(r.y,a.y),u=Math.max(r.x+r.width,a.x+a.width),c=Math.max(r.y+r.height,a.y+a.height);return new t.Rect(l,h,u-l,c-h)},intersection:function(s){var r=1e-10,a=[],l=this.getTopLeft();s.containsPoint(l,r)&&a.push(l);var h=this.getTopRight();s.containsPoint(h,r)&&a.push(h);var u=this.getBottomLeft();s.containsPoint(u,r)&&a.push(u);var c=this.getBottomRight();s.containsPoint(c,r)&&a.push(c);var R=s.getTopLeft();this.containsPoint(R,r)&&a.push(R);var b=s.getTopRight();this.containsPoint(b,r)&&a.push(b);var _=s.getBottomLeft();this.containsPoint(_,r)&&a.push(_);var L=s.getBottomRight();this.containsPoint(L,r)&&a.push(L);for(var z=this._getSegments(),Z=s._getSegments(),X=0;X<z.length;X++)for(var oe=z[X],v=0;v<Z.length;v++){var B=Z[v],U=j(oe[0],oe[1],B[0],B[1]);U&&a.push(U)}function j(ve,be,we,ke){var De=be.minus(ve),Fe=ke.minus(we),ze=-Fe.x*De.y+De.x*Fe.y;if(ze===0)return null;var ce=(De.x*(ve.y-we.y)-De.y*(ve.x-we.x))/ze,je=(Fe.x*(ve.y-we.y)-Fe.y*(ve.x-we.x))/ze;return-r<=ce&&ce<=1-r&&-r<=je&&je<=1-r?new t.Point(ve.x+je*De.x,ve.y+je*De.y):null}if(a.length===0)return null;for(var Y=a[0].x,K=a[0].x,ae=a[0].y,ie=a[0].y,ge=1;ge<a.length;ge++){var ye=a[ge];ye.x<Y&&(Y=ye.x),ye.x>K&&(K=ye.x),ye.y<ae&&(ae=ye.y),ye.y>ie&&(ie=ye.y)}return new t.Rect(Y,ae,K-Y,ie-ae)},_getSegments:function(){var s=this.getTopLeft(),r=this.getTopRight(),a=this.getBottomLeft(),l=this.getBottomRight();return[[s,r],[r,l],[l,a],[a,s]]},rotate:function(s,r){if(s=t.positiveModulo(s,360),s===0)return this.clone();r=r||this.getCenter();var a=this.getTopLeft().rotate(s,r),l=this.getTopRight().rotate(s,r),h=l.minus(a);h=h.apply(function(c){var R=1e-15;return Math.abs(c)<R?0:c});var u=Math.atan(h.y/h.x);return h.x<0?u+=Math.PI:h.y<0&&(u+=2*Math.PI),new t.Rect(a.x,a.y,this.width,this.height,u/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var s=this.getTopLeft(),r=this.getTopRight(),a=this.getBottomLeft(),l=this.getBottomRight(),h=Math.min(s.x,r.x,a.x,l.x),u=Math.max(s.x,r.x,a.x,l.x),c=Math.min(s.y,r.y,a.y,l.y),R=Math.max(s.y,r.y,a.y,l.y);return new t.Rect(h,c,u-h,R-c)},getIntegerBoundingBox:function(){var s=this.getBoundingBox(),r=Math.floor(s.x),a=Math.floor(s.y),l=Math.ceil(s.width+s.x-r),h=Math.ceil(s.height+s.y-a);return new t.Rect(r,a,l,h)},containsPoint:function(s,r){r=r||0;var a=this.getTopLeft(),l=this.getTopRight(),h=this.getBottomLeft(),u=l.minus(a),c=h.minus(a);return(s.x-a.x)*u.x+(s.y-a.y)*u.y>=-r&&(s.x-l.x)*u.x+(s.y-l.y)*u.y<=r&&(s.x-a.x)*c.x+(s.y-a.y)*c.y>=-r&&(s.x-h.x)*c.x+(s.y-h.y)*c.y<=r},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(t){var s={};t.ReferenceStrip=function(b){var _=this,L=b.viewer,z=t.getElementSize(L.element),Z,X,oe;for(b.id||(b.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=b.id,this.element.className="referencestrip"),b=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},b,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,b),s[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,X=this.element.style,X.marginTop="0px",X.marginRight="0px",X.marginBottom="0px",X.marginLeft="0px",X.left="0px",X.bottom="0px",X.border="0px",X.background="#000",X.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=L,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,r),scrollHandler:t.delegate(this,a),enterHandler:t.delegate(this,h),exitHandler:t.delegate(this,u),keyDownHandler:t.delegate(this,c),keyHandler:t.delegate(this,R)}),b.width&&b.height?(this.element.style.width=b.width+"px",this.element.style.height=b.height+"px",L.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):b.scroll=="horizontal"?(this.element.style.width=z.x*b.sizeRatio*L.tileSources.length+12*L.tileSources.length+"px",this.element.style.height=z.y*b.sizeRatio+"px",L.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=z.y*b.sizeRatio*L.tileSources.length+12*L.tileSources.length+"px",this.element.style.width=z.x*b.sizeRatio+"px",L.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=z.x*this.sizeRatio+8,this.panelHeight=z.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},oe=0;oe<L.tileSources.length;oe++)Z=t.makeNeutralElement("div"),Z.id=this.element.id+"-"+oe,Z.style.width=_.panelWidth+"px",Z.style.height=_.panelHeight+"px",Z.style.display="inline",Z.style.float="left",Z.style.cssFloat="left",Z.style.styleFloat="left",Z.style.padding="2px",t.setElementTouchActionNone(Z),Z.innerTracker=new t.MouseTracker({element:Z,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(v){v.eventSource.dragging=t.now()},releaseHandler:function(v){var B=v.eventSource,U=B.element.id,j=Number(U.split("-")[2]),Y=t.now();v.insideElementPressed&&v.insideElementReleased&&B.dragging&&Y-B.dragging<B.clickTimeThreshold&&(B.dragging=null,L.goToPage(j))}}),this.element.appendChild(Z),Z.activePanel=!1,this.panels.push(Z);l(this,this.scroll=="vertical"?z.y:z.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(b){var _=this.element.querySelector("#"+this.element.id+"-"+b),L=t.getElementSize(this.viewer.canvas),z=Number(this.element.style.width.replace("px","")),Z=Number(this.element.style.height.replace("px","")),X=-Number(this.element.style.marginLeft.replace("px","")),oe=-Number(this.element.style.marginTop.replace("px","")),v;this.currentSelected!==_&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=_,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(v=Number(b)*(this.panelWidth+3),v>X+L.x-this.panelWidth?(v=Math.min(v,z-L.x),this.element.style.marginLeft=-v+"px",l(this,L.x,-v)):v<X&&(v=Math.max(0,v-L.x/2),this.element.style.marginLeft=-v+"px",l(this,L.x,-v))):(v=Number(b)*(this.panelHeight+3),v>oe+L.y-this.panelHeight?(v=Math.min(v,Z-L.y),this.element.style.marginTop=-v+"px",l(this,L.y,-v)):v<oe&&(v=Math.max(0,v-L.y/2),this.element.style.marginTop=-v+"px",l(this,L.y,-v))),this.currentPage=b,h.call(this,{eventSource:this.innerTracker}))},update:function(){return s[this.id].animating?(t.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var b in this.miniViewers)this.miniViewers[b].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function r(b){var _=Number(this.element.style.marginLeft.replace("px","")),L=Number(this.element.style.marginTop.replace("px","")),z=Number(this.element.style.width.replace("px","")),Z=Number(this.element.style.height.replace("px","")),X=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-b.delta.x>0?_>-(z-X.x)&&(this.element.style.marginLeft=_+b.delta.x*2+"px",l(this,X.x,_+b.delta.x*2)):-b.delta.x<0&&_<0&&(this.element.style.marginLeft=_+b.delta.x*2+"px",l(this,X.x,_+b.delta.x*2)):-b.delta.y>0?L>-(Z-X.y)&&(this.element.style.marginTop=L+b.delta.y*2+"px",l(this,X.y,L+b.delta.y*2)):-b.delta.y<0&&L<0&&(this.element.style.marginTop=L+b.delta.y*2+"px",l(this,X.y,L+b.delta.y*2))),!1}function a(b){var _=Number(this.element.style.marginLeft.replace("px","")),L=Number(this.element.style.marginTop.replace("px","")),z=Number(this.element.style.width.replace("px","")),Z=Number(this.element.style.height.replace("px","")),X=t.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?b.scroll>0?_>-(z-X.x)&&(this.element.style.marginLeft=_-b.scroll*60+"px",l(this,X.x,_-b.scroll*60)):b.scroll<0&&_<0&&(this.element.style.marginLeft=_-b.scroll*60+"px",l(this,X.x,_-b.scroll*60)):b.scroll<0?L>X.y-Z&&(this.element.style.marginTop=L+b.scroll*60+"px",l(this,X.y,L+b.scroll*60)):b.scroll>0&&L<0&&(this.element.style.marginTop=L+b.scroll*60+"px",l(this,X.y,L+b.scroll*60))),!1}function l(b,_,L){var z,Z,X,oe,v,B,U;for(b.scroll=="horizontal"?z=b.panelWidth:z=b.panelHeight,Z=Math.ceil(_/z)+5,X=Math.ceil((Math.abs(L)+_)/z)+1,Z=X-Z,Z=Z<0?0:Z,B=Z;B<X&&B<b.panels.length;B++)if(U=b.panels[B],!U.activePanel){var j,Y=b.viewer.tileSources[B];Y.referenceStripThumbnailUrl?j={type:"image",url:Y.referenceStripThumbnailUrl}:j=Y,oe=new t.Viewer({id:U.id,tileSources:[j],element:U,navigatorSizeRatio:b.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:b.viewer.loadTilesWithAjax,ajaxHeaders:b.viewer.ajaxHeaders,useCanvas:b.useCanvas}),oe.displayRegion=t.makeNeutralElement("div"),oe.displayRegion.id=U.id+"-displayregion",oe.displayRegion.className="displayregion",v=oe.displayRegion.style,v.position="relative",v.top="0px",v.left="0px",v.fontSize="0px",v.overflow="hidden",v.float="left",v.cssFloat="left",v.styleFloat="left",v.zIndex=999999999,v.cursor="default",v.width=b.panelWidth-4+"px",v.height=b.panelHeight-4+"px",oe.displayRegion.innerTracker=new t.MouseTracker({element:oe.displayRegion,startDisabled:!0}),U.getElementsByTagName("div")[0].appendChild(oe.displayRegion),b.miniViewers[U.id]=oe,U.activePanel=!0}}function h(b){var _=b.eventSource.element;return this.scroll=="horizontal"?_.style.marginBottom="0px":_.style.marginLeft="0px",!1}function u(b){var _=b.eventSource.element;return this.scroll=="horizontal"?_.style.marginBottom="-"+t.getElementSize(_).y/2+"px":_.style.marginLeft="-"+t.getElementSize(_).x/2+"px",!1}function c(b){if(!b.preventDefaultAction&&!b.ctrl&&!b.alt&&!b.meta)switch(b.keyCode){case 38:return a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function R(b){if(!b.preventDefaultAction&&!b.ctrl&&!b.alt&&!b.meta)switch(b.keyCode){case 61:return a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(t){t.DisplayRect=function(s,r,a,l,h,u){t.Rect.apply(this,[s,r,a,l]),this.minLevel=h,this.maxLevel=u},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(OpenSeadragon),function(t){t.Spring=function(r){var a=arguments;typeof r!="object"&&(r={initial:a.length&&typeof a[0]=="number"?a[0]:void 0,springStiffness:a.length>1?a[1].springStiffness:5,animationTime:a.length>1?a[1].animationTime:1.5}),t.console.assert(typeof r.springStiffness=="number"&&r.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof r.animationTime=="number"&&r.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),r.exponential&&(this._exponential=!0,delete r.exponential),t.extend(!0,this,r),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=r,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=r,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(r){this.start.value+=r,this.target.value+=r,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(r){this._exponential=r,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var r,a;this._exponential?(r=this.start._logValue,a=this.target._logValue):(r=this.start.value,a=this.target.value);var l=this.current.time>=this.target.time?a:r+(a-r)*s(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),h=this.current.value;return this._exponential?this.current.value=Math.exp(l):this.current.value=l,h!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function s(r,a){return(1-Math.exp(r*-a))/(1-Math.exp(-r))}}(OpenSeadragon),function(t){function s(a){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},a),this.image=null}s.prototype={errorMsg:null,start:function(){var a=this,l=this.abort;this.image=new Image,this.image.onload=function(){a.finish(!0)},this.image.onabort=this.image.onerror=function(){a.errorMsg="Image load aborted",a.finish(!1)},this.jobId=window.setTimeout(function(){a.errorMsg="Image load exceeded timeout ("+a.timeout+" ms)",a.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(h){var u;try{u=new window.Blob([h.response])}catch(_){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(_.name==="TypeError"&&c){var R=new c;R.append(h.response),u=R.getBlob()}}u.size===0&&(a.errorMsg="Empty image response.",a.finish(!1));var b=(window.URL||window.webkitURL).createObjectURL(u);a.image.src=b},error:function(h){a.errorMsg="Image load aborted - XHR error",a.finish(!1)}}),this.abort=function(){a.request.abort(),typeof l=="function"&&l()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(a){this.image.onload=this.image.onerror=this.image.onabort=null,a||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(a){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},a)},t.ImageLoader.prototype={addJob:function(a){var l=this,h=function(R){r(l,R,a.callback)},u={src:a.src,loadWithAjax:a.loadWithAjax,ajaxHeaders:a.loadWithAjax?a.ajaxHeaders:null,crossOriginPolicy:a.crossOriginPolicy,ajaxWithCredentials:a.ajaxWithCredentials,callback:h,abort:a.abort,timeout:this.timeout},c=new s(u);!this.jobLimit||this.jobsInProgress<this.jobLimit?(c.start(),this.jobsInProgress++):this.jobQueue.push(c)},clear:function(){for(var a=0;a<this.jobQueue.length;a++){var l=this.jobQueue[a];typeof l.abort=="function"&&l.abort()}this.jobQueue=[]}};function r(a,l,h){var u;a.jobsInProgress--,(!a.jobLimit||a.jobsInProgress<a.jobLimit)&&a.jobQueue.length>0&&(u=a.jobQueue.shift(),u.start(),a.jobsInProgress++),h(l.image,l.errorMsg,l.request)}}(OpenSeadragon),function(t){t.Tile=function(s,r,a,l,h,u,c,R,b,_){this.level=s,this.x=r,this.y=a,this.bounds=l,this.sourceBounds=_,this.exists=h,this.url=u,this.context2D=c,this.loadWithAjax=R,this.ajaxHeaders=b,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(s){if(!this.cacheImageRecord){t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=s&&s.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",t.setElementOpacity(this.element,this.opacity)},drawCanvas:function(s,r,a,l){var h=this.position.times(t.pixelDensityRatio),u=this.size.times(t.pixelDensityRatio),c;if(!this.context2D&&!this.cacheImageRecord){t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(c=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!c){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}s.save(),s.globalAlpha=this.opacity,typeof a=="number"&&a!==1&&(h=h.times(a),u=u.times(a)),l instanceof t.Point&&(h=h.plus(l)),s.globalAlpha===1&&this._hasTransparencyChannel()&&s.clearRect(h.x,h.y,u.x,u.y),r({context:s,tile:this,rendered:c});var R,b;this.sourceBounds?(R=Math.min(this.sourceBounds.width,c.canvas.width),b=Math.min(this.sourceBounds.height,c.canvas.height)):(R=c.canvas.width,b=c.canvas.height),s.drawImage(c.canvas,0,0,R,b,h.x,h.y,u.x,u.y),s.restore()},getScaleForEdgeSmoothing:function(){var s;if(this.cacheImageRecord)s=this.cacheImageRecord.getRenderedContext();else if(this.context2D)s=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return s.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(s,r,a){var l=Math.max(1,Math.ceil((a.x-r.x)/2)),h=Math.max(1,Math.ceil((a.y-r.y)/2));return new t.Point(l,h).minus(this.position.times(t.pixelDensityRatio).times(s||1).apply(function(u){return u%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(s,r,a){var l;t.isPlainObject(s)?l=s:l={element:s,location:r,placement:a},this.element=l.element,this.style=l.element.style,this._init(l)},t.Overlay.prototype={_init:function(s){this.location=s.location,this.placement=s.placement===void 0?t.Placement.TOP_LEFT:s.placement,this.onDraw=s.onDraw,this.checkResize=s.checkResize===void 0?!0:s.checkResize,this.width=s.width===void 0?null:s.width,this.height=s.height===void 0?null:s.height,this.rotationMode=s.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(s,r){var a=t.Placement.properties[this.placement];!a||(a.isHorizontallyCentered?s.x-=r.x/2:a.isRight&&(s.x-=r.x),a.isVerticallyCentered?s.y-=r.y/2:a.isBottom&&(s.y-=r.y))},destroy:function(){var s=this.element,r=this.style;s.parentNode&&(s.parentNode.removeChild(s),s.prevElementParent&&(r.display="none",document.body.appendChild(s))),this.onDraw=null,r.top="",r.left="",r.position="",this.width!==null&&(r.width=""),this.height!==null&&(r.height="");var a=t.getCssPropertyWithVendorPrefix("transformOrigin"),l=t.getCssPropertyWithVendorPrefix("transform");a&&l&&(r[a]="",r[l]="")},drawHTML:function(s,r){var a=this.element;a.parentNode!==s&&(a.prevElementParent=a.parentNode,a.prevNextSibling=a.nextSibling,s.appendChild(a),this.style.position="absolute",this.size=t.getElementSize(a));var l=this._getOverlayPositionAndSize(r),h=l.position,u=this.size=l.size,c=l.rotate;if(this.onDraw)this.onDraw(h,u,this.element);else{var R=this.style;R.left=h.x+"px",R.top=h.y+"px",this.width!==null&&(R.width=u.x+"px"),this.height!==null&&(R.height=u.y+"px");var b=t.getCssPropertyWithVendorPrefix("transformOrigin"),_=t.getCssPropertyWithVendorPrefix("transform");b&&_&&(c?(R[b]=this._getTransformOrigin(),R[_]="rotate("+c+"deg)"):(R[b]="",R[_]="")),R.display!=="none"&&(R.display="block")}},_getOverlayPositionAndSize:function(s){var r=s.pixelFromPoint(this.location,!0),a=this._getSizeInPixels(s);this.adjust(r,a);var l=0;if(s.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var h=new t.Rect(r.x,r.y,a.x,a.y),u=this._getBoundingBox(h,s.degrees);r=u.getTopLeft(),a=u.getSize()}else l=s.degrees;return{position:r,size:a,rotate:l}},_getSizeInPixels:function(s){var r=this.size.x,a=this.size.y;if(this.width!==null||this.height!==null){var l=s.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(r=l.x),this.height!==null&&(a=l.y)}if(this.checkResize&&(this.width===null||this.height===null)){var h=this.size=t.getElementSize(this.element);this.width===null&&(r=h.x),this.height===null&&(a=h.y)}return new t.Point(r,a)},_getBoundingBox:function(s,r){var a=this._getPlacementPoint(s);return s.rotate(r,a).getBoundingBox()},_getPlacementPoint:function(s){var r=new t.Point(s.x,s.y),a=t.Placement.properties[this.placement];return a&&(a.isHorizontallyCentered?r.x+=s.width/2:a.isRight&&(r.x+=s.width),a.isVerticallyCentered?r.y+=s.height/2:a.isBottom&&(r.y+=s.height)),r},_getTransformOrigin:function(){var s="",r=t.Placement.properties[this.placement];return r&&(r.isLeft?s="left":r.isRight&&(s="right"),r.isTop?s+=" top":r.isBottom&&(s+=" bottom")),s},update:function(s,r){var a=t.isPlainObject(s)?s:{location:s,placement:r};this._init({location:a.location||this.location,placement:a.placement!==void 0?a.placement:this.placement,onDraw:a.onDraw||this.onDraw,checkResize:a.checkResize||this.checkResize,width:a.width!==void 0?a.width:this.width,height:a.height!==void 0?a.height:this.height,rotationMode:a.rotationMode||this.rotationMode})},getBounds:function(s){t.console.assert(s,"A viewport must now be passed to Overlay.getBounds.");var r=this.width,a=this.height;if(r===null||a===null){var l=s.deltaPointsFromPixelsNoRotate(this.size,!0);r===null&&(r=l.x),a===null&&(a=l.y)}var h=this.location.clone();return this.adjust(h,new t.Point(r,a)),this._adjustBoundsForRotation(s,new t.Rect(h.x,h.y,r,a))},_adjustBoundsForRotation:function(s,r){if(!s||s.degrees===0||this.rotationMode===t.OverlayRotationMode.EXACT)return r;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return r;var a=this._getOverlayPositionAndSize(s);return s.viewerElementToViewportRectangle(new t.Rect(a.position.x,a.position.y,a.size.x,a.size.y))}return r.rotate(-s.degrees,this._getPlacementPoint(r))}}}(OpenSeadragon),function(t){t.Drawer=function(s){t.console.assert(s.viewer,"[Drawer] options.viewer is required");var r=arguments;if(t.isPlainObject(s)||(s={source:r[0],viewport:r[1],element:r[2]}),t.console.assert(s.viewport,"[Drawer] options.viewport is required"),t.console.assert(s.element,"[Drawer] options.element is required"),s.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=s.viewer,this.viewport=s.viewport,this.debugGridColor=typeof s.debugGridColor=="string"?[s.debugGridColor]:s.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,s.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=t.getElement(s.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var a=this._calculateCanvasSize();this.canvas.width=a.x,this.canvas.height=a.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(s,r,a,l){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(s,r,a,l),this},updateOverlay:function(s,r,a){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(s,r,a),this},removeOverlay:function(s){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(s),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(s){var r=this.viewport.pixelFromPointNoRotate(s,!0);return new t.Point(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio)},clipWithPolygons:function(s,r){if(this.useCanvas){var a=this._getContext(r);a.beginPath(),s.forEach(function(l){l.forEach(function(h,u){a[u===0?"moveTo":"lineTo"](h.x,h.y)})}),a.clip()}},setOpacity:function(s){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var r=this.viewer.world,a=0;a<r.getItemCount();a++)r.getItemAt(a).setOpacity(s);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var s=this.viewer.world,r=0,a=0;a<s.getItemCount();a++){var l=s.getItemAt(a).getOpacity();l>r&&(r=l)}return r},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var s=this._calculateCanvasSize();if((this.canvas.width!=s.x||this.canvas.height!=s.y)&&(this.canvas.width=s.x,this.canvas.height=s.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var r=this._calculateSketchCanvasSize();this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(s,r){if(this.useCanvas){var a=this._getContext(s);if(r)a.clearRect(r.x,r.y,r.width,r.height);else{var l=a.canvas;a.clearRect(0,0,l.width,l.height)}}},viewportToDrawerRectangle:function(s){var r=this.viewport.pixelFromPointNoRotate(s.getTopLeft(),!0),a=this.viewport.deltaPixelsFromPointsNoRotate(s.getSize(),!0);return new t.Rect(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio,a.x*t.pixelDensityRatio,a.y*t.pixelDensityRatio)},drawTile:function(s,r,a,l,h){if(t.console.assert(s,"[Drawer.drawTile] tile is required"),t.console.assert(r,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var u=this._getContext(a);l=l||1,s.drawCanvas(u,r,l,h)}else s.drawHTML(this.canvas)},_getContext:function(s){var r=this.context;if(s){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var a=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=a.x,this.sketchCanvas.height=a.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var l=this;this.viewer.addHandler("rotate",function h(){if(l.viewport.getRotation()!==0){l.viewer.removeHandler("rotate",h);var u=l._calculateSketchCanvasSize();l.sketchCanvas.width=u.x,l.sketchCanvas.height=u.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}r=this.sketchContext}return r},saveContext:function(s){!this.useCanvas||this._getContext(s).save()},restoreContext:function(s){!this.useCanvas||this._getContext(s).restore()},setClip:function(s,r){if(this.useCanvas){var a=this._getContext(r);a.beginPath(),a.rect(s.x,s.y,s.width,s.height),a.clip()}},drawRectangle:function(s,r,a){if(this.useCanvas){var l=this._getContext(a);l.save(),l.fillStyle=r,l.fillRect(s.x,s.y,s.width,s.height),l.restore()}},blendSketch:function(s,r,a,l){var h=s;if(t.isPlainObject(h)||(h={opacity:s,scale:r,translate:a,compositeOperation:l}),!(!this.useCanvas||!this.sketchCanvas)){s=h.opacity,l=h.compositeOperation;var u=h.bounds;if(this.context.save(),this.context.globalAlpha=s,l&&(this.context.globalCompositeOperation=l),u)u.x<0&&(u.width+=u.x,u.x=0),u.x+u.width>this.canvas.width&&(u.width=this.canvas.width-u.x),u.y<0&&(u.height+=u.y,u.y=0),u.y+u.height>this.canvas.height&&(u.height=this.canvas.height-u.y),this.context.drawImage(this.sketchCanvas,u.x,u.y,u.width,u.height,u.x,u.y,u.width,u.height);else{r=h.scale||1,a=h.translate;var c=a instanceof t.Point?a:new t.Point(0,0),R=0,b=0;if(a){var _=this.sketchCanvas.width-this.canvas.width,L=this.sketchCanvas.height-this.canvas.height;R=Math.round(_/2),b=Math.round(L/2)}this.context.drawImage(this.sketchCanvas,c.x-R*r,c.y-b*r,(this.canvas.width+2*R)*r,(this.canvas.height+2*b)*r,-R,-b,this.canvas.width+2*R,this.canvas.height+2*b)}this.context.restore()}},drawDebugInfo:function(s,r,a,l){if(this.useCanvas){var h=this.viewer.world.getIndexOfItem(l)%this.debugGridColor.length,u=this.context;u.save(),u.lineWidth=2*t.pixelDensityRatio,u.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",u.strokeStyle=this.debugGridColor[h],u.fillStyle=this.debugGridColor[h],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),l.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:l.getRotation(!0),point:l.viewport.pixelFromPointNoRotate(l._getRotationPoint(!0),!0)}),l.viewport.degrees===0&&l.getRotation(!0)%360==0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),u.strokeRect(s.position.x*t.pixelDensityRatio,s.position.y*t.pixelDensityRatio,s.size.x*t.pixelDensityRatio,s.size.y*t.pixelDensityRatio);var c=(s.position.x+s.size.x/2)*t.pixelDensityRatio,R=(s.position.y+s.size.y/2)*t.pixelDensityRatio;u.translate(c,R),u.rotate(Math.PI/180*-this.viewport.degrees),u.translate(-c,-R),s.x===0&&s.y===0&&(u.fillText("Zoom: "+this.viewport.getZoom(),s.position.x*t.pixelDensityRatio,(s.position.y-30)*t.pixelDensityRatio),u.fillText("Pan: "+this.viewport.getBounds().toString(),s.position.x*t.pixelDensityRatio,(s.position.y-20)*t.pixelDensityRatio)),u.fillText("Level: "+s.level,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+20)*t.pixelDensityRatio),u.fillText("Column: "+s.x,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+30)*t.pixelDensityRatio),u.fillText("Row: "+s.y,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+40)*t.pixelDensityRatio),u.fillText("Order: "+a+" of "+r,(s.position.x+10)*t.pixelDensityRatio,(s.position.y+50)*t.pixelDensityRatio),u.fillText("Size: "+s.size.toString(),(s.position.x+10)*t.pixelDensityRatio,(s.position.y+60)*t.pixelDensityRatio),u.fillText("Position: "+s.position.toString(),(s.position.x+10)*t.pixelDensityRatio,(s.position.y+70)*t.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),l.getRotation(!0)%360!=0&&this._restoreRotationChanges(),l.viewport.degrees===0&&l.getRotation(!0)%360==0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),u.restore()}},debugRect:function(s){if(this.useCanvas){var r=this.context;r.save(),r.lineWidth=2*t.pixelDensityRatio,r.strokeStyle=this.debugGridColor[0],r.fillStyle=this.debugGridColor[0],r.strokeRect(s.x*t.pixelDensityRatio,s.y*t.pixelDensityRatio,s.width*t.pixelDensityRatio,s.height*t.pixelDensityRatio),r.restore()}},setImageSmoothingEnabled:function(s){this.useCanvas&&(this._imageSmoothingEnabled=s,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(s){s.msImageSmoothingEnabled=this._imageSmoothingEnabled,s.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(s){var r=this._getContext(s).canvas;return new t.Point(r.width,r.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(s){var r=s.point?s.point.times(t.pixelDensityRatio):this.getCanvasCenter(),a=this._getContext(s.useSketch);a.save(),a.translate(r.x,r.y),this.viewer.viewport.flipped?(a.rotate(Math.PI/180*-s.degrees),a.scale(-1,1)):a.rotate(Math.PI/180*s.degrees),a.translate(-r.x,-r.y)},_flip:function(s){s=s||{};var r=s.point?s.point.times(t.pixelDensityRatio):this.getCanvasCenter(),a=this._getContext(s.useSketch);a.translate(r.x,0),a.scale(-1,1),a.translate(-r.x,0)},_restoreRotationChanges:function(s){var r=this._getContext(s);r.restore()},_calculateCanvasSize:function(){var s=t.pixelDensityRatio,r=this.viewport.getContainerSize();return{x:Math.round(r.x*s),y:Math.round(r.y*s)}},_calculateSketchCanvasSize:function(){var s=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return s;var r=Math.ceil(Math.sqrt(s.x*s.x+s.y*s.y));return{x:r,y:r}}}}(OpenSeadragon),function(t){t.Viewport=function(s){var r=arguments;r.length&&r[0]instanceof t.Point&&(s={containerSize:r[0],contentSize:r[1],config:r[2]}),s.config&&(t.extend(!0,s,s.config),delete s.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},s.margins||{}),delete s.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},s),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(s){return t.console.assert(s,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(s instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(s.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(s.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,s.y/s.x),s.x),this},setHomeBounds:function(s,r){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(s,r)},_setContentBounds:function(s,r){t.console.assert(s,"[Viewport._setContentBounds] bounds is required"),t.console.assert(s instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(s.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(s.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=s.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(r),this._contentBounds=s.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(r),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:r,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var s=this._contentAspectRatio/this.getAspectRatio(),r;return this.homeFillsViewer?r=s>=1?s:1:r=s>=1?1:s,r/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var s=this._contentBounds.getCenter(),r=1/this.getHomeZoom(),a=r/this.getAspectRatio();return new t.Rect(s.x-r/2,s.y-a/2,r,a)},goHome:function(s){return this.viewer&&this.viewer.raiseEvent("home",{immediately:s}),this.fitBounds(this.getHomeBounds(),s)},getMinZoom:function(){var s=this.getHomeZoom(),r=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*s;return r},getMaxZoom:function(){var s=this.maxZoomLevel;return s||(s=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,s/=this._contentBounds.width),Math.max(s,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(s){t.console.assert(t.type(s)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},s),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(s){return this.getBoundsNoRotate(s).rotate(-this.getRotation())},getBoundsNoRotate:function(s){var r=this.getCenter(s),a=1/this.getZoom(s),l=a/this.getAspectRatio();return new t.Rect(r.x-a/2,r.y-l/2,a,l)},getBoundsWithMargins:function(s){return this.getBoundsNoRotateWithMargins(s).rotate(-this.getRotation(),this.getCenter(s))},getBoundsNoRotateWithMargins:function(s){var r=this.getBoundsNoRotate(s),a=this._containerInnerSize.x*this.getZoom(s);return r.x-=this._margins.left/a,r.y-=this._margins.top/a,r.width+=(this._margins.left+this._margins.right)/a,r.height+=(this._margins.top+this._margins.bottom)/a,r},getCenter:function(s){var r=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),a=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),l,h,u,c,R,b,_,L;return s?r:this.zoomPoint?(l=this.pixelFromPoint(this.zoomPoint,!0),h=this.getZoom(),u=1/h,c=u/this.getAspectRatio(),R=new t.Rect(r.x-u/2,r.y-c/2,u,c),b=this._pixelFromPoint(this.zoomPoint,R),_=b.minus(l),L=_.divide(this._containerInnerSize.x*h),a.plus(L)):a},getZoom:function(s){return s?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(s){return Math.max(Math.min(s,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(s){var r=new t.Rect(s.x,s.y,s.width,s.height);if(!this.wrapHorizontal){var a=this.visibilityRatio*r.width,l=r.x+r.width,h=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,u=this._contentBoundsNoRotate.x-l+a,c=h-r.x-a;a>this._contentBoundsNoRotate.width?r.x+=(u+c)/2:c<0?r.x+=c:u>0&&(r.x+=u)}if(!this.wrapVertical){var R=this.visibilityRatio*r.height,b=r.y+r.height,_=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,L=this._contentBoundsNoRotate.y-b+R,z=_-r.y-R;R>this._contentBoundsNoRotate.height?r.y+=(L+z)/2:z<0?r.y+=z:L>0&&(r.y+=L)}return r},_raiseConstraintsEvent:function(s){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:s})},applyConstraints:function(s){var r=this.getZoom(),a=this._applyZoomConstraints(r);r!==a&&this.zoomTo(a,this.zoomPoint,s);var l=this.getBoundsNoRotate(),h=this._applyBoundaryConstraints(l);return this._raiseConstraintsEvent(s),(l.x!==h.x||l.y!==h.y||s)&&this.fitBounds(h.rotate(-this.getRotation()),s),this},ensureVisible:function(s){return this.applyConstraints(s)},_fitBounds:function(s,r){r=r||{};var a=r.immediately||!1,l=r.constraints||!1,h=this.getAspectRatio(),u=s.getCenter(),c=new t.Rect(s.x,s.y,s.width,s.height,s.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=h?c.height=c.width/h:c.width=c.height*h,c.x=u.x-c.width/2,c.y=u.y-c.height/2;var R=1/c.width;if(l){var b=c.getAspectRatio(),_=this._applyZoomConstraints(R);R!==_&&(R=_,c.width=1/R,c.x=u.x-c.width/2,c.height=c.width/b,c.y=u.y-c.height/2),c=this._applyBoundaryConstraints(c),u=c.getCenter(),this._raiseConstraintsEvent(a)}if(a)return this.panTo(u,!0),this.zoomTo(R,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var L=this.getBounds(),z=this.getZoom();if(z===0||Math.abs(R/z-1)<1e-8)return this.zoomTo(R,!0),this.panTo(u,a);c=c.rotate(-this.getRotation());var Z=c.getTopLeft().times(R).minus(L.getTopLeft().times(z)).divide(R-z);return this.zoomTo(R,Z,a)},fitBounds:function(s,r){return this._fitBounds(s,{immediately:r,constraints:!1})},fitBoundsWithConstraints:function(s,r){return this._fitBounds(s,{immediately:r,constraints:!0})},fitVertically:function(s){var r=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(r,s)},fitHorizontally:function(s){var r=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(r,s)},getConstrainedBounds:function(s){var r,a;return r=this.getBounds(s),a=this._applyBoundaryConstraints(r),a},panBy:function(s,r){var a=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(a.plus(s),r)},panTo:function(s,r){return r?(this.centerSpringX.resetTo(s.x),this.centerSpringY.resetTo(s.y)):(this.centerSpringX.springTo(s.x),this.centerSpringY.springTo(s.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:s,immediately:r}),this},zoomBy:function(s,r,a){return this.zoomTo(this.zoomSpring.target.value*s,r,a)},zoomTo:function(s,r,a){var l=this;return this.zoomPoint=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,a?this._adjustCenterSpringsForZoomPoint(function(){l.zoomSpring.resetTo(s)}):this.zoomSpring.springTo(s),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:s,refPoint:r,immediately:a}),this},setRotation:function(s){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=t.positiveModulo(s,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:s}),this)},getRotation:function(){return this.degrees},resize:function(s,r){var a=this.getBoundsNoRotate(),l=a,h;return this.containerSize.x=s.x,this.containerSize.y=s.y,this._updateContainerInnerSize(),r&&(h=s.x/this.containerSize.x,l.width=a.width*h,l.height=l.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:s,maintain:r}),this.fitBounds(l,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var s=this;this._adjustCenterSpringsForZoomPoint(function(){s.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var r=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,r},_adjustCenterSpringsForZoomPoint:function(s){if(this.zoomPoint){var r=this.pixelFromPoint(this.zoomPoint,!0);s();var a=this.pixelFromPoint(this.zoomPoint,!0),l=a.minus(r),h=this.deltaPointsFromPixels(l,!0);this.centerSpringX.shiftBy(h.x),this.centerSpringY.shiftBy(h.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else s()},deltaPixelsFromPointsNoRotate:function(s,r){return s.times(this._containerInnerSize.x*this.getZoom(r))},deltaPixelsFromPoints:function(s,r){return this.deltaPixelsFromPointsNoRotate(s.rotate(this.getRotation()),r)},deltaPointsFromPixelsNoRotate:function(s,r){return s.divide(this._containerInnerSize.x*this.getZoom(r))},deltaPointsFromPixels:function(s,r){return this.deltaPointsFromPixelsNoRotate(s,r).rotate(-this.getRotation())},pixelFromPointNoRotate:function(s,r){return this._pixelFromPointNoRotate(s,this.getBoundsNoRotate(r))},pixelFromPoint:function(s,r){return this._pixelFromPoint(s,this.getBoundsNoRotate(r))},_pixelFromPointNoRotate:function(s,r){return s.minus(r.getTopLeft()).times(this._containerInnerSize.x/r.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(s,r){return this._pixelFromPointNoRotate(s.rotate(this.getRotation(),this.getCenter(!0)),r)},pointFromPixelNoRotate:function(s,r){var a=this.getBoundsNoRotate(r);return s.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/a.width).plus(a.getTopLeft())},pointFromPixel:function(s,r){return this.pointFromPixelNoRotate(s,r).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(s,r){var a=this._contentBoundsNoRotate.width;return new t.Point(s*this._contentSizeNoRotate.x/a,r*this._contentSizeNoRotate.x/a)},viewportToImageCoordinates:function(s,r){if(s instanceof t.Point)return this.viewportToImageCoordinates(s.x,s.y);if(this.viewer){var a=this.viewer.world.getItemCount();if(a>1)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(a===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageCoordinates(s,r,!0)}}return this._viewportToImageDelta(s-this._contentBoundsNoRotate.x,r-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(s,r){var a=this._contentBoundsNoRotate.width;return new t.Point(s/this._contentSizeNoRotate.x*a,r/this._contentSizeNoRotate.x*a)},imageToViewportCoordinates:function(s,r){if(s instanceof t.Point)return this.imageToViewportCoordinates(s.x,s.y);if(this.viewer){var a=this.viewer.world.getItemCount();if(a>1)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(a===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportCoordinates(s,r,!0)}}var h=this._imageToViewportDelta(s,r);return h.x+=this._contentBoundsNoRotate.x,h.y+=this._contentBoundsNoRotate.y,h},imageToViewportRectangle:function(s,r,a,l){var h=s;if(h instanceof t.Rect||(h=new t.Rect(s,r,a,l)),this.viewer){var u=this.viewer.world.getItemCount();if(u>1)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(u===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportRectangle(s,r,a,l,!0)}}var R=this.imageToViewportCoordinates(h.x,h.y),b=this._imageToViewportDelta(h.width,h.height);return new t.Rect(R.x,R.y,b.x,b.y,h.degrees)},viewportToImageRectangle:function(s,r,a,l){var h=s;if(h instanceof t.Rect||(h=new t.Rect(s,r,a,l)),this.viewer){var u=this.viewer.world.getItemCount();if(u>1)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(u===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageRectangle(s,r,a,l,!0)}}var R=this.viewportToImageCoordinates(h.x,h.y),b=this._viewportToImageDelta(h.width,h.height);return new t.Rect(R.x,R.y,b.x,b.y,h.degrees)},viewerElementToImageCoordinates:function(s){var r=this.pointFromPixel(s,!0);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(s){var r=this.imageToViewportCoordinates(s);return this.pixelFromPoint(r,!0)},windowToImageCoordinates:function(s){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var r=s.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(s){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var r=this.imageToViewerElementCoordinates(s);return r.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(s){return this.pointFromPixel(s,!0)},viewportToViewerElementCoordinates:function(s){return this.pixelFromPoint(s,!0)},viewerElementToViewportRectangle:function(s){return t.Rect.fromSummits(this.pointFromPixel(s.getTopLeft(),!0),this.pointFromPixel(s.getTopRight(),!0),this.pointFromPixel(s.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(s){return t.Rect.fromSummits(this.pixelFromPoint(s.getTopLeft(),!0),this.pixelFromPoint(s.getTopRight(),!0),this.pixelFromPoint(s.getBottomLeft(),!0))},windowToViewportCoordinates:function(s){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var r=s.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(r)},viewportToWindowCoordinates:function(s){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var r=this.viewportToViewerElementCoordinates(s);return r.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(s){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(r===1){var a=this.viewer.world.getItemAt(0);return a.viewportToImageZoom(s)}}var l=this._contentSizeNoRotate.x,h=this._containerInnerSize.x,u=this._contentBoundsNoRotate.width,c=h/l*u;return s*c},imageToViewportZoom:function(s){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(r===1){var a=this.viewer.world.getItemAt(0);return a.imageToViewportZoom(s)}}var l=this._contentSizeNoRotate.x,h=this._containerInnerSize.x,u=this._contentBoundsNoRotate.width,c=l/h/u;return s*c},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(s){return this.flipped===s?this:(this.flipped=s,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:s}),this)}}}(OpenSeadragon),function(t){t.TiledImage=function(v){var B=this;t.console.assert(v.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(v.drawer,"[TiledImage] options.drawer is required"),t.console.assert(v.viewer,"[TiledImage] options.viewer is required"),t.console.assert(v.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(v.source,"[TiledImage] options.source is required"),t.console.assert(!v.clip||v.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=v.tileCache,delete v.tileCache,this._drawer=v.drawer,delete v.drawer,this._imageLoader=v.imageLoader,delete v.imageLoader,v.clip instanceof t.Rect&&(this._clip=v.clip.clone()),delete v.clip;var U=v.x||0;delete v.x;var j=v.y||0;delete v.y,this.normHeight=v.source.dimensions.y/v.source.dimensions.x,this.contentAspectX=v.source.dimensions.x/v.source.dimensions.y;var Y=1;v.width?(Y=v.width,delete v.width,v.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete v.height)):v.height&&(Y=v.height/this.normHeight,delete v.height);var K=v.fitBounds;delete v.fitBounds;var ae=v.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete v.fitBoundsPlacement;var ie=v.degrees||0;delete v.degrees,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},v),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:U,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:j,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:Y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:ie,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),K&&this.fitBounds(K,ae,!0),this._drawingHandler=function(ge){B.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:B},ge))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(v){v!==this._fullyLoaded&&(this._fullyLoaded=v,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var v=this._xSpring.update(),B=this._ySpring.update(),U=this._scaleSpring.update(),j=this._degreesSpring.update();return v||B||U||j?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(v){return this.getBoundsNoRotate(v).rotate(this.getRotation(v),this._getRotationPoint(v))},getBoundsNoRotate:function(v){return v?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(v){var B=this.getBoundsNoRotate(v);if(this._clip){var U=v?this._worldWidthCurrent:this._worldWidthTarget,j=U/this.source.dimensions.x,Y=this._clip.times(j);B=new t.Rect(B.x+Y.x,B.y+Y.y,Y.width,Y.height)}return B.rotate(this.getRotation(v),this._getRotationPoint(v))},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(v,B,U){var j=U?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(v*(this.source.dimensions.x/j),B*(this.source.dimensions.y*this.contentAspectX/j))},viewportToImageCoordinates:function(v,B,U){var j;return v instanceof t.Point?(U=B,j=v):j=new t.Point(v,B),j=j.rotate(-this.getRotation(U),this._getRotationPoint(U)),U?this._viewportToImageDelta(j.x-this._xSpring.current.value,j.y-this._ySpring.current.value):this._viewportToImageDelta(j.x-this._xSpring.target.value,j.y-this._ySpring.target.value)},_imageToViewportDelta:function(v,B,U){var j=U?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(v/this.source.dimensions.x*j,B/this.source.dimensions.y/this.contentAspectX*j)},imageToViewportCoordinates:function(v,B,U){v instanceof t.Point&&(U=B,B=v.y,v=v.x);var j=this._imageToViewportDelta(v,B);return U?(j.x+=this._xSpring.current.value,j.y+=this._ySpring.current.value):(j.x+=this._xSpring.target.value,j.y+=this._ySpring.target.value),j.rotate(this.getRotation(U),this._getRotationPoint(U))},imageToViewportRectangle:function(v,B,U,j,Y){var K=v;K instanceof t.Rect?Y=B:K=new t.Rect(v,B,U,j);var ae=this.imageToViewportCoordinates(K.getTopLeft(),Y),ie=this._imageToViewportDelta(K.width,K.height,Y);return new t.Rect(ae.x,ae.y,ie.x,ie.y,K.degrees+this.getRotation(Y))},viewportToImageRectangle:function(v,B,U,j,Y){var K=v;v instanceof t.Rect?Y=B:K=new t.Rect(v,B,U,j);var ae=this.viewportToImageCoordinates(K.getTopLeft(),Y),ie=this._viewportToImageDelta(K.width,K.height,Y);return new t.Rect(ae.x,ae.y,ie.x,ie.y,K.degrees-this.getRotation(Y))},viewerElementToImageCoordinates:function(v){var B=this.viewport.pointFromPixel(v,!0);return this.viewportToImageCoordinates(B)},imageToViewerElementCoordinates:function(v){var B=this.imageToViewportCoordinates(v);return this.viewport.pixelFromPoint(B,!0)},windowToImageCoordinates:function(v){var B=v.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(B)},imageToWindowCoordinates:function(v){var B=this.imageToViewerElementCoordinates(v);return B.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(v){var B=this._scaleSpring.current.value;return v=v.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((v.x-this._xSpring.current.value)/B,(v.y-this._ySpring.current.value)/B,v.width/B,v.height/B,v.degrees)},viewportToImageZoom:function(v){var B=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return B*v},imageToViewportZoom:function(v){var B=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return v/B},setPosition:function(v,B){var U=this._xSpring.target.value===v.x&&this._ySpring.target.value===v.y;if(B){if(U&&this._xSpring.current.value===v.x&&this._ySpring.current.value===v.y)return;this._xSpring.resetTo(v.x),this._ySpring.resetTo(v.y),this._needsDraw=!0}else{if(U)return;this._xSpring.springTo(v.x),this._ySpring.springTo(v.y),this._needsDraw=!0}U||this._raiseBoundsChange()},setWidth:function(v,B){this._setScale(v,B)},setHeight:function(v,B){this._setScale(v/this.normHeight,B)},setCroppingPolygons:function(v){var B=function(j){return j instanceof t.Point||typeof j.x=="number"&&typeof j.y=="number"},U=function(j){return j.map(function(Y){try{if(B(Y))return{x:Y.x,y:Y.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(v))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=v.map(function(j){return U(j)})}catch(j){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(j),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(v,B,U){B=B||t.Placement.CENTER;var j=t.Placement.properties[B],Y=this.contentAspectX,K=0,ae=0,ie=1,ge=1;if(this._clip&&(Y=this._clip.getAspectRatio(),ie=this._clip.width/this.source.dimensions.x,ge=this._clip.height/this.source.dimensions.y,v.getAspectRatio()>Y?(K=this._clip.x/this._clip.height*v.height,ae=this._clip.y/this._clip.height*v.height):(K=this._clip.x/this._clip.width*v.width,ae=this._clip.y/this._clip.width*v.width)),v.getAspectRatio()>Y){var ye=v.height/ge,ve=0;j.isHorizontallyCentered?ve=(v.width-v.height*Y)/2:j.isRight&&(ve=v.width-v.height*Y),this.setPosition(new t.Point(v.x-K+ve,v.y-ae),U),this.setHeight(ye,U)}else{var be=v.width/ie,we=0;j.isVerticallyCentered?we=(v.height-v.width/Y)/2:j.isBottom&&(we=v.height-v.width/Y),this.setPosition(new t.Point(v.x-K,v.y-ae+we),U),this.setWidth(be,U)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(v){t.console.assert(!v||v instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),v instanceof t.Rect?this._clip=v.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(v){v!==this.opacity&&(this.opacity=v,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(v){this._preload=!!v,this._needsDraw=!0},getRotation:function(v){return v?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(v,B){this._degreesSpring.target.value===v&&this._degreesSpring.isAtTargetValue()||(B?this._degreesSpring.resetTo(v):this._degreesSpring.springTo(v),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(v){return this.getBoundsNoRotate(v).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(v){v!==this.compositeOperation&&(this.compositeOperation=v,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(v,B){var U=this._scaleSpring.target.value===v;if(B){if(U&&this._scaleSpring.current.value===v)return;this._scaleSpring.resetTo(v),this._updateForScale(),this._needsDraw=!0}else{if(U)return;this._scaleSpring.springTo(v),this._updateForScale(),this._needsDraw=!0}U||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var v=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),B=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,U=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(B/this.minPixelRatio)/Math.log(2))));return U=Math.max(U,this.source.minLevel||0),v=Math.min(v,U),{lowestLevel:v,highestLevel:U}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var v=this.lastDrawn.pop();v.beingDrawn=!1}var B=this.viewport,U=this._viewportToTiledImageRectangle(B.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var j=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(U=U.intersection(j),U===null)return}for(var Y=this._getLevelsInterval(),K=Y.lowestLevel,ae=Y.highestLevel,ie=null,ge=!1,ye=t.now(),ve=ae;ve>=K;ve--){var be=!1,we=B.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(ve),!0).x*this._scaleSpring.current.value;if(ve===K||!ge&&we>=this.minPixelRatio)be=!0,ge=!0;else if(!ge)continue;var ke=B.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(ve),!1).x*this._scaleSpring.current.value,De=B.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,Fe=this.immediateRender?1:De,ze=Math.min(1,(we-.5)/.5),ce=Fe/Math.abs(Fe-ke);if(ie=s(this,ge,be,ve,ze,ce,U,ye,ie),b(this.coverage,ve))break}X(this,this.lastDrawn),ie&&!ie.context2D?(l(this,ie,ye),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(v,B,U){var j,Y;this.wrapHorizontal?(j=t.positiveModulo(B.x,1),Y=t.positiveModulo(U.x,1)):(j=Math.max(0,B.x),Y=Math.min(1,U.x));var K,ae,ie=1/this.source.aspectRatio;this.wrapVertical?(K=t.positiveModulo(B.y,ie),ae=t.positiveModulo(U.y,ie)):(K=Math.max(0,B.y),ae=Math.min(ie,U.y));var ge=this.source.getTileAtPoint(v,new t.Point(j,K)),ye=this.source.getTileAtPoint(v,new t.Point(Y,ae)),ve=this.source.getNumTiles(v);return this.wrapHorizontal&&(ge.x+=ve.x*Math.floor(B.x),ye.x+=ve.x*Math.floor(U.x)),this.wrapVertical&&(ge.y+=ve.y*Math.floor(B.y/ie),ye.y+=ve.y*Math.floor(U.y/ie)),{topLeft:ge,bottomRight:ye}}});function s(v,B,U,j,Y,K,ae,ie,ge){var ye=ae.getBoundingBox().getTopLeft(),ve=ae.getBoundingBox().getBottomRight();v.viewer&&v.viewer.raiseEvent("update-level",{tiledImage:v,havedrawn:B,level:j,opacity:Y,visibility:K,drawArea:ae,topleft:ye,bottomright:ve,currenttime:ie,best:ge}),z(v.coverage,j),z(v.loadingCoverage,j);for(var be=v._getCornerTiles(j,ye,ve),we=be.topLeft,ke=be.bottomRight,De=v.source.getNumTiles(j),Fe=v.viewport.pixelFromPoint(v.viewport.getCenter()),ze=we.x;ze<=ke.x;ze++)for(var ce=we.y;ce<=ke.y;ce++){if(!v.wrapHorizontal&&!v.wrapVertical){var je=v.source.getTileBounds(j,ze,ce);if(ae.intersection(je)===null)continue}ge=r(v,U,B,ze,ce,j,Y,K,Fe,De,ie,ge)}return ge}function r(v,B,U,j,Y,K,ae,ie,ge,ye,ve,be){var we=a(j,Y,K,v,v.source,v.tilesMatrix,ve,ye,v._worldWidthCurrent,v._worldHeightCurrent),ke=U;v.viewer&&v.viewer.raiseEvent("update-tile",{tiledImage:v,tile:we}),L(v.coverage,K,j,Y,!1);var De=we.loaded||we.loading||_(v.loadingCoverage,K,j,Y);if(L(v.loadingCoverage,K,j,Y,De),!we.exists||(B&&!ke&&(_(v.coverage,K,j,Y)?L(v.coverage,K,j,Y,!0):ke=!0),!ke))return be;if(c(we,v.source.tileOverlap,v.viewport,ge,ie,v),!we.loaded)if(we.context2D)u(v,we);else{var Fe=v._tileCache.getImageRecord(we.cacheKey);if(Fe){var ze=Fe.getImage();u(v,we,ze)}}if(we.loaded){var ce=R(v,we,j,Y,K,ae,ve);ce&&(v._needsDraw=!0)}else we.loading?v._tilesLoading++:De||(be=Z(be,we));return be}function a(v,B,U,j,Y,K,ae,ie,ge,ye){var ve,be,we,ke,De,Fe,ze,ce,je;return K[U]||(K[U]={}),K[U][v]||(K[U][v]={}),K[U][v][B]||(ve=(ie.x+v%ie.x)%ie.x,be=(ie.y+B%ie.y)%ie.y,we=Y.getTileBounds(U,ve,be),ke=Y.getTileBounds(U,ve,be,!0),De=Y.tileExists(U,ve,be),Fe=Y.getTileUrl(U,ve,be),j.loadTilesWithAjax?(ze=Y.getTileAjaxHeaders(U,ve,be),t.isPlainObject(j.ajaxHeaders)&&(ze=t.extend({},j.ajaxHeaders,ze))):ze=null,ce=Y.getContext2D?Y.getContext2D(U,ve,be):void 0,we.x+=(v-ve)/ie.x,we.y+=ye/ge*((B-be)/ie.y),je=new t.Tile(U,v,B,we,De,Fe,ce,j.loadTilesWithAjax,ze,ke),ve===ie.x-1&&(je.isRightMost=!0),be===ie.y-1&&(je.isBottomMost=!0),K[U][v][B]=je),je=K[U][v][B],je.lastTouchTime=ae,je}function l(v,B,U){B.loading=!0,v._imageLoader.addJob({src:B.url,loadWithAjax:B.loadWithAjax,ajaxHeaders:B.ajaxHeaders,crossOriginPolicy:v.crossOriginPolicy,ajaxWithCredentials:v.ajaxWithCredentials,callback:function(j,Y,K){h(v,B,U,j,Y,K)},abort:function(){B.loading=!1}})}function h(v,B,U,j,Y,K){if(!j){t.console.log("Tile %s failed to load: %s - error: %s",B,B.url,Y),v.viewer.raiseEvent("tile-load-failed",{tile:B,tiledImage:v,time:U,message:Y,tileRequest:K}),B.loading=!1,B.exists=!1;return}if(U<v.lastResetTime){t.console.log("Ignoring tile %s loaded before reset: %s",B,B.url),B.loading=!1;return}var ae=function(){var ie=v.source.getClosestLevel();u(v,B,j,ie,K)};v._midDraw?window.setTimeout(ae,1):ae()}function u(v,B,U,j,Y){var K=0;function ae(){return K++,ie}function ie(){K--,K===0&&(B.loading=!1,B.loaded=!0,B.context2D||v._tileCache.cacheTile({image:U,tile:B,cutoff:j,tiledImage:v}),v._needsDraw=!0)}v.viewer.raiseEvent("tile-loaded",{tile:B,tiledImage:v,tileRequest:Y,image:U,getCompletionCallback:ae}),ae()()}function c(v,B,U,j,Y,K){var ae=v.bounds.getTopLeft();ae.x*=K._scaleSpring.current.value,ae.y*=K._scaleSpring.current.value,ae.x+=K._xSpring.current.value,ae.y+=K._ySpring.current.value;var ie=v.bounds.getSize();ie.x*=K._scaleSpring.current.value,ie.y*=K._scaleSpring.current.value;var ge=U.pixelFromPointNoRotate(ae,!0),ye=U.pixelFromPointNoRotate(ae,!1),ve=U.deltaPixelsFromPointsNoRotate(ie,!0),be=U.deltaPixelsFromPointsNoRotate(ie,!1),we=ye.plus(be.divide(2)),ke=j.squaredDistanceTo(we);B||(ve=ve.plus(new t.Point(1,1))),v.isRightMost&&K.wrapHorizontal&&(ve.x+=.75),v.isBottomMost&&K.wrapVertical&&(ve.y+=.75),v.position=ge,v.size=ve,v.squaredDistance=ke,v.visibility=Y}function R(v,B,U,j,Y,K,ae){var ie=1e3*v.blendTime,ge,ye;if(B.blendStart||(B.blendStart=ae),ge=ae-B.blendStart,ye=ie?Math.min(1,ge/ie):1,v.alwaysBlend&&(ye*=K),B.opacity=ye,v.lastDrawn.push(B),ye===1)L(v.coverage,Y,U,j,!0),v._hasOpaqueTile=!0;else if(ge<ie)return!0;return!1}function b(v,B,U,j){var Y,K,ae,ie;if(!v[B])return!1;if(U===void 0||j===void 0){Y=v[B];for(ae in Y)if(Object.prototype.hasOwnProperty.call(Y,ae)){K=Y[ae];for(ie in K)if(Object.prototype.hasOwnProperty.call(K,ie)&&!K[ie])return!1}return!0}return v[B][U]===void 0||v[B][U][j]===void 0||v[B][U][j]===!0}function _(v,B,U,j){return U===void 0||j===void 0?b(v,B+1):b(v,B+1,2*U,2*j)&&b(v,B+1,2*U,2*j+1)&&b(v,B+1,2*U+1,2*j)&&b(v,B+1,2*U+1,2*j+1)}function L(v,B,U,j,Y){if(!v[B]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",B);return}v[B][U]||(v[B][U]={}),v[B][U][j]=Y}function z(v,B){v[B]={}}function Z(v,B){return!v||B.visibility>v.visibility||B.visibility==v.visibility&&B.squaredDistance<v.squaredDistance?B:v}function X(v,B){if(!(v.opacity===0||B.length===0&&!v.placeholderFillStyle)){var U=B[0],j;U&&(j=v.opacity<1||v.compositeOperation&&v.compositeOperation!=="source-over"||!v._isBottomItem()&&U._hasTransparencyChannel());var Y,K,ae=v.viewport.getZoom(!0),ie=v.viewportToImageZoom(ae);B.length>1&&ie>v.smoothTileEdgesMinZoom&&!v.iOSDevice&&v.getRotation(!0)%360==0&&t.supportsCanvas&&(j=!0,Y=U.getScaleForEdgeSmoothing(),K=U.getTranslationForEdgeSmoothing(Y,v._drawer.getCanvasSize(!1),v._drawer.getCanvasSize(!0)));var ge;j&&(Y||(ge=v.viewport.viewportToViewerElementRectangle(v.getClippedBounds(!0)).getIntegerBoundingBox(),v._drawer.viewer.viewport.getFlip()&&(v.viewport.degrees!==0||v.getRotation(!0)%360!=0)&&(ge.x=v._drawer.viewer.container.clientWidth-(ge.x+ge.width)),ge=ge.times(t.pixelDensityRatio)),v._drawer._clear(!0,ge)),Y||(v.viewport.degrees!==0&&v._drawer._offsetForRotation({degrees:v.viewport.degrees,useSketch:j}),v.getRotation(!0)%360!=0&&v._drawer._offsetForRotation({degrees:v.getRotation(!0),point:v.viewport.pixelFromPointNoRotate(v._getRotationPoint(!0),!0),useSketch:j}),v.viewport.degrees===0&&v.getRotation(!0)%360==0&&v._drawer.viewer.viewport.getFlip()&&v._drawer._flip());var ye=!1;if(v._clip){v._drawer.saveContext(j);var ve=v.imageToViewportRectangle(v._clip,!0);ve=ve.rotate(-v.getRotation(!0),v._getRotationPoint(!0));var be=v._drawer.viewportToDrawerRectangle(ve);Y&&(be=be.times(Y)),K&&(be=be.translate(K)),v._drawer.setClip(be,j),ye=!0}if(v._croppingPolygons){v._drawer.saveContext(j);try{var we=v._croppingPolygons.map(function(ze){return ze.map(function(ce){var je=v.imageToViewportCoordinates(ce.x,ce.y,!0).rotate(-v.getRotation(!0),v._getRotationPoint(!0)),Ze=v._drawer.viewportCoordToDrawerCoord(je);return Y&&(Ze=Ze.times(Y)),Ze})});v._drawer.clipWithPolygons(we,j)}catch(ze){t.console.error(ze)}ye=!0}if(v.placeholderFillStyle&&v._hasOpaqueTile===!1){var ke=v._drawer.viewportToDrawerRectangle(v.getBounds(!0));Y&&(ke=ke.times(Y)),K&&(ke=ke.translate(K));var De=null;typeof v.placeholderFillStyle=="function"?De=v.placeholderFillStyle(v,v._drawer.context):De=v.placeholderFillStyle,v._drawer.drawRectangle(ke,De,j)}for(var Fe=B.length-1;Fe>=0;Fe--)U=B[Fe],v._drawer.drawTile(U,v._drawingHandler,j,Y,K),U.beingDrawn=!0,v.viewer&&v.viewer.raiseEvent("tile-drawn",{tiledImage:v,tile:U});ye&&v._drawer.restoreContext(j),Y||(v.getRotation(!0)%360!=0&&v._drawer._restoreRotationChanges(j),v.viewport.degrees!==0&&v._drawer._restoreRotationChanges(j)),j&&(Y&&(v.viewport.degrees!==0&&v._drawer._offsetForRotation({degrees:v.viewport.degrees,useSketch:!1}),v.getRotation(!0)%360!=0&&v._drawer._offsetForRotation({degrees:v.getRotation(!0),point:v.viewport.pixelFromPointNoRotate(v._getRotationPoint(!0),!0),useSketch:!1})),v._drawer.blendSketch({opacity:v.opacity,scale:Y,translate:K,compositeOperation:v.compositeOperation,bounds:ge}),Y&&(v.getRotation(!0)%360!=0&&v._drawer._restoreRotationChanges(!1),v.viewport.degrees!==0&&v._drawer._restoreRotationChanges(!1))),Y||v.viewport.degrees===0&&v.getRotation(!0)%360==0&&v._drawer.viewer.viewport.getFlip()&&v._drawer._flip(),oe(v,B)}}function oe(v,B){if(v.debugMode)for(var U=B.length-1;U>=0;U--){var j=B[U];try{v._drawer.drawDebugInfo(j,B.length,U,v)}catch(Y){t.console.error(Y)}}}}(OpenSeadragon),function(t){var s=function(a){t.console.assert(a,"[TileCache.cacheTile] options is required"),t.console.assert(a.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(a.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=a.tile,this.tiledImage=a.tiledImage},r=function(a){t.console.assert(a,"[ImageRecord] options is required"),t.console.assert(a.image,"[ImageRecord] options.image is required"),this._image=a.image,this._tiles=[]};r.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var a=document.createElement("canvas");a.width=this._image.width,a.height=this._image.height,this._renderedContext=a.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(a){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=a},addTile:function(a){t.console.assert(a,"[ImageRecord.addTile] tile is required"),this._tiles.push(a)},removeTile:function(a){for(var l=0;l<this._tiles.length;l++)if(this._tiles[l]===a){this._tiles.splice(l,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",a)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(a){a=a||{},this._maxImageCacheCount=a.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(a){t.console.assert(a,"[TileCache.cacheTile] options is required"),t.console.assert(a.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(a.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(a.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var l=a.cutoff||0,h=this._tilesLoaded.length,u=this._imagesLoaded[a.tile.cacheKey];if(u||(t.console.assert(a.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),u=this._imagesLoaded[a.tile.cacheKey]=new r({image:a.image}),this._imagesLoadedCount++),u.addTile(a.tile),a.tile.cacheImageRecord=u,this._imagesLoadedCount>this._maxImageCacheCount){for(var c=null,R=-1,b=null,_,L,z,Z,X,oe,v=this._tilesLoaded.length-1;v>=0;v--)if(oe=this._tilesLoaded[v],_=oe.tile,!(_.level<=l||_.beingDrawn)){if(!c){c=_,R=v,b=oe;continue}Z=_.lastTouchTime,L=c.lastTouchTime,X=_.level,z=c.level,(Z<L||Z==L&&X>z)&&(c=_,R=v,b=oe)}c&&R>=0&&(this._unloadTile(b),h=R)}this._tilesLoaded[h]=new s({tile:a.tile,tiledImage:a.tiledImage})},clearTilesFor:function(a){t.console.assert(a,"[TileCache.clearTilesFor] tiledImage is required");for(var l,h=0;h<this._tilesLoaded.length;++h)l=this._tilesLoaded[h],l.tiledImage===a&&(this._unloadTile(l),this._tilesLoaded.splice(h,1),h--)},getImageRecord:function(a){return t.console.assert(a,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[a]},_unloadTile:function(a){t.console.assert(a,"[TileCache._unloadTile] tileRecord is required");var l=a.tile,h=a.tiledImage;l.unload(),l.cacheImageRecord=null;var u=this._imagesLoaded[l.cacheKey];u.removeTile(l),u.getTileCount()||(u.destroy(),delete this._imagesLoaded[l.cacheKey],this._imagesLoadedCount--),h.viewer.raiseEvent("tile-unloaded",{tile:l,tiledImage:h})}}}(OpenSeadragon),function(t){t.World=function(s){var r=this;t.console.assert(s.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=s.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(a){r._autoRefigureSizes?r._figureSizes():r._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(s,r){if(t.console.assert(s,"[World.addItem] item is required"),t.console.assert(s instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),r=r||{},r.index!==void 0){var a=Math.max(0,Math.min(this._items.length,r.index));this._items.splice(a,0,s)}else this._items.push(s);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,s.addHandler("bounds-change",this._delegatedFigureSizes),s.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:s})},getItemAt:function(s){return t.console.assert(s!==void 0,"[World.getItemAt] index is required"),this._items[s]},getIndexOfItem:function(s){return t.console.assert(s,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,s)},getItemCount:function(){return this._items.length},setItemIndex:function(s,r){t.console.assert(s,"[World.setItemIndex] item is required"),t.console.assert(r!==void 0,"[World.setItemIndex] index is required");var a=this.getIndexOfItem(s);if(r>=this._items.length)throw new Error("Index bigger than number of layers.");r===a||a===-1||(this._items.splice(a,1),this._items.splice(r,0,s),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:s,previousIndex:a,newIndex:r}))},removeItem:function(s){t.console.assert(s,"[World.removeItem] item is required");var r=t.indexOf(this._items,s);r!==-1&&(s.removeHandler("bounds-change",this._delegatedFigureSizes),s.removeHandler("clip-change",this._delegatedFigureSizes),s.destroy(),this._items.splice(r,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(s))},removeAll:function(){this.viewer._cancelPendingImages();var s,r;for(r=0;r<this._items.length;r++)s=this._items[r],s.removeHandler("bounds-change",this._delegatedFigureSizes),s.removeHandler("clip-change",this._delegatedFigureSizes),s.destroy();var a=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,r=0;r<a.length;r++)s=a[r],this._raiseRemoveItem(s)},resetItems:function(){for(var s=0;s<this._items.length;s++)this._items[s].reset()},update:function(){for(var s=!1,r=0;r<this._items.length;r++)s=this._items[r].update()||s;return s},draw:function(){for(var s=0;s<this._items.length;s++)this._items[s].draw();this._needsDraw=!1},needsDraw:function(){for(var s=0;s<this._items.length;s++)if(this._items[s].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(s){this._autoRefigureSizes=s,s&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(s){s=s||{};var r=s.immediately||!1,a=s.layout||t.DEFAULT_SETTINGS.collectionLayout,l=s.rows||t.DEFAULT_SETTINGS.collectionRows,h=s.columns||t.DEFAULT_SETTINGS.collectionColumns,u=s.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,c=s.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,R=u+c,b;!s.rows&&h?b=h:b=Math.ceil(this._items.length/l);var _=0,L=0,z,Z,X,oe,v;this.setAutoRefigureSizes(!1);for(var B=0;B<this._items.length;B++)B&&B%b==0&&(a==="horizontal"?(L+=R,_=0):(_+=R,L=0)),z=this._items[B],Z=z.getBounds(),Z.width>Z.height?X=u:X=u*(Z.width/Z.height),oe=X*(Z.height/Z.width),v=new t.Point(_+(u-X)/2,L+(u-oe)/2),z.setPosition(v,r),z.setWidth(X,r),a==="horizontal"?_+=R:L+=R;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var s=this._homeBounds?this._homeBounds.clone():null,r=this._contentSize?this._contentSize.clone():null,a=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var l=this._items[0],h=l.getBounds();this._contentFactor=l.getContentSize().x/h.width;for(var u=l.getClippedBounds().getBoundingBox(),c=u.x,R=u.y,b=u.x+u.width,_=u.y+u.height,L=1;L<this._items.length;L++)l=this._items[L],h=l.getBounds(),this._contentFactor=Math.max(this._contentFactor,l.getContentSize().x/h.width),u=l.getClippedBounds().getBoundingBox(),c=Math.min(c,u.x),R=Math.min(R,u.y),b=Math.max(b,u.x+u.width),_=Math.max(_,u.y+u.height);this._homeBounds=new t.Rect(c,R,b-c,_-R),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==a||!this._homeBounds.equals(s)||!this._contentSize.equals(r))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(s){this.raiseEvent("remove-item",{item:s})}})}(OpenSeadragon)}),ei=n$1((t,s)=>{(function(r,a){typeof t=="object"&&typeof s=="object"?s.exports=a(at()):typeof define=="function"&&define.amd?define(["openseadragon"],a):typeof t=="object"?t["openseadragon-viewerinputhook"]=a(at()):r["openseadragon-viewerinputhook"]=a(r.openseadragon)})(window,function(r){return function(a){function l(u){if(h[u])return h[u].exports;var c=h[u]={i:u,l:!1,exports:{}};return a[u].call(c.exports,c,c.exports,l),c.l=!0,c.exports}var h={};return l.m=a,l.c=h,l.d=function(u,c,R){l.o(u,c)||Object.defineProperty(u,c,{enumerable:!0,get:R})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,c){if(1&c&&(u=l(u)),8&c||4&c&&typeof u=="object"&&u&&u.__esModule)return u;var R=Object.create(null);if(l.r(R),Object.defineProperty(R,"default",{enumerable:!0,value:u}),2&c&&typeof u!="string")for(var b in u)l.d(R,b,function(_){return u[_]}.bind(null,b));return R},l.n=function(u){var c=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(c,"a",c),c},l.o=function(u,c){return Object.prototype.hasOwnProperty.call(u,c)},l.p="",l(l.s=1)}([function(a){a.exports=r},function(a,l,h){h.r(l);var u=h(0),c=h.n(u);l.default=function(R,b){if(!R.version||1>R.version.major)throw new Error("OpenSeadragonViewerInputHook requires OpenSeadragon version 1.0.0+");return R.Viewer.prototype.addViewerInputHook=function(_){return(_=_||{}).viewer=this,new b.ViewerInputHook(_)},b.ViewerInputHook=function(_){var L,z;for((_=_||{}).hooks=_.hooks||[],this.viewer=_.viewer||null,this.viewerTrackers={},this.hooks=[],this.viewer&&(this.viewerTrackers.viewer=this.viewer.innerTracker,this.viewerTrackers.viewer_outer=this.viewer.outerTracker),L=0;L<_.hooks.length;L++){if(typeof _.hooks[L].tracker=="string"){if(!this.viewer)throw new Error("A viewer must be specified.");if((z=this.viewerTrackers[_.hooks[L].tracker])===void 0)throw new Error("Unknown tracker specified: "+_.hooks[L].tracker)}else z=_.hooks[L].tracker;this.hooks.push({tracker:z,handlerName:_.hooks[L].handler,origHandler:z[_.hooks[L].handler],hookHandler:_.hooks[L].hookHandler}),function(Z,X,oe,v){var B=X[oe];X[oe]=function(U){return Z._callHandlers(v,B,U)}}(this,z,_.hooks[L].handler,_.hooks[L].hookHandler)}},b.ViewerInputHook.version={versionStr:"2.2.1",major:2,minor:2,revision:1},b.ViewerInputHook.prototype._callHandlers=function(_,L,z){var Z=_(z);return L&&!z.stopHandlers&&(Z=L(z)),!z.stopBubbling&&Z},b.ViewerInputHook.prototype.destroy=function(){for(;0<this.hooks.length;){var _=this.hooks.pop();_.tracker[_.handlerName]=_.origHandler}this.viewer&&(delete this.viewerTrackers.viewer,delete this.viewerTrackers.viewer_outer,this.viewer=null)},b.ViewerInputHook}(c.a||window.OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{})}]).default})}),Ie=class{constructor(t,s,r,a){this.x=t,this.y=s,this.w=r,this.h=a}toString(){return`${this.x},${this.y},${this.w},${this.h}`}static fromString(t){t=t.replace("xywh=","");let s=t.split(",");return new Ie(Number(s[0]),Number(s[1]),Number(s[2]),Number(s[3]))}},$e=class{constructor(t,s){this.x=t,this.y=s}},vt=class{constructor(){this.region=new f(0,0),this.regionPos=new $e(0,0),this.size=new f(0,0)}},W=o(qt()),et=o(xf()),Me=o(G()),gi=({canvases:t,confinedImageSize:s,content:r,getConfinedImageDimensions:a,getConfinedImageUri:l,getCroppedImageDimensions:h,locale:u,manifest:c,maxImageWidth:R,mediaDownloadEnabled:b,onClose:_,onDownloadCurrentView:L,onDownloadSelection:z,onShowTermsOfUse:Z,open:X,paged:oe,parent:v,resources:B,requiredStatement:U,rotation:j,selectionEnabled:Y,sequence:K,termsOfUseEnabled:ae,triggerButton:ie})=>{let ge=(0,W.useRef)(null),[ye,ve]=(0,W.useState)({top:"0px",left:"0px"}),[be,we]=(0,W.useState)("0px 0px"),[ke,De]=(0,W.useState)("left"),Fe=j%180==0;if((0,W.useEffect)(()=>{if(X){let M=v.clientHeight-ge.current.clientHeight-ie.clientHeight,V=ie.getBoundingClientRect().left-v.getBoundingClientRect().left,q=T.normalise(V,0,v.clientWidth);V=v.clientWidth*q-ge.current.clientWidth*q;let de=ge.current.clientWidth*q;ve({top:`${M}px`,left:`${V}px`}),we(`${de}px 0px`)}},[X]),!X)return null;function ze(M){if(M.externalResource.data){let V=M.externalResource.data.width,q=M.externalResource.data.height;if(V&&q)return new Me.Size(V,q)}return null}function ce(M){let V=ze(M),q=M.getMaxDimensions();if(!V)return null;if(!q||V.width<=q.width&&V.height<=q.height)return V;let de=q.width/V.width,Q=q.height/V.height,Pe=Math.min(de,Q);return new Me.Size(Math.floor(V.width*Pe),Math.floor(V.height*Pe))}function je(M){return!M||!M.length?!1:Me.Utils.isLevel0ImageProfile(M[0])}function Ze(){return t[ke==="left"?0:1]}function st(){return B&&B.length?B.length>1?B[ke==="left"?0:1]:B[0]:null}function Xe(M){let V=st();if(!V)return!1;let q=Ze();if(!q.externalResource.hasServiceDescriptor()||je(q.externalResource.data.profile))return M===E.WHOLE_IMAGE_HIGH_RES&&!(oe||oe&&V);switch(M){case E.CURRENT_VIEW:return!oe;case E.CANVAS_RENDERINGS:case E.IMAGE_RENDERINGS:case E.WHOLE_IMAGE_HIGH_RES:let de=q.getMaxDimensions();return de?de.width<=R:!0;case E.WHOLE_IMAGE_LOW_RES:let Q=ce(q);return Q?Q.width>s:!1;case E.SELECTION:return Y;case E.RANGE_RENDERINGS:return q.ranges&&q.ranges.length?q.ranges[0].getRenderings().length>0:!1;case E.ENTIRE_FILE_AS_ORIGINAL:return b;default:return!0}}function Qe(M){let V=M.getImages();return V[0]?V[0].getResource():null}function Ke(M){let V=Qe(M);if(V){let q=V.getFormat();if(q)return q.toString()}return null}function ot(M){let V=ce(M);if(V){let q=V.width,de=M.getCanonicalImageUri(q);if(M.externalResource&&M.externalResource.hasServiceDescriptor()){let Q=de.split("/");Q[Q.length-2]=String(j),de=Q.join("/")}return de}else if(M.externalResource&&!M.externalResource.hasServiceDescriptor())return M.externalResource.dataUri;return""}function rt(){let M="",V=Ze(),q=Ke(V);q?q=p.simplifyMimeType(q):q="?";let de=ce(V);return de?M=Fe?P.format(r.wholeImageHighRes,de.width.toString(),de.height.toString(),q):P.format(r.wholeImageHighRes,de.height.toString(),de.width.toString(),q):V.externalResource&&!V.externalResource.hasServiceDescriptor()&&(M=P.format(r.wholeImageHighRes,"?","?",q)),M}function lt(){let M=Ze(),V=a(M),q="";return V&&(q=Fe?P.format(r.wholeImageLowResAsJpg,V.width.toString(),V.height.toString()):P.format(r.wholeImageLowResAsJpg,V.height.toString(),V.width.toString())),q}function it(){let M=r.currentViewAsJpg,V=h(Ze());return V&&(M=Fe?P.format(M,V.size.width.toString(),V.size.height.toString()):P.format(M,V.size.height.toString(),V.size.width.toString())),M}function Je({resource:M,defaultLabel:V}){let q=M.getRenderings();return W.default.createElement(W.default.Fragment,null,q.map((de,Q)=>{let Pe=Me.LanguageMap.getValue(de.getLabel(),u);Pe?Pe+=" ({0})":Pe=V;let Ve=p.simplifyMimeType(de.getFormat().toString());return Pe=P.format(Pe,Ve),W.default.createElement("li",{key:Q},W.default.createElement("button",{onClick:()=>{window.open(de.id,"_blank")}},Pe))}))}function ht(){var V;let M=Ze();return W.default.createElement(W.default.Fragment,null,(V=M.ranges)==null?void 0:V.map(q=>{r.entireFileAsOriginal}))}function nt(){let M=Ze().getImages();return W.default.createElement(W.default.Fragment,null,M.map(V=>{V.getResource(),r.entireFileAsOriginal}))}function ct(){let M=Ze();return W.default.createElement(Je,{resource:M,defaultLabel:r.entireFileAsOriginal})}function ut(){return K.getRenderings().length>0||c.getRenderings.length>0}function g(){return W.default.createElement(W.default.Fragment,null,W.default.createElement(Je,{resource:K,defaultLabel:r.entireFileAsOriginal}),W.default.createElement(Je,{resource:c,defaultLabel:r.entireFileAsOriginal}))}function C(){return ae&&U?W.default.createElement("button",{onClick:()=>{Z()}},r.termsOfUse):null}return W.default.createElement("div",{ref:ge,className:(0,et.default)("overlay download"),style:ye},W.default.createElement("div",{className:"top"}),W.default.createElement("div",{className:"middle"},W.default.createElement("div",{className:"content"},W.default.createElement("div",{role:"heading",className:"heading"},r.download),W.default.createElement("h2",null,r.individualPages),t.length===2&&W.default.createElement("div",{className:"pages"},W.default.createElement("div",{onClick:()=>{De("left")},className:(0,et.default)("page left",{selected:ke==="left"})},W.default.createElement("span",{className:"label"},t[0].getLabel().getValue())),W.default.createElement("div",{onClick:()=>{De("right")},className:(0,et.default)("page right",{selected:ke==="right"})},W.default.createElement("span",{className:"label"},t[1].getLabel().getValue()))),W.default.createElement("ol",{className:"options"},Xe(E.CURRENT_VIEW)&&W.default.createElement("li",{className:"option single"},W.default.createElement("button",{onClick:()=>{L(Ze())}},it())),Xe(E.WHOLE_IMAGE_HIGH_RES)&&W.default.createElement("li",{className:"option single"},W.default.createElement("button",{onClick:()=>{window.open(ot(Ze()))}},rt())),Xe(E.WHOLE_IMAGE_LOW_RES)&&W.default.createElement("li",{className:"option single"},W.default.createElement("button",{onClick:()=>{let M=l(Ze());M&&window.open(M)}},lt())),Xe(E.RANGE_RENDERINGS)&&W.default.createElement(ht,null),Xe(E.IMAGE_RENDERINGS)&&W.default.createElement(nt,null),Xe(E.CANVAS_RENDERINGS)&&W.default.createElement(ct,null)),(ut()||Xe(E.SELECTION))&&W.default.createElement("h2",null,r.allPages),W.default.createElement("ol",{className:"options"},Xe(E.MANIFEST_RENDERINGS)&&W.default.createElement(g,null),Xe(E.SELECTION)&&W.default.createElement("li",{className:"option single"},W.default.createElement("button",{onClick:()=>{z()}},r.selection))),W.default.createElement("div",{className:"footer"},W.default.createElement(C,null))),W.default.createElement("div",{className:"buttons"},W.default.createElement("button",{type:"button",className:"btn btn-default close",tabIndex:0,onClick:()=>{_()}},r.close))),W.default.createElement("div",{className:(0,et.default)("bottom"),style:{backgroundPosition:be}}))},Yt=gi,ue=class{},O=ue;O.namespace="openseadragonExtension.",O.CURRENT_VIEW_URI=ue.namespace+"currentViewUri",O.DOUBLECLICK=ue.namespace+"doubleClick",O.IMAGE_SEARCH=ue.namespace+"imageSearch",O.MODE_CHANGE=ue.namespace+"modeChange",O.NEXT_SEARCH_RESULT=ue.namespace+"nextSearchResult",O.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=ue.namespace+"nextImagesSearchResultUnavailable",O.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=ue.namespace+"prevImagesSearchResultUnavailable",O.PAGE_SEARCH=ue.namespace+"pageSearch",O.PAGING_TOGGLED=ue.namespace+"pagingToggled",O.PREV_SEARCH_RESULT=ue.namespace+"prevSearchResult",O.PRINT=ue.namespace+"print",O.ROTATE=ue.namespace+"rotate",O.OPENSEADRAGON_ANIMATION_FINISH=ue.namespace+"animationFinish",O.OPENSEADRAGON_ANIMATION_START=ue.namespace+"animationStart",O.OPENSEADRAGON_ANIMATION=ue.namespace+"animation",O.OPENSEADRAGON_OPEN=ue.namespace+"open",O.OPENSEADRAGON_RESIZE=ue.namespace+"resize",O.OPENSEADRAGON_ROTATION=ue.namespace+"rotationChange",O.SEARCH_PREVIEW_FINISH=ue.namespace+"searchPreviewFinish",O.SEARCH_PREVIEW_START=ue.namespace+"searchPreviewStart",O.SEARCH=ue.namespace+"search",O.XYWH_CHANGE=ue.namespace+"xywhChange",O.ZOOM_IN=ue.namespace+"zoomIn",O.ZOOM_OUT=ue.namespace+"zoomOut";var pi=ir(),wt=class extends k{constructor(t){super(t)}create(){this.setConfig("externalContentDialogue"),super.create(),this.openCommand=e.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=e.HIDE_EXTERNALCONTENT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,t=>{this.open(),this.$iframe.prop("src",t.uri)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$iframe=pi("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()}resize(){super.resize(),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())}},xt=ir(),yt=class extends Xt{constructor(t){super(t)}create(){this.setConfig("mobileFooterPanel"),super.create(),this.$rotateButton=xt(`
            <button class="btn imageBtn rotate" title="${this.content.rotateRight}">
                <i class="uv-icon-rotate" aria-hidden="true"></i>${this.content.rotateRight}
            </button>
        `),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=xt(`
            <button class="btn imageBtn zoomOut" title="${this.content.zoomOut}">
                <i class="uv-icon-zoom-out" aria-hidden="true"></i>${this.content.zoomOut}
            </button>
        `),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=xt(`
            <button class="btn imageBtn zoomIn" title="${this.content.zoomIn}">
                <i class="uv-icon-zoom-in" aria-hidden="true"></i>${this.content.zoomIn}
            </button>
        `),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed(()=>{this.extensionHost.publish(O.ZOOM_IN)}),this.$zoomOutButton.onPressed(()=>{this.extensionHost.publish(O.ZOOM_OUT)}),this.$rotateButton.onPressed(()=>{this.extensionHost.publish(O.ROTATE)})}resize(){super.resize(),setTimeout(()=>{this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},1)}},Be=ir(),tt=class{constructor(t,s,r,a,l=300,h=2,u=!1,c=!1){this._$element=t,this._autoCompleteFunc=s,this._delay=l,this._minChars=h,this._onSelect=a,this._parseResultsFunc=r,this._positionAbove=u,this._allowWords=c,this._$searchResultsList=Be('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=Be('<li class="result"><a href="#" tabindex="-1"></a></li>');let R=function(){let _=0;return function(L,z){clearTimeout(_),_=setTimeout(L,z)}}(),b=this;this._$element.on("keydown",function(_){let L=_.originalEvent,z=N.getCharCode(L),Z=!1;(z===F.LeftArrow||z===F.RightArrow)&&(Z=!0),Z&&(L.cancelBubble=!0,L.stopPropagation&&L.stopPropagation())}),this._$element.on("keyup",function(_){if(!b._getSelectedListItem().length&&_.keyCode===F.Enter){b._onSelect(b._getTerms());return}if(_.keyCode!==F.Tab){if(Tg(b._$searchResultsList)&&b._results.length){if(_.keyCode===F.Enter)b._searchForItem(b._getSelectedListItem());else if(_.keyCode===F.DownArrow){b._setSelectedResultIndex(1);return}else if(_.keyCode===F.UpArrow){b._setSelectedResultIndex(-1);return}}_.keyCode!==F.Enter&&R(()=>{let L=b._getTerms();L&&L.length>b._minChars&&b._searchForWords(L)?b._search(L):(b._clearResults(),b._hideResults())},b._delay)}}),Be(document).on("mouseup",_=>{this._$searchResultsList.parent().has(Be(_.target)[0]).length===0&&(this._clearResults(),this._hideResults())}),Be(document).on("focusin",_=>{this._$searchResultsList.has(Be(_.target)[0]).length===0&&!this._$element.is(Be(_.target)[0])&&(this._clearResults(),this._hideResults())}),this._hideResults()}_searchForWords(t){return!!(this._allowWords||!t.includes(" "))}_getTerms(){return this._$element.val().trim()}_setSelectedResultIndex(t){let s;t===1?s=this._selectedResultIndex+1:s=this._selectedResultIndex-1;let r=this._$searchResultsList.find("li");s<0?s=r.length-1:s>r.length-1&&(s=0),this._selectedResultIndex=s,r.removeClass("selected");let a=r.eq(this._selectedResultIndex);a.addClass("selected");let l=a.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(l)}_search(t){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();let s=this;this._autoCompleteFunc(t,r=>{s._listResults(r)})}_clearResults(){this._$searchResultsList.empty()}_hideResults(){this._$searchResultsList.hide()}_showResults(){this._selectedResultIndex=-1,this._$searchResultsList.show()}_updateListPosition(){this._positionAbove?this._$searchResultsList.css({top:this._$searchResultsList.outerHeight(!0)*-1}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})}_listResults(t){if(this._results=this._parseResultsFunc(t),this._clearResults(),!this._results.length){this._hideResults();return}for(let r=0;r<this._results.length;r++){let a=this._results[r],l=this._$searchResultTemplate.clone();l.find("a").text(a),this._$searchResultsList.append(l)}this._updateListPosition();let s=this;this._$searchResultsList.find("li").each((r,a)=>{Be(a).on("click",function(l){l.preventDefault(),s._searchForItem(Be(this))})})}_searchForItem(t){let s=t.find("a").text();this._$element.val(s),this._hideResults(),this._onSelect(s),this._clearResults(),this._hideResults()}_getSelectedListItem(){return this._$searchResultsList.find("li.selected")}},Tt=o(G()),le=ir(),bt=class extends Xt{constructor(t){super(t),this.placemarkerTouched=!1}create(){this.setConfig("searchFooterPanel"),super.create(),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE,()=>{this.canvasIndexChanged(),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton()}),this.extensionHost.subscribe(e.CLEAR_ANNOTATIONS,()=>{this.clearSearchResults()}),this.extensionHost.subscribe(O.MODE_CHANGE,()=>{this.settingsChanged()}),this.extensionHost.subscribe(O.SEARCH,a=>{this.terms=a}),this.extensionHost.subscribe(e.ANNOTATIONS,a=>{a.annotations.length&&(this.displaySearchResults(a.annotations,a.terms),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton())}),this.extensionHost.subscribe(e.ANNOTATIONS_EMPTY,()=>{this.hideSearchSpinner()}),this.extensionHost.subscribe(e.ANNOTATION_CHANGE,()=>{this.updatePrevButton(),this.updateNextButton()}),this.$printButton=le(`
          <button class="print btn imageBtn" title="${this.content.print}" tabindex="0">
            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>${this.content.print}
          </button>
        `),this.$options.prepend(this.$printButton),this.$searchContainer=le('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=le('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=le('<label class="label" for="searchWithinInput">'+this.content.searchWithin+"</label>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=le('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=le('<input class="searchText" id="searchWithinInput" autocomplete="off" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=le('<button class="imageButton searchButton"></button>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=le('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=le('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=le('<button class="previousResult">'+this.content.previousResult+"</button>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=le(`<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> '<span class="terms">y</span>'</span></div>`),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=le('<button class="clearSearch">'+this.content.clearSearch+"</button>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=le('<button class="nextResult">'+this.content.nextResult+"</button>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=le('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=le('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=le('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=le('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=le('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=le('<div role="heading" class="heading"></div>'),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=le("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var t=this;this.$searchButton.on("click",a=>{a.preventDefault(),this.search(this.$searchText.val())}),this.$searchText.on("focus",()=>{this.$searchText.val()===this.content.enterKeyword&&this.$searchText.val("")}),this.$placemarkerDetails.on("mouseover",()=>{t.extensionHost.publish(O.SEARCH_PREVIEW_START,this.currentPlacemarkerIndex)}),this.$placemarkerDetails.on("mouseleave",function(){le(this).hide(),t.extensionHost.publish(O.SEARCH_PREVIEW_FINISH);var a=t.getSearchResultPlacemarkers();a.removeClass("hover")}),this.onAccessibleClick(this.$placemarkerDetails,()=>{t.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex)}),this.$previousResultButton.on("click",a=>{a.preventDefault(),this.isPreviousButtonEnabled()&&t.extensionHost.publish(O.PREV_SEARCH_RESULT)}),this.$nextResultButton.on("click",a=>{a.preventDefault(),this.isNextButtonEnabled()&&t.extensionHost.publish(O.NEXT_SEARCH_RESULT)}),this.$clearSearchResultsButton.on("click",a=>{a.preventDefault(),t.extensionHost.publish(e.CLEAR_ANNOTATIONS)}),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),this.extension.helper.getTotalCanvases()===1&&this.$searchResultsContainer.hide();let s=this.extension.getAutoCompleteUri();s?new tt(this.$searchText,(a,l)=>{fetch(P.format(s,a)).then(h=>h.json()).then(h=>{l(h)})},a=>le.map(a.terms,l=>l.match),a=>{this.search(a)},300,2,!0,S.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",a=>{a.keyCode===F.Enter&&t.search(t.$searchText.val())}),this.$printButton.onPressed(()=>{t.extensionHost.publish(O.PRINT)}),this.updatePrintButton();var r=S.getBool(this.config.options.positionMarkerEnabled,!0);r||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())}isSearchEnabled(){return this.extension.isSearchEnabled()}isZoomToSearchResultEnabled(){return S.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}isPreviousButtonEnabled(){let t=this.extension.helper.canvasIndex,s=this.getFirstSearchResultCanvasIndex(),r=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?t<s?!1:!(t===s&&r===0):t>s}isNextButtonEnabled(){let t=this.extension.helper.canvasIndex,s=this.getLastSearchResultCanvasIndex(),r=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?t>s?!1:!(t===s&&r===this.getLastSearchResultRectIndex()):t<s}getSearchResults(){return this.extension.annotations}getCurrentSearchResultRectIndex(){return this.extension.getCurrentAnnotationRectIndex()}getFirstSearchResultCanvasIndex(){let t=this.getSearchResults();return!t||!t.length?-1:t[0].canvasIndex}getLastSearchResultCanvasIndex(){let t=this.getSearchResults();return!t||!t.length?-1:t[t.length-1].canvasIndex}getLastSearchResultRectIndex(){return this.extension.getLastAnnotationRectIndex()}updateNextButton(){let t=this.getSearchResults();t&&t.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))}updatePrevButton(){let t=this.getSearchResults();t&&t.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))}updatePrintButton(){S.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()}search(t){if(this.terms=t,this.terms===""||this.terms===this.content.enterKeyword){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,function(){this.$searchText.focus()});return}this.$searchText.blur(),this.showSearchSpinner(),this.extensionHost.publish(O.SEARCH,this.terms)}getSearchResultPlacemarkers(){return this.$searchResultsContainer.find(".searchResultPlacemarker")}setCurrentSearchResultPlacemarker(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),le('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")}positionSearchResultPlacemarkers(){let t=this.getSearchResults();if(!t||!t.length)return;let s=this.getSearchResultPlacemarkers(),r=s.length===0;s.remove();let a=this.getPageLineRatio(),l=this.$line.position().top,h=this.$line.position().left,u=this;for(let c=0;c<t.length;c++){let R=t[c],b=R.canvasIndex*a,_=le('<div class="searchResultPlacemarker" tabindex="0" data-index="'+R.canvasIndex+'"></div>');_[0].ontouchstart=function(Z){u.onPlacemarkerTouchStart.call(this,u)},_.click(function(Z){u.onPlacemarkerClick.call(this,u)}),_.mouseenter(function(Z){u.onPlacemarkerMouseEnter.call(this,u)}),this.onAccessibleClick(_,Z=>{u.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex),u.onPlacemarkerMouseLeave.call(this,Z,u)},!1),_.mouseleave(function(Z){u.onPlacemarkerMouseLeave.call(this,Z,u)}),_.blur(function(Z){u.onPlacemarkerMouseLeave.call(this,Z,u)}),this.$searchResultsContainer.append(_);let L=l-_.height(),z=h+b-_.width()/2;_.css({top:L,left:z}),c===0&&r&&_.focus()}}onPlacemarkerTouchStart(t){t.placemarkerTouched=!0}onPlacemarkerClick(t){t.placemarkerTouched||(t.placemarkerTouched=!1)}onPlacemarkerMouseEnter(t){if(t.placemarkerTouched)return;let s=le(this);s.addClass("hover");let r=parseInt(s.attr("data-index"));t.extensionHost.publish(O.SEARCH_PREVIEW_START,r);let a=t.getSearchResultPlacemarkers().index(s[0]);t.currentPlacemarkerIndex=r,t.$placemarkerDetails.show();let l="{0} {1}";if(t.isPageModeEnabled()){let b=t.extension.helper.getCanvasByIndex(r),_=Tt.LanguageMap.getValue(b.getLabel());!_&&t.extension.helper.manifest&&(_=t.extension.helper.manifest.options.defaultLabel),_&&(l=P.format(l,t.content.pageCaps,_))}else l=P.format(l,t.content.imageCaps,String(r+1));t.$placemarkerDetailsTop.html(l);let h=t.getSearchResults();if(h){let b=h[a],_="";t.terms&&(_=P.ellipsis(t.terms,t.options.elideDetailsTermsCount));let L=t.content.instanceFound,z=t.content.instancesFound,Z="";b.rects.length===1?(Z=P.format(L,_),t.$placemarkerDetailsBottom.html(Z)):(Z=P.format(z,String(b.rects.length),_),t.$placemarkerDetailsBottom.html(Z))}let u=s.position(),c=u.top-t.$placemarkerDetails.height(),R=u.left;R<t.$placemarkerDetails.width()/2?R=0-s.width()/2:R>t.$line.width()-t.$placemarkerDetails.width()/2?R=t.$line.width()-t.$placemarkerDetails.width()+s.width()/2:R-=t.$placemarkerDetails.width()/2,t.$placemarkerDetails.css({top:c,left:R})}onPlacemarkerMouseLeave(t,s){s.extensionHost.publish(O.SEARCH_PREVIEW_FINISH);let r=le(this),a=t.toElement||t.relatedTarget,l=le(a).closest(s.$placemarkerDetails).length;a!=s.$placemarkerDetails.get(0)&&l===0&&(s.$placemarkerDetails.hide(),r.removeClass("hover"))}setPageMarkerPosition(){if(this.extension.helper.canvasIndex===null)return;let t=this.getPageLineRatio(),s=this.$line.position().top,r=this.$line.position().left,a=this.extension.helper.canvasIndex*t,l=s,h=r+a;this.$pagePositionMarker.css({top:l,left:h});let u=this.$line.width();h+this.$pagePositionLabel.outerWidth(!0)>u?(h-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:l,left:h})}clearSearchResults(){!this.isSearchEnabled()||(this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus())}getPageLineRatio(){let t=this.$line.width();return this.extension.helper.getTotalCanvases()===1?0:t/(this.extension.helper.getTotalCanvases()-1)}canvasIndexChanged(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()}settingsChanged(){this.setPlacemarkerLabel()}setPlacemarkerLabel(){let t=this.content.displaying,s=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){let r=this.extension.helper.getCanvasByIndex(s),a=Tt.LanguageMap.getValue(r.getLabel());a||(a=this.content.defaultLabel);let l=this.extension.helper.getLastCanvasLabel(!0);l&&this.$pagePositionLabel.html(P.format(t,this.content.page,yg(a),yg(l)))}else this.$pagePositionLabel.html(P.format(t,this.content.image,String(s+1),this.extension.helper.getTotalCanvases().toString()))}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Nr.page.toString()&&!S.getBool(this.config.options.forceImageMode,!1)}showSearchSpinner(){this.$searchText.addClass("searching")}hideSearchSpinner(){this.$searchText.removeClass("searching")}displaySearchResults(t,s){if(!this.isSearchEnabled())return;this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});let r=this.$searchResultsInfo.find(".info"),a=r.find(".number"),l=r.find(".foundFor"),h=r.find(".terms");s?(r.show(),a.text(this.extension.getTotalAnnotationRects()),t.length===1?l.html(this.content.resultFoundFor):l.html(this.content.resultsFoundFor),h.html(P.ellipsis(s,this.options.elideResultsTermsCount)),h.prop("title",s)):r.hide(),this.$searchPagerContainer.show(),this.resize()}resize(){super.resize();let t=this.getSearchResults();t&&t.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());let s=this.$element.width()/2;this.$searchPagerControls.css({left:s-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:s-this.$searchOptions.outerWidth()/2})}},$t=ir(),Et=class extends k{constructor(t){super(t)}create(){this.setConfig("multiSelectDialogue"),super.create();let t=this;this.openCommand=e.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=e.HIDE_MULTISELECT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,()=>{this.open(),this.extension.helper.getMultiSelectState().setEnabled(!0),this.galleryComponent.set(this.data)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close(),this.extension.helper.getMultiSelectState().setEnabled(!1)}),this.$title=$t('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=$t('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new $f({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",s=>{this.extensionHost.publish(e.MULTISELECTION_MADE,s),t.close()},!1),this.$element.hide()}isPageModeEnabled(){return S.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===Nr.page.toString()}open(){super.open()}close(){super.close()}resize(){super.resize();let t=this.$gallery.find(".main"),s=this.$gallery.find(".header");t.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-s.height())}},St=class{},me=o(H()),Ge=o(G()),pe=ir(),Pt=class extends Zt{constructor(t){super(t),this.firstButtonEnabled=!1,this.lastButtonEnabled=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}create(){if(this.setConfig("pagingHeaderPanel"),super.create(),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE,s=>{this.canvasIndexChanged(s)}),this.extensionHost.subscribe(e.SETTINGS_CHANGE,()=>{this.modeChanged(),this.updatePagingToggle()}),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE_FAILED,()=>{this.setSearchFieldValue(this.extension.helper.canvasIndex)}),this.extensionHost.subscribe(e.LEFTPANEL_EXPAND_FULL_START,()=>{this.openGallery()}),this.extensionHost.subscribe(e.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.closeGallery()}),this.$prevOptions=pe('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=pe(`
          <button class="btn imageBtn first" tabindex="0" title="${this.content.first}">
            <i class="uv-icon-first" aria-hidden="true"></i>
            <span class="sr-only">${this.content.first}</span>
          </button>
        `),this.$prevOptions.append(this.$firstButton),this.$prevButton=pe(`
          <button class="btn imageBtn prev" tabindex="0" title="${this.content.previous}">
            <i class="uv-icon-prev" aria-hidden="true"></i>
            <span class="sr-only">${this.content.previous}</span>
          </button>
        `),this.$prevOptions.append(this.$prevButton),this.$modeOptions=pe('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=pe('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=pe('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=pe('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=pe('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=pe('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=pe('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),S.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=pe('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new tt(this.$autoCompleteBox,(s,r)=>{let a=[],l=this.extension.helper.getCanvases();if(this.isPageModeEnabled())for(let h=0;h<l.length;h++){let u=l[h],c=Ge.LanguageMap.getValue(u.getLabel());c&&c.startsWith(s)&&a.push(c)}else for(let h=0;h<l.length;h++){let u=l[h];u.index.toString().startsWith(s)&&a.push(u.index.toString())}r(a)},s=>s,s=>{this.search(s)},300,0,S.getBool(this.options.autocompleteAllowWords,!1));else if(S.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=pe('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=pe('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(let s=0;s<this.extension.helper.getTotalCanvases();s++){let r=this.extension.helper.getCanvasByIndex(s),a=yg(Ge.LanguageMap.getValue(r.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+s+">"+a+"</option>")}this.$imageSelectionBox.change(()=>{let s=parseInt(this.$imageSelectionBox.val());this.extensionHost.publish(O.IMAGE_SEARCH,s)})}this.$total=pe('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=pe(`<a class="go btn btn-primary" tabindex="0">${this.content.go}</a>`),this.$search.append(this.$searchButton),this.$nextOptions=pe('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=pe(`
          <button class="btn imageBtn next" tabindex="0" title="${this.content.next}">
            <i class="uv-icon-next" aria-hidden="true"></i>
            <span class="sr-only">${this.content.next}</span>
          </button>
        `),this.$nextOptions.append(this.$nextButton),this.$lastButton=pe(`
          <button class="btn imageBtn last" tabindex="0" title="${this.content.last}">
            <i class="uv-icon-last" aria-hidden="true"></i>
            <span class="sr-only">${this.content.last}</span>
          </button>
        `),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType()===Ge.ManifestType.MANUSCRIPT?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=pe(`
          <button class="btn imageBtn gallery" title="${this.content.gallery}">
            <i class="uv-icon-gallery" aria-hidden="true"></i>
            <span class="sr-only">${this.content.gallery}</span>
          </button>
        `),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=pe('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=pe(`
          <button class="btn imageBtn one-up" title="${this.content.oneUp}">
            <i class="uv-icon-one-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.oneUp}</span>
          </button>`),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=pe(`
          <button class="btn imageBtn two-up" title="${this.content.twoUp}">
            <i class="uv-icon-two-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.twoUp}</span>
          </button>
        `),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed(()=>{let s=!1;this.updateSettings({pagingEnabled:s}),this.extensionHost.publish(O.PAGING_TOGGLED,s)}),this.$twoUpButton.onPressed(()=>{let s=!0;this.updateSettings({pagingEnabled:s}),this.extensionHost.publish(O.PAGING_TOGGLED,s)}),this.$galleryButton.onPressed(()=>{this.extensionHost.publish(e.TOGGLE_EXPAND_LEFT_PANEL)}),this.setNavigationTitles(),this.setTotal();let t=this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT;this.extension.helper.getTotalCanvases()===1&&this.$centerOptions.hide(),this.$firstButton.onPressed(()=>{switch(t.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(e.FIRST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.LAST);break}}),this.$prevButton.onPressed(()=>{switch(t.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(e.PREV);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.NEXT);break}}),this.$nextButton.onPressed(()=>{switch(t.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(e.NEXT);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.PREV);break}}),this.$lastButton.onPressed(()=>{switch(t.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(e.LAST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(e.FIRST);break}}),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",()=>{this.extensionHost.publish(O.MODE_CHANGE,Nr.image.toString())}),this.$pageModeOption.on("click",()=>{this.extensionHost.publish(O.MODE_CHANGE,Nr.page.toString())})):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter(()=>{this.$searchText.blur(),this.search(this.$searchText.val())}),this.$searchText.click(function(){pe(this).select()}),this.$searchButton.onPressed(()=>{this.options.autoCompleteBoxEnabled?this.search(this.$autoCompleteBox.val()):this.search(this.$searchText.val())}),this.options.modeOptionsEnabled===!1&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$search.hide(),this.options.helpEnabled===!1&&this.$helpButton.hide(),S.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()}openGallery(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")}closeGallery(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Nr.page.toString()}setNavigationTitles(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))}updatePagingToggle(){if(!this.pagingToggleIsVisible()){this.$pagingToggleButtons.hide();return}this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on"))}pagingToggleIsVisible(){return S.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()}updateGalleryButton(){this.galleryIsVisible()||this.$galleryButton.hide()}galleryIsVisible(){return S.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()}setTotal(){let t=this.content.of;this.isPageModeEnabled()?this.$total.html(P.format(t,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(P.format(t,this.extension.helper.getTotalCanvases().toString()))}setSearchFieldValue(t){let s=this.extension.helper.getCanvasByIndex(t),r=null;if(this.isPageModeEnabled()){let a=Ge.LanguageMap.getValue(s.getLabel());a==="-"?r="":r=a}else t+=1,r=t.toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(r):this.$searchText.val(r)}search(t){if(!t){this.extension.showMessage(this.content.emptyValue),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}if(this.isPageModeEnabled())this.extensionHost.publish(O.PAGE_SEARCH,t);else{let s;if(this.options.autoCompleteBoxEnabled?s=parseInt(this.$autoCompleteBox.val(),10):s=parseInt(this.$searchText.val(),10),s-=1,isNaN(s)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}if(!this.extension.helper.getCanvasByIndex(s)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}this.extensionHost.publish(O.IMAGE_SEARCH,s)}}canvasIndexChanged(t){this.setSearchFieldValue(t),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$imageSelectionBox.val(t),(this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT)===me.ViewingDirection.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))}disableFirstButton(){this.firstButtonEnabled=!1,this.$firstButton.disable()}enableFirstButton(){this.firstButtonEnabled=!0,this.$firstButton.enable()}disableLastButton(){this.lastButtonEnabled=!1,this.$lastButton.disable()}enableLastButton(){this.lastButtonEnabled=!0,this.$lastButton.enable()}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.disable()}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.enable()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.disable()}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.enable()}modeChanged(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()}resize(){super.resize(),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())}},Le=o(at());o(ei());var ti=o(H()),He=ir(),Ct=class extends ee{constructor(t){super(t),this.controlsVisible=!1,this.isCreated=!1,this.isLoaded=!1,this.isFirstLoad=!0,this.navigatedFromSearch=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}create(){this.setConfig("openSeadragonCenterPanel"),super.create(),this.viewerId="osd"+new Date().getTime(),this.$viewer=He('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.extensionHost.subscribe(e.ANNOTATIONS,t=>{this.overlayAnnotations()}),this.extensionHost.subscribe(e.SETTINGS_CHANGE,t=>{this.viewer.gestureSettingsMouse.clickToZoom=t.clickToZoomEnabled}),this.extensionHost.subscribe(e.OPEN_EXTERNAL_RESOURCE,t=>{this.whenResized(async()=>{this.isCreated||this.createUI(),this.isLoaded=!1,await this.openMedia(t),this.isLoaded=!0,this.extensionHost.publish(x.EXTERNAL_RESOURCE_OPENED),this.extensionHost.publish(x.LOAD)})}),this.extensionHost.subscribe(e.CLEAR_ANNOTATIONS,()=>{this.whenCreated(()=>{this.extension.currentAnnotationRect=null,this.clearAnnotations()})}),this.extensionHost.subscribe(O.NEXT_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.nextAnnotation()})}),this.extensionHost.subscribe(O.PREV_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.prevAnnotation()})}),this.extensionHost.subscribe(O.ZOOM_IN,()=>{this.whenCreated(()=>{this.zoomIn()})}),this.extensionHost.subscribe(O.ZOOM_OUT,()=>{this.whenCreated(()=>{this.zoomOut()})}),this.extensionHost.subscribe(O.ROTATE,()=>{this.whenCreated(()=>{this.rotateRight()})}),this.extensionHost.subscribe(e.METRIC_CHANGE,()=>{this.whenCreated(()=>{this.updateResponsiveView()})}),this.extensionHost.subscribe(e.SET_TARGET,t=>{this.whenLoaded(()=>{this.fitToBounds(t,!1)})}),this.extensionHost.subscribe(e.SET_ROTATION,t=>{this.whenLoaded(()=>{this.viewer.viewport.setRotation(t)})})}whenCreated(t){d.waitFor(()=>this.isCreated,t)}whenLoaded(t){d.waitFor(()=>this.isLoaded,t)}zoomIn(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*2)}zoomOut(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*.5)}rotateRight(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)}updateResponsiveView(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?this.viewer.autoHideControls=!0:this.viewer.autoHideControls=!1}async createUI(){this.$spinner=He('<div class="spinner"></div>'),this.$content.append(this.$spinner);let t="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";this.viewer=(0,Le.default)({element:this.$viewer[0],crossOriginPolicy:"Anonymous",showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:S.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",navigatorHeight:"100px",navigatorWidth:"100px",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:S.getBool(this.config.options.constrainDuringPan,!1),immediateRender:S.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:S.getBool(this.config.options.autoHideControls,!0),prefixUrl:null,gestureSettingsMouse:{clickToZoom:S.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:t,GROUP:t,HOVER:t,DOWN:t},zoomOut:{REST:t,GROUP:t,HOVER:t,DOWN:t},home:{REST:t,GROUP:t,HOVER:t,DOWN:t},rotateright:{REST:t,GROUP:t,HOVER:t,DOWN:t},rotateleft:{REST:t,GROUP:t,HOVER:t,DOWN:t},next:{REST:t,GROUP:t,HOVER:t,DOWN:t},previous:{REST:t,GROUP:t,HOVER:t,DOWN:t}}});let s=this,r=xg(a=>{let l=s.extension.helper.getCurrentCanvas();var h=s.viewer.viewport.pointFromPixel(a.position),u=s.viewer.viewport.viewportToImageCoordinates(h.x,h.y);this.extensionHost.publish(O.DOUBLECLICK,{target:`${l.id}#xywh=${Math.round(u.x)},${Math.round(u.y)},1,1`})},100);this.viewer.addViewerInputHook({hooks:[{tracker:"viewer",handler:"dblClickHandler",hookHandler:a=>{let l=this.extension.getSettings(),h=this.extension.helper.isPagingAvailable();(h&&!l.pagingEnabled||!h)&&this.config.options.doubleClickAnnotationEnabled&&r(a)}}]}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.prop("aria-label",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.prop("aria-label",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.prop("aria-label",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.prop("aria-label",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=He(this.viewer.canvas),this.$canvas.on("contextmenu",()=>!1),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$element.on("mouseleave",()=>{!this.controlsVisible||(this.controlsVisible=!1,this.viewer.setControlsEnabled(!1))}),this.$element.on("mousemove",()=>{if(!this.$prevButton.ismouseover()&&!this.$nextButton.ismouseover()&&!this.$viewer.find(".navigator").ismouseover()){if(!this.controlsVisible)return;this.controlsVisible=!1,this.viewer.setControlsEnabled(!1)}},this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",()=>{this.$spinner.hide()}),this.viewer.addHandler("resize",a=>{this.extensionHost.publish(O.OPENSEADRAGON_RESIZE,a),this.viewerResize(a)}),this.viewer.addHandler("animation-start",a=>{this.extensionHost.publish(O.OPENSEADRAGON_ANIMATION_START,a)}),this.viewer.addHandler("animation",a=>{this.extensionHost.publish(O.OPENSEADRAGON_ANIMATION,a)}),this.viewer.addHandler("animation-finish",a=>{this.currentBounds=this.getViewportBounds(),this.updateVisibleAnnotationRects(),this.extensionHost.publish(O.OPENSEADRAGON_ANIMATION_FINISH,a)}),this.viewer.addHandler("rotate",a=>{this.extensionHost.publish(O.OPENSEADRAGON_ROTATION,a.degrees)}),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0}createNavigationButtons(){let t=this.extension.helper.getViewingDirection()||Xt$1.LEFT_TO_RIGHT;switch(this.$prevButton=He('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=He('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:Le.default.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:Le.default.ControlAnchor.TOP_RIGHT}),t){case Xt$1.BOTTOM_TO_TOP:case Xt$1.TOP_TO_BOTTOM:this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical");break}let s=this;this.onAccessibleClick(this.$prevButton,r=>{if(r.preventDefault(),Le.default.cancelEvent(r),!!s.prevButtonEnabled)switch(t){case Xt$1.LEFT_TO_RIGHT:case Xt$1.BOTTOM_TO_TOP:case Xt$1.TOP_TO_BOTTOM:this.extensionHost.publish(e.PREV);break;case Xt$1.RIGHT_TO_LEFT:this.extensionHost.publish(e.NEXT);break}}),this.onAccessibleClick(this.$nextButton,r=>{if(r.preventDefault(),Le.default.cancelEvent(r),!!s.nextButtonEnabled)switch(t){case Xt$1.LEFT_TO_RIGHT:case Xt$1.BOTTOM_TO_TOP:case Xt$1.TOP_TO_BOTTOM:this.extensionHost.publish(e.NEXT);break;case Xt$1.RIGHT_TO_LEFT:this.extensionHost.publish(e.PREV);break}}),this.$prevButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$nextButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))})}async getGirderTileSource(){return new Promise(t=>{let s=this.extension.helper.getCurrentCanvas().getContent();if(s.length){let r=s[0].getBody();if(r.length){let a=r[0].getServices();if(a.length){let l=a[0].id,h=l;h.endsWith("/")||(h+="/"),h+="tiles",l.endsWith("/")&&(l=l.substr(0,l.length-1)),fetch(h).then(u=>u.json()).then(u=>{let c={height:u.sizeY,width:u.sizeX,tileWidth:u.tileWidth,tileHeight:u.tileHeight,minLevel:0,maxLevel:u.levels-1,units:"mm",spacing:[u.mm_x,u.mm_y],getTileUrl:function(R,b,_,L){var z=h+"/zxy/"+R+"/"+b+"/"+_;return L&&(z+="?"+He.param(L)),z}};u.mm_x||(c.units="pixels",c.spacing=[1,1]),t(c)})}}}})}async openMedia(t){if(!this.viewer)return;this.$spinner.show(),this.items=[];let s=await this.extension.getExternalResources(t),r=this.extension.format===ti.MediaType.GIRDER;try{this.viewer.close(),s=this.getPagePositions(s);for(let a=0;a<s.length;a++){let l=s[a],h;l.hasServiceDescriptor?h=l:r?h=await this.getGirderTileSource():h={type:"image",url:l.id,buildPyramid:!1},this.viewer.addTiledImage({tileSource:h,x:l.x,y:l.y,width:l.width,success:u=>{this.items.push(u),this.items.length===s.length&&this.openPagesHandler(),this.resize(),this.goHome()}})}}catch{}}getPagePositions(t){let s,r,a,l,h,u;if(t.length>1)if(t.length===2)this.extension.helper.isVerticallyAligned()?(a=t[0],a.y=0,l=t[1],l.y=a.height+this.config.options.pageGap):(s=t[0],s.x=0,r=t[1],r.x=s.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(let c=0;c<t.length-1;c++)h=t[c],u=t[c+1],u.y=(h.y||0)+h.height;else for(let c=t.length;c>0;c--)h=t[c],u=t[c-1],u.y=(h.y||0)-h.height;else if(this.extension.helper.isLeftToRight())for(let c=0;c<t.length-1;c++)h=t[c],u=t[c+1],u.x=(h.x||0)+h.width;else for(let c=t.length-1;c>0;c--)h=t[c],u=t[c-1],u.x=(h.x||0)-h.width;return t}openPagesHandler(){this.extensionHost.publish(O.OPENSEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous()&&(this.showPrevButton(),this.showNextButton(),He(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||Xt$1.LEFT_TO_RIGHT)===Xt$1.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton())),this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1}zoomToInitialAnnotation(){let t=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,t&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(t)}overlayAnnotations(){let t=this.getAnnotationsForCurrentImages();this.clearAnnotations();for(let s=0;s<t.length;s++){let r=t[s],a=this.getAnnotationOverlayRects(r);for(let l=0;l<a.length;l++){let h=a[l],u=document.createElement("DIV");if(u.id="annotation-"+h.canvasIndex+"-"+h.resultIndex,u.title=yg(h.chars),h.width===1&&h.height===1){u.className="annotationPin",u.onclick=R=>{R.preventDefault(),this.extensionHost.publish(e.PINPOINT_ANNOTATION_CLICKED,l)};let c=document.createElement("SPAN");c.innerText=String(l+1),u.appendChild(c)}else u.className="annotationRect";this.viewer.addOverlay(u,h)}}}updateBounds(){let t=this.extension.getSettings();if(this.isFirstLoad){this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation));let s=this.extension.data.xywh;s&&(this.initialBounds=Ie.fromString(s),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))}else t.preserveViewport&&this.currentBounds?this.fitToBounds(this.currentBounds):this.goHome()}goHome(){this.viewer.viewport.goHome(!0)}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")}hidePrevButton(){this.disablePrevButton(),this.$prevButton.hide()}showPrevButton(){this.enablePrevButton(),this.$prevButton.show()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")}hideNextButton(){this.disableNextButton(),this.$nextButton.hide()}showNextButton(){this.enableNextButton(),this.$nextButton.show()}fitToBounds(t,s=!0){let r=new Le.default.Rect;r.x=Number(t.x),r.y=Number(t.y),r.width=Number(t.w),r.height=Number(t.h),setTimeout(()=>{this.viewer.viewport.fitBoundsWithConstraints(r,s)},100)}getCroppedImageBounds(){if(!this.viewer||!this.viewer.viewport)return null;let t=this.extension.helper.getCurrentCanvas(),s=this.extension.getCroppedImageDimensions(t,this.viewer);return s?new Ie(s.regionPos.x,s.regionPos.y,s.region.width,s.region.height).toString():null}getViewportBounds(){if(!this.viewer||!this.viewer.viewport)return null;let t=this.viewer.viewport.getBounds(!0);return new Ie(Math.floor(t.x),Math.floor(t.y),Math.floor(t.width),Math.floor(t.height))}viewerResize(t){if(!t.viewport)return;let s=t.viewport.getCenter(!0);!s||setTimeout(function(){t.viewport.panTo(s,!0)},1)}clearAnnotations(){this.viewer.clearOverlays()}getAnnotationsForCurrentImages(){let t=[],s=this.extension.annotations;if(!s||!s.length)return t;let r=this.extension.getPagedIndices();for(let a=0;a<r.length;a++){let l=r[a];for(let h=0;h<s.length;h++)if(s[h].canvasIndex===l){t.push(s[h]);break}}return t}getAnnotationRectsForCurrentImages(){let t=this.getAnnotationsForCurrentImages();return t.length?t.map(s=>s.rects).reduce((s,r)=>s.concat(r)):[]}updateVisibleAnnotationRects(){let t=this.getAnnotationRectsForCurrentImages();for(let s=0;s<t.length;s++){let r=t[s],a=this.viewer.viewport.getBounds();r.isVisible=D.hitRect(a.x,a.y,a.width,a.height,r.viewportX,r.viewportY)}}getAnnotationRectIndex(t){return this.getAnnotationRectsForCurrentImages().indexOf(t)}isZoomToSearchResultEnabled(){return S.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}prevAnnotation(){let t=this.getAnnotationRectsForCurrentImages(),s=this.extension.currentAnnotationRect,r=s?this.getAnnotationRectIndex(s):t.length,a=null;for(let l=r-1;l>=0;l--){a=t[l];break}a&&this.isZoomToSearchResultEnabled()?a.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=a,this.navigatedFromSearch=!0,this.extensionHost.publish(e.ANNOTATION_CANVAS_CHANGE,[a])):this.zoomToAnnotation(a):(this.navigatedFromSearch=!0,this.extensionHost.publish(O.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))}nextAnnotation(){let t=this.getAnnotationRectsForCurrentImages(),s=this.extension.currentAnnotationRect,r=s?this.getAnnotationRectIndex(s):-1,a=null;for(let l=r+1;l<t.length;l++){a=t[l];break}a&&this.isZoomToSearchResultEnabled()?a.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=a,this.navigatedFromSearch=!0,this.extensionHost.publish(e.ANNOTATION_CANVAS_CHANGE,[a])):this.zoomToAnnotation(a):(this.navigatedFromSearch=!0,this.extensionHost.publish(O.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))}getAnnotationRectByIndex(t){let s=this.getAnnotationRectsForCurrentImages();return s.length?s[t]:null}getInitialAnnotationRect(){let t=this.getAnnotationRectsForCurrentImages();if(!t.length)return null;if(!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex){let s=t.filter(r=>r.canvasIndex===this.extension.helper.canvasIndex);return s[s.length-1]}return t.filter(s=>s.canvasIndex===this.extension.helper.canvasIndex)[0]}zoomToAnnotation(t){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||t,this.extension.currentAnnotationRect=t,S.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new Ie(t.viewportX,t.viewportY,t.width,t.height),!1);else if(this.currentBounds){let s=t.viewportX-(this.currentBounds.w*.5-t.width*.5),r=t.viewportY-(this.currentBounds.h*.5-t.height*.5),a=this.currentBounds.w,l=this.currentBounds.h,h=new Ie(s,r,a,l);this.fitToBounds(h)}this.highlightAnnotationRect(t),this.extensionHost.publish(e.ANNOTATION_CHANGE)}highlightAnnotationRect(t){let s=He("#annotation-"+t.canvasIndex+"-"+t.index);s.addClass("current"),He(".annotationRect").not(s).removeClass("current")}getAnnotationOverlayRects(t){let s=[];if(!this.extension.resources)return s;let r=this.extension.resources.filter(h=>h.index===t.canvasIndex)[0],a=this.extension.resources.indexOf(r),l=0;a>0&&(l=this.extension.resources[a-1].width);for(let h=0;h<t.rects.length;h++){let u=t.rects[h],c=u.x+l+(a>0?this.config.options.pageGap:0),R=u.y,b=u.width,_=u.height,L=new Le.default.Rect(c,R,b,_);u.viewportX=c,u.viewportY=R,L.canvasIndex=u.canvasIndex,L.resultIndex=u.index,L.chars=u.chars,s.push(L)}return s}resize(){if(super.resize(),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),!this.isCreated)return;this.title&&this.$title.text(yg(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);let t=this.extension.helper.getViewingDirection()||Xt$1.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){let s=Math.floor(this.$content.width()/2);switch(t){case Xt$1.BOTTOM_TO_TOP:this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",s-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",s*-1-this.$nextButton.outerWidth()/2);break;case Xt$1.TOP_TO_BOTTOM:this.$prevButton.css("left",s-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",s*-1-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2);break}}setTimeout(()=>{if(this.extension.helper.isContinuous())if(this.extension.helper.isHorizontallyAligned()){let s=this.$viewer.width()-this.$viewer.rightMargin();this.$navigator.width(s)}else this.$navigator.height(this.$viewer.height())},100)}setFocus(){this.$canvas&&!this.$canvas.is(":focus")&&this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()}setNavigatorVisible(){let t=S.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer&&this.viewer.navigator&&(this.viewer.navigator.setVisible(t),t?this.$navigator.show():this.$navigator.hide())}},Re=ir(),_t=class extends ne{constructor(t){super(t)}create(){this.setConfig("settingsDialogue"),super.create(),this.$navigatorEnabled=Re('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=Re('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=Re('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=Re('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=Re('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=Re('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=Re('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=Re('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=Re('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=Re('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=Re('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=Re('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change(()=>{let t={};this.$navigatorEnabledCheckbox.is(":checked")?t.navigatorEnabled=!0:t.navigatorEnabled=!1,this.updateSettings(t)}),this.$clickToZoomEnabledCheckbox.change(()=>{let t={};this.$clickToZoomEnabledCheckbox.is(":checked")?t.clickToZoomEnabled=!0:t.clickToZoomEnabled=!1,this.updateSettings(t)}),this.$pagingEnabledCheckbox.change(()=>{let t={};this.$pagingEnabledCheckbox.is(":checked")?t.pagingEnabled=!0:t.pagingEnabled=!1,this.updateSettings(t)}),this.$preserveViewportCheckbox.change(()=>{let t={};this.$preserveViewportCheckbox.is(":checked")?t.preserveViewport=!0:t.preserveViewport=!1,this.updateSettings(t)})}open(){super.open();let t=this.getSettings();t.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),t.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?t.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),t.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")}},It=class extends se{constructor(t){super(t),this.extensionHost.subscribe(O.OPENSEADRAGON_OPEN,()=>{this.update()}),this.extensionHost.subscribe(O.OPENSEADRAGON_ANIMATION_FINISH,()=>{this.update()})}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update();let t=this.extension.getViewportBounds(),s=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,t,s),this.$code.val(this.code)}resize(){super.resize()}},Te=o(H()),Ce=o(G()),fi={allowStealFocus:!1,authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,leftPanelEnabled:!0,limitLocales:!1,doubleClickAnnotationEnabled:!1,metrics:[{type:"sm",minWidth:0},{type:"md",minWidth:768},{type:"lg",minWidth:1024},{type:"xl",minWidth:1280}],multiSelectionMimeType:"application/zip",navigatorEnabled:!0,openTemplate:"http://universalviewer.io?manifest={0}",overrideFullScreen:!1,pagingEnabled:!0,pagingOptionEnabled:!0,pessimisticAccessControl:!1,preserveViewport:!1,rightPanelEnabled:!0,saveUserSettings:!1,clickToZoomEnabled:!0,searchWithinEnabled:!0,termsOfUseEnabled:!0,theme:"uv-en-GB-theme",tokenStorage:"session",useArrowKeysToNavigate:!1,zoomToSearchResultEnabled:!0,zoomToBoundsEnabled:!0},mi={contentLeftPanel:{options:{autoExpandTreeEnabled:!1,autoExpandTreeIfFewerThan:20,branchNodesExpandOnClick:!0,branchNodesSelectable:!1,defaultToTreeEnabled:!1,defaultToTreeIfGreaterThan:0,elideCount:40,expandFullEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,tabOrder:"",thumbsCacheInvalidation:{enabled:!0,paramType:"?"},thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90},content:{collapse:"Collapse Contents",collapseFull:"Collapse Gallery",date:"date",expand:"Expand Contents",expandFull:"Expand Gallery",index:"Index",manifestRanges:"Manifest Ranges",searchResult:"{0} search result",searchResults:"{0} search results",sortBy:"Sort By:",thumbnails:"Thumbnails",title:"Contents",volume:"volume"}},dialogue:{topCloseButtonEnabled:!1,content:{close:"Close"}},downloadDialogue:{options:{confinedImageSize:1e3,currentViewDisabledPercentage:90,maxImageWidth:5e3,optionsExplanatoryTextEnabled:!1,selectionEnabled:!1},content:{allPages:"All Pages",currentViewAsJpg:"Current view {0} x {1}px (jpg)",currentViewAsJpgExplanation:"Opens in a new window",download:"Download",downloadSelection:"Download Selection",downloadSelectionExplanation:"Opens a dialogue to select which pages to download.",editSettings:"Edit Settings",entireDocument:"Entire document ({0})",entireFileAsOriginal:"Entire file",individualPages:"Individual Pages",noneAvailable:"No download options are available.",pagingNote:"Please turn off Two Page View for additional options.",preview:"Preview",selection:"Selection",termsOfUse:"Terms of Use",title:"Download",wholeImageHighRes:"Whole image {0} x {1}px ({2})",wholeImageHighResExplanation:"Opens in a new window.",wholeImageLowResAsJpg:"Whole image {0} x {1}px (jpg)",wholeImageLowResAsJpgExplanation:"Opens in a new window.",wholeImagesHighRes:"Whole images ({0})",wholeImagesHighResExplanation:"Opens in two new windows."}},footerPanel:{options:{autocompleteAllowWords:!1,bookmarkEnabled:!1,downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,fullscreenEnabled:!0,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,printEnabled:!1,shareEnabled:!0},content:{bookmark:"Add to bookmarks",download:"Download",embed:"Embed",exitFullScreen:"Exit Full Screen",feedback:"Feedback",fullScreen:"Full Screen",moreInfo:"More Information",open:"Open",share:"Share"}},genericDialogue:{content:{emptyValue:"please enter a value.",invalidNumber:"Please enter a valid number.",noMatches:"No matches were found.",ok:"OK",pageNotFound:"This item does not contain a page with the number you entered. Try switching the numbering mode to 'image'.",refresh:"Refresh"}},headerPanel:{options:{centerOptionsEnabled:!0,localeToggleEnabled:!1,settingsButtonEnabled:!0}},helpDialogue:{content:{text:"placeholder text",title:"Help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines"},content:{attribution:"Attribution",canvasHeader:"About the image",collapse:"Collapse Information",collapseFull:"Collapse Gallery",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",expand:"Expand Information",expandFull:"Expand Gallery",holdingText:"Your module goes here!",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",page:"Page",rangeHeader:"About this section",title:"More Information"}},multiSelectDialogue:{options:{galleryThumbChunkedResizingEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,pageModeEnabled:!0},content:{select:"Download",selectAll:"Select All",title:"Select Pages for Download"}},pagingHeaderPanel:{options:{autoCompleteBoxEnabled:!0,autocompleteAllowWords:!1,galleryButtonEnabled:!0,imageSelectionBoxEnabled:!1,pageModeEnabled:!1,pagingToggleEnabled:!0},content:{close:"Close",emptyValue:"Please enter a value",first:"First",firstImage:"First Image",firstPage:"First Page",folio:"Folio",gallery:"Gallery",go:"Go",help:"Help",image:"Image",last:"Last",lastImage:"Last Image",lastPage:"Last Page",next:"Next",nextImage:"Next Image",nextPage:"Next Page",of:"of {0}",oneUp:"Single page view",page:"Page",pageSearchLabel:"Search by Page Number",previous:"Previous",previousImage:"Previous Image",previousPage:"Previous Page",settings:"Settings",twoUp:"Two page view"}},openSeadragonCenterPanel:{options:{animationTime:.15,autoHideControls:!0,requiredStatementEnabled:!0,blendTime:0,constrainDuringPan:!1,controlsFadeAfterInactive:1500,controlsFadeDelay:250,controlsFadeLength:250,defaultZoomLevel:0,immediateRender:!1,maxZoomPixelRatio:1.25,navigatorPosition:"BOTTOM_RIGHT",pageGap:50,showHomeControl:!1,trimAttributionCount:150,visibilityRatio:.5},content:{attribution:"Attribution",goHome:"Go Home",imageUnavailable:"Image Unavailable",next:"Next",previous:"Previous",rotateRight:"Rotate Right",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},searchFooterPanel:{options:{elideDetailsTermsCount:20,elideResultsTermsCount:10,forceImageMode:!1,pageModeEnabled:!0,positionMarkerEnabled:!0},content:{clearSearch:"Clear",defaultLabel:"-",displaying:"{0} {1} of {2}",enterKeyword:"Enter Keyword",image:"image",imageCaps:"Image",instanceFound:"1 instance of '{0}' found",instancesFound:"{0} instances of '{1}' found",nextResult:"Next Result",page:"page",pageCaps:"Page",previousResult:"Previous Result",print:"Print",resultFoundFor:"result found for",resultsFoundFor:"results found for",searchWithin:"Search within this item:"}},settingsDialogue:{content:{locale:"Locale",navigatorEnabled:"Navigator Enabled",clickToZoomEnabled:"Mouse Click To Zoom",pagingEnabled:"Two Page View",reducedMotion:"Reduce motion (disables animations)",preserveViewport:"Preserve Zoom",title:"Settings",website:"<a href='https://github.com/universalviewer/universalviewer#contributors'>more info</a>"}},shareDialogue:{options:{embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>',instructionsEnabled:!1,shareFrameEnabled:!0,shareManifestsEnabled:!0},content:{customSize:"custom",embed:"Embed",embedInstructions:"To embed this item in your own website, copy and paste the code below.",height:"Height",iiif:"IIIF Manifest",share:"Share",shareInstructions:"To share this item, copy the URL below.",size:"Size:",width:"Width"}},authDialogue:{content:{cancel:"Cancel",confirm:"Confirm"}},clickThroughDialogue:{content:{viewTerms:"Read Full Terms and Conditions"}},loginDialogue:{content:{login:"Login",logout:"Logout",cancel:"Cancel"}},mobileFooterPanel:{content:{rotateRight:"Rotate Right",moreInfo:"More Information",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},restrictedDialogue:{content:{cancel:"Cancel"}}},vi={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xE7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},wi={authCORSError:"Your browser does not support CORS, please upgrade to view this content.",authorisationFailedMessage:"Your log-in attempt did not appear to be successful. Please try again.",canvasIndexOutOfRange:"Canvas index out of range.",fallbackDegradedLabel:"Login",fallbackDegradedMessage:"Please log in to view this content at full resolution.",forbiddenResourceMessage:"Your current access rights are insufficient to view this image",mediaViewer:"Media Viewer",skipToDownload:"Skip to downloads and alternative formats",termsOfUse:"Terms of Use"},Ot={options:fi,modules:mi,localisation:vi,content:wi},oi=o(_f()),ri=o(qt()),ii=t=>{let s,r=new Set,a=(u,c)=>{let R=typeof u=="function"?u(s):u;if(R!==s){let b=s;s=c?R:Object.assign({},s,R),r.forEach(_=>_(s,b))}},l=()=>s,h={setState:a,getState:l,subscribe:u=>(r.add(u),()=>r.delete(u)),destroy:()=>r.clear()};return s=t(a,l,h),h},ni=t=>t?ii(t):ii,si=()=>ni(t=>({downloadDialogueOpen:!1,dialogueTriggerButton:null,openDownloadDialogue:s=>t({downloadDialogueOpen:!0,dialogueTriggerButton:s}),closeDialogue:()=>t({downloadDialogueOpen:!1,dialogueTriggerButton:null})})),ai=class extends Yt$1{constructor(){super(...arguments),this.currentRotation=0,this.isAnnotating=!1,this.defaultConfig=Ot,this.locales={"en-GB":Ot,"cy-GB":()=>__vitePreload(()=>import("./cy-GB-45UAN3WW.afd58b87.mjs"),["_nuxt/cy-GB-45UAN3WW.afd58b87.mjs","_nuxt/entry.cc194de1.mjs","_nuxt/entry.a877e1a1.css"]),"fr-FR":()=>__vitePreload(()=>import("./fr-FR-ZAUOZTUF.2386ba10.mjs"),["_nuxt/fr-FR-ZAUOZTUF.2386ba10.mjs","_nuxt/entry.cc194de1.mjs","_nuxt/entry.a877e1a1.css"]),"pl-PL":()=>__vitePreload(()=>import("./pl-PL-W4ZT7O3X.17eff498.mjs"),["_nuxt/pl-PL-W4ZT7O3X.17eff498.mjs","_nuxt/entry.cc194de1.mjs","_nuxt/entry.a877e1a1.css"]),"sv-SE":()=>__vitePreload(()=>import("./sv-SE-457UNQZJ.06055cb1.mjs"),["_nuxt/sv-SE-457UNQZJ.06055cb1.mjs","_nuxt/entry.cc194de1.mjs","_nuxt/entry.a877e1a1.css"])}}create(){super.create(),this.store=si(),this.store.subscribe(t=>{this.renderDownloadDialogue()}),this.extensionHost.subscribe(e.METRIC_CHANGE,()=>{if(!this.isDesktopMetric()){let t={};t.pagingEnabled=!1,this.updateSettings(t),this.extensionHost.publish(e.UPDATE_SETTINGS)}}),this.extensionHost.subscribe(e.CANVAS_INDEX_CHANGE,t=>{this.previousAnnotationRect=null,this.currentAnnotationRect=null,this.changeCanvas(t)}),this.extensionHost.subscribe(e.CLEAR_ANNOTATIONS,()=>{this.clearAnnotations(),this.extensionHost.publish(e.ANNOTATIONS_CLEARED),this.fire(e.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(e.DOWN_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.END,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(e.FIRST,()=>{this.fire(e.FIRST),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(e.GALLERY_DECREASE_SIZE,()=>{this.fire(e.GALLERY_DECREASE_SIZE)}),this.extensionHost.subscribe(e.GALLERY_INCREASE_SIZE,()=>{this.fire(e.GALLERY_INCREASE_SIZE)}),this.extensionHost.subscribe(e.GALLERY_THUMB_SELECTED,()=>{this.fire(e.GALLERY_THUMB_SELECTED)}),this.extensionHost.subscribe(e.HOME,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(O.IMAGE_SEARCH,t=>{this.fire(O.IMAGE_SEARCH,t),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,t)}),this.extensionHost.subscribe(e.LAST,()=>{this.fire(e.LAST),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(e.LEFT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getPrevPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.isDesktopMetric()&&this.shell.$rightPanel.show()}),this.extensionHost.subscribe(e.LEFTPANEL_COLLAPSE_FULL_FINISH,()=>{this.shell.$centerPanel.show(),this.resize()}),this.extensionHost.subscribe(e.LEFTPANEL_EXPAND_FULL_START,()=>{this.shell.$centerPanel.hide(),this.shell.$rightPanel.hide()}),this.extensionHost.subscribe(e.MINUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(O.MODE_CHANGE,t=>{this.fire(O.MODE_CHANGE,t),this.mode=new Nr(t);let s=this.getSettings();this.extensionHost.publish(e.SETTINGS_CHANGE,s)}),this.extensionHost.subscribe(e.MULTISELECTION_MADE,t=>{let s=new St;s.manifestUri=this.helper.manifestUri,s.allCanvases=t.length===this.helper.getCanvases().length,s.canvases=t,s.format=this.data.config.options.multiSelectionMimeType,s.sequence=this.helper.getCurrentSequence().id,this.fire(e.MULTISELECTION_MADE,s)}),this.extensionHost.subscribe(e.NEXT,()=>{this.fire(e.NEXT),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(O.NEXT_SEARCH_RESULT,()=>{this.fire(O.NEXT_SEARCH_RESULT)}),this.extensionHost.subscribe(O.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(O.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.nextSearchResult()}),this.extensionHost.subscribe(O.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(O.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.prevSearchResult()}),this.extensionHost.subscribe(e.OPEN_THUMBS_VIEW,()=>{this.fire(e.OPEN_THUMBS_VIEW)}),this.extensionHost.subscribe(e.OPEN_TREE_VIEW,()=>{this.fire(e.OPEN_TREE_VIEW)}),this.extensionHost.subscribe(e.PAGE_DOWN,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(O.PAGE_SEARCH,t=>{this.fire(O.PAGE_SEARCH,t),this.viewLabel(t)}),this.extensionHost.subscribe(e.PAGE_UP,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(O.PAGING_TOGGLED,t=>{this.fire(O.PAGING_TOGGLED,t)}),this.extensionHost.subscribe(e.PLUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.PREV,()=>{this.fire(e.PREV),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(O.PREV_SEARCH_RESULT,()=>{this.fire(O.PREV_SEARCH_RESULT)}),this.extensionHost.subscribe(O.PRINT,()=>{this.print()}),this.extensionHost.subscribe(x.RELOAD,()=>{this.extensionHost.publish(e.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(e.RIGHT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.getNextPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(O.OPENSEADRAGON_ANIMATION,()=>{this.fire(O.OPENSEADRAGON_ANIMATION)}),this.extensionHost.subscribe(O.OPENSEADRAGON_ROTATION,t=>{this.fire(O.OPENSEADRAGON_ROTATION,t)}),this.extensionHost.subscribe(O.OPENSEADRAGON_ANIMATION_FINISH,t=>{let s=this.centerPanel.getViewportBounds(),r=this.helper.getCurrentCanvas();this.centerPanel&&s&&r&&(this.extensionHost.publish(O.XYWH_CHANGE,s.toString()),this.data.target=r.id+"#xywh="+s.toString(),this.fire(e.TARGET_CHANGE,this.data.target)),this.fire(O.CURRENT_VIEW_URI,{cropUri:this.getCroppedImageUri(r,this.getViewer()),fullUri:this.getConfinedImageUri(r,r.getWidth())})}),this.extensionHost.subscribe(O.OPENSEADRAGON_ANIMATION_START,()=>{this.fire(O.OPENSEADRAGON_ANIMATION_START)}),this.extensionHost.subscribe(O.OPENSEADRAGON_OPEN,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus(),this.fire(O.OPENSEADRAGON_OPEN)}),this.extensionHost.subscribe(O.OPENSEADRAGON_RESIZE,()=>{this.fire(O.OPENSEADRAGON_RESIZE)}),this.extensionHost.subscribe(O.OPENSEADRAGON_ROTATION,t=>{this.data.rotation=t,this.fire(O.OPENSEADRAGON_ROTATION,this.data.rotation),this.currentRotation=t}),this.extensionHost.subscribe(O.SEARCH,t=>{this.fire(O.SEARCH,t),this.search(t)}),this.extensionHost.subscribe(O.SEARCH_PREVIEW_FINISH,()=>{this.fire(O.SEARCH_PREVIEW_FINISH)}),this.extensionHost.subscribe(O.SEARCH_PREVIEW_START,()=>{this.fire(O.SEARCH_PREVIEW_START)}),this.extensionHost.subscribe(e.ANNOTATIONS,t=>{this.fire(e.ANNOTATIONS,t)}),this.extensionHost.subscribe(e.ANNOTATION_CANVAS_CHANGE,t=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,t[0].canvasIndex)}),this.extensionHost.subscribe(e.ANNOTATIONS_EMPTY,()=>{this.fire(e.ANNOTATIONS_EMPTY)}),this.extensionHost.subscribe(e.THUMB_SELECTED,t=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,t.index)}),this.extensionHost.subscribe(e.TREE_NODE_SELECTED,t=>{this.fire(e.TREE_NODE_SELECTED,t.data.path),this.treeNodeSelected(t)}),this.extensionHost.subscribe(e.UP_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(e.UPDATE_SETTINGS,()=>{this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.canvasIndex);let t=this.getSettings();this.extensionHost.publish(e.SETTINGS_CHANGE,t)}),this.extensionHost.subscribe(e.SHOW_DOWNLOAD_DIALOGUE,t=>{this.store.getState().openDownloadDialogue(t[0])}),this.extensionHost.subscribe(e.HIDE_DOWNLOAD_DIALOGUE,()=>{this.store.getState().closeDialogue()}),this.extensionHost.subscribe(e.CLOSE_ACTIVE_DIALOGUE,()=>{this.store.getState().closeDialogue()}),this.extensionHost.subscribe(e.ESCAPE,()=>{this.store.getState().closeDialogue()})}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new Pt(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new Ih(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new Ct(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new te(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new bt(this.shell.$footerPanel),this.mobileFooterPanel=new yt(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new n(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new m(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new Et(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new It(this.$shareDialogue),this.$downloadDialogue=$("<div></div>"),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogueRoot=(0,oi.createRoot)(this.$downloadDialogue[0]),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new _t(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new wt(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()}render(){super.render(),this.checkForTarget(),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()}renderDownloadDialogue(){var R;let t=this.isPagingSettingEnabled(),{downloadDialogueOpen:s,dialogueTriggerButton:r}=this.store.getState();s?this.extensionHost.publish(e.SHOW_OVERLAY):this.extensionHost.publish(e.HIDE_OVERLAY);let a=this.getPagedIndices(),l=this.helper.getCanvases().filter((b,_)=>a.includes(_)),h=_g(this.data.config.modules.dialogue,this.data.config.modules.downloadDialogue),u=this.helper.manifest.getService(Te.ServiceProfile.DOWNLOAD_EXTENSIONS),c=h.options.selectionEnabled&&(u==null?void 0:u.__jsonld.selectionEnabled);this.downloadDialogueRoot.render((0,ri.createElement)(Yt,{canvases:l,confinedImageSize:h.options.confinedImageSize,content:h.content,locale:this.getLocale(),manifest:this.helper.manifest,maxImageWidth:h.options.maxImageWidth,mediaDownloadEnabled:this.helper.isUIEnabled("mediaDownload"),open:s,paged:t,parent:this.shell.$overlays[0],resources:this.resources,requiredStatement:(R=this.helper.getRequiredStatement())==null?void 0:R.value,termsOfUseEnabled:this.data.config.options.termsOfUseEnabled,rotation:this.getViewerRotation(),selectionEnabled:c,sequence:this.helper.getCurrentSequence(),triggerButton:r,getCroppedImageDimensions:b=>this.getCroppedImageDimensions(b,this.getViewer()),getConfinedImageDimensions:b=>this.getConfinedImageDimensions(b,h.options.confinedImageSize),getConfinedImageUri:b=>this.getConfinedImageUri(b,h.options.confinedImageSize),onClose:()=>{this.store.getState().closeDialogue()},onDownloadCurrentView:b=>{let _=this.getViewer();window.open(this.getCroppedImageUri(b,_))},onDownloadSelection:()=>{this.store.getState().closeDialogue(),this.extensionHost.publish(e.SHOW_MULTISELECT_DIALOGUE)},onShowTermsOfUse:()=>{this.store.getState().closeDialogue(),this.extensionHost.publish(e.SHOW_TERMS_OF_USE)}}))}checkForTarget(){if(this.data.target){let t=this.data.target.split("#"),s=t[0],r=this.helper.getCanvasIndexById(s);r!==null&&this.helper.canvasIndex!==r&&this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,r);let a=t[1];this.extensionHost.publish(e.SET_TARGET,Ie.fromString(a))}}checkForAnnotations(){if(this.data.annotations){let t=[],s=this.data.annotations;Array.isArray(s)?t=this.groupWebAnnotationsByTarget(this.data.annotations):s.resources.length&&(t=this.groupOpenAnnotationsByTarget(this.data.annotations),this.extensionHost.publish(e.CLEAR_ANNOTATIONS)),this.annotate(t)}}annotate(t,s){this.annotations=t,this.annotations=t.sort((a,l)=>a.canvasIndex-l.canvasIndex);let r=new o$1;r.terms=s,r.annotations=this.annotations,this.extensionHost.publish(e.ANNOTATIONS,r)}groupWebAnnotationsByTarget(t){let s=[];for(let r=0;r<t.length;r++){let a=t[r],l=a.target.match(/(.*)#/)[1],h=this.helper.getCanvasIndexById(l),u=new gt(l);u.canvasIndex=h;let c=s.filter(R=>R.canvasId===u.canvasId)[0];c?c.addRect(a):(u.addRect(a),s.push(u))}return s}groupOpenAnnotationsByTarget(t){let s=[];for(let r=0;r<t.resources.length;r++){let a=t.resources[r],l=a.on.match(/(.*)#/)[1],h=this.helper.getCanvasIndexById(l),u=new gt(l);u.canvasIndex=h;let c=s.filter(R=>R.canvasId===u.canvasId)[0];c?c.addRect(a):(u.addRect(a),s.push(u))}return s.sort((r,a)=>r.canvasIndex-a.canvasIndex),s}checkForSearchParam(){let t=this.data.highlight;t&&(t.replace(/\+/g," ").replace(/"/g,""),this.extensionHost.publish(O.SEARCH,t))}checkForRotationParam(){let t=this.data.rotation;t&&this.extensionHost.publish(e.SET_ROTATION,t)}changeCanvas(t){if(t===-1)return;let s=!1;if(t===this.helper.canvasIndex&&(s=!0),this.helper.isCanvasIndexOutOfRange(t)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),t=0),this.isPagingSettingEnabled()&&!s&&this.getPagedIndices(t).includes(this.helper.canvasIndex)){this.viewCanvas(t);return}this.viewCanvas(t)}getViewer(){return this.centerPanel.viewer}getMode(){if(this.mode)return this.mode;switch(this.helper.getManifestType()){case Ce.ManifestType.MONOGRAPH:return Nr.page;case Ce.ManifestType.MANUSCRIPT:return Nr.page;default:return Nr.image}}getViewportBounds(){if(!this.centerPanel)return null;let t=this.centerPanel.getViewportBounds();return t?t.toString():null}getViewerRotation(){return this.centerPanel?this.currentRotation:null}viewRange(t){let s=this.helper.getRangeByPath(t);if(!s)return;let r=s.getCanvasIds()[0],a=this.helper.getCanvasIndexById(r);this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,a),this.extensionHost.publish(e.RANGE_CHANGE,s)}viewLabel(t){if(!t){this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED);return}let s=this.helper.getCanvasIndexByLabel(t);s!=-1?this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,s):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(e.CANVAS_INDEX_CHANGE_FAILED))}treeNodeSelected(t){let s=t.data;if(s.type)switch(s.type){case Te.IIIFResourceType.MANIFEST:this.viewManifest(s);break;case Te.IIIFResourceType.COLLECTION:this.viewCollection(s);break;default:this.viewRange(s.path);break}}clearAnnotations(){this.annotations=[],this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,this.helper.canvasIndex)}prevSearchResult(){let t;if(this.annotations)for(let s=this.annotations.length-1;s>=0;s--){let r=this.annotations[s];if(r.canvasIndex<=this.getPrevPageIndex()){t=r,this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,t.canvasIndex);break}}}nextSearchResult(){if(this.annotations)for(let t=0;t<this.annotations.length;t++){let s=this.annotations[t];if(s&&s.canvasIndex>=this.getNextPageIndex()){this.extensionHost.publish(e.CANVAS_INDEX_CHANGE,s.canvasIndex);break}}}bookmark(){super.bookmark();let t=this.helper.getCurrentCanvas(),s=new i;s.index=this.helper.canvasIndex,s.label=Ce.LanguageMap.getValue(t.getLabel()),s.path=this.getCroppedImageUri(t,this.getViewer()),s.thumb=t.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),s.title=this.helper.getLabel(),s.trackingLabel=window.trackingLabel,s.type=Te.ExternalResourceType.IMAGE,this.fire(e.BOOKMARK,s)}print(){window.print(),this.fire(O.PRINT)}getCroppedImageDimensions(t,s){if(!s||!s.viewport)return null;let r,a;if(t.getWidth()?r=t.getWidth():r=t.externalResource.width,t.getHeight()?a=t.getHeight():a=t.externalResource.height,!r||!a)return null;let l=s.viewport.getBounds(!0),h=new vt,u=Math.floor(l.width),c=Math.floor(l.height),R=Math.floor(l.x),b=Math.floor(l.y);R+u>r?u=r-R:R<0&&(u=u+R),R<0&&(R=0),b+c>a?c=a-b:b<0&&(c=c+b),b<0&&(b=0),u=Math.min(u,r),c=Math.min(c,a);let _=u,L=c,z=t.getMaxDimensions();if(z){if(u>z.width){let Z=z.width;c=Math.round(Z*(c/u)),u=Z}if(c>z.height){let Z=z.height;u=Math.round(u/c*Z),c=Z}}return h.region=new Ce.Size(_,L),h.regionPos=new $e(R,b),h.size=new Ce.Size(u,c),h}getCroppedImageUri(t,s){if(!s||!s.viewport)return null;let r=this.getCroppedImageDimensions(t,s);if(!r)return null;let a=this.getImageBaseUri(t),l=this.getImageId(t);if(!l)return null;let h=r.regionPos.x+","+r.regionPos.y+","+r.region.width+","+r.region.height,u=r.size.width+","+r.size.height,c=this.getViewerRotation();return`${a}/${l}/${h}/${u}/${c}/default.jpg`}getConfinedImageDimensions(t,s){let r=t.getWidth();r||(r=t.externalResource.width);let a=t.getHeight();a||(a=t.externalResource.height);let l=new Ce.Size(0,0);l.width=s;let h=T.normalise(s,0,r);return l.height=Math.floor(a*h),l}getConfinedImageUri(t,s){let r=this.getImageBaseUri(t),a=this.getImageId(t);if(!a)return null;let l="full",h=this.getConfinedImageDimensions(t,s),u=h.width+","+h.height,c=this.getViewerRotation();return`${r}/${a}/${l}/${u}/${c}/default.jpg`}getImageId(t){if(t.externalResource){let s=t.externalResource.data["@id"];if(s)return s.substr(s.lastIndexOf("/")+1)}return null}getImageBaseUri(t){let s=this.getInfoUri(t);return s=s.substr(0,s.lastIndexOf("/")),s.substr(0,s.lastIndexOf("/"))}getInfoUri(t){let s=null,r=t.getImages();if(r&&r.length){let a=r[0].getResource().getServices();for(let l=0;l<a.length;l++){let h=a[l],u=h.id;u.endsWith("/")||(u+="/"),Ce.Utils.isImageProfile(h.getProfile())&&(s=u+"info.json")}}else{r=t.getContent();let a=r[0].getBody();if(a.length){let l=a[0].getServices();for(let h=0;h<l.length;h++){let u=l[h],c=u.id;c.endsWith("/")||(c+="/"),Ce.Utils.isImageProfile(u.getProfile())&&(s=c+"info.json")}}}return s||(s="lib/imageunavailable.json"),s}getEmbedScript(t,s,r,a,l){let h=this.data.config.uri||"",u=this.getSerializedLocales(),c=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}&config=${h}&locales=${u}&xywh=${a}&r=${l}`;return P.format(t,c,s.toString(),r.toString())}isSearchEnabled(){return!(!S.getBool(this.data.config.options.searchWithinEnabled,!1)||!this.helper.getSearchService())}isPagingSettingEnabled(){return this.helper.isPagingAvailable()?this.getSettings().pagingEnabled:!1}getAutoCompleteService(){let t=this.helper.getSearchService();return t?t.getService(Te.ServiceProfile.SEARCH_0_AUTO_COMPLETE)||t.getService(Te.ServiceProfile.SEARCH_1_AUTO_COMPLETE):null}getAutoCompleteUri(){let t=this.getAutoCompleteService();return t?t.id+"?q={0}":null}getSearchServiceUri(){let t=this.helper.getSearchService();if(!t)return null;let s=t.id;return s=s+"?q={0}",s}search(t){if(this.isAnnotating)return;this.isAnnotating=!0,this.annotations=[];let s=this,r=this.getSearchServiceUri();!r||(r=P.format(r,encodeURIComponent(t)),this.getSearchResults(r,t,this.annotations,a=>{s.isAnnotating=!1,a.length?s.annotate(a,t):s.showMessage(s.data.config.modules.genericDialogue.content.noMatches,()=>{this.extensionHost.publish(e.ANNOTATIONS_EMPTY)})}))}getSearchResults(t,s,r,a){fetch(t).then(l=>l.json()).then(l=>{l.resources&&l.resources.length&&(r=r.concat(this.groupOpenAnnotationsByTarget(l))),l.next?this.getSearchResults(l.next,s,r,a):a(r)})}getAnnotationRects(){return this.annotations.length?this.annotations.map(t=>t.rects).reduce((t,s)=>t.concat(s)):[]}getCurrentAnnotationRectIndex(){let t=this.getAnnotationRects();return this.currentAnnotationRect?t.indexOf(this.currentAnnotationRect):-1}getTotalAnnotationRects(){return this.getAnnotationRects().length}isFirstAnnotationRect(){return this.getCurrentAnnotationRectIndex()===0}getLastAnnotationRectIndex(){return this.getTotalAnnotationRects()-1}getPrevPageIndex(t=this.helper.canvasIndex){let s;if(this.isPagingSettingEnabled()){let r=this.getPagedIndices(t);this.helper.isRightToLeft()?s=r[r.length-1]-1:s=r[0]-1}else s=t-1;return s}getNextPageIndex(t=this.helper.canvasIndex){let s;if(this.isPagingSettingEnabled()){let r=this.getPagedIndices(t);this.helper.isRightToLeft()?s=r[0]+1:s=r[r.length-1]+1}else s=t+1;return s>this.helper.getTotalCanvases()-1?-1:s}getPagedIndices(t=this.helper.canvasIndex){let s=this.helper.manifest.getSequences()[0],r=s.getCanvases(),a=!!this.getSettings().pagingEnabled,l=this.helper.getViewingDirection(),h=[];if(s.getViewingHint()===Te.ViewingHint.CONTINUOUS)h=r.map((u,c)=>c);else if(!a)h.push(t);else{if(t===0||t===r.length&&r.length%2==0)h=[t];else if(t%2==0){let u=r[t],c=r[t-1];(u==null?void 0:u.getViewingHint())!==Te.ViewingHint.NON_PAGED&&(c==null?void 0:c.getViewingHint())!==Te.ViewingHint.NON_PAGED?c?h=[t-1,t]:h=[t]:h=[t]}else{let u=r[t],c=r[t+1];(u==null?void 0:u.getViewingHint())!==Te.ViewingHint.NON_PAGED&&(c==null?void 0:c.getViewingHint())!==Te.ViewingHint.NON_PAGED?c?h=[t,t+1]:h=[t]:h=[t]}l===Te.ViewingDirection.RIGHT_TO_LEFT&&(h=h.reverse())}return h}};/*! @openseadragon-imaging/openseadragon-viewerinputhook 2.2.1 ab9b394 (clean)  @license MIT *///! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! License: http://openseadragon.github.io/license/
//! http://openseadragon.github.io
//! openseadragon 2.4.2
export{ai as default};
