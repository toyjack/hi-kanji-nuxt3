import{D as x,F as g}from"./chunk-P2U3GQ3L-2d793356.mjs";import{H as f}from"./IIIFContentHandler-2D2CUZM6-76bcbaed.mjs";import{D as C,G as $,M as r,P as T,T as I,Q as v,R as w}from"./entry-cf55a5cd.mjs";var c=C(f()),h=$(),_=class extends x{constructor(t){super(t,!0,!0),this.isCreated=!1,this.isOpen=!1}create(){super.create(),this.extensionHost.subscribe(r.CANVAS_INDEX_CHANGE,e=>{this.selectIndex(parseInt(e))}),this.extensionHost.subscribe(r.LOGIN,()=>{this.loadThumbs()}),this.extensionHost.subscribe(r.CLICKTHROUGH,()=>{this.loadThumbs()}),this.$thumbs=h('<div class="thumbs"></div>'),this.$element.append(this.$thumbs);let t=this.extension.helper.getViewingDirection()||c.ViewingDirection.LEFT_TO_RIGHT;this.$thumbs.addClass(t);let i=this;h.templates({thumbsTemplate:'<a id="thumb{{>index}}" class="{{:~className()}}" data-src="{{>uri}}" data-visible="{{>visible}}" data-index="{{>index}}" tabindex="0">                                <div class="wrap" style="height:{{>height + ~extraHeight()}}px"></div>                                <div class="info">                                    <span class="index">{{:#index + 1}}</span>                                    <span class="label" title="{{>label}}">{{>label}}&nbsp;</span>                                    <span class="searchResults" title="{{:~searchResultsTitle()}}">{{>data.searchResults}}</span>                                </div>                             </a>                             {{if ~separator()}}                                  <div class="separator"></div>                              {{/if}}'});let a=this.options.thumbsExtraHeight;h.views.helpers({separator:function(){return!1},extraHeight:function(){return a},className:function(){let e="thumb";this.data.index===0&&(e+=" first"),this.data.uri||(e+=" placeholder");let s=i.extension.helper.getViewingDirection();return s&&(s===c.ViewingDirection.LEFT_TO_RIGHT||s===c.ViewingDirection.RIGHT_TO_LEFT)||i.extension.helper.isPaged()?e+=" twoCol":e+=" oneCol",e},searchResultsTitle:function(){let e=Number(this.data.data.searchResults);return e?e>1?T.format(i.content.searchResults,e.toString()):T.format(i.content.searchResult,e.toString()):""}}),this.$element.on("scroll",()=>{this.scrollStop()},100),this.resize()}databind(){!this.thumbs||(this._$thumbsCache=null,this.createThumbs(),this.loadThumbs(0),this.selectIndex(this.extension.helper.canvasIndex))}createThumbs(){let t=this;if(!this.thumbs)return;let i=[];for(let e=0;e<this.thumbs.length;e++){let s=this.thumbs[e];i.push(s.height)}let a=I.median(i);for(let e=0;e<this.thumbs.length;e++){let s=this.thumbs[e];s.height=a}this.$thumbs.link(h.templates.thumbsTemplate,this.thumbs),this.$thumbs.undelegate(".thumb","click"),this.$thumbs.delegate(".thumb","click",function(e){e.preventDefault();let s=h.view(this).data;return t.lastThumbClickedIndex=s.index,t.extensionHost.publish(r.THUMB_SELECTED,s),!1}),this.$thumbs.delegate(".thumb","keydown",function(e){let s=e.originalEvent,d=v.getCharCode(s);if(d===g.Spacebar||d===g.Enter){e.preventDefault();let u=h.view(this).data;t.lastThumbClickedIndex=u.index,t.extensionHost.publish(r.THUMB_SELECTED,u)}}),this.setLabel(),this.isCreated=!0}scrollStop(){let t=1/((this.$thumbs.height()-this.$element.height())/this.$element.scrollTop());t>1&&(t=1);let i=Math.floor((this.thumbs.length-1)*t);this.loadThumbs(i)}loadThumbs(t=this.extension.helper.canvasIndex){if(!this.thumbs||!this.thumbs.length)return;let i,a=this.extension.helper.getCanvasByIndex(t).getContent();if(a.length){let l=a[0].getBody();if(l.length){let o=l[0].getType();o&&(i=o.toString().toLowerCase())}}let e=t,s=this.options.thumbsLoadRange,d={start:e>s?e-s:0,end:e<this.thumbs.length-1-s?e+s:this.thumbs.length-1},u=this.options.thumbsImageFadeInDuration,b=this;for(let l=d.start;l<=d.end;l++){let o=this.getThumbByIndex(l),n=o.find(".wrap");if(!n.hasClass("loading")&&!n.hasClass("loaded"))if(o.attr("data-visible")!=="false"){n.removeClass("loadingFailed"),n.addClass("loading"),i&&n.addClass(i);let p=o.attr("data-src");b.config.options.thumbsCacheInvalidation&&b.config.options.thumbsCacheInvalidation.enabled&&(p+=`${b.config.options.thumbsCacheInvalidation.paramType}t=${w.getTimeStamp()}`);let m=h('<img src="'+p+'" alt=""/>');m.hide(),m.on("load",function(){h(this).fadeIn(u,function(){h(this).parent().switchClass("loading","loaded")})}),m.on("error",function(){h(this).parent().switchClass("loading","loadingFailed")}),n.append(m)}else n.hide()}}show(){this.isOpen=!0,this.$element.show(),setTimeout(()=>{this.selectIndex(this.extension.helper.canvasIndex)},1)}hide(){this.isOpen=!1,this.$element.hide()}isPDF(){let t=this.extension.helper.getCurrentCanvas().getType();return t?t.toString().includes("pdf"):!1}setLabel(){h(this.$thumbs).find("span.index").hide(),h(this.$thumbs).find("span.label").show()}addSelectedClassToThumbs(t){this.getThumbByIndex(t).addClass("selected")}selectIndex(t){t===-1||!this.thumbs||!this.thumbs.length||(this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(t),this.addSelectedClassToThumbs(t),~this.extension.getPagedIndices(t).indexOf(this.lastThumbClickedIndex)||this.$element.scrollTop(this.$selectedThumb.position().top),this.loadThumbs(t))}getAllThumbs(){return this._$thumbsCache||(this._$thumbsCache=this.$thumbs.find(".thumb")),this._$thumbsCache}getThumbByIndex(t){return this.$thumbs.find('[data-index="'+t+'"]')}scrollToThumb(t){let i=this.getThumbByIndex(t);this.$element.scrollTop(i.position().top)}resize(){super.resize()}};export{_ as E};
