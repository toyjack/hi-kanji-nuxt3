import{i as v,D as L,F as f}from"./chunk-7YKIH5A2.3fd30fe6.mjs";import{H as C,G as I}from"./IIIFContentHandler-JCX6SYFT.f723564c.mjs";import{a3 as g,a5 as w,ak as F,ad as a,af as x,ai as _,as as E,at as H}from"./entry.6e61bf97.mjs";var p=g(C()),n=w(),V=class extends L{constructor(t){super(t,!0,!0),this.isCreated=!1,this.isOpen=!1}create(){super.create(),this.extensionHost.subscribe(a.CANVAS_INDEX_CHANGE,e=>{this.selectIndex(parseInt(e))}),this.extensionHost.subscribe(a.LOGIN,()=>{this.loadThumbs()}),this.extensionHost.subscribe(a.CLICKTHROUGH,()=>{this.loadThumbs()}),this.$thumbs=n('<div class="thumbs"></div>'),this.$element.append(this.$thumbs);let t=this.extension.helper.getViewingDirection()||p.ViewingDirection.LEFT_TO_RIGHT;this.$thumbs.addClass(t);let s=this;n.templates({thumbsTemplate:'<a id="thumb{{>index}}" class="{{:~className()}}" data-src="{{>uri}}" data-visible="{{>visible}}" data-index="{{>index}}" tabindex="0">                                <div class="wrap" style="height:{{>height + ~extraHeight()}}px"></div>                                <div class="info">                                    <span class="index">{{:#index + 1}}</span>                                    <span class="label" title="{{>label}}">{{>label}}&nbsp;</span>                                    <span class="searchResults" title="{{:~searchResultsTitle()}}">{{>data.searchResults}}</span>                                </div>                             </a>                             {{if ~separator()}}                                  <div class="separator"></div>                              {{/if}}'});let h=this.options.thumbsExtraHeight;n.views.helpers({separator:function(){return!1},extraHeight:function(){return h},className:function(){let e="thumb";this.data.index===0&&(e+=" first"),this.data.uri||(e+=" placeholder");let i=s.extension.helper.getViewingDirection();return i&&(i===p.ViewingDirection.LEFT_TO_RIGHT||i===p.ViewingDirection.RIGHT_TO_LEFT)||s.extension.helper.isPaged()?e+=" twoCol":e+=" oneCol",e},searchResultsTitle:function(){let e=Number(this.data.data.searchResults);return e?e>1?x.format(s.content.searchResults,e.toString()):x.format(s.content.searchResult,e.toString()):""}}),this.$element.on("scroll",()=>{this.scrollStop()},100),this.resize()}databind(){!this.thumbs||(this._$thumbsCache=null,this.createThumbs(),this.loadThumbs(0),this.selectIndex(this.extension.helper.canvasIndex))}createThumbs(){let t=this;if(!this.thumbs)return;let s=[];for(let e=0;e<this.thumbs.length;e++){let i=this.thumbs[e];s.push(i.height)}let h=_.median(s);for(let e=0;e<this.thumbs.length;e++){let i=this.thumbs[e];i.height=h}this.$thumbs.link(n.templates.thumbsTemplate,this.thumbs),this.$thumbs.undelegate(".thumb","click"),this.$thumbs.delegate(".thumb","click",function(e){e.preventDefault();let i=n.view(this).data;return t.lastThumbClickedIndex=i.index,t.extensionHost.publish(a.THUMB_SELECTED,i),!1}),this.$thumbs.delegate(".thumb","keydown",function(e){let i=e.originalEvent,l=E.getCharCode(i);if(l===f.Spacebar||l===f.Enter){e.preventDefault();let c=n.view(this).data;t.lastThumbClickedIndex=c.index,t.extensionHost.publish(a.THUMB_SELECTED,c)}}),this.setLabel(),this.isCreated=!0}scrollStop(){let t=1/((this.$thumbs.height()-this.$element.height())/this.$element.scrollTop());t>1&&(t=1);let s=Math.floor((this.thumbs.length-1)*t);this.loadThumbs(s)}loadThumbs(t=this.extension.helper.canvasIndex){if(!this.thumbs||!this.thumbs.length)return;let s,h=this.extension.helper.getCanvasByIndex(t).getContent();if(h.length){let r=h[0].getBody();if(r.length){let u=r[0].getType();u&&(s=u.toString().toLowerCase())}}let e=t,i=this.options.thumbsLoadRange,l={start:e>i?e-i:0,end:e<this.thumbs.length-1-i?e+i:this.thumbs.length-1},c=this.options.thumbsImageFadeInDuration,b=this;for(let r=l.start;r<=l.end;r++){let u=this.getThumbByIndex(r),o=u.find(".wrap");if(!o.hasClass("loading")&&!o.hasClass("loaded"))if(u.attr("data-visible")!=="false"){o.removeClass("loadingFailed"),o.addClass("loading"),s&&o.addClass(s);let T=u.attr("data-src");b.config.options.thumbsCacheInvalidation&&b.config.options.thumbsCacheInvalidation.enabled&&(T+=`${b.config.options.thumbsCacheInvalidation.paramType}t=${H.getTimeStamp()}`);let m=n('<img src="'+T+'" alt=""/>');m.hide(),m.on("load",function(){n(this).fadeIn(c,function(){n(this).parent().switchClass("loading","loaded")})}),m.on("error",function(){n(this).parent().switchClass("loading","loadingFailed")}),o.append(m)}else o.hide()}}show(){this.isOpen=!0,this.$element.show(),setTimeout(()=>{this.selectIndex(this.extension.helper.canvasIndex)},1)}hide(){this.isOpen=!1,this.$element.hide()}isPDF(){let t=this.extension.helper.getCurrentCanvas().getType();return t?t.toString().includes("pdf"):!1}setLabel(){n(this.$thumbs).find("span.index").hide(),n(this.$thumbs).find("span.label").show()}addSelectedClassToThumbs(t){this.getThumbByIndex(t).addClass("selected")}selectIndex(t){t===-1||!this.thumbs||!this.thumbs.length||(this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(t),this.addSelectedClassToThumbs(t),~this.extension.getPagedIndices(t).indexOf(this.lastThumbClickedIndex)||this.$element.scrollTop(this.$selectedThumb.position().top),this.loadThumbs(t))}getAllThumbs(){return this._$thumbsCache||(this._$thumbsCache=this.$thumbs.find(".thumb")),this._$thumbsCache}getThumbByIndex(t){return this.$thumbs.find('[data-index="'+t+'"]')}scrollToThumb(t){let s=this.getThumbByIndex(t);this.$element.scrollTop(s.position().top)}resize(){super.resize()}},S=class extends V{create(){this.setConfig("resourcesLeftPanel"),super.create()}},$=g(C()),R=g(I()),d=w(),N=class extends v{constructor(t){super(t)}create(){this.setConfig("resourcesLeftPanel"),super.create(),this.setTitle(this.content.title),this.$tabsContent=d('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$views=d('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$thumbsView=d('<div class="thumbsView"></div>'),this.$views.append(this.$thumbsView),this.$resourcesView=d('<div class="resourcesView"></div>'),this.$resources=d("<ul></ul>"),this.$resourcesView.append(this.$resources),this.$views.append(this.$resourcesView),this.thumbsView=new S(this.$thumbsView),this.dataBind()}dataBind(){this.dataBindThumbsView();let t=this.extension.helper.getCurrentCanvas().getResources();t.length===0&&this.$resourcesView.hide();for(let s=0;s<t.length;s++){let h=t[s].getResource();if(h){let e=R.LanguageMap.getValue(h.getLabel());if(e){let i=F.simplifyMimeType(h.getFormat().toString()),l=d('<li><a href="'+h.id+'" target="_blank">'+e+" ("+i+")</li>");this.$resources.append(l)}}}}dataBindThumbsView(){if(!this.thumbsView)return;let t,s,h=this.extension.helper.getViewingDirection();h&&(h===$.ViewingDirection.LEFT_TO_RIGHT||h===$.ViewingDirection.RIGHT_TO_LEFT)?(t=this.config.options.twoColThumbWidth,s=this.config.options.twoColThumbHeight):(t=this.config.options.oneColThumbWidth,s=this.config.options.oneColThumbHeight),typeof t>"u"&&(t=100),typeof s>"u"&&(s=100),this.thumbsView.thumbs=this.extension.helper.getThumbs(t,s),this.thumbsView.thumbs.length<2&&this.$thumbsView.hide(),this.thumbsView.databind()}expandFullStart(){super.expandFullStart(),this.extensionHost.publish(a.LEFTPANEL_EXPAND_FULL_START)}expandFullFinish(){super.expandFullFinish(),this.extensionHost.publish(a.LEFTPANEL_EXPAND_FULL_FINISH)}collapseFullStart(){super.collapseFullStart(),this.extensionHost.publish(a.LEFTPANEL_COLLAPSE_FULL_START)}collapseFullFinish(){super.collapseFullFinish(),this.extensionHost.publish(a.LEFTPANEL_COLLAPSE_FULL_FINISH)}resize(){super.resize(),this.$views.height(this.$main.height()),this.$resources.height(this.$main.height())}};export{N as A};
