var P0=Object.defineProperty;var Yc=Object.getOwnPropertySymbols;var I0=Object.prototype.hasOwnProperty,D0=Object.prototype.propertyIsEnumerable;var $c=(e,t,i)=>t in e?P0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Zc=(e,t)=>{for(var i in t||(t={}))I0.call(t,i)&&$c(e,i,t[i]);if(Yc)for(var i of Yc(t))D0.call(t,i)&&$c(e,i,t[i]);return e};import{G as N0,D as Jf,K as Na,M as jt,P as O0,I as Jc,a2 as F0,a0 as U0,N as Kc}from"./entry-cf55a5cd.mjs";import{o as k0}from"./chunk-3UUJB7QR-b602784f.mjs";import{m as z0}from"./chunk-6AUGIHTP-2176d952.mjs";import{i as B0}from"./chunk-CHPN5XCG-6b41ee64.mjs";import{V as H0}from"./chunk-CXIKZ7FQ-6dbcc404.mjs";import"./chunk-VVWTEMUP-9eb3ed02.mjs";import{_ as G0}from"./chunk-RSUYDEOQ-61ff0f08.mjs";import{Y as V0,Z as W0,t as j0,X as Kf,n as X0,a as q0,e as Y0}from"./chunk-P2U3GQ3L-2d793356.mjs";import{H as $0,G as Z0,g as J0}from"./IIIFContentHandler-2D2CUZM6-76bcbaed.mjs";var K0=class extends G0{constructor(e){super(e)}create(){this.setConfig("downloadDialogue"),super.create()}open(e){super.open(e),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()}isDownloadOptionAvailable(e){return super.isDownloadOptionAvailable(e)}},Q0=class extends Kf{constructor(e){super(e)}create(){this.setConfig("mobileFooterPanel"),super.create()}resize(){super.resize(),setTimeout(()=>{this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},100)}},ey=class extends X0{constructor(e){super(e)}create(){this.setConfig("settingsDialogue"),super.create()}},ty=class extends q0{constructor(e){super(e)}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update(),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)}resize(){super.resize()}},Qc=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,hc=(e,t,i=null)=>{for(;t!==i;){let r=t.nextSibling;e.removeChild(t),t=r}},Xi=`{{lit-${String(Math.random()).slice(2)}}}`,Qf=`<!--${Xi}-->`,ed=new RegExp(`${Xi}|${Qf}`),$n="$lit$",eg=class{constructor(e,t){this.parts=[],this.element=t;let i=[],r=[],s=document.createTreeWalker(t.content,133,null,!1),n=0,a=-1,o=0,{strings:l,values:{length:h}}=e;for(;o<h;){let u=s.nextNode();if(u===null){s.currentNode=r.pop();continue}if(a++,u.nodeType===1){if(u.hasAttributes()){let c=u.attributes,{length:d}=c,p=0;for(let f=0;f<d;f++)td(c[f].name,$n)&&p++;for(;p-- >0;){let f=l[o],v=Tu.exec(f)[2],y=v.toLowerCase()+$n,g=u.getAttribute(y);u.removeAttribute(y);let m=g.split(ed);this.parts.push({type:"attribute",index:a,name:v,strings:m}),o+=m.length-1}}u.tagName==="TEMPLATE"&&(r.push(u),s.currentNode=u.content)}else if(u.nodeType===3){let c=u.data;if(c.indexOf(Xi)>=0){let d=u.parentNode,p=c.split(ed),f=p.length-1;for(let v=0;v<f;v++){let y,g=p[v];if(g==="")y=fr();else{let m=Tu.exec(g);m!==null&&td(m[2],$n)&&(g=g.slice(0,m.index)+m[1]+m[2].slice(0,-$n.length)+m[3]),y=document.createTextNode(g)}d.insertBefore(y,u),this.parts.push({type:"node",index:++a})}p[f]===""?(d.insertBefore(fr(),u),i.push(u)):u.data=p[f],o+=f}}else if(u.nodeType===8)if(u.data===Xi){let c=u.parentNode;(u.previousSibling===null||a===n)&&(a++,c.insertBefore(fr(),u)),n=a,this.parts.push({type:"node",index:a}),u.nextSibling===null?u.data="":(i.push(u),a--),o++}else{let c=-1;for(;(c=u.data.indexOf(Xi,c+1))!==-1;)this.parts.push({type:"node",index:-1}),o++}}for(let u of i)u.parentNode.removeChild(u)}},td=(e,t)=>{let i=e.length-t.length;return i>=0&&e.slice(i)===t},tg=e=>e.index!==-1,fr=()=>document.createComment(""),Tu=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/,uc=133;function ig(e,t){let{element:{content:i},parts:r}=e,s=document.createTreeWalker(i,uc,null,!1),n=ia(r),a=r[n],o=-1,l=0,h=[],u=null;for(;s.nextNode();){o++;let c=s.currentNode;for(c.previousSibling===u&&(u=null),t.has(c)&&(h.push(c),u===null&&(u=c)),u!==null&&l++;a!==void 0&&a.index===o;)a.index=u!==null?-1:a.index-l,n=ia(r,n),a=r[n]}h.forEach(c=>c.parentNode.removeChild(c))}var iy=e=>{let t=e.nodeType===11?0:1,i=document.createTreeWalker(e,uc,null,!1);for(;i.nextNode();)t++;return t},ia=(e,t=-1)=>{for(let i=t+1;i<e.length;i++){let r=e[i];if(tg(r))return i}return-1};function ry(e,t,i=null){let{element:{content:r},parts:s}=e;if(i==null){r.appendChild(t);return}let n=document.createTreeWalker(r,uc,null,!1),a=ia(s),o=0,l=-1;for(;n.nextNode();)for(l++,n.currentNode===i&&(o=iy(t),i.parentNode.insertBefore(t,i));a!==-1&&s[a].index===l;){if(o>0){for(;a!==-1;)s[a].index+=o,a=ia(s,a);return}a=ia(s,a)}}var sy=new WeakMap,pa=e=>typeof e=="function"&&sy.has(e),ui={},id={},Eu=class{constructor(e,t,i){this.__parts=[],this.template=e,this.processor=t,this.options=i}update(e){let t=0;for(let i of this.__parts)i!==void 0&&i.setValue(e[t]),t++;for(let i of this.__parts)i!==void 0&&i.commit()}_clone(){let e=Qc?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],i=this.template.parts,r=document.createTreeWalker(e,133,null,!1),s=0,n=0,a,o=r.nextNode();for(;s<i.length;){if(a=i[s],!tg(a)){this.__parts.push(void 0),s++;continue}for(;n<a.index;)n++,o.nodeName==="TEMPLATE"&&(t.push(o),r.currentNode=o.content),(o=r.nextNode())===null&&(r.currentNode=t.pop(),o=r.nextNode());if(a.type==="node"){let l=this.processor.handleTextExpression(this.options);l.insertAfterNode(o.previousSibling),this.__parts.push(l)}else this.__parts.push(...this.processor.handleAttributeExpressions(o,a.name,a.strings,this.options));s++}return Qc&&(document.adoptNode(e),customElements.upgrade(e)),e}},rd=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),ny=` ${Xi} `,rg=class{constructor(e,t,i,r){this.strings=e,this.values=t,this.type=i,this.processor=r}getHTML(){let e=this.strings.length-1,t="",i=!1;for(let r=0;r<e;r++){let s=this.strings[r],n=s.lastIndexOf("<!--");i=(n>-1||i)&&s.indexOf("-->",n+1)===-1;let a=Tu.exec(s);a===null?t+=s+(i?ny:Qf):t+=s.substr(0,a.index)+a[1]+a[2]+$n+a[3]+Xi}return t+=this.strings[e],t}getTemplateElement(){let e=document.createElement("template"),t=this.getHTML();return rd!==void 0&&(t=rd.createHTML(t)),e.innerHTML=t,e}},cc=e=>e===null||!(typeof e=="object"||typeof e=="function"),Au=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),sg=class{constructor(e,t,i){this.dirty=!0,this.element=e,this.name=t,this.strings=i,this.parts=[];for(let r=0;r<i.length-1;r++)this.parts[r]=this._createPart()}_createPart(){return new ng(this)}_getValue(){let e=this.strings,t=e.length-1,i=this.parts;if(t===1&&e[0]===""&&e[1]===""){let s=i[0].value;if(typeof s=="symbol")return String(s);if(typeof s=="string"||!Au(s))return s}let r="";for(let s=0;s<t;s++){r+=e[s];let n=i[s];if(n!==void 0){let a=n.value;if(cc(a)||!Au(a))r+=typeof a=="string"?a:String(a);else for(let o of a)r+=typeof o=="string"?o:String(o)}}return r+=e[t],r}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},ng=class{constructor(e){this.value=void 0,this.committer=e}setValue(e){e!==ui&&(!cc(e)||e!==this.value)&&(this.value=e,pa(e)||(this.committer.dirty=!0))}commit(){for(;pa(this.value);){let e=this.value;this.value=ui,e(this)}this.value!==ui&&this.committer.commit()}},dc=class{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(fr()),this.endNode=e.appendChild(fr())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=fr()),e.__insert(this.endNode=fr())}insertAfterPart(e){e.__insert(this.startNode=fr()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(this.startNode.parentNode===null)return;for(;pa(this.__pendingValue);){let t=this.__pendingValue;this.__pendingValue=ui,t(this)}let e=this.__pendingValue;e!==ui&&(cc(e)?e!==this.value&&this.__commitText(e):e instanceof rg?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):Au(e)?this.__commitIterable(e):e===id?(this.value=id,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){let t=this.startNode.nextSibling;e=e!=null?e:"";let i=typeof e=="string"?e:String(e);t===this.endNode.previousSibling&&t.nodeType===3?t.data=i:this.__commitNode(document.createTextNode(i)),this.value=e}__commitTemplateResult(e){let t=this.options.templateFactory(e);if(this.value instanceof Eu&&this.value.template===t)this.value.update(e.values);else{let i=new Eu(t,e.processor,this.options),r=i._clone();i.update(e.values),this.__commitNode(r),this.value=i}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());let t=this.value,i=0,r;for(let s of e)r=t[i],r===void 0&&(r=new dc(this.options),t.push(r),i===0?r.appendIntoPart(this):r.insertAfterPart(t[i-1])),r.setValue(s),r.commit(),i++;i<t.length&&(t.length=i,this.clear(r&&r.endNode))}clear(e=this.startNode){hc(this.startNode.parentNode,e.nextSibling,this.endNode)}},ay=class{constructor(e,t,i){if(this.value=void 0,this.__pendingValue=void 0,i.length!==2||i[0]!==""||i[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=i}setValue(e){this.__pendingValue=e}commit(){for(;pa(this.__pendingValue);){let t=this.__pendingValue;this.__pendingValue=ui,t(this)}if(this.__pendingValue===ui)return;let e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=ui}},oy=class extends sg{constructor(e,t,i){super(e,t,i),this.single=i.length===2&&i[0]===""&&i[1]===""}_createPart(){return new ly(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},ly=class extends ng{},ag=!1;(()=>{try{let e={get capture(){return ag=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();var hy=class{constructor(e,t,i){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=i,this.__boundHandleEvent=r=>this.handleEvent(r)}setValue(e){this.__pendingValue=e}commit(){for(;pa(this.__pendingValue);){let s=this.__pendingValue;this.__pendingValue=ui,s(this)}if(this.__pendingValue===ui)return;let e=this.__pendingValue,t=this.value,i=e==null||t!=null&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),r=e!=null&&(t==null||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=uy(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=ui}handleEvent(e){typeof this.value=="function"?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}},uy=e=>e&&(ag?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);function cy(e){let t=ma.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},ma.set(e.type,t));let i=t.stringsArray.get(e.strings);if(i!==void 0)return i;let r=e.strings.join(Xi);return i=t.keyString.get(r),i===void 0&&(i=new eg(e,e.getTemplateElement()),t.keyString.set(r,i)),t.stringsArray.set(e.strings,i),i}var ma=new Map,Bs=new WeakMap,og=(e,t,i)=>{let r=Bs.get(t);r===void 0&&(hc(t,t.firstChild),Bs.set(t,r=new dc(Object.assign({templateFactory:cy},i))),r.appendInto(t)),r.setValue(e),r.commit()},dy=class{handleAttributeExpressions(e,t,i,r){let s=t[0];return s==="."?new oy(e,t.slice(1),i).parts:s==="@"?[new hy(e,t.slice(1),r.eventContext)]:s==="?"?[new ay(e,t.slice(1),i)]:new sg(e,t,i).parts}handleTextExpression(e){return new dc(e)}},py=new dy;typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var ll=(e,...t)=>new rg(e,t,"html",py),lg=(e,t)=>`${e}--${t}`,jo=!0;typeof window.ShadyCSS=="undefined"?jo=!1:typeof window.ShadyCSS.prepareTemplateDom=="undefined"&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),jo=!1);var my=e=>t=>{let i=lg(t.type,e),r=ma.get(i);r===void 0&&(r={stringsArray:new WeakMap,keyString:new Map},ma.set(i,r));let s=r.stringsArray.get(t.strings);if(s!==void 0)return s;let n=t.strings.join(Xi);if(s=r.keyString.get(n),s===void 0){let a=t.getTemplateElement();jo&&window.ShadyCSS.prepareTemplateDom(a,e),s=new eg(t,a),r.keyString.set(n,s)}return r.stringsArray.set(t.strings,s),s},fy=["html","svg"],gy=e=>{fy.forEach(t=>{let i=ma.get(lg(t,e));i!==void 0&&i.keyString.forEach(r=>{let{element:{content:s}}=r,n=new Set;Array.from(s.querySelectorAll("style")).forEach(a=>{n.add(a)}),ig(r,n)})})},hg=new Set,vy=(e,t,i)=>{hg.add(e);let r=i?i.element:document.createElement("template"),s=t.querySelectorAll("style"),{length:n}=s;if(n===0){window.ShadyCSS.prepareTemplateStyles(r,e);return}let a=document.createElement("style");for(let h=0;h<n;h++){let u=s[h];u.parentNode.removeChild(u),a.textContent+=u.textContent}gy(e);let o=r.content;i?ry(i,a,o.firstChild):o.insertBefore(a,o.firstChild),window.ShadyCSS.prepareTemplateStyles(r,e);let l=o.querySelector("style");if(window.ShadyCSS.nativeShadow&&l!==null)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(i){o.insertBefore(a,o.firstChild);let h=new Set;h.add(a),ig(i,h)}},yy=(e,t,i)=>{if(!i||typeof i!="object"||!i.scopeName)throw new Error("The `scopeName` option is required.");let r=i.scopeName,s=Bs.has(t),n=jo&&t.nodeType===11&&!!t.host,a=n&&!hg.has(r),o=a?document.createDocumentFragment():t;if(og(e,o,Object.assign({templateFactory:my(r)},i)),a){let l=Bs.get(o);Bs.delete(o);let h=l.value instanceof Eu?l.value.template:void 0;vy(r,o,h),hc(t,t.firstChild),t.appendChild(o),Bs.set(t,l)}!s&&n&&window.ShadyCSS.styleElement(t.host)},ug;window.JSCompiler_renameProperty=(e,t)=>e;var Ru={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return e!==null;case Number:return e===null?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},cg=(e,t)=>t!==e&&(t===t||e===e),Cl={attribute:!0,type:String,converter:Ru,reflect:!1,hasChanged:cg},Pl=1,Il=1<<2,Dl=1<<3,Nl=1<<4,Lu="finalized",pc=class extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();let e=[];return this._classProperties.forEach((t,i)=>{let r=this._attributeNameForProperty(i,t);r!==void 0&&(this._attributeToPropertyMap.set(r,i),e.push(r))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;let e=Object.getPrototypeOf(this)._classProperties;e!==void 0&&e.forEach((t,i)=>this._classProperties.set(i,t))}}static createProperty(e,t=Cl){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;let i=typeof e=="symbol"?Symbol():`__${e}`,r=this.getPropertyDescriptor(e,i,t);r!==void 0&&Object.defineProperty(this.prototype,e,r)}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(r){let s=this[e];this[t]=r,this.requestUpdateInternal(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||Cl}static finalize(){let e=Object.getPrototypeOf(this);if(e.hasOwnProperty(Lu)||e.finalize(),this[Lu]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){let t=this.properties,i=[...Object.getOwnPropertyNames(t),...typeof Object.getOwnPropertySymbols=="function"?Object.getOwnPropertySymbols(t):[]];for(let r of i)this.createProperty(r,t[r])}}static _attributeNameForProperty(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}static _valueHasChanged(e,t,i=cg){return i(e,t)}static _propertyValueFromAttribute(e,t){let i=t.type,r=t.converter||Ru,s=typeof r=="function"?r:r.fromAttribute;return s?s(e,i):e}static _propertyValueToAttribute(e,t){if(t.reflect===void 0)return;let i=t.type,r=t.converter;return(r&&r.toAttribute||Ru.toAttribute)(e,i)}initialize(){this._updateState=0,this._updatePromise=new Promise(e=>this._enableUpdatingResolver=e),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){let i=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,i)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){this._enableUpdatingResolver!==void 0&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,i){t!==i&&this._attributeToProperty(e,i)}_propertyToAttribute(e,t,i=Cl){let r=this.constructor,s=r._attributeNameForProperty(e,i);if(s!==void 0){let n=r._propertyValueToAttribute(t,i);if(n===void 0)return;this._updateState=this._updateState|Dl,n==null?this.removeAttribute(s):this.setAttribute(s,n),this._updateState=this._updateState&~Dl}}_attributeToProperty(e,t){if(this._updateState&Dl)return;let i=this.constructor,r=i._attributeToPropertyMap.get(e);if(r!==void 0){let s=i.getPropertyOptions(r);this._updateState=this._updateState|Nl,this[r]=i._propertyValueFromAttribute(t,s),this._updateState=this._updateState&~Nl}}requestUpdateInternal(e,t,i){let r=!0;if(e!==void 0){let s=this.constructor;i=i||s.getPropertyOptions(e),s._valueHasChanged(this[e],t,i.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),i.reflect===!0&&!(this._updateState&Nl)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,i))):r=!1}!this._hasRequestedUpdate&&r&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this.requestUpdateInternal(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=this._updateState|Il;try{await this._updatePromise}catch{}let e=this.performUpdate();return e!=null&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return this._updateState&Il}get hasUpdated(){return this._updateState&Pl}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let e=!1,t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(i){throw e=!1,this._markUpdated(),i}e&&(this._updateState&Pl||(this._updateState=this._updateState|Pl,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~Il}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){this._reflectingProperties!==void 0&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((t,i)=>this._propertyToAttribute(i,this[i],t)),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}};ug=Lu;pc[ug]=!0;var xy=(e,t)=>t.kind==="method"&&t.descriptor&&!("value"in t.descriptor)?Object.assign(Object.assign({},t),{finisher(i){i.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){typeof t.initializer=="function"&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,e)}},by=(e,t,i)=>{t.constructor.createProperty(i,e)};function Ae(e){return(t,i)=>i!==void 0?by(e,t,i):xy(e,t)}var Cu=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,dg=Symbol(),wy=class{constructor(e,t){if(t!==dg)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return this._styleSheet===void 0&&(Cu?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}},_y=e=>new wy(String(e),dg);(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");var sd={},mc=class extends pc{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;let e=this.getStyles();if(Array.isArray(e)){let t=(s,n)=>s.reduceRight((a,o)=>Array.isArray(o)?t(o,a):(a.add(o),a),n),i=t(e,new Set),r=[];i.forEach(s=>r.unshift(s)),this._styles=r}else this._styles=e===void 0?[]:[e];this._styles=this._styles.map(t=>{if(t instanceof CSSStyleSheet&&!Cu){let i=Array.prototype.slice.call(t.cssRules).reduce((r,s)=>r+s.cssText,"");return _y(i)}return t})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){let e=this.constructor._styles;e.length!==0&&(window.ShadyCSS!==void 0&&!window.ShadyCSS.nativeShadow?window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(t=>t.cssText),this.localName):Cu?this.renderRoot.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):this._needsShimAdoptedStyleSheets=!0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(e){let t=this.render();super.update(e),t!==sd&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(i=>{let r=document.createElement("style");r.textContent=i.cssText,this.renderRoot.appendChild(r)}))}render(){return sd}};mc.finalized=!0;mc.render=yy;mc.shadowRootOptions={mode:"open"};var pg=navigator.xr!=null&&self.XRSession!=null&&navigator.xr.isSessionSupported!=null,mg=pg&&self.XRSession.prototype.requestHitTestSource,Ol=self.ResizeObserver!=null,Fl=self.IntersectionObserver!=null,fg=mg;(()=>{let e=navigator.userAgent||navigator.vendor||self.opera,t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t})();/\bCrOS\b/.test(navigator.userAgent);var My=/android/i.test(navigator.userAgent),Sy=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,nd=(()=>{let e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))})();/Safari\//.test(navigator.userAgent);var Ty=/firefox/i.test(navigator.userAgent),Ey=/OculusBrowser/.test(navigator.userAgent);Sy&&/CriOS\//.test(navigator.userAgent);var Ay=My&&!Ty&&!Ey,Ry=ll`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`,Ly=ll`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`,Cy=ll`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`,Py=ll`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

/* NOTE: This ruleset is our integration surface area with the
 * :focus-visible polyfill.
 *
 * @see https://github.com/WICG/focus-visible/pull/196 */
:host([data-js-focus-visible]:focus:not(.focus-visible)),
:host([data-js-focus-visible]) :focus:not(.focus-visible) {
  outline: none;
}

.container {
  position: relative;
}

.userInput {
  width: 100%;
  height: 100%;
  display: block;
  position: relative;
  overflow: hidden;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

canvas.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  opacity: 0;
  transition: opacity 0.3s 0.3s;
  background-color: inherit;
}

.slot.poster.show {
  opacity: 1;
  transition: none;
}

.slot.poster.quick {
  transition: none;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: var(--poster-color, #fff);
  background-image: var(--poster-image, none);
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .mask {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--progress-mask, #fff);
  transition: opacity 0.3s;
  opacity: 0.2;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  align-items: center;
  justify-content: center;

  opacity: 0;
  will-change: opacity;
  overflow: hidden;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.slot.interaction-prompt > .animated-container {
  will-change: transform, opacity;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 16px;
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="A depiction of a 3D model"
      aria-live="polite">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>
  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Activate to view in 3D!"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          aria-label="View this 3D model up close">
        ${Cy}
      </a>
    </slot>
  </div>

  <div class="slot interaction-prompt">
    <div class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${Ly}
      </slot>
    </div>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="mask" part="default-progress-mask"></div>
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>
    
    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${Ry}
        </a>
      </slot>
    </div>
  </div>
</div>`,Iy=e=>{og(Py,e)},gg="133",Dy=0,ad=1,Ny=2,vg=1,yg=2,Zn=3,br=0,rt=1,xi=2,xg=1,vi=0,ra=1,od=2,ld=3,hd=4,Oy=5,Os=100,Fy=101,Uy=102,ud=103,cd=104,ky=200,zy=201,By=202,Hy=203,bg=204,wg=205,Gy=206,Vy=207,Wy=208,jy=209,Xy=210,qy=0,Yy=1,$y=2,Pu=3,Zy=4,Jy=5,Ky=6,Qy=7,hl=0,ex=1,tx=2,vr=0,ix=1,rx=2,sx=3,_g=4,nx=5,Mg=300,ul=301,cl=302,Xo=303,Iu=304,dl=306,fc=307,$i=1e3,bt=1001,fa=1002,st=1003,qo=1004,Yo=1005,Je=1006,gc=1007,Qi=1008,Jt=1009,ax=1010,ox=1011,$o=1012,lx=1013,Oo=1014,Yt=1015,Zt=1016,hx=1017,ux=1018,cx=1019,sa=1020,dx=1021,ci=1022,ot=1023,px=1024,mx=1025,Sg=ot,js=1026,ga=1027,fx=1028,gx=1029,vx=1030,yx=1031,xx=1032,bx=1033,Du=33776,dd=33777,pd=33778,Nu=33779,Ou=35840,md=35841,Fu=35842,fd=35843,Tg=36196,Uu=37492,ku=37496,Eg=37808,wx=37809,_x=37810,Mx=37811,Sx=37812,Tx=37813,Ex=37814,Ax=37815,Rx=37816,Lx=37817,Cx=37818,Px=37819,Ix=37820,Dx=37821,Ag=36492,Nx=37840,Ox=37841,Fx=37842,Ux=37843,kx=37844,zx=37845,Bx=37846,Hx=37847,Gx=37848,Vx=37849,Wx=37850,jx=37851,Xx=37852,qx=37853,Yx=2200,$x=2201,Zx=2202,Ys=2300,Xr=2301,Ul=2302,Hs=2400,Gs=2401,Zo=2402,vc=2500,Rg=2501,Jx=0,Kx=1,Lg=2,Ke=3e3,Bt=3001,Ra=3007,pl=3002,Qx=3003,Cg=3004,Pg=3005,Ig=3006,eb=3200,tb=3201,Kr=0,ib=1,kl=7680,rb=519,va=35044,Jo=35048,gd="300 es",Ht=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},Oa=1234567,na=Math.PI/180,ya=180/Math.PI,yt=[];for(let e=0;e<256;e++)yt[e]=(e<16?"0":"")+e.toString(16);var sb=typeof crypto!="undefined"&&"randomUUID"in crypto;function Kt(){if(sb)return crypto.randomUUID().toUpperCase();let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(yt[e&255]+yt[e>>8&255]+yt[e>>16&255]+yt[e>>24&255]+"-"+yt[t&255]+yt[t>>8&255]+"-"+yt[t>>16&15|64]+yt[t>>24&255]+"-"+yt[i&63|128]+yt[i>>8&255]+"-"+yt[i>>16&255]+yt[i>>24&255]+yt[r&255]+yt[r>>8&255]+yt[r>>16&255]+yt[r>>24&255]).toUpperCase()}function At(e,t,i){return Math.max(t,Math.min(i,e))}function yc(e,t){return(e%t+t)%t}function nb(e,t,i,r,s){return r+(e-t)*(s-r)/(i-t)}function ab(e,t,i){return e!==t?(i-e)/(t-e):0}function aa(e,t,i){return(1-i)*e+i*t}function ob(e,t,i,r){return aa(e,t,1-Math.exp(-i*r))}function lb(e,t=1){return t-Math.abs(yc(e,t*2)-t)}function hb(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function ub(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function cb(e,t){return e+Math.floor(Math.random()*(t-e+1))}function db(e,t){return e+Math.random()*(t-e)}function pb(e){return e*(.5-Math.random())}function mb(e){return e!==void 0&&(Oa=e%2147483647),Oa=Oa*16807%2147483647,(Oa-1)/2147483646}function fb(e){return e*na}function gb(e){return e*ya}function zu(e){return(e&e-1)==0&&e!==0}function Dg(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ng(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function vb(e,t,i,r,s){let n=Math.cos,a=Math.sin,o=n(i/2),l=a(i/2),h=n((t+r)/2),u=a((t+r)/2),c=n((t-r)/2),d=a((t-r)/2),p=n((r-t)/2),f=a((r-t)/2);switch(s){case"XYX":e.set(o*u,l*c,l*d,o*h);break;case"YZY":e.set(l*d,o*u,l*c,o*h);break;case"ZXZ":e.set(l*c,l*d,o*u,o*h);break;case"XZX":e.set(o*u,l*f,l*p,o*h);break;case"YXY":e.set(l*p,o*u,l*f,o*h);break;case"ZYZ":e.set(l*f,l*p,o*u,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}var Ko=Object.freeze({__proto__:null,DEG2RAD:na,RAD2DEG:ya,generateUUID:Kt,clamp:At,euclideanModulo:yc,mapLinear:nb,inverseLerp:ab,lerp:aa,damp:ob,pingpong:lb,smoothstep:hb,smootherstep:ub,randInt:cb,randFloat:db,randFloatSpread:pb,seededRandom:mb,degToRad:fb,radToDeg:gb,isPowerOfTwo:zu,ceilPowerOfTwo:Dg,floorPowerOfTwo:Ng,setQuaternionFromProperEuler:vb}),K=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,n=this.y-e.y;return this.x=s*i-n*r+e.x,this.y=s*r+n*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};K.prototype.isVector2=!0;var ct=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,s,n,a,o,l){let h=this.elements;return h[0]=e,h[1]=r,h[2]=a,h[3]=t,h[4]=s,h[5]=o,h[6]=i,h[7]=n,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this.elements,n=i[0],a=i[3],o=i[6],l=i[1],h=i[4],u=i[7],c=i[2],d=i[5],p=i[8],f=r[0],v=r[3],y=r[6],g=r[1],m=r[4],_=r[7],x=r[2],w=r[5],S=r[8];return s[0]=n*f+a*g+o*x,s[3]=n*v+a*m+o*w,s[6]=n*y+a*_+o*S,s[1]=l*f+h*g+u*x,s[4]=l*v+h*m+u*w,s[7]=l*y+h*_+u*S,s[2]=c*f+d*g+p*x,s[5]=c*v+d*m+p*w,s[8]=c*y+d*_+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],o=e[6],l=e[7],h=e[8];return t*n*h-t*a*l-i*s*h+i*a*o+r*s*l-r*n*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],o=e[6],l=e[7],h=e[8],u=h*n-a*l,c=a*o-h*s,d=l*s-n*o,p=t*u+i*c+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=u*f,e[1]=(r*l-h*i)*f,e[2]=(a*i-r*n)*f,e[3]=c*f,e[4]=(h*t-r*o)*f,e[5]=(r*s-a*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(n*t-i*s)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,n,a){let o=Math.cos(s),l=Math.sin(s);return this.set(i*o,i*l,-i*(o*n+l*a)+n+e,-r*l,r*o,-r*(-l*n+o*a)+a+t,0,0,1),this}scale(e,t){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){let t=Math.cos(e),i=Math.sin(e),r=this.elements,s=r[0],n=r[3],a=r[6],o=r[1],l=r[4],h=r[7];return r[0]=t*s+i*o,r[3]=t*n+i*l,r[6]=t*a+i*h,r[1]=-i*s+t*o,r[4]=-i*n+t*l,r[7]=-i*a+t*h,this}translate(e,t){let i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};ct.prototype.isMatrix3=!0;function Og(e){if(e.length===0)return-1/0;let t=e[0];for(let i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}function ml(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}var ss,en=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ss===void 0&&(ss=ml("canvas")),ss.width=e.width,ss.height=e.height;let i=ss.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=ss}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},yb=0,ht=class extends Ht{constructor(e=ht.DEFAULT_IMAGE,t=ht.DEFAULT_MAPPING,i=bt,r=bt,s=Je,n=Qi,a=ot,o=Jt,l=1,h=Ke){super(),Object.defineProperty(this,"id",{value:yb++}),this.uuid=Kt(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=n,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new K(0,0),this.repeat=new K(1,1),this.center=new K(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ct,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let r=this.image;if(r.uuid===void 0&&(r.uuid=Kt()),!t&&e.images[r.uuid]===void 0){let s;if(Array.isArray(r)){s=[];for(let n=0,a=r.length;n<a;n++)r[n].isDataTexture?s.push(zl(r[n].image)):s.push(zl(r[n]))}else s=zl(r);e.images[r.uuid]={uuid:r.uuid,url:s}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Mg)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case $i:e.x=e.x-Math.floor(e.x);break;case bt:e.x=e.x<0?0:1;break;case fa:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case $i:e.y=e.y-Math.floor(e.y);break;case bt:e.y=e.y<0?0:1;break;case fa:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}};ht.DEFAULT_IMAGE=void 0;ht.DEFAULT_MAPPING=Mg;ht.prototype.isTexture=!0;function zl(e){return typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap?en.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var We=class{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,s=this.w,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12]*s,this.y=n[1]*t+n[5]*i+n[9]*r+n[13]*s,this.z=n[2]*t+n[6]*i+n[10]*r+n[14]*s,this.w=n[3]*t+n[7]*i+n[11]*r+n[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s,n=.01,a=.1,o=e.elements,l=o[0],h=o[4],u=o[8],c=o[1],d=o[5],p=o[9],f=o[2],v=o[6],y=o[10];if(Math.abs(h-c)<n&&Math.abs(u-f)<n&&Math.abs(p-v)<n){if(Math.abs(h+c)<a&&Math.abs(u+f)<a&&Math.abs(p+v)<a&&Math.abs(l+d+y-3)<a)return this.set(1,0,0,0),this;t=Math.PI;let m=(l+1)/2,_=(d+1)/2,x=(y+1)/2,w=(h+c)/4,S=(u+f)/4,b=(p+v)/4;return m>_&&m>x?m<n?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(m),r=w/i,s=S/i):_>x?_<n?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(_),i=w/r,s=b/r):x<n?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(x),i=S/s,r=b/s),this.set(i,r,s,t),this}let g=Math.sqrt((v-p)*(v-p)+(u-f)*(u-f)+(c-h)*(c-h));return Math.abs(g)<.001&&(g=1),this.x=(v-p)/g,this.y=(u-f)/g,this.z=(c-h)/g,this.w=Math.acos((l+d+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};We.prototype.isVector4=!0;var Ot=class extends Ht{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new We(0,0,e,t),this.scissorTest=!1,this.viewport=new We(0,0,e,t),this.texture=new ht(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Je,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Zc({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}};Ot.prototype.isWebGLRenderTarget=!0;var xb=class extends Ot{constructor(e,t,i){super(e,t);let r=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=r.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}};xb.prototype.isWebGLMultipleRenderTargets=!0;var Fg=class extends Ot{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}};Fg.prototype.isWebGLMultisampleRenderTarget=!0;var Ct=class{constructor(e=0,t=0,i=0,r=1){this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,r)}static slerpFlat(e,t,i,r,s,n,a){let o=i[r+0],l=i[r+1],h=i[r+2],u=i[r+3],c=s[n+0],d=s[n+1],p=s[n+2],f=s[n+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=h,e[t+3]=u;return}if(a===1){e[t+0]=c,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(u!==f||o!==c||l!==d||h!==p){let v=1-a,y=o*c+l*d+h*p+u*f,g=y>=0?1:-1,m=1-y*y;if(m>Number.EPSILON){let x=Math.sqrt(m),w=Math.atan2(x,y*g);v=Math.sin(v*w)/x,a=Math.sin(a*w)/x}let _=a*g;if(o=o*v+c*_,l=l*v+d*_,h=h*v+p*_,u=u*v+f*_,v===1-a){let x=1/Math.sqrt(o*o+l*l+h*h+u*u);o*=x,l*=x,h*=x,u*=x}}e[t]=o,e[t+1]=l,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,s,n){let a=i[r],o=i[r+1],l=i[r+2],h=i[r+3],u=s[n],c=s[n+1],d=s[n+2],p=s[n+3];return e[t]=a*p+h*u+o*d-l*c,e[t+1]=o*p+h*c+l*u-a*d,e[t+2]=l*p+h*d+a*c-o*u,e[t+3]=h*p-a*u-o*c-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=e._x,r=e._y,s=e._z,n=e._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(r/2),u=a(s/2),c=o(i/2),d=o(r/2),p=o(s/2);switch(n){case"XYZ":this._x=c*h*u+l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u-c*d*p;break;case"YXZ":this._x=c*h*u+l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u+c*d*p;break;case"ZXY":this._x=c*h*u-l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u-c*d*p;break;case"ZYX":this._x=c*h*u-l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u+c*d*p;break;case"YZX":this._x=c*h*u+l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u-c*d*p;break;case"XZY":this._x=c*h*u-l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u+c*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],s=t[8],n=t[1],a=t[5],o=t[9],l=t[2],h=t[6],u=t[10],c=i+a+u;if(c>0){let d=.5/Math.sqrt(c+1);this._w=.25/d,this._x=(h-o)*d,this._y=(s-l)*d,this._z=(n-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(h-o)/d,this._x=.25*d,this._y=(r+n)/d,this._z=(s+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(s-l)/d,this._x=(r+n)/d,this._y=.25*d,this._z=(o+h)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(n-r)/d,this._x=(s+l)/d,this._y=(o+h)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(At(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,s=e._z,n=e._w,a=t._x,o=t._y,l=t._z,h=t._w;return this._x=i*h+n*a+r*l-s*o,this._y=r*h+n*o+s*a-i*l,this._z=s*h+n*l+i*o-r*a,this._w=n*h-i*a-r*o-s*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,s=this._z,n=this._w,a=n*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=n,this._x=i,this._y=r,this._z=s,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*n+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*s+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),h=Math.atan2(l,a),u=Math.sin((1-t)*h)/l,c=Math.sin(t*h)/l;return this._w=n*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=s*u+this._z*c,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};Ct.prototype.isQuaternion=!0;var E=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(vd.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(vd.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,s=e.elements,n=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*n,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*n,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*n,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,s=e.x,n=e.y,a=e.z,o=e.w,l=o*t+n*r-a*i,h=o*i+a*t-s*r,u=o*r+s*i-n*t,c=-s*t-n*i-a*r;return this.x=l*o+c*-s+h*-a-u*-n,this.y=h*o+c*-n+u*-s-l*-a,this.z=u*o+c*-a+l*-n-h*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,s=e.z,n=t.x,a=t.y,o=t.z;return this.x=r*o-s*a,this.y=s*n-i*o,this.z=i*a-r*n,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Bl.copy(this).projectOnVector(e),this.sub(Bl)}reflect(e){return this.sub(Bl.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(At(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};E.prototype.isVector3=!0;var Bl=new E,vd=new Ct,It=class{constructor(e=new E(1/0,1/0,1/0),t=new E(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,s=-1/0,n=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let h=e[o],u=e[o+1],c=e[o+2];h<t&&(t=h),u<i&&(i=u),c<r&&(r=c),h>s&&(s=h),u>n&&(n=u),c>a&&(a=c)}return this.min.set(t,i,r),this.max.set(s,n,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,s=-1/0,n=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let h=e.getX(o),u=e.getY(o),c=e.getZ(o);h<t&&(t=h),u<i&&(i=u),c<r&&(r=c),h>s&&(s=h),u>n&&(n=u),c>a&&(a=c)}return this.min.set(t,i,r),this.max.set(s,n,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=cn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),Hl.copy(t.boundingBox),Hl.applyMatrix4(e.matrixWorld),this.union(Hl));let i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,cn),cn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(dn),Fa.subVectors(this.max,dn),ns.subVectors(e.a,dn),as.subVectors(e.b,dn),os.subVectors(e.c,dn),ir.subVectors(as,ns),rr.subVectors(os,as),Cr.subVectors(ns,os);let t=[0,-ir.z,ir.y,0,-rr.z,rr.y,0,-Cr.z,Cr.y,ir.z,0,-ir.x,rr.z,0,-rr.x,Cr.z,0,-Cr.x,-ir.y,ir.x,0,-rr.y,rr.x,0,-Cr.y,Cr.x,0];return!Gl(t,ns,as,os,Fa)||(t=[1,0,0,0,1,0,0,0,1],!Gl(t,ns,as,os,Fa))?!1:(Ua.crossVectors(ir,rr),t=[Ua.x,Ua.y,Ua.z],Gl(t,ns,as,os,Fa))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return cn.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(cn).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ai[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ai[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ai[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ai[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ai[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ai[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ai[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ai[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ai),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};It.prototype.isBox3=!0;var Ai=[new E,new E,new E,new E,new E,new E,new E,new E],cn=new E,Hl=new It,ns=new E,as=new E,os=new E,ir=new E,rr=new E,Cr=new E,dn=new E,Fa=new E,Ua=new E,Pr=new E;function Gl(e,t,i,r,s){for(let n=0,a=e.length-3;n<=a;n+=3){Pr.fromArray(e,n);let o=s.x*Math.abs(Pr.x)+s.y*Math.abs(Pr.y)+s.z*Math.abs(Pr.z),l=t.dot(Pr),h=i.dot(Pr),u=r.dot(Pr);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>o)return!1}return!0}var bb=new It,yd=new E,Vl=new E,Wl=new E,Sr=class{constructor(e=new E,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):bb.setFromPoints(e).getCenter(i);let r=0;for(let s=0,n=e.length;s<n;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Wl.subVectors(e,this.center);let t=Wl.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.add(Wl.multiplyScalar(r/i)),this.radius+=r}return this}union(e){return Vl.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(yd.copy(e.center).add(Vl)),this.expandByPoint(yd.copy(e.center).sub(Vl)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Ri=new E,jl=new E,ka=new E,sr=new E,Xl=new E,za=new E,ql=new E,Qr=class{constructor(e=new E,t=new E(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ri)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Ri.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ri.copy(this.direction).multiplyScalar(t).add(this.origin),Ri.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){jl.copy(e).add(t).multiplyScalar(.5),ka.copy(t).sub(e).normalize(),sr.copy(this.origin).sub(jl);let s=e.distanceTo(t)*.5,n=-this.direction.dot(ka),a=sr.dot(this.direction),o=-sr.dot(ka),l=sr.lengthSq(),h=Math.abs(1-n*n),u,c,d,p;if(h>0)if(u=n*o-a,c=n*a-o,p=s*h,u>=0)if(c>=-p)if(c<=p){let f=1/h;u*=f,c*=f,d=u*(u+n*c+2*a)+c*(n*u+c+2*o)+l}else c=s,u=Math.max(0,-(n*c+a)),d=-u*u+c*(c+2*o)+l;else c=-s,u=Math.max(0,-(n*c+a)),d=-u*u+c*(c+2*o)+l;else c<=-p?(u=Math.max(0,-(-n*s+a)),c=u>0?-s:Math.min(Math.max(-s,-o),s),d=-u*u+c*(c+2*o)+l):c<=p?(u=0,c=Math.min(Math.max(-s,-o),s),d=c*(c+2*o)+l):(u=Math.max(0,-(n*s+a)),c=u>0?s:Math.min(Math.max(-s,-o),s),d=-u*u+c*(c+2*o)+l);else c=n>0?-s:s,u=Math.max(0,-(n*c+a)),d=-u*u+c*(c+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(ka).multiplyScalar(c).add(jl),d}intersectSphere(e,t){Ri.subVectors(e.center,this.origin);let i=Ri.dot(this.direction),r=Ri.dot(Ri)-i*i,s=e.radius*e.radius;if(r>s)return null;let n=Math.sqrt(s-r),a=i-n,o=i+n;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,n,a,o,l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,c=this.origin;return l>=0?(i=(e.min.x-c.x)*l,r=(e.max.x-c.x)*l):(i=(e.max.x-c.x)*l,r=(e.min.x-c.x)*l),h>=0?(s=(e.min.y-c.y)*h,n=(e.max.y-c.y)*h):(s=(e.max.y-c.y)*h,n=(e.min.y-c.y)*h),i>n||s>r||((s>i||i!==i)&&(i=s),(n<r||r!==r)&&(r=n),u>=0?(a=(e.min.z-c.z)*u,o=(e.max.z-c.z)*u):(a=(e.max.z-c.z)*u,o=(e.min.z-c.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Ri)!==null}intersectTriangle(e,t,i,r,s){Xl.subVectors(t,e),za.subVectors(i,e),ql.crossVectors(Xl,za);let n=this.direction.dot(ql),a;if(n>0){if(r)return null;a=1}else if(n<0)a=-1,n=-n;else return null;sr.subVectors(this.origin,e);let o=a*this.direction.dot(za.crossVectors(sr,za));if(o<0)return null;let l=a*this.direction.dot(Xl.cross(sr));if(l<0||o+l>n)return null;let h=-a*sr.dot(ql);return h<0?null:this.at(h/n,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},me=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,s,n,a,o,l,h,u,c,d,p,f,v){let y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=r,y[1]=s,y[5]=n,y[9]=a,y[13]=o,y[2]=l,y[6]=h,y[10]=u,y[14]=c,y[3]=d,y[7]=p,y[11]=f,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new me().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/ls.setFromMatrixColumn(e,0).length(),s=1/ls.setFromMatrixColumn(e,1).length(),n=1/ls.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*n,t[9]=i[9]*n,t[10]=i[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,i=e.x,r=e.y,s=e.z,n=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),h=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){let c=n*h,d=n*u,p=a*h,f=a*u;t[0]=o*h,t[4]=-o*u,t[8]=l,t[1]=d+p*l,t[5]=c-f*l,t[9]=-a*o,t[2]=f-c*l,t[6]=p+d*l,t[10]=n*o}else if(e.order==="YXZ"){let c=o*h,d=o*u,p=l*h,f=l*u;t[0]=c+f*a,t[4]=p*a-d,t[8]=n*l,t[1]=n*u,t[5]=n*h,t[9]=-a,t[2]=d*a-p,t[6]=f+c*a,t[10]=n*o}else if(e.order==="ZXY"){let c=o*h,d=o*u,p=l*h,f=l*u;t[0]=c-f*a,t[4]=-n*u,t[8]=p+d*a,t[1]=d+p*a,t[5]=n*h,t[9]=f-c*a,t[2]=-n*l,t[6]=a,t[10]=n*o}else if(e.order==="ZYX"){let c=n*h,d=n*u,p=a*h,f=a*u;t[0]=o*h,t[4]=p*l-d,t[8]=c*l+f,t[1]=o*u,t[5]=f*l+c,t[9]=d*l-p,t[2]=-l,t[6]=a*o,t[10]=n*o}else if(e.order==="YZX"){let c=n*o,d=n*l,p=a*o,f=a*l;t[0]=o*h,t[4]=f-c*u,t[8]=p*u+d,t[1]=u,t[5]=n*h,t[9]=-a*h,t[2]=-l*h,t[6]=d*u+p,t[10]=c-f*u}else if(e.order==="XZY"){let c=n*o,d=n*l,p=a*o,f=a*l;t[0]=o*h,t[4]=-u,t[8]=l*h,t[1]=c*u+f,t[5]=n*h,t[9]=d*u-p,t[2]=p*u-d,t[6]=a*h,t[10]=f*u+c}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(wb,e,_b)}lookAt(e,t,i){let r=this.elements;return Ft.subVectors(e,t),Ft.lengthSq()===0&&(Ft.z=1),Ft.normalize(),nr.crossVectors(i,Ft),nr.lengthSq()===0&&(Math.abs(i.z)===1?Ft.x+=1e-4:Ft.z+=1e-4,Ft.normalize(),nr.crossVectors(i,Ft)),nr.normalize(),Ba.crossVectors(Ft,nr),r[0]=nr.x,r[4]=Ba.x,r[8]=Ft.x,r[1]=nr.y,r[5]=Ba.y,r[9]=Ft.y,r[2]=nr.z,r[6]=Ba.z,r[10]=Ft.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this.elements,n=i[0],a=i[4],o=i[8],l=i[12],h=i[1],u=i[5],c=i[9],d=i[13],p=i[2],f=i[6],v=i[10],y=i[14],g=i[3],m=i[7],_=i[11],x=i[15],w=r[0],S=r[4],b=r[8],R=r[12],C=r[1],D=r[5],L=r[9],j=r[13],N=r[2],I=r[6],H=r[10],U=r[14],O=r[3],Z=r[7],re=r[11],xe=r[15];return s[0]=n*w+a*C+o*N+l*O,s[4]=n*S+a*D+o*I+l*Z,s[8]=n*b+a*L+o*H+l*re,s[12]=n*R+a*j+o*U+l*xe,s[1]=h*w+u*C+c*N+d*O,s[5]=h*S+u*D+c*I+d*Z,s[9]=h*b+u*L+c*H+d*re,s[13]=h*R+u*j+c*U+d*xe,s[2]=p*w+f*C+v*N+y*O,s[6]=p*S+f*D+v*I+y*Z,s[10]=p*b+f*L+v*H+y*re,s[14]=p*R+f*j+v*U+y*xe,s[3]=g*w+m*C+_*N+x*O,s[7]=g*S+m*D+_*I+x*Z,s[11]=g*b+m*L+_*H+x*re,s[15]=g*R+m*j+_*U+x*xe,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],n=e[1],a=e[5],o=e[9],l=e[13],h=e[2],u=e[6],c=e[10],d=e[14],p=e[3],f=e[7],v=e[11],y=e[15];return p*(+s*o*u-r*l*u-s*a*c+i*l*c+r*a*d-i*o*d)+f*(+t*o*d-t*l*c+s*n*c-r*n*d+r*l*h-s*o*h)+v*(+t*l*u-t*a*d-s*n*u+i*n*d+s*a*h-i*l*h)+y*(-r*a*h-t*o*u+t*a*c+r*n*u-i*n*c+i*o*h)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],o=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11],p=e[12],f=e[13],v=e[14],y=e[15],g=u*v*l-f*c*l+f*o*d-a*v*d-u*o*y+a*c*y,m=p*c*l-h*v*l-p*o*d+n*v*d+h*o*y-n*c*y,_=h*f*l-p*u*l+p*a*d-n*f*d-h*a*y+n*u*y,x=p*u*o-h*f*o-p*a*c+n*f*c+h*a*v-n*u*v,w=t*g+i*m+r*_+s*x;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/w;return e[0]=g*S,e[1]=(f*c*s-u*v*s-f*r*d+i*v*d+u*r*y-i*c*y)*S,e[2]=(a*v*s-f*o*s+f*r*l-i*v*l-a*r*y+i*o*y)*S,e[3]=(u*o*s-a*c*s-u*r*l+i*c*l+a*r*d-i*o*d)*S,e[4]=m*S,e[5]=(h*v*s-p*c*s+p*r*d-t*v*d-h*r*y+t*c*y)*S,e[6]=(p*o*s-n*v*s-p*r*l+t*v*l+n*r*y-t*o*y)*S,e[7]=(n*c*s-h*o*s+h*r*l-t*c*l-n*r*d+t*o*d)*S,e[8]=_*S,e[9]=(p*u*s-h*f*s-p*i*d+t*f*d+h*i*y-t*u*y)*S,e[10]=(n*f*s-p*a*s+p*i*l-t*f*l-n*i*y+t*a*y)*S,e[11]=(h*a*s-n*u*s-h*i*l+t*u*l+n*i*d-t*a*d)*S,e[12]=x*S,e[13]=(h*f*r-p*u*r+p*i*c-t*f*c-h*i*v+t*u*v)*S,e[14]=(p*a*r-n*f*r-p*i*o+t*f*o+n*i*v-t*a*v)*S,e[15]=(n*u*r-h*a*r+h*i*o-t*u*o-n*i*c+t*a*c)*S,this}scale(e){let t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),s=1-i,n=e.x,a=e.y,o=e.z,l=s*n,h=s*a;return this.set(l*n+i,l*a-r*o,l*o+r*a,0,l*a+r*o,h*a+i,h*o-r*n,0,l*o-r*a,h*o+r*n,s*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,n){return this.set(1,i,s,0,e,1,n,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,s=t._x,n=t._y,a=t._z,o=t._w,l=s+s,h=n+n,u=a+a,c=s*l,d=s*h,p=s*u,f=n*h,v=n*u,y=a*u,g=o*l,m=o*h,_=o*u,x=i.x,w=i.y,S=i.z;return r[0]=(1-(f+y))*x,r[1]=(d+_)*x,r[2]=(p-m)*x,r[3]=0,r[4]=(d-_)*w,r[5]=(1-(c+y))*w,r[6]=(v+g)*w,r[7]=0,r[8]=(p+m)*S,r[9]=(v-g)*S,r[10]=(1-(c+f))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,s=ls.set(r[0],r[1],r[2]).length(),n=ls.set(r[4],r[5],r[6]).length(),a=ls.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ii.copy(this);let o=1/s,l=1/n,h=1/a;return ii.elements[0]*=o,ii.elements[1]*=o,ii.elements[2]*=o,ii.elements[4]*=l,ii.elements[5]*=l,ii.elements[6]*=l,ii.elements[8]*=h,ii.elements[9]*=h,ii.elements[10]*=h,t.setFromRotationMatrix(ii),i.x=s,i.y=n,i.z=a,this}makePerspective(e,t,i,r,s,n){n===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,o=2*s/(t-e),l=2*s/(i-r),h=(t+e)/(t-e),u=(i+r)/(i-r),c=-(n+s)/(n-s),d=-2*n*s/(n-s);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,s,n){let a=this.elements,o=1/(t-e),l=1/(i-r),h=1/(n-s),u=(t+e)*o,c=(i+r)*l,d=(n+s)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};me.prototype.isMatrix4=!0;var ls=new E,ii=new me,wb=new E(0,0,0),_b=new E(1,1,1),nr=new E,Ba=new E,Ft=new E,xd=new me,bd=new Ct,es=class{constructor(e=0,t=0,i=0,r=es.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,s=r[0],n=r[4],a=r[8],o=r[1],l=r[5],h=r[9],u=r[2],c=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(At(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-n,s)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-At(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(At(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-n,l)):(this._y=0,this._z=Math.atan2(o,s));break;case"ZYX":this._y=Math.asin(-At(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-n,l));break;case"YZX":this._z=Math.asin(At(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-At(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return xd.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xd,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return bd.setFromEuler(this),this.setFromQuaternion(bd,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new E(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};es.prototype.isEuler=!0;es.DefaultOrder="XYZ";es.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Ug=class{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}},Mb=0,wd=new E,hs=new Ct,Li=new me,Ha=new E,pn=new E,Sb=new E,Tb=new Ct,_d=new E(1,0,0),Md=new E(0,1,0),Sd=new E(0,0,1),Eb={type:"added"},Td={type:"removed"},Fe=class extends Ht{constructor(){super(),Object.defineProperty(this,"id",{value:Mb++}),this.uuid=Kt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Fe.DefaultUp.clone();let e=new E,t=new es,i=new Ct,r=new E(1,1,1);function s(){i.setFromEuler(t,!1)}function n(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(n),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new me},normalMatrix:{value:new ct}}),this.matrix=new me,this.matrixWorld=new me,this.matrixAutoUpdate=Fe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ug,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return hs.setFromAxisAngle(e,t),this.quaternion.multiply(hs),this}rotateOnWorldAxis(e,t){return hs.setFromAxisAngle(e,t),this.quaternion.premultiply(hs),this}rotateX(e){return this.rotateOnAxis(_d,e)}rotateY(e){return this.rotateOnAxis(Md,e)}rotateZ(e){return this.rotateOnAxis(Sd,e)}translateOnAxis(e,t){return wd.copy(e).applyQuaternion(this.quaternion),this.position.add(wd.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_d,e)}translateY(e){return this.translateOnAxis(Md,e)}translateZ(e){return this.translateOnAxis(Sd,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Li.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Ha.copy(e):Ha.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),pn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Li.lookAt(pn,Ha,this.up):Li.lookAt(Ha,pn,this.up),this.quaternion.setFromRotationMatrix(Li),r&&(Li.extractRotation(r.matrixWorld),hs.setFromRotationMatrix(Li),this.quaternion.premultiply(hs.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Eb)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Td)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(Td)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Li.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Li.multiply(e.parent.matrixWorld)),e.applyMatrix4(Li),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let s=this.children[i].getObjectByProperty(e,t);if(s!==void 0)return s}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(pn,e,Sb),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(pn,Tb,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let s=0,n=r.length;s<n;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,h=o.length;l<h;l++){let u=o[l];s(e.shapes,u)}else s(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(s(e.materials,this.material[o]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(s(e.animations,o))}}if(t){let a=n(e.geometries),o=n(e.materials),l=n(e.textures),h=n(e.images),u=n(e.shapes),c=n(e.skeletons),d=n(e.animations);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),c.length>0&&(i.skeletons=c),d.length>0&&(i.animations=d)}return i.object=r,i;function n(a){let o=[];for(let l in a){let h=a[l];delete h.metadata,o.push(h)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};Fe.DefaultUp=new E(0,1,0);Fe.DefaultMatrixAutoUpdate=!0;Fe.prototype.isObject3D=!0;var ri=new E,Ci=new E,Yl=new E,Pi=new E,us=new E,cs=new E,Ed=new E,$l=new E,Zl=new E,Jl=new E,ut=class{constructor(e=new E,t=new E,i=new E){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ri.subVectors(e,t),r.cross(ri);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){ri.subVectors(r,t),Ci.subVectors(i,t),Yl.subVectors(e,t);let n=ri.dot(ri),a=ri.dot(Ci),o=ri.dot(Yl),l=Ci.dot(Ci),h=Ci.dot(Yl),u=n*l-a*a;if(u===0)return s.set(-2,-1,-1);let c=1/u,d=(l*o-a*h)*c,p=(n*h-a*o)*c;return s.set(1-d-p,p,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Pi),Pi.x>=0&&Pi.y>=0&&Pi.x+Pi.y<=1}static getUV(e,t,i,r,s,n,a,o){return this.getBarycoord(e,t,i,r,Pi),o.set(0,0),o.addScaledVector(s,Pi.x),o.addScaledVector(n,Pi.y),o.addScaledVector(a,Pi.z),o}static isFrontFacing(e,t,i,r){return ri.subVectors(i,t),Ci.subVectors(e,t),ri.cross(Ci).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ri.subVectors(this.c,this.b),Ci.subVectors(this.a,this.b),ri.cross(Ci).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ut.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ut.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return ut.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return ut.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ut.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,s=this.c,n,a;us.subVectors(r,i),cs.subVectors(s,i),$l.subVectors(e,i);let o=us.dot($l),l=cs.dot($l);if(o<=0&&l<=0)return t.copy(i);Zl.subVectors(e,r);let h=us.dot(Zl),u=cs.dot(Zl);if(h>=0&&u<=h)return t.copy(r);let c=o*u-h*l;if(c<=0&&o>=0&&h<=0)return n=o/(o-h),t.copy(i).addScaledVector(us,n);Jl.subVectors(e,s);let d=us.dot(Jl),p=cs.dot(Jl);if(p>=0&&d<=p)return t.copy(s);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(cs,a);let v=h*p-d*u;if(v<=0&&u-h>=0&&d-p>=0)return Ed.subVectors(s,r),a=(u-h)/(u-h+(d-p)),t.copy(r).addScaledVector(Ed,a);let y=1/(v+f+c);return n=f*y,a=c*y,t.copy(i).addScaledVector(us,n).addScaledVector(cs,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Ab=0,lt=class extends Ht{constructor(){super(),Object.defineProperty(this,"id",{value:Ab++}),this.uuid=Kt(),this.name="",this.type="Material",this.fog=!0,this.blending=ra,this.side=br,this.vertexColors=!1,this.opacity=1,this.format=ot,this.transparent=!1,this.blendSrc=bg,this.blendDst=wg,this.blendEquation=Os,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Pu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kl,this.stencilZFail=kl,this.stencilZPass=kl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===xg;continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenTint&&this.sheenTint.isColor&&(i.sheenTint=this.sheenTint.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(i.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(i.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(i.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ra&&(i.blending=this.blending),this.side!==br&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==ot&&(i.format=this.format),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function r(s){let n=[];for(let a in s){let o=s[a];delete o.metadata,n.push(o)}return n}if(t){let s=r(e.textures),n=r(e.images);s.length>0&&(i.textures=s),n.length>0&&(i.images=n)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};lt.prototype.isMaterial=!0;var kg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},si={h:0,s:0,l:0},Ga={h:0,s:0,l:0};function Kl(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function Ql(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function eh(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var pe=class{constructor(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=yc(e,1),t=At(t,0,1),i=At(i,0,1),t===0)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+t):i+t-i*t,s=2*i-r;this.r=Kl(s,r,e+1/3),this.g=Kl(s,r,e),this.b=Kl(s,r,e-1/3)}return this}setStyle(e){function t(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r,s=i[1],n=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){let a=parseFloat(r[1])/360,o=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(a,o,l)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=i[1],s=r.length;if(s===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=kg[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Ql(e.r),this.g=Ql(e.g),this.b=Ql(e.b),this}copyLinearToSRGB(e){return this.r=eh(e.r),this.g=eh(e.g),this.b=eh(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){let t=this.r,i=this.g,r=this.b,s=Math.max(t,i,r),n=Math.min(t,i,r),a,o,l=(n+s)/2;if(n===s)a=0,o=0;else{let h=s-n;switch(o=l<=.5?h/(s+n):h/(2-s-n),s){case t:a=(i-r)/h+(i<r?6:0);break;case i:a=(r-t)/h+2;break;case r:a=(t-i)/h+4;break}a/=6}return e.h=a,e.s=o,e.l=l,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(si),si.h+=e,si.s+=t,si.l+=i,this.setHSL(si.h,si.s,si.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(si),e.getHSL(Ga);let i=aa(si.h,Ga.h,t),r=aa(si.s,Ga.s,t),s=aa(si.l,Ga.l,t);return this.setHSL(i,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};pe.NAMES=kg;pe.prototype.isColor=!0;pe.prototype.r=1;pe.prototype.g=1;pe.prototype.b=1;var hi=class extends lt{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new pe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};hi.prototype.isMeshBasicMaterial=!0;var Xe=new E,Va=new K,je=class{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=va,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),n=new pe),t[i++]=n.r,t[i++]=n.g,t[i++]=n.b}return this}copyVector2sArray(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),n=new K),t[i++]=n.x,t[i++]=n.y}return this}copyVector3sArray(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),n=new E),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z}return this}copyVector4sArray(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),n=new We),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i++]=n.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Va.fromBufferAttribute(this,t),Va.applyMatrix3(e),this.setXY(t,Va.x,Va.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Xe.fromBufferAttribute(this,t),Xe.applyMatrix3(e),this.setXYZ(t,Xe.x,Xe.y,Xe.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Xe.x=this.getX(t),Xe.y=this.getY(t),Xe.z=this.getZ(t),Xe.applyMatrix4(e),this.setXYZ(t,Xe.x,Xe.y,Xe.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Xe.x=this.getX(t),Xe.y=this.getY(t),Xe.z=this.getZ(t),Xe.applyNormalMatrix(e),this.setXYZ(t,Xe.x,Xe.y,Xe.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Xe.x=this.getX(t),Xe.y=this.getY(t),Xe.z=this.getZ(t),Xe.transformDirection(e),this.setXYZ(t,Xe.x,Xe.y,Xe.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==va&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};je.prototype.isBufferAttribute=!0;var zg=class extends je{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Bg=class extends je{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Rb=class extends je{constructor(e,t,i){super(new Uint16Array(e),t,i)}};Rb.prototype.isFloat16BufferAttribute=!0;var dt=class extends je{constructor(e,t,i){super(new Float32Array(e),t,i)}},Lb=0,Vt=new me,th=new Fe,ds=new E,Ut=new It,mn=new It,mt=new E,Ye=class extends Ht{constructor(){super(),Object.defineProperty(this,"id",{value:Lb++}),this.uuid=Kt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Og(e)>65535?Bg:zg)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let s=new ct().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Vt.makeRotationFromQuaternion(e),this.applyMatrix4(Vt),this}rotateX(e){return Vt.makeRotationX(e),this.applyMatrix4(Vt),this}rotateY(e){return Vt.makeRotationY(e),this.applyMatrix4(Vt),this}rotateZ(e){return Vt.makeRotationZ(e),this.applyMatrix4(Vt),this}translate(e,t,i){return Vt.makeTranslation(e,t,i),this.applyMatrix4(Vt),this}scale(e,t,i){return Vt.makeScale(e,t,i),this.applyMatrix4(Vt),this}lookAt(e){return th.lookAt(e),th.updateMatrix(),this.applyMatrix4(th.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ds).negate(),this.translate(ds.x,ds.y,ds.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new dt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new It);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let s=t[i];Ut.setFromBufferAttribute(s),this.morphTargetsRelative?(mt.addVectors(this.boundingBox.min,Ut.min),this.boundingBox.expandByPoint(mt),mt.addVectors(this.boundingBox.max,Ut.max),this.boundingBox.expandByPoint(mt)):(this.boundingBox.expandByPoint(Ut.min),this.boundingBox.expandByPoint(Ut.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sr);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new E,1/0);return}if(e){let i=this.boundingSphere.center;if(Ut.setFromBufferAttribute(e),t)for(let s=0,n=t.length;s<n;s++){let a=t[s];mn.setFromBufferAttribute(a),this.morphTargetsRelative?(mt.addVectors(Ut.min,mn.min),Ut.expandByPoint(mt),mt.addVectors(Ut.max,mn.max),Ut.expandByPoint(mt)):(Ut.expandByPoint(mn.min),Ut.expandByPoint(mn.max))}Ut.getCenter(i);let r=0;for(let s=0,n=e.count;s<n;s++)mt.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(mt));if(t)for(let s=0,n=t.length;s<n;s++){let a=t[s],o=this.morphTargetsRelative;for(let l=0,h=a.count;l<h;l++)mt.fromBufferAttribute(a,l),o&&(ds.fromBufferAttribute(e,l),mt.add(ds)),r=Math.max(r,i.distanceToSquared(mt))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,s=t.normal.array,n=t.uv.array,a=r.length/3;t.tangent===void 0&&this.setAttribute("tangent",new je(new Float32Array(4*a),4));let o=t.tangent.array,l=[],h=[];for(let C=0;C<a;C++)l[C]=new E,h[C]=new E;let u=new E,c=new E,d=new E,p=new K,f=new K,v=new K,y=new E,g=new E;function m(C,D,L){u.fromArray(r,C*3),c.fromArray(r,D*3),d.fromArray(r,L*3),p.fromArray(n,C*2),f.fromArray(n,D*2),v.fromArray(n,L*2),c.sub(u),d.sub(u),f.sub(p),v.sub(p);let j=1/(f.x*v.y-v.x*f.y);!isFinite(j)||(y.copy(c).multiplyScalar(v.y).addScaledVector(d,-f.y).multiplyScalar(j),g.copy(d).multiplyScalar(f.x).addScaledVector(c,-v.x).multiplyScalar(j),l[C].add(y),l[D].add(y),l[L].add(y),h[C].add(g),h[D].add(g),h[L].add(g))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let C=0,D=_.length;C<D;++C){let L=_[C],j=L.start,N=L.count;for(let I=j,H=j+N;I<H;I+=3)m(i[I+0],i[I+1],i[I+2])}let x=new E,w=new E,S=new E,b=new E;function R(C){S.fromArray(s,C*3),b.copy(S);let D=l[C];x.copy(D),x.sub(S.multiplyScalar(S.dot(D))).normalize(),w.crossVectors(b,D);let L=w.dot(h[C])<0?-1:1;o[C*4]=x.x,o[C*4+1]=x.y,o[C*4+2]=x.z,o[C*4+3]=L}for(let C=0,D=_.length;C<D;++C){let L=_[C],j=L.start,N=L.count;for(let I=j,H=j+N;I<H;I+=3)R(i[I+0]),R(i[I+1]),R(i[I+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new je(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let c=0,d=i.count;c<d;c++)i.setXYZ(c,0,0,0);let r=new E,s=new E,n=new E,a=new E,o=new E,l=new E,h=new E,u=new E;if(e)for(let c=0,d=e.count;c<d;c+=3){let p=e.getX(c+0),f=e.getX(c+1),v=e.getX(c+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),n.fromBufferAttribute(t,v),h.subVectors(n,s),u.subVectors(r,s),h.cross(u),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,v),a.add(h),o.add(h),l.add(h),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(v,l.x,l.y,l.z)}else for(let c=0,d=t.count;c<d;c+=3)r.fromBufferAttribute(t,c+0),s.fromBufferAttribute(t,c+1),n.fromBufferAttribute(t,c+2),h.subVectors(n,s),u.subVectors(r,s),h.cross(u),i.setXYZ(c+0,h.x,h.y,h.z),i.setXYZ(c+1,h.x,h.y,h.z),i.setXYZ(c+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let i=this.attributes;for(let r in i){if(e.attributes[r]===void 0)continue;let s=i[r].array,n=e.attributes[r],a=n.array,o=n.itemSize*t,l=Math.min(a.length,s.length-o);for(let h=0,u=o;h<l;h++,u++)s[u]=a[h]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)mt.fromBufferAttribute(e,t),mt.normalize(),e.setXYZ(t,mt.x,mt.y,mt.z)}toNonIndexed(){function e(a,o){let l=a.array,h=a.itemSize,u=a.normalized,c=new l.constructor(o.length*h),d=0,p=0;for(let f=0,v=o.length;f<v;f++){a.isInterleavedBufferAttribute?d=o[f]*a.data.stride+a.offset:d=o[f]*h;for(let y=0;y<h;y++)c[p++]=l[d++]}return new je(c,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Ye,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let s=this.morphAttributes;for(let a in s){let o=[],l=s[a];for(let h=0,u=l.length;h<u;h++){let c=l[h],d=e(c,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let n=this.groups;for(let a=0,o=n.length;a<o;a++){let l=n[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},s=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],h=[];for(let u=0,c=l.length;u<c;u++){let d=l[u];h.push(d.toJSON(e.data))}h.length>0&&(r[o]=h,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let n=this.groups;n.length>0&&(e.data.groups=JSON.parse(JSON.stringify(n)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let h=r[l];this.setAttribute(l,h.clone(t))}let s=e.morphAttributes;for(let l in s){let h=[],u=s[l];for(let c=0,d=u.length;c<d;c++)h.push(u[c].clone(t));this.morphAttributes[l]=h}this.morphTargetsRelative=e.morphTargetsRelative;let n=e.groups;for(let l=0,h=n.length;l<h;l++){let u=n[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};Ye.prototype.isBufferGeometry=!0;var Ad=new me,ps=new Qr,ih=new Sr,ar=new E,or=new E,lr=new E,rh=new E,sh=new E,nh=new E,Wa=new E,ja=new E,Xa=new E,qa=new K,Ya=new K,$a=new K,ah=new E,Za=new E,_e=class extends Fe{constructor(e=new Ye,t=new hi){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,n=r.length;s<n;s++){let a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let i=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),ih.copy(i.boundingSphere),ih.applyMatrix4(s),e.ray.intersectsSphere(ih)===!1)||(Ad.copy(s).invert(),ps.copy(e.ray).applyMatrix4(Ad),i.boundingBox!==null&&ps.intersectsBox(i.boundingBox)===!1))return;let n;if(i.isBufferGeometry){let a=i.index,o=i.attributes.position,l=i.morphAttributes.position,h=i.morphTargetsRelative,u=i.attributes.uv,c=i.attributes.uv2,d=i.groups,p=i.drawRange;if(a!==null)if(Array.isArray(r))for(let f=0,v=d.length;f<v;f++){let y=d[f],g=r[y.materialIndex],m=Math.max(y.start,p.start),_=Math.min(a.count,Math.min(y.start+y.count,p.start+p.count));for(let x=m,w=_;x<w;x+=3){let S=a.getX(x),b=a.getX(x+1),R=a.getX(x+2);n=Ja(this,g,e,ps,o,l,h,u,c,S,b,R),n&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=y.materialIndex,t.push(n))}}else{let f=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let y=f,g=v;y<g;y+=3){let m=a.getX(y),_=a.getX(y+1),x=a.getX(y+2);n=Ja(this,r,e,ps,o,l,h,u,c,m,_,x),n&&(n.faceIndex=Math.floor(y/3),t.push(n))}}else if(o!==void 0)if(Array.isArray(r))for(let f=0,v=d.length;f<v;f++){let y=d[f],g=r[y.materialIndex],m=Math.max(y.start,p.start),_=Math.min(o.count,Math.min(y.start+y.count,p.start+p.count));for(let x=m,w=_;x<w;x+=3){let S=x,b=x+1,R=x+2;n=Ja(this,g,e,ps,o,l,h,u,c,S,b,R),n&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=y.materialIndex,t.push(n))}}else{let f=Math.max(0,p.start),v=Math.min(o.count,p.start+p.count);for(let y=f,g=v;y<g;y+=3){let m=y,_=y+1,x=y+2;n=Ja(this,r,e,ps,o,l,h,u,c,m,_,x),n&&(n.faceIndex=Math.floor(y/3),t.push(n))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};_e.prototype.isMesh=!0;function Cb(e,t,i,r,s,n,a,o){let l;if(t.side===rt?l=r.intersectTriangle(a,n,s,!0,o):l=r.intersectTriangle(s,n,a,t.side!==xi,o),l===null)return null;Za.copy(o),Za.applyMatrix4(e.matrixWorld);let h=i.ray.origin.distanceTo(Za);return h<i.near||h>i.far?null:{distance:h,point:Za.clone(),object:e}}function Ja(e,t,i,r,s,n,a,o,l,h,u,c){ar.fromBufferAttribute(s,h),or.fromBufferAttribute(s,u),lr.fromBufferAttribute(s,c);let d=e.morphTargetInfluences;if(n&&d){Wa.set(0,0,0),ja.set(0,0,0),Xa.set(0,0,0);for(let f=0,v=n.length;f<v;f++){let y=d[f],g=n[f];y!==0&&(rh.fromBufferAttribute(g,h),sh.fromBufferAttribute(g,u),nh.fromBufferAttribute(g,c),a?(Wa.addScaledVector(rh,y),ja.addScaledVector(sh,y),Xa.addScaledVector(nh,y)):(Wa.addScaledVector(rh.sub(ar),y),ja.addScaledVector(sh.sub(or),y),Xa.addScaledVector(nh.sub(lr),y)))}ar.add(Wa),or.add(ja),lr.add(Xa)}e.isSkinnedMesh&&(e.boneTransform(h,ar),e.boneTransform(u,or),e.boneTransform(c,lr));let p=Cb(e,t,i,r,ar,or,lr,ah);if(p){o&&(qa.fromBufferAttribute(o,h),Ya.fromBufferAttribute(o,u),$a.fromBufferAttribute(o,c),p.uv=ut.getUV(ah,ar,or,lr,qa,Ya,$a,new K)),l&&(qa.fromBufferAttribute(l,h),Ya.fromBufferAttribute(l,u),$a.fromBufferAttribute(l,c),p.uv2=ut.getUV(ah,ar,or,lr,qa,Ya,$a,new K));let f={a:h,b:u,c,normal:new E,materialIndex:0};ut.getNormal(ar,or,lr,f.normal),p.face=f}return p}var ts=class extends Ye{constructor(e=1,t=1,i=1,r=1,s=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:n};let a=this;r=Math.floor(r),s=Math.floor(s),n=Math.floor(n);let o=[],l=[],h=[],u=[],c=0,d=0;p("z","y","x",-1,-1,i,t,e,n,s,0),p("z","y","x",1,-1,i,t,-e,n,s,1),p("x","z","y",1,1,e,i,t,r,n,2),p("x","z","y",1,-1,e,i,-t,r,n,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(o),this.setAttribute("position",new dt(l,3)),this.setAttribute("normal",new dt(h,3)),this.setAttribute("uv",new dt(u,2));function p(f,v,y,g,m,_,x,w,S,b,R){let C=_/S,D=x/b,L=_/2,j=x/2,N=w/2,I=S+1,H=b+1,U=0,O=0,Z=new E;for(let re=0;re<H;re++){let xe=re*D-j;for(let ce=0;ce<I;ce++){let q=ce*C-L;Z[f]=q*g,Z[v]=xe*m,Z[y]=N,l.push(Z.x,Z.y,Z.z),Z[f]=0,Z[v]=0,Z[y]=w>0?1:-1,h.push(Z.x,Z.y,Z.z),u.push(ce/S),u.push(1-re/b),U+=1}}for(let re=0;re<b;re++)for(let xe=0;xe<S;xe++){let ce=c+xe+I*re,q=c+xe+I*(re+1),Q=c+(xe+1)+I*(re+1),se=c+(xe+1)+I*re;o.push(ce,q,se),o.push(q,Q,se),O+=6}a.addGroup(d,O,R),d+=O,c+=U}}static fromJSON(e){return new ts(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function $s(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let s=e[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?t[i][r]=s.clone():Array.isArray(s)?t[i][r]=s.slice():t[i][r]=s}}return t}function Mt(e){let t={};for(let i=0;i<e.length;i++){let r=$s(e[i]);for(let s in r)t[s]=r[s]}return t}var Pb={clone:$s,merge:Mt},Ib=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Db=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Zi=class extends lt{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ib,this.fragmentShader=Db,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$s(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let s=this.uniforms[r].value;s&&s.isTexture?t.uniforms[r]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[r]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[r]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[r]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[r]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[r]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[r]={type:"m4",value:s.toArray()}:t.uniforms[r]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}};Zi.prototype.isShaderMaterial=!0;var xc=class extends Fe{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new me,this.projectionMatrix=new me,this.projectionMatrixInverse=new me}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};xc.prototype.isCamera=!0;var ft=class extends xc{constructor(e=50,t=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=ya*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(na*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ya*2*Math.atan(Math.tan(na*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,n){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(na*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r,n=this.view;if(this.view!==null&&this.view.enabled){let o=n.fullWidth,l=n.fullHeight;s+=n.offsetX*r/o,t-=n.offsetY*i/l,r*=n.width/o,i*=n.height/l}let a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};ft.prototype.isPerspectiveCamera=!0;var ms=90,fs=1,xa=class extends Fe{constructor(e,t,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;let r=new ft(ms,fs,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new E(1,0,0)),this.add(r);let s=new ft(ms,fs,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new E(-1,0,0)),this.add(s);let n=new ft(ms,fs,e,t);n.layers=this.layers,n.up.set(0,0,1),n.lookAt(new E(0,1,0)),this.add(n);let a=new ft(ms,fs,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new E(0,-1,0)),this.add(a);let o=new ft(ms,fs,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new E(0,0,1)),this.add(o);let l=new ft(ms,fs,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new E(0,0,-1)),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,s,n,a,o,l]=this.children,h=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;let c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,n),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=c,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=h}},fl=class extends ht{constructor(e,t,i,r,s,n,a,o,l,h){e=e!==void 0?e:[],t=t!==void 0?t:ul,super(e,t,i,r,s,n,a,o,l,h),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};fl.prototype.isCubeTexture=!0;var gl=class extends Ot{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new fl(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Je,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=ot,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ts(5,5,5),s=new Zi({name:"CubemapFromEquirect",uniforms:$s(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:rt,blending:vi});s.uniforms.tEquirect.value=t;let n=new _e(r,s),a=t.minFilter;return t.minFilter===Qi&&(t.minFilter=Je),new xa(1,10,this).update(e,n),t.minFilter=a,n.geometry.dispose(),n.material.dispose(),this}clear(e,t,i,r){let s=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,i,r);e.setRenderTarget(s)}};gl.prototype.isWebGLCubeRenderTarget=!0;var oh=new E,Nb=new E,Ob=new ct,Gi=class{constructor(e=new E(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=oh.subVectors(i,t).cross(Nb.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(oh),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Ob.getNormalMatrix(e),r=this.coplanarPoint(oh).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};Gi.prototype.isPlane=!0;var gs=new Sr,Ka=new E,vl=class{constructor(e=new Gi,t=new Gi,i=new Gi,r=new Gi,s=new Gi,n=new Gi){this.planes=[e,t,i,r,s,n]}set(e,t,i,r,s,n){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(n),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],s=i[1],n=i[2],a=i[3],o=i[4],l=i[5],h=i[6],u=i[7],c=i[8],d=i[9],p=i[10],f=i[11],v=i[12],y=i[13],g=i[14],m=i[15];return t[0].setComponents(a-r,u-o,f-c,m-v).normalize(),t[1].setComponents(a+r,u+o,f+c,m+v).normalize(),t[2].setComponents(a+s,u+l,f+d,m+y).normalize(),t[3].setComponents(a-s,u-l,f-d,m-y).normalize(),t[4].setComponents(a-n,u-h,f-p,m-g).normalize(),t[5].setComponents(a+n,u+h,f+p,m+g).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),gs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(gs)}intersectsSprite(e){return gs.center.set(0,0,0),gs.radius=.7071067811865476,gs.applyMatrix4(e.matrixWorld),this.intersectsSphere(gs)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(Ka.x=r.normal.x>0?e.max.x:e.min.x,Ka.y=r.normal.y>0?e.max.y:e.min.y,Ka.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ka)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function Hg(){let e=null,t=!1,i=null,r=null;function s(n,a){i(n,a),r=e.requestAnimationFrame(s)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(n){i=n},setContext:function(n){e=n}}}function Fb(e,t){let i=t.isWebGL2,r=new WeakMap;function s(h,u){let c=h.array,d=h.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,c,d),h.onUploadCallback();let f=5126;return c instanceof Float32Array?f=5126:c instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):c instanceof Uint16Array?h.isFloat16BufferAttribute?i?f=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):f=5123:c instanceof Int16Array?f=5122:c instanceof Uint32Array?f=5125:c instanceof Int32Array?f=5124:c instanceof Int8Array?f=5120:(c instanceof Uint8Array||c instanceof Uint8ClampedArray)&&(f=5121),{buffer:p,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:h.version}}function n(h,u,c){let d=u.array,p=u.updateRange;e.bindBuffer(c,h),p.count===-1?e.bufferSubData(c,0,d):(i?e.bufferSubData(c,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(c,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1)}function a(h){return h.isInterleavedBufferAttribute&&(h=h.data),r.get(h)}function o(h){h.isInterleavedBufferAttribute&&(h=h.data);let u=r.get(h);u&&(e.deleteBuffer(u.buffer),r.delete(h))}function l(h,u){if(h.isGLBufferAttribute){let d=r.get(h);(!d||d.version<h.version)&&r.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);let c=r.get(h);c===void 0?r.set(h,s(h,u)):c.version<h.version&&(n(c.buffer,h,u),c.version=h.version)}return{get:a,remove:o,update:l}}var is=class extends Ye{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let s=e/2,n=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,h=o+1,u=e/a,c=t/o,d=[],p=[],f=[],v=[];for(let y=0;y<h;y++){let g=y*c-n;for(let m=0;m<l;m++){let _=m*u-s;p.push(_,-g,0),f.push(0,0,1),v.push(m/a),v.push(1-y/o)}}for(let y=0;y<o;y++)for(let g=0;g<a;g++){let m=g+l*y,_=g+l*(y+1),x=g+1+l*(y+1),w=g+1+l*y;d.push(m,_,w),d.push(_,x,w)}this.setIndex(d),this.setAttribute("position",new dt(p,3)),this.setAttribute("normal",new dt(f,3)),this.setAttribute("uv",new dt(v,2))}static fromJSON(e){return new is(e.width,e.height,e.widthSegments,e.heightSegments)}},Ub=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,kb=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,zb=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Bb=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Hb=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Gb=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Vb="vec3 transformed = vec3( position );",Wb=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,jb=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenTint, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenTint * ( D * V );
}
#endif`,Xb=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,qb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Yb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,$b=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Zb=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Jb=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Kb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Qb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ew=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,tw=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,iw=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,rw=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,sw=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,nw=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,aw=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ow=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,lw="gl_FragColor = linearToOutputTexel( gl_FragColor );",hw=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,uw=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,cw=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,dw=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,pw=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,mw=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fw=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,gw=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,vw=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,yw=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,xw=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,bw=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,ww=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,_w=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Mw=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Sw=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Tw=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Ew=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Aw=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Rw=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Lw=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenTint = sheenTint;
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
#endif`,Cw=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenTint;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenTint, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Pw=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Iw=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Dw=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Nw=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Ow=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Fw=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Uw=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,kw=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,zw=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Bw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Hw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Gw=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Vw=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ww=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,jw=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Xw=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,qw=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Yw=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,$w=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Zw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Jw=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Kw=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Qw=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,e_=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,t_=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,i_=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,r_=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,s_=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,n_=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,a_=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,o_=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,l_=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,h_=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,u_=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,c_=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,d_=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,p_=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,m_=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,f_=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,g_=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,v_=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,y_=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,x_=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,b_=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,w_=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,__=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,M_=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,S_=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,T_=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,E_=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,A_=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,R_=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,L_=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,C_=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,P_=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,I_=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,D_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,N_=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,O_=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,F_=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,U_=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,k_=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,z_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,B_=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,H_=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,G_=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,V_=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,W_=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,j_=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,X_=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q_=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Y_=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$_=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Z_=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,J_=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,K_=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Q_=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,e1=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenTint;
	uniform float sheenRoughness;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,t1=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,i1=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,r1=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,s1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,n1=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,a1=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,o1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,l1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ce={alphamap_fragment:Ub,alphamap_pars_fragment:kb,alphatest_fragment:zb,alphatest_pars_fragment:Bb,aomap_fragment:Hb,aomap_pars_fragment:Gb,begin_vertex:Vb,beginnormal_vertex:Wb,bsdfs:jb,bumpmap_pars_fragment:Xb,clipping_planes_fragment:qb,clipping_planes_pars_fragment:Yb,clipping_planes_pars_vertex:$b,clipping_planes_vertex:Zb,color_fragment:Jb,color_pars_fragment:Kb,color_pars_vertex:Qb,color_vertex:ew,common:tw,cube_uv_reflection_fragment:iw,defaultnormal_vertex:rw,displacementmap_pars_vertex:sw,displacementmap_vertex:nw,emissivemap_fragment:aw,emissivemap_pars_fragment:ow,encodings_fragment:lw,encodings_pars_fragment:hw,envmap_fragment:uw,envmap_common_pars_fragment:cw,envmap_pars_fragment:dw,envmap_pars_vertex:pw,envmap_physical_pars_fragment:Sw,envmap_vertex:mw,fog_vertex:fw,fog_pars_vertex:gw,fog_fragment:vw,fog_pars_fragment:yw,gradientmap_pars_fragment:xw,lightmap_fragment:bw,lightmap_pars_fragment:ww,lights_lambert_vertex:_w,lights_pars_begin:Mw,lights_toon_fragment:Tw,lights_toon_pars_fragment:Ew,lights_phong_fragment:Aw,lights_phong_pars_fragment:Rw,lights_physical_fragment:Lw,lights_physical_pars_fragment:Cw,lights_fragment_begin:Pw,lights_fragment_maps:Iw,lights_fragment_end:Dw,logdepthbuf_fragment:Nw,logdepthbuf_pars_fragment:Ow,logdepthbuf_pars_vertex:Fw,logdepthbuf_vertex:Uw,map_fragment:kw,map_pars_fragment:zw,map_particle_fragment:Bw,map_particle_pars_fragment:Hw,metalnessmap_fragment:Gw,metalnessmap_pars_fragment:Vw,morphnormal_vertex:Ww,morphtarget_pars_vertex:jw,morphtarget_vertex:Xw,normal_fragment_begin:qw,normal_fragment_maps:Yw,normal_pars_fragment:$w,normal_pars_vertex:Zw,normal_vertex:Jw,normalmap_pars_fragment:Kw,clearcoat_normal_fragment_begin:Qw,clearcoat_normal_fragment_maps:e_,clearcoat_pars_fragment:t_,output_fragment:i_,packing:r_,premultiplied_alpha_fragment:s_,project_vertex:n_,dithering_fragment:a_,dithering_pars_fragment:o_,roughnessmap_fragment:l_,roughnessmap_pars_fragment:h_,shadowmap_pars_fragment:u_,shadowmap_pars_vertex:c_,shadowmap_vertex:d_,shadowmask_pars_fragment:p_,skinbase_vertex:m_,skinning_pars_vertex:f_,skinning_vertex:g_,skinnormal_vertex:v_,specularmap_fragment:y_,specularmap_pars_fragment:x_,tonemapping_fragment:b_,tonemapping_pars_fragment:w_,transmission_fragment:__,transmission_pars_fragment:M_,uv_pars_fragment:S_,uv_pars_vertex:T_,uv_vertex:E_,uv2_pars_fragment:A_,uv2_pars_vertex:R_,uv2_vertex:L_,worldpos_vertex:C_,background_vert:P_,background_frag:I_,cube_vert:D_,cube_frag:N_,depth_vert:O_,depth_frag:F_,distanceRGBA_vert:U_,distanceRGBA_frag:k_,equirect_vert:z_,equirect_frag:B_,linedashed_vert:H_,linedashed_frag:G_,meshbasic_vert:V_,meshbasic_frag:W_,meshlambert_vert:j_,meshlambert_frag:X_,meshmatcap_vert:q_,meshmatcap_frag:Y_,meshnormal_vert:$_,meshnormal_frag:Z_,meshphong_vert:J_,meshphong_frag:K_,meshphysical_vert:Q_,meshphysical_frag:e1,meshtoon_vert:t1,meshtoon_frag:i1,points_vert:r1,points_frag:s1,shadow_vert:n1,shadow_frag:a1,sprite_vert:o1,sprite_frag:l1},ne={common:{diffuse:{value:new pe(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ct},uv2Transform:{value:new ct},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new K(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ct}},sprite:{diffuse:{value:new pe(16777215)},opacity:{value:1},center:{value:new K(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ct}}},fi={basic:{uniforms:Mt([ne.common,ne.specularmap,ne.envmap,ne.aomap,ne.lightmap,ne.fog]),vertexShader:Ce.meshbasic_vert,fragmentShader:Ce.meshbasic_frag},lambert:{uniforms:Mt([ne.common,ne.specularmap,ne.envmap,ne.aomap,ne.lightmap,ne.emissivemap,ne.fog,ne.lights,{emissive:{value:new pe(0)}}]),vertexShader:Ce.meshlambert_vert,fragmentShader:Ce.meshlambert_frag},phong:{uniforms:Mt([ne.common,ne.specularmap,ne.envmap,ne.aomap,ne.lightmap,ne.emissivemap,ne.bumpmap,ne.normalmap,ne.displacementmap,ne.fog,ne.lights,{emissive:{value:new pe(0)},specular:{value:new pe(1118481)},shininess:{value:30}}]),vertexShader:Ce.meshphong_vert,fragmentShader:Ce.meshphong_frag},standard:{uniforms:Mt([ne.common,ne.envmap,ne.aomap,ne.lightmap,ne.emissivemap,ne.bumpmap,ne.normalmap,ne.displacementmap,ne.roughnessmap,ne.metalnessmap,ne.fog,ne.lights,{emissive:{value:new pe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ce.meshphysical_vert,fragmentShader:Ce.meshphysical_frag},toon:{uniforms:Mt([ne.common,ne.aomap,ne.lightmap,ne.emissivemap,ne.bumpmap,ne.normalmap,ne.displacementmap,ne.gradientmap,ne.fog,ne.lights,{emissive:{value:new pe(0)}}]),vertexShader:Ce.meshtoon_vert,fragmentShader:Ce.meshtoon_frag},matcap:{uniforms:Mt([ne.common,ne.bumpmap,ne.normalmap,ne.displacementmap,ne.fog,{matcap:{value:null}}]),vertexShader:Ce.meshmatcap_vert,fragmentShader:Ce.meshmatcap_frag},points:{uniforms:Mt([ne.points,ne.fog]),vertexShader:Ce.points_vert,fragmentShader:Ce.points_frag},dashed:{uniforms:Mt([ne.common,ne.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ce.linedashed_vert,fragmentShader:Ce.linedashed_frag},depth:{uniforms:Mt([ne.common,ne.displacementmap]),vertexShader:Ce.depth_vert,fragmentShader:Ce.depth_frag},normal:{uniforms:Mt([ne.common,ne.bumpmap,ne.normalmap,ne.displacementmap,{opacity:{value:1}}]),vertexShader:Ce.meshnormal_vert,fragmentShader:Ce.meshnormal_frag},sprite:{uniforms:Mt([ne.sprite,ne.fog]),vertexShader:Ce.sprite_vert,fragmentShader:Ce.sprite_frag},background:{uniforms:{uvTransform:{value:new ct},t2D:{value:null}},vertexShader:Ce.background_vert,fragmentShader:Ce.background_frag},cube:{uniforms:Mt([ne.envmap,{opacity:{value:1}}]),vertexShader:Ce.cube_vert,fragmentShader:Ce.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ce.equirect_vert,fragmentShader:Ce.equirect_frag},distanceRGBA:{uniforms:Mt([ne.common,ne.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ce.distanceRGBA_vert,fragmentShader:Ce.distanceRGBA_frag},shadow:{uniforms:Mt([ne.lights,ne.fog,{color:{value:new pe(0)},opacity:{value:1}}]),vertexShader:Ce.shadow_vert,fragmentShader:Ce.shadow_frag}};fi.physical={uniforms:Mt([fi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new K(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenTint:{value:new pe(0)},sheenRoughness:{value:0},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new K},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new pe(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new pe(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Ce.meshphysical_vert,fragmentShader:Ce.meshphysical_frag};function h1(e,t,i,r,s){let n=new pe(0),a=0,o,l,h=null,u=0,c=null;function d(f,v){let y=!1,g=v.isScene===!0?v.background:null;g&&g.isTexture&&(g=t.get(g));let m=e.xr,_=m.getSession&&m.getSession();_&&_.environmentBlendMode==="additive"&&(g=null),g===null?p(n,a):g&&g.isColor&&(p(g,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===dl)?(l===void 0&&(l=new _e(new ts(1,1,1),new Zi({name:"BackgroundCubeMaterial",uniforms:$s(fi.cube.uniforms),vertexShader:fi.cube.vertexShader,fragmentShader:fi.cube.fragmentShader,side:rt,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(x,w,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=g,l.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,(h!==g||u!==g.version||c!==e.toneMapping)&&(l.material.needsUpdate=!0,h=g,u=g.version,c=e.toneMapping),f.unshift(l,l.geometry,l.material,0,0,null)):g&&g.isTexture&&(o===void 0&&(o=new _e(new is(2,2),new Zi({name:"BackgroundMaterial",uniforms:$s(fi.background.uniforms),vertexShader:fi.background.vertexShader,fragmentShader:fi.background.fragmentShader,side:br,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=g,g.matrixAutoUpdate===!0&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),(h!==g||u!==g.version||c!==e.toneMapping)&&(o.material.needsUpdate=!0,h=g,u=g.version,c=e.toneMapping),f.unshift(o,o.geometry,o.material,0,0,null))}function p(f,v){i.buffers.color.setClear(f.r,f.g,f.b,v,s)}return{getClearColor:function(){return n},setClearColor:function(f,v=1){n.set(f),a=v,p(n,a)},getClearAlpha:function(){return a},setClearAlpha:function(f){a=f,p(n,a)},render:d}}function u1(e,t,i,r){let s=e.getParameter(34921),n=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||n!==null,o={},l=v(null),h=l;function u(N,I,H,U,O){let Z=!1;if(a){let re=f(U,H,I);h!==re&&(h=re,d(h.object)),Z=y(U,O),Z&&g(U,O)}else{let re=I.wireframe===!0;(h.geometry!==U.id||h.program!==H.id||h.wireframe!==re)&&(h.geometry=U.id,h.program=H.id,h.wireframe=re,Z=!0)}N.isInstancedMesh===!0&&(Z=!0),O!==null&&i.update(O,34963),Z&&(b(N,I,H,U),O!==null&&e.bindBuffer(34963,i.get(O).buffer))}function c(){return r.isWebGL2?e.createVertexArray():n.createVertexArrayOES()}function d(N){return r.isWebGL2?e.bindVertexArray(N):n.bindVertexArrayOES(N)}function p(N){return r.isWebGL2?e.deleteVertexArray(N):n.deleteVertexArrayOES(N)}function f(N,I,H){let U=H.wireframe===!0,O=o[N.id];O===void 0&&(O={},o[N.id]=O);let Z=O[I.id];Z===void 0&&(Z={},O[I.id]=Z);let re=Z[U];return re===void 0&&(re=v(c()),Z[U]=re),re}function v(N){let I=[],H=[],U=[];for(let O=0;O<s;O++)I[O]=0,H[O]=0,U[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:H,attributeDivisors:U,object:N,attributes:{},index:null}}function y(N,I){let H=h.attributes,U=N.attributes,O=0;for(let Z in U){let re=H[Z],xe=U[Z];if(re===void 0||re.attribute!==xe||re.data!==xe.data)return!0;O++}return h.attributesNum!==O||h.index!==I}function g(N,I){let H={},U=N.attributes,O=0;for(let Z in U){let re=U[Z],xe={};xe.attribute=re,re.data&&(xe.data=re.data),H[Z]=xe,O++}h.attributes=H,h.attributesNum=O,h.index=I}function m(){let N=h.newAttributes;for(let I=0,H=N.length;I<H;I++)N[I]=0}function _(N){x(N,0)}function x(N,I){let H=h.newAttributes,U=h.enabledAttributes,O=h.attributeDivisors;H[N]=1,U[N]===0&&(e.enableVertexAttribArray(N),U[N]=1),O[N]!==I&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](N,I),O[N]=I)}function w(){let N=h.newAttributes,I=h.enabledAttributes;for(let H=0,U=I.length;H<U;H++)I[H]!==N[H]&&(e.disableVertexAttribArray(H),I[H]=0)}function S(N,I,H,U,O,Z){r.isWebGL2===!0&&(H===5124||H===5125)?e.vertexAttribIPointer(N,I,H,O,Z):e.vertexAttribPointer(N,I,H,U,O,Z)}function b(N,I,H,U){if(r.isWebGL2===!1&&(N.isInstancedMesh||U.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;m();let O=U.attributes,Z=H.getAttributes(),re=I.defaultAttributeValues;for(let xe in Z){let ce=Z[xe];if(ce.location>=0){let q=O[xe];if(q===void 0&&(xe==="instanceMatrix"&&N.instanceMatrix&&(q=N.instanceMatrix),xe==="instanceColor"&&N.instanceColor&&(q=N.instanceColor)),q!==void 0){let Q=q.normalized,se=q.itemSize,ae=i.get(q);if(ae===void 0)continue;let z=ae.buffer,Ve=ae.type,we=ae.bytesPerElement;if(q.isInterleavedBufferAttribute){let te=q.data,G=te.stride,J=q.offset;if(te&&te.isInstancedInterleavedBuffer){for(let X=0;X<ce.locationSize;X++)x(ce.location+X,te.meshPerAttribute);N.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let X=0;X<ce.locationSize;X++)_(ce.location+X);e.bindBuffer(34962,z);for(let X=0;X<ce.locationSize;X++)S(ce.location+X,se/ce.locationSize,Ve,Q,G*we,(J+se/ce.locationSize*X)*we)}else{if(q.isInstancedBufferAttribute){for(let te=0;te<ce.locationSize;te++)x(ce.location+te,q.meshPerAttribute);N.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=q.meshPerAttribute*q.count)}else for(let te=0;te<ce.locationSize;te++)_(ce.location+te);e.bindBuffer(34962,z);for(let te=0;te<ce.locationSize;te++)S(ce.location+te,se/ce.locationSize,Ve,Q,se*we,se/ce.locationSize*te*we)}}else if(re!==void 0){let Q=re[xe];if(Q!==void 0)switch(Q.length){case 2:e.vertexAttrib2fv(ce.location,Q);break;case 3:e.vertexAttrib3fv(ce.location,Q);break;case 4:e.vertexAttrib4fv(ce.location,Q);break;default:e.vertexAttrib1fv(ce.location,Q)}}}}w()}function R(){L();for(let N in o){let I=o[N];for(let H in I){let U=I[H];for(let O in U)p(U[O].object),delete U[O];delete I[H]}delete o[N]}}function C(N){if(o[N.id]===void 0)return;let I=o[N.id];for(let H in I){let U=I[H];for(let O in U)p(U[O].object),delete U[O];delete I[H]}delete o[N.id]}function D(N){for(let I in o){let H=o[I];if(H[N.id]===void 0)continue;let U=H[N.id];for(let O in U)p(U[O].object),delete U[O];delete H[N.id]}}function L(){j(),h!==l&&(h=l,d(h.object))}function j(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:L,resetDefaultState:j,dispose:R,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:m,enableAttribute:_,disableUnusedAttributes:w}}function c1(e,t,i,r){let s=r.isWebGL2,n;function a(h){n=h}function o(h,u){e.drawArrays(n,h,u),i.update(u,n,1)}function l(h,u,c){if(c===0)return;let d,p;if(s)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](n,h,u,c),i.update(u,n,c)}this.setMode=a,this.render=o,this.renderInstances=l}function d1(e,t,i){let r;function s(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let b=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function n(b){if(b==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return b==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&e instanceof WebGL2ComputeRenderingContext,o=i.precision!==void 0?i.precision:"highp",l=n(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let h=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,c=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),v=e.getParameter(34921),y=e.getParameter(36347),g=e.getParameter(36348),m=e.getParameter(36349),_=d>0,x=a||t.has("OES_texture_float"),w=_&&x,S=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:s,getMaxPrecision:n,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:v,maxVertexUniforms:y,maxVaryings:g,maxFragmentUniforms:m,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:w,maxSamples:S}}function p1(e){let t=this,i=null,r=0,s=!1,n=!1,a=new Gi,o=new ct,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(c,d,p){let f=c.length!==0||d||r!==0||s;return s=d,i=u(c,p,0),r=c.length,f},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,h()},this.setState=function(c,d,p){let f=c.clippingPlanes,v=c.clipIntersection,y=c.clipShadows,g=e.get(c);if(!s||f===null||f.length===0||n&&!y)n?u(null):h();else{let m=n?0:r,_=m*4,x=g.clippingState||null;l.value=x,x=u(f,d,_,p);for(let w=0;w!==_;++w)x[w]=i[w];g.clippingState=x,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=m}};function h(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(c,d,p,f){let v=c!==null?c.length:0,y=null;if(v!==0){if(y=l.value,f!==!0||y===null){let g=p+v*4,m=d.matrixWorldInverse;o.getNormalMatrix(m),(y===null||y.length<g)&&(y=new Float32Array(g));for(let _=0,x=p;_!==v;++_,x+=4)a.copy(c[_]).applyMatrix4(m,o),a.normal.toArray(y,x),y[x+3]=a.constant}l.value=y,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,y}}function m1(e){let t=new WeakMap;function i(a,o){return o===Xo?a.mapping=ul:o===Iu&&(a.mapping=cl),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===Xo||o===Iu)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let h=e.getRenderTarget(),u=new gl(l.height/2);return u.fromEquirectangularTexture(e,a),t.set(a,u),e.setRenderTarget(h),a.addEventListener("dispose",s),i(u.texture,a.mapping)}else return null}}return a}function s(a){let o=a.target;o.removeEventListener("dispose",s);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function n(){t=new WeakMap}return{get:r,dispose:n}}var rs=class extends xc{constructor(e=-1,t=1,i=1,r=-1,s=.1,n=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=n,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=i-e,n=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,n=s+l*this.view.width,a-=h*this.view.offsetY,o=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,n,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};rs.prototype.isOrthographicCamera=!0;var La=class extends Zi{constructor(e){super(e),this.type="RawShaderMaterial"}};La.prototype.isRawShaderMaterial=!0;var Xs=4,yr=8,mi=Math.pow(2,yr),Gg=[.125,.215,.35,.446,.526,.582],Vg=yr-Xs+1+Gg.length,vs=20,wr={[Ke]:0,[Bt]:1,[pl]:2,[Cg]:3,[Pg]:4,[Ig]:5,[Ra]:6},lh=new rs,{_lodPlanes:fn,_sizeLods:Rd,_sigmas:Qa}=v1(),Ld=new pe,hh=null,kr=(1+Math.sqrt(5))/2,ys=1/kr,Cd=[new E(1,1,1),new E(-1,1,1),new E(1,1,-1),new E(-1,1,-1),new E(0,kr,ys),new E(0,kr,-ys),new E(ys,0,kr),new E(-ys,0,kr),new E(kr,ys,0),new E(-kr,ys,0)],f1=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=y1(vs),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){hh=this._renderer.getRenderTarget();let s=this._allocateTargets();return this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=Dd(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=Id(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<fn.length;e++)fn[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(hh),e.scissorTest=!1,eo(e,0,0,e.width,e.height)}_fromTexture(e){hh=this._renderer.getRenderTarget();let t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){let t={magFilter:st,minFilter:st,generateMipmaps:!1,type:Jt,format:Sg,encoding:g1(e)?e.encoding:pl,depthBuffer:!1},i=Pd(t);return i.depthBuffer=!e,this._pingPongRenderTarget=Pd(t),i}_compileMaterial(e){let t=new _e(fn[0],e);this._renderer.compile(t,lh)}_sceneToCubeUV(e,t,i,r){let s=90,n=1,a=new ft(s,n,t,i),o=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,c=h.outputEncoding,d=h.toneMapping;h.getClearColor(Ld),h.toneMapping=vr,h.outputEncoding=Ke,h.autoClear=!1;let p=new hi({name:"PMREM.Background",side:rt,depthWrite:!1,depthTest:!1}),f=new _e(new ts,p),v=!1,y=e.background;y?y.isColor&&(p.color.copy(y),e.background=null,v=!0):(p.color.copy(Ld),v=!0);for(let g=0;g<6;g++){let m=g%3;m==0?(a.up.set(0,o[g],0),a.lookAt(l[g],0,0)):m==1?(a.up.set(0,0,o[g]),a.lookAt(0,l[g],0)):(a.up.set(0,o[g],0),a.lookAt(0,0,l[g])),eo(r,m*mi,g>2?mi:0,mi,mi),h.setRenderTarget(r),v&&h.render(f,a),h.render(e,a)}f.geometry.dispose(),f.material.dispose(),h.toneMapping=d,h.outputEncoding=c,h.autoClear=u,e.background=y}_setEncoding(e,t){this._renderer.capabilities.isWebGL2===!0&&t.format===ot&&t.type===Jt&&t.encoding===Bt?e.value=wr[Ke]:e.value=wr[t.encoding]}_textureToCubeUV(e,t){let i=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=Dd()):this._equirectShader==null&&(this._equirectShader=Id());let r=e.isCubeTexture?this._cubemapShader:this._equirectShader,s=new _e(fn[0],r),n=r.uniforms;n.envMap.value=e,e.isCubeTexture||n.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(n.inputEncoding,e),this._setEncoding(n.outputEncoding,t.texture),eo(t,0,0,3*mi,2*mi),i.setRenderTarget(t),i.render(s,lh)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<Vg;r++){let s=Math.sqrt(Qa[r]*Qa[r]-Qa[r-1]*Qa[r-1]),n=Cd[(r-1)%Cd.length];this._blur(e,r-1,r,s,n)}t.autoClear=i}_blur(e,t,i,r,s){let n=this._pingPongRenderTarget;this._halfBlur(e,n,t,i,r,"latitudinal",s),this._halfBlur(n,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,n,a){let o=this._renderer,l=this._blurMaterial;n!=="latitudinal"&&n!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let h=3,u=new _e(fn[r],l),c=l.uniforms,d=Rd[i]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*vs-1),f=s/p,v=isFinite(s)?1+Math.floor(h*f):vs;v>vs&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${vs}`);let y=[],g=0;for(let w=0;w<vs;++w){let S=w/f,b=Math.exp(-S*S/2);y.push(b),w==0?g+=b:w<v&&(g+=2*b)}for(let w=0;w<y.length;w++)y[w]=y[w]/g;c.envMap.value=e.texture,c.samples.value=v,c.weights.value=y,c.latitudinal.value=n==="latitudinal",a&&(c.poleAxis.value=a),c.dTheta.value=p,c.mipInt.value=yr-i,this._setEncoding(c.inputEncoding,e.texture),this._setEncoding(c.outputEncoding,e.texture);let m=Rd[r],_=3*Math.max(0,mi-2*m),x=(r===0?0:2*mi)+2*m*(r>yr-Xs?r-yr+Xs:0);eo(t,_,x,3*m,2*m),o.setRenderTarget(t),o.render(u,lh)}};function g1(e){return e===void 0||e.type!==Jt?!1:e.encoding===Ke||e.encoding===Bt||e.encoding===Ra}function v1(){let e=[],t=[],i=[],r=yr;for(let s=0;s<Vg;s++){let n=Math.pow(2,r);t.push(n);let a=1/n;s>yr-Xs?a=Gg[s-yr+Xs-1]:s==0&&(a=0),i.push(a);let o=1/(n-1),l=-o/2,h=1+o/2,u=[l,l,h,l,h,h,l,l,h,h,l,h],c=6,d=6,p=3,f=2,v=1,y=new Float32Array(p*d*c),g=new Float32Array(f*d*c),m=new Float32Array(v*d*c);for(let x=0;x<c;x++){let w=x%3*2/3-1,S=x>2?0:-1,b=[w,S,0,w+2/3,S,0,w+2/3,S+1,0,w,S,0,w+2/3,S+1,0,w,S+1,0];y.set(b,p*d*x),g.set(u,f*d*x);let R=[x,x,x,x,x,x];m.set(R,v*d*x)}let _=new Ye;_.setAttribute("position",new je(y,p)),_.setAttribute("uv",new je(g,f)),_.setAttribute("faceIndex",new je(m,v)),e.push(_),r>Xs&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function Pd(e){let t=new Ot(3*mi,3*mi,e);return t.texture.mapping=dl,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function eo(e,t,i,r,s){e.viewport.set(t,i,r,s),e.scissor.set(t,i,r,s)}function y1(e){let t=new Float32Array(e),i=new E(0,1,0);return new La({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:wr[Ke]},outputEncoding:{value:wr[Ke]}},vertexShader:bc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${wc()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:vi,depthTest:!1,depthWrite:!1})}function Id(){let e=new K(1,1);return new La({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:wr[Ke]},outputEncoding:{value:wr[Ke]}},vertexShader:bc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${wc()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:vi,depthTest:!1,depthWrite:!1})}function Dd(){return new La({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:wr[Ke]},outputEncoding:{value:wr[Ke]}},vertexShader:bc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${wc()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:vi,depthTest:!1,depthWrite:!1})}function bc(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function wc(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function x1(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){let l=o.mapping,h=l===Xo||l===Iu,u=l===ul||l===cl;if(h||u){if(t.has(o))return t.get(o).texture;{let c=o.image;if(h&&c&&c.height>0||u&&c&&s(c)){let d=e.getRenderTarget();i===null&&(i=new f1(e));let p=h?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,p),e.setRenderTarget(d),o.addEventListener("dispose",n),p.texture}else return null}}}return o}function s(o){let l=0,h=6;for(let u=0;u<h;u++)o[u]!==void 0&&l++;return l===h}function n(o){let l=o.target;l.removeEventListener("dispose",n);let h=t.get(l);h!==void 0&&(t.delete(l),h.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function b1(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let s;switch(r){case"WEBGL_depth_texture":s=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=e.getExtension(r)}return t[r]=s,s}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(r){let s=i(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function w1(e,t,i,r){let s={},n=new WeakMap;function a(c){let d=c.target;d.index!==null&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",a),delete s[d.id];let p=n.get(d);p&&(t.remove(p),n.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(c,d){return s[d.id]===!0||(d.addEventListener("dispose",a),s[d.id]=!0,i.memory.geometries++),d}function l(c){let d=c.attributes;for(let f in d)t.update(d[f],34962);let p=c.morphAttributes;for(let f in p){let v=p[f];for(let y=0,g=v.length;y<g;y++)t.update(v[y],34962)}}function h(c){let d=[],p=c.index,f=c.attributes.position,v=0;if(p!==null){let m=p.array;v=p.version;for(let _=0,x=m.length;_<x;_+=3){let w=m[_+0],S=m[_+1],b=m[_+2];d.push(w,S,S,b,b,w)}}else{let m=f.array;v=f.version;for(let _=0,x=m.length/3-1;_<x;_+=3){let w=_+0,S=_+1,b=_+2;d.push(w,S,S,b,b,w)}}let y=new(Og(d)>65535?Bg:zg)(d,1);y.version=v;let g=n.get(c);g&&t.remove(g),n.set(c,y)}function u(c){let d=n.get(c);if(d){let p=c.index;p!==null&&d.version<p.version&&h(c)}else h(c);return n.get(c)}return{get:o,update:l,getWireframeAttribute:u}}function _1(e,t,i,r){let s=r.isWebGL2,n;function a(d){n=d}let o,l;function h(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(n,p,o,d*l),i.update(p,n,1)}function c(d,p,f){if(f===0)return;let v,y;if(s)v=e,y="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[y](n,p,o,d*l,f),i.update(p,n,f)}this.setMode=a,this.setIndex=h,this.render=u,this.renderInstances=c}function M1(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(n,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(n/3);break;case 1:i.lines+=o*(n/2);break;case 3:i.lines+=o*(n-1);break;case 2:i.lines+=o*n;break;case 0:i.points+=o*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:s,update:r}}var _c=class extends ht{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=st,this.minFilter=st,this.wrapR=bt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};_c.prototype.isDataTexture2DArray=!0;function S1(e,t){return e[0]-t[0]}function T1(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Nd(e,t){let i=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?i=127:r instanceof Int16Array?i=32767:r instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(i)}function E1(e,t,i){let r={},s=new Float32Array(8),n=new WeakMap,a=new E,o=[];for(let h=0;h<8;h++)o[h]=[h,0];function l(h,u,c,d){let p=h.morphTargetInfluences;if(t.isWebGL2===!0){let f=u.morphAttributes.position.length,v=n.get(u);if(v===void 0||v.count!==f){v!==void 0&&v.texture.dispose();let m=u.morphAttributes.normal!==void 0,_=u.morphAttributes.position,x=u.morphAttributes.normal||[],w=u.attributes.position.count,S=m===!0?2:1,b=w*S,R=1;b>t.maxTextureSize&&(R=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);let C=new Float32Array(b*R*4*f),D=new _c(C,b,R,f);D.format=ot,D.type=Yt;let L=S*4;for(let j=0;j<f;j++){let N=_[j],I=x[j],H=b*R*4*j;for(let U=0;U<N.count;U++){a.fromBufferAttribute(N,U),N.normalized===!0&&Nd(a,N);let O=U*L;C[H+O+0]=a.x,C[H+O+1]=a.y,C[H+O+2]=a.z,C[H+O+3]=0,m===!0&&(a.fromBufferAttribute(I,U),I.normalized===!0&&Nd(a,I),C[H+O+4]=a.x,C[H+O+5]=a.y,C[H+O+6]=a.z,C[H+O+7]=0)}}v={count:f,texture:D,size:new K(b,R)},n.set(u,v)}let y=0;for(let m=0;m<p.length;m++)y+=p[m];let g=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",g),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",v.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{let f=p===void 0?0:p.length,v=r[u.id];if(v===void 0||v.length!==f){v=[];for(let x=0;x<f;x++)v[x]=[x,0];r[u.id]=v}for(let x=0;x<f;x++){let w=v[x];w[0]=x,w[1]=p[x]}v.sort(T1);for(let x=0;x<8;x++)x<f&&v[x][1]?(o[x][0]=v[x][0],o[x][1]=v[x][1]):(o[x][0]=Number.MAX_SAFE_INTEGER,o[x][1]=0);o.sort(S1);let y=u.morphAttributes.position,g=u.morphAttributes.normal,m=0;for(let x=0;x<8;x++){let w=o[x],S=w[0],b=w[1];S!==Number.MAX_SAFE_INTEGER&&b?(y&&u.getAttribute("morphTarget"+x)!==y[S]&&u.setAttribute("morphTarget"+x,y[S]),g&&u.getAttribute("morphNormal"+x)!==g[S]&&u.setAttribute("morphNormal"+x,g[S]),s[x]=b,m+=b):(y&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),g&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),s[x]=0)}let _=u.morphTargetsRelative?1:1-m;d.getUniforms().setValue(e,"morphTargetBaseInfluence",_),d.getUniforms().setValue(e,"morphTargetInfluences",s)}}return{update:l}}function A1(e,t,i,r){let s=new WeakMap;function n(l){let h=r.render.frame,u=l.geometry,c=t.get(l,u);return s.get(c)!==h&&(t.update(c),s.set(c,h)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),c}function a(){s=new WeakMap}function o(l){let h=l.target;h.removeEventListener("dispose",o),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:n,dispose:a}}var Wg=class extends ht{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=st,this.minFilter=st,this.wrapR=bt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};Wg.prototype.isDataTexture3D=!0;var jg=new ht,R1=new _c,L1=new Wg,Xg=new fl,Od=[],Fd=[],Ud=new Float32Array(16),kd=new Float32Array(9),zd=new Float32Array(4);function tn(e,t,i){let r=e[0];if(r<=0||r>0)return e;let s=t*i,n=Od[s];if(n===void 0&&(n=new Float32Array(s),Od[s]=n),t!==0){r.toArray(n,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(n,o)}return n}function Dt(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Tt(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function qg(e,t){let i=Fd[t];i===void 0&&(i=new Int32Array(t),Fd[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function C1(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function P1(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Dt(i,t))return;e.uniform2fv(this.addr,t),Tt(i,t)}}function I1(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Dt(i,t))return;e.uniform3fv(this.addr,t),Tt(i,t)}}function D1(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Dt(i,t))return;e.uniform4fv(this.addr,t),Tt(i,t)}}function N1(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Dt(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Tt(i,t)}else{if(Dt(i,r))return;zd.set(r),e.uniformMatrix2fv(this.addr,!1,zd),Tt(i,r)}}function O1(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Dt(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Tt(i,t)}else{if(Dt(i,r))return;kd.set(r),e.uniformMatrix3fv(this.addr,!1,kd),Tt(i,r)}}function F1(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Dt(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Tt(i,t)}else{if(Dt(i,r))return;Ud.set(r),e.uniformMatrix4fv(this.addr,!1,Ud),Tt(i,r)}}function U1(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function k1(e,t){let i=this.cache;Dt(i,t)||(e.uniform2iv(this.addr,t),Tt(i,t))}function z1(e,t){let i=this.cache;Dt(i,t)||(e.uniform3iv(this.addr,t),Tt(i,t))}function B1(e,t){let i=this.cache;Dt(i,t)||(e.uniform4iv(this.addr,t),Tt(i,t))}function H1(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function G1(e,t){let i=this.cache;Dt(i,t)||(e.uniform2uiv(this.addr,t),Tt(i,t))}function V1(e,t){let i=this.cache;Dt(i,t)||(e.uniform3uiv(this.addr,t),Tt(i,t))}function W1(e,t){let i=this.cache;Dt(i,t)||(e.uniform4uiv(this.addr,t),Tt(i,t))}function j1(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.safeSetTexture2D(t||jg,s)}function X1(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.setTexture3D(t||L1,s)}function q1(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.safeSetTextureCube(t||Xg,s)}function Y1(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.setTexture2DArray(t||R1,s)}function $1(e){switch(e){case 5126:return C1;case 35664:return P1;case 35665:return I1;case 35666:return D1;case 35674:return N1;case 35675:return O1;case 35676:return F1;case 5124:case 35670:return U1;case 35667:case 35671:return k1;case 35668:case 35672:return z1;case 35669:case 35673:return B1;case 5125:return H1;case 36294:return G1;case 36295:return V1;case 36296:return W1;case 35678:case 36198:case 36298:case 36306:case 35682:return j1;case 35679:case 36299:case 36307:return X1;case 35680:case 36300:case 36308:case 36293:return q1;case 36289:case 36303:case 36311:case 36292:return Y1}}function Z1(e,t){e.uniform1fv(this.addr,t)}function J1(e,t){let i=tn(t,this.size,2);e.uniform2fv(this.addr,i)}function K1(e,t){let i=tn(t,this.size,3);e.uniform3fv(this.addr,i)}function Q1(e,t){let i=tn(t,this.size,4);e.uniform4fv(this.addr,i)}function eM(e,t){let i=tn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function tM(e,t){let i=tn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function iM(e,t){let i=tn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function rM(e,t){e.uniform1iv(this.addr,t)}function sM(e,t){e.uniform2iv(this.addr,t)}function nM(e,t){e.uniform3iv(this.addr,t)}function aM(e,t){e.uniform4iv(this.addr,t)}function oM(e,t){e.uniform1uiv(this.addr,t)}function lM(e,t){e.uniform2uiv(this.addr,t)}function hM(e,t){e.uniform3uiv(this.addr,t)}function uM(e,t){e.uniform4uiv(this.addr,t)}function cM(e,t,i){let r=t.length,s=qg(i,r);e.uniform1iv(this.addr,s);for(let n=0;n!==r;++n)i.safeSetTexture2D(t[n]||jg,s[n])}function dM(e,t,i){let r=t.length,s=qg(i,r);e.uniform1iv(this.addr,s);for(let n=0;n!==r;++n)i.safeSetTextureCube(t[n]||Xg,s[n])}function pM(e){switch(e){case 5126:return Z1;case 35664:return J1;case 35665:return K1;case 35666:return Q1;case 35674:return eM;case 35675:return tM;case 35676:return iM;case 5124:case 35670:return rM;case 35667:case 35671:return sM;case 35668:case 35672:return nM;case 35669:case 35673:return aM;case 5125:return oM;case 36294:return lM;case 36295:return hM;case 36296:return uM;case 35678:case 36198:case 36298:case 36306:case 35682:return cM;case 35680:case 36300:case 36308:case 36293:return dM}}function mM(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=$1(t.type)}function Yg(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=pM(t.type)}Yg.prototype.updateCache=function(e){let t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Tt(t,e)};function $g(e){this.id=e,this.seq=[],this.map={}}$g.prototype.setValue=function(e,t,i){let r=this.seq;for(let s=0,n=r.length;s!==n;++s){let a=r[s];a.setValue(e,t[a.id],i)}};var uh=/(\w+)(\])?(\[|\.)?/g;function Bd(e,t){e.seq.push(t),e.map[t.id]=t}function fM(e,t,i){let r=e.name,s=r.length;for(uh.lastIndex=0;;){let n=uh.exec(r),a=uh.lastIndex,o=n[1],l=n[2]==="]",h=n[3];if(l&&(o=o|0),h===void 0||h==="["&&a+2===s){Bd(i,h===void 0?new mM(o,e,t):new Yg(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new $g(o),Bd(i,u)),i=u}}}function xr(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let s=e.getActiveUniform(t,r),n=e.getUniformLocation(t,s.name);fM(s,n,this)}}xr.prototype.setValue=function(e,t,i,r){let s=this.map[t];s!==void 0&&s.setValue(e,i,r)};xr.prototype.setOptional=function(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)};xr.upload=function(e,t,i,r){for(let s=0,n=t.length;s!==n;++s){let a=t[s],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}};xr.seqWithValue=function(e,t){let i=[];for(let r=0,s=e.length;r!==s;++r){let n=e[r];n.id in t&&i.push(n)}return i};function Hd(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var gM=0;function vM(e){let t=e.split(`
`);for(let i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join(`
`)}function Zg(e){switch(e){case Ke:return["Linear","( value )"];case Bt:return["sRGB","( value )"];case pl:return["RGBE","( value )"];case Cg:return["RGBM","( value, 7.0 )"];case Pg:return["RGBM","( value, 16.0 )"];case Ig:return["RGBD","( value, 256.0 )"];case Ra:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Qx:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Gd(e,t,i){let r=e.getShaderParameter(t,35713),s=e.getShaderInfoLog(t).trim();return r&&s===""?"":i.toUpperCase()+`

`+s+`

`+vM(e.getShaderSource(t))}function xs(e,t){let i=Zg(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function yM(e,t){let i=Zg(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function xM(e,t){let i;switch(t){case ix:i="Linear";break;case rx:i="Reinhard";break;case sx:i="OptimizedCineon";break;case _g:i="ACESFilmic";break;case nx:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function bM(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Jn).join(`
`)}function wM(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function _M(e,t){let i={},r=e.getProgramParameter(t,35721);for(let s=0;s<r;s++){let n=e.getActiveAttrib(t,s),a=n.name,o=1;n.type===35674&&(o=2),n.type===35675&&(o=3),n.type===35676&&(o=4),i[a]={type:n.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Jn(e){return e!==""}function Vd(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Wd(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var MM=/^[ \t]*#include +<([\w\d./]+)>/gm;function Bu(e){return e.replace(MM,SM)}function SM(e,t){let i=Ce[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return Bu(i)}var TM=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,EM=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function jd(e){return e.replace(EM,Jg).replace(TM,AM)}function AM(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Jg(e,t,i,r)}function Jg(e,t,i,r){let s="";for(let n=parseInt(t);n<parseInt(i);n++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,n);return s}function Xd(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function RM(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===vg?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===yg?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Zn&&(t="SHADOWMAP_TYPE_VSM"),t}function LM(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ul:case cl:t="ENVMAP_TYPE_CUBE";break;case dl:case fc:t="ENVMAP_TYPE_CUBE_UV";break}return t}function CM(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case cl:case fc:t="ENVMAP_MODE_REFRACTION";break}return t}function PM(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case hl:t="ENVMAP_BLENDING_MULTIPLY";break;case ex:t="ENVMAP_BLENDING_MIX";break;case tx:t="ENVMAP_BLENDING_ADD";break}return t}function IM(e,t,i,r){let s=e.getContext(),n=i.defines,a=i.vertexShader,o=i.fragmentShader,l=RM(i),h=LM(i),u=CM(i),c=PM(i),d=e.gammaFactor>0?e.gammaFactor:1,p=i.isWebGL2?"":bM(i),f=wM(n),v=s.createProgram(),y,g,m=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(y=[f].filter(Jn).join(`
`),y.length>0&&(y+=`
`),g=[p,f].filter(Jn).join(`
`),g.length>0&&(g+=`
`)):(y=[Xd(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularTintMap?"#define USE_SPECULARTINTMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Jn).join(`
`),g=[p,Xd(i),"#define SHADER_NAME "+i.shaderName,f,"#define GAMMA_FACTOR "+d,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularTintMap?"#define USE_SPECULARTINTMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==vr?"#define TONE_MAPPING":"",i.toneMapping!==vr?Ce.tonemapping_pars_fragment:"",i.toneMapping!==vr?xM("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.format===ci?"#define OPAQUE":"",Ce.encodings_pars_fragment,i.map?xs("mapTexelToLinear",i.mapEncoding):"",i.matcap?xs("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?xs("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?xs("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.specularTintMap?xs("specularTintMapTexelToLinear",i.specularTintMapEncoding):"",i.lightMap?xs("lightMapTexelToLinear",i.lightMapEncoding):"",yM("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Jn).join(`
`)),a=Bu(a),a=Vd(a,i),a=Wd(a,i),o=Bu(o),o=Vd(o,i),o=Wd(o,i),a=jd(a),o=jd(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,g=["#define varying in",i.glslVersion===gd?"":"out highp vec4 pc_fragColor;",i.glslVersion===gd?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);let _=m+y+a,x=m+g+o,w=Hd(s,35633,_),S=Hd(s,35632,x);if(s.attachShader(v,w),s.attachShader(v,S),i.index0AttributeName!==void 0?s.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v),e.debug.checkShaderErrors){let C=s.getProgramInfoLog(v).trim(),D=s.getShaderInfoLog(w).trim(),L=s.getShaderInfoLog(S).trim(),j=!0,N=!0;if(s.getProgramParameter(v,35714)===!1){j=!1;let I=Gd(s,w,"vertex"),H=Gd(s,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(v,35715)+`

Program Info Log: `+C+`
`+I+`
`+H)}else C!==""?console.warn("THREE.WebGLProgram: Program Info Log:",C):(D===""||L==="")&&(N=!1);N&&(this.diagnostics={runnable:j,programLog:C,vertexShader:{log:D,prefix:y},fragmentShader:{log:L,prefix:g}})}s.deleteShader(w),s.deleteShader(S);let b;this.getUniforms=function(){return b===void 0&&(b=new xr(s,v)),b};let R;return this.getAttributes=function(){return R===void 0&&(R=_M(s,v)),R},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=gM++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=S,this}function DM(e,t,i,r,s,n,a){let o=[],l=s.isWebGL2,h=s.logarithmicDepthBuffer,u=s.floatVertexTextures,c=s.maxVertexUniforms,d=s.vertexTextures,p=s.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheen","transmission","transmissionMap","thicknessMap"];function y(b){let R=b.skeleton.bones;if(u)return 1024;{let C=Math.floor((c-20)/4),D=Math.min(C,R.length);return D<R.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+R.length+" bones. This GPU supports "+D+"."),0):D}}function g(b){let R;return b&&b.isTexture?R=b.encoding:b&&b.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),R=b.texture.encoding):R=Ke,l&&b&&b.isTexture&&b.format===ot&&b.type===Jt&&b.encoding===Bt&&(R=Ke),R}function m(b,R,C,D,L){let j=D.fog,N=b.isMeshStandardMaterial?D.environment:null,I=(b.isMeshStandardMaterial?i:t).get(b.envMap||N),H=f[b.type],U=L.isSkinnedMesh?y(L):0;b.precision!==null&&(p=s.getMaxPrecision(b.precision),p!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",p,"instead."));let O,Z;if(H){let q=fi[H];O=q.vertexShader,Z=q.fragmentShader}else O=b.vertexShader,Z=b.fragmentShader;let re=e.getRenderTarget(),xe=b.alphaTest>0,ce=b.clearcoat>0;return{isWebGL2:l,shaderID:H,shaderName:b.type,vertexShader:O,fragmentShader:Z,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:p,instancing:L.isInstancedMesh===!0,instancingColor:L.isInstancedMesh===!0&&L.instanceColor!==null,supportsVertexTextures:d,outputEncoding:re!==null?g(re.texture):e.outputEncoding,map:!!b.map,mapEncoding:g(b.map),matcap:!!b.matcap,matcapEncoding:g(b.matcap),envMap:!!I,envMapMode:I&&I.mapping,envMapEncoding:g(I),envMapCubeUV:!!I&&(I.mapping===dl||I.mapping===fc),lightMap:!!b.lightMap,lightMapEncoding:g(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:g(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===ib,tangentSpaceNormalMap:b.normalMapType===Kr,clearcoat:ce,clearcoatMap:ce&&!!b.clearcoatMap,clearcoatRoughnessMap:ce&&!!b.clearcoatRoughnessMap,clearcoatNormalMap:ce&&!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,specularIntensityMap:!!b.specularIntensityMap,specularTintMap:!!b.specularTintMap,specularTintMapEncoding:g(b.specularTintMap),alphaMap:!!b.alphaMap,alphaTest:xe,gradientMap:!!b.gradientMap,sheen:b.sheen>0,transmission:b.transmission>0,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:!!b.normalMap&&!!L.geometry&&!!L.geometry.attributes.tangent,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&!!L.geometry&&!!L.geometry.attributes.color&&L.geometry.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap||!!b.transmissionMap||!!b.thicknessMap||!!b.specularIntensityMap||!!b.specularTintMap,uvsVertexOnly:!(!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatNormalMap||b.transmission>0||!!b.transmissionMap||!!b.thicknessMap||!!b.specularIntensityMap||!!b.specularTintMap)&&!!b.displacementMap,fog:!!j,useFog:b.fog,fogExp2:j&&j.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0&&U>0,maxBones:U,useVertexTexture:u,morphTargets:!!L.geometry&&!!L.geometry.morphAttributes.position,morphNormals:!!L.geometry&&!!L.geometry.morphAttributes.normal,morphTargetsCount:!!L.geometry&&!!L.geometry.morphAttributes.position?L.geometry.morphAttributes.position.length:0,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:b.format,dithering:b.dithering,shadowMapEnabled:e.shadowMap.enabled&&C.length>0,shadowMapType:e.shadowMap.type,toneMapping:b.toneMapped?e.toneMapping:vr,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,doubleSided:b.side===xi,flipSided:b.side===rt,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function _(b){let R=[];if(b.shaderID?R.push(b.shaderID):(R.push(b.fragmentShader),R.push(b.vertexShader)),b.defines!==void 0)for(let C in b.defines)R.push(C),R.push(b.defines[C]);if(b.isRawShaderMaterial===!1){for(let C=0;C<v.length;C++)R.push(b[v[C]]);R.push(e.outputEncoding),R.push(e.gammaFactor)}return R.push(b.customProgramCacheKey),R.join()}function x(b){let R=f[b.type],C;if(R){let D=fi[R];C=Pb.clone(D.uniforms)}else C=b.uniforms;return C}function w(b,R){let C;for(let D=0,L=o.length;D<L;D++){let j=o[D];if(j.cacheKey===R){C=j,++C.usedTimes;break}}return C===void 0&&(C=new IM(e,R,b,n),o.push(C)),C}function S(b){if(--b.usedTimes==0){let R=o.indexOf(b);o[R]=o[o.length-1],o.pop(),b.destroy()}}return{getParameters:m,getProgramCacheKey:_,getUniforms:x,acquireProgram:w,releaseProgram:S,programs:o}}function NM(){let e=new WeakMap;function t(n){let a=e.get(n);return a===void 0&&(a={},e.set(n,a)),a}function i(n){e.delete(n)}function r(n,a,o){e.get(n)[a]=o}function s(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:s}}function OM(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qd(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Yd(e){let t=[],i=0,r=[],s=[],n=[],a={id:-1};function o(){i=0,r.length=0,s.length=0,n.length=0}function l(p,f,v,y,g,m){let _=t[i],x=e.get(v);return _===void 0?(_={id:p.id,object:p,geometry:f,material:v,program:x.program||a,groupOrder:y,renderOrder:p.renderOrder,z:g,group:m},t[i]=_):(_.id=p.id,_.object=p,_.geometry=f,_.material=v,_.program=x.program||a,_.groupOrder=y,_.renderOrder=p.renderOrder,_.z=g,_.group=m),i++,_}function h(p,f,v,y,g,m){let _=l(p,f,v,y,g,m);v.transmission>0?s.push(_):v.transparent===!0?n.push(_):r.push(_)}function u(p,f,v,y,g,m){let _=l(p,f,v,y,g,m);v.transmission>0?s.unshift(_):v.transparent===!0?n.unshift(_):r.unshift(_)}function c(p,f){r.length>1&&r.sort(p||OM),s.length>1&&s.sort(f||qd),n.length>1&&n.sort(f||qd)}function d(){for(let p=i,f=t.length;p<f;p++){let v=t[p];if(v.id===null)break;v.id=null,v.object=null,v.geometry=null,v.material=null,v.program=null,v.group=null}}return{opaque:r,transmissive:s,transparent:n,init:o,push:h,unshift:u,finish:d,sort:c}}function FM(e){let t=new WeakMap;function i(s,n){let a;return t.has(s)===!1?(a=new Yd(e),t.set(s,[a])):n>=t.get(s).length?(a=new Yd(e),t.get(s).push(a)):a=t.get(s)[n],a}function r(){t=new WeakMap}return{get:i,dispose:r}}function UM(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new E,color:new pe};break;case"SpotLight":i={position:new E,direction:new E,color:new pe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new E,color:new pe,distance:0,decay:0};break;case"HemisphereLight":i={direction:new E,skyColor:new pe,groundColor:new pe};break;case"RectAreaLight":i={color:new pe,position:new E,halfWidth:new E,halfHeight:new E};break}return e[t.id]=i,i}}}function kM(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new K};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new K};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new K,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var zM=0;function BM(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function HM(e,t){let i=new UM,r=kM(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)s.probe.push(new E);let n=new E,a=new me,o=new me;function l(u,c){let d=0,p=0,f=0;for(let C=0;C<9;C++)s.probe[C].set(0,0,0);let v=0,y=0,g=0,m=0,_=0,x=0,w=0,S=0;u.sort(BM);let b=c!==!0?Math.PI:1;for(let C=0,D=u.length;C<D;C++){let L=u[C],j=L.color,N=L.intensity,I=L.distance,H=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)d+=j.r*N*b,p+=j.g*N*b,f+=j.b*N*b;else if(L.isLightProbe)for(let U=0;U<9;U++)s.probe[U].addScaledVector(L.sh.coefficients[U],N);else if(L.isDirectionalLight){let U=i.get(L);if(U.color.copy(L.color).multiplyScalar(L.intensity*b),L.castShadow){let O=L.shadow,Z=r.get(L);Z.shadowBias=O.bias,Z.shadowNormalBias=O.normalBias,Z.shadowRadius=O.radius,Z.shadowMapSize=O.mapSize,s.directionalShadow[v]=Z,s.directionalShadowMap[v]=H,s.directionalShadowMatrix[v]=L.shadow.matrix,x++}s.directional[v]=U,v++}else if(L.isSpotLight){let U=i.get(L);if(U.position.setFromMatrixPosition(L.matrixWorld),U.color.copy(j).multiplyScalar(N*b),U.distance=I,U.coneCos=Math.cos(L.angle),U.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),U.decay=L.decay,L.castShadow){let O=L.shadow,Z=r.get(L);Z.shadowBias=O.bias,Z.shadowNormalBias=O.normalBias,Z.shadowRadius=O.radius,Z.shadowMapSize=O.mapSize,s.spotShadow[g]=Z,s.spotShadowMap[g]=H,s.spotShadowMatrix[g]=L.shadow.matrix,S++}s.spot[g]=U,g++}else if(L.isRectAreaLight){let U=i.get(L);U.color.copy(j).multiplyScalar(N),U.halfWidth.set(L.width*.5,0,0),U.halfHeight.set(0,L.height*.5,0),s.rectArea[m]=U,m++}else if(L.isPointLight){let U=i.get(L);if(U.color.copy(L.color).multiplyScalar(L.intensity*b),U.distance=L.distance,U.decay=L.decay,L.castShadow){let O=L.shadow,Z=r.get(L);Z.shadowBias=O.bias,Z.shadowNormalBias=O.normalBias,Z.shadowRadius=O.radius,Z.shadowMapSize=O.mapSize,Z.shadowCameraNear=O.camera.near,Z.shadowCameraFar=O.camera.far,s.pointShadow[y]=Z,s.pointShadowMap[y]=H,s.pointShadowMatrix[y]=L.shadow.matrix,w++}s.point[y]=U,y++}else if(L.isHemisphereLight){let U=i.get(L);U.skyColor.copy(L.color).multiplyScalar(N*b),U.groundColor.copy(L.groundColor).multiplyScalar(N*b),s.hemi[_]=U,_++}}m>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=ne.LTC_FLOAT_1,s.rectAreaLTC2=ne.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=ne.LTC_HALF_1,s.rectAreaLTC2=ne.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=d,s.ambient[1]=p,s.ambient[2]=f;let R=s.hash;(R.directionalLength!==v||R.pointLength!==y||R.spotLength!==g||R.rectAreaLength!==m||R.hemiLength!==_||R.numDirectionalShadows!==x||R.numPointShadows!==w||R.numSpotShadows!==S)&&(s.directional.length=v,s.spot.length=g,s.rectArea.length=m,s.point.length=y,s.hemi.length=_,s.directionalShadow.length=x,s.directionalShadowMap.length=x,s.pointShadow.length=w,s.pointShadowMap.length=w,s.spotShadow.length=S,s.spotShadowMap.length=S,s.directionalShadowMatrix.length=x,s.pointShadowMatrix.length=w,s.spotShadowMatrix.length=S,R.directionalLength=v,R.pointLength=y,R.spotLength=g,R.rectAreaLength=m,R.hemiLength=_,R.numDirectionalShadows=x,R.numPointShadows=w,R.numSpotShadows=S,s.version=zM++)}function h(u,c){let d=0,p=0,f=0,v=0,y=0,g=c.matrixWorldInverse;for(let m=0,_=u.length;m<_;m++){let x=u[m];if(x.isDirectionalLight){let w=s.directional[d];w.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(n),w.direction.transformDirection(g),d++}else if(x.isSpotLight){let w=s.spot[f];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(g),w.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(n),w.direction.transformDirection(g),f++}else if(x.isRectAreaLight){let w=s.rectArea[v];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(g),o.identity(),a.copy(x.matrixWorld),a.premultiply(g),o.extractRotation(a),w.halfWidth.set(x.width*.5,0,0),w.halfHeight.set(0,x.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),v++}else if(x.isPointLight){let w=s.point[p];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(g),p++}else if(x.isHemisphereLight){let w=s.hemi[y];w.direction.setFromMatrixPosition(x.matrixWorld),w.direction.transformDirection(g),w.direction.normalize(),y++}}}return{setup:l,setupView:h,state:s}}function $d(e,t){let i=new HM(e,t),r=[],s=[];function n(){r.length=0,s.length=0}function a(u){r.push(u)}function o(u){s.push(u)}function l(u){i.setup(r,u)}function h(u){i.setupView(r,u)}return{init:n,state:{lightsArray:r,shadowsArray:s,lights:i},setupLights:l,setupLightsView:h,pushLight:a,pushShadow:o}}function GM(e,t){let i=new WeakMap;function r(n,a=0){let o;return i.has(n)===!1?(o=new $d(e,t),i.set(n,[o])):a>=i.get(n).length?(o=new $d(e,t),i.get(n).push(o)):o=i.get(n)[a],o}function s(){i=new WeakMap}return{get:r,dispose:s}}var Kg=class extends lt{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=eb,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};Kg.prototype.isMeshDepthMaterial=!0;var Qg=class extends lt{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new E,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};Qg.prototype.isMeshDistanceMaterial=!0;var VM=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,WM=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
uniform float samples;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ev(e,t,i){let r=new vl,s=new K,n=new K,a=new We,o=new Kg({depthPacking:tb}),l=new Qg,h={},u=i.maxTextureSize,c={0:rt,1:br,2:xi},d=new Zi({uniforms:{shadow_pass:{value:null},resolution:{value:new K},radius:{value:4},samples:{value:8}},vertexShader:VM,fragmentShader:WM}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Ye;f.setAttribute("position",new je(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new _e(f,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=vg,this.render=function(x,w,S){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||x.length===0)return;let b=e.getRenderTarget(),R=e.getActiveCubeFace(),C=e.getActiveMipmapLevel(),D=e.state;D.setBlending(vi),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);for(let L=0,j=x.length;L<j;L++){let N=x[L],I=N.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",N,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;s.copy(I.mapSize);let H=I.getFrameExtents();if(s.multiply(H),n.copy(I.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(n.x=Math.floor(u/H.x),s.x=n.x*H.x,I.mapSize.x=n.x),s.y>u&&(n.y=Math.floor(u/H.y),s.y=n.y*H.y,I.mapSize.y=n.y)),I.map===null&&!I.isPointLightShadow&&this.type===Zn){let O={minFilter:Je,magFilter:Je,format:ot};I.map=new Ot(s.x,s.y,O),I.map.texture.name=N.name+".shadowMap",I.mapPass=new Ot(s.x,s.y,O),I.camera.updateProjectionMatrix()}if(I.map===null){let O={minFilter:st,magFilter:st,format:ot};I.map=new Ot(s.x,s.y,O),I.map.texture.name=N.name+".shadowMap",I.camera.updateProjectionMatrix()}e.setRenderTarget(I.map),e.clear();let U=I.getViewportCount();for(let O=0;O<U;O++){let Z=I.getViewport(O);a.set(n.x*Z.x,n.y*Z.y,n.x*Z.z,n.y*Z.w),D.viewport(a),I.updateMatrices(N,O),r=I.getFrustum(),_(w,S,I.camera,N,this.type)}!I.isPointLightShadow&&this.type===Zn&&g(I,S),I.needsUpdate=!1}y.needsUpdate=!1,e.setRenderTarget(b,R,C)};function g(x,w){let S=t.update(v);d.uniforms.shadow_pass.value=x.map.texture,d.uniforms.resolution.value=x.mapSize,d.uniforms.radius.value=x.radius,d.uniforms.samples.value=x.blurSamples,e.setRenderTarget(x.mapPass),e.clear(),e.renderBufferDirect(w,null,S,d,v,null),p.uniforms.shadow_pass.value=x.mapPass.texture,p.uniforms.resolution.value=x.mapSize,p.uniforms.radius.value=x.radius,p.uniforms.samples.value=x.blurSamples,e.setRenderTarget(x.map),e.clear(),e.renderBufferDirect(w,null,S,p,v,null)}function m(x,w,S,b,R,C,D){let L=null,j=b.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(j!==void 0?L=j:L=b.isPointLight===!0?l:o,e.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0){let N=L.uuid,I=S.uuid,H=h[N];H===void 0&&(H={},h[N]=H);let U=H[I];U===void 0&&(U=L.clone(),H[I]=U),L=U}return L.visible=S.visible,L.wireframe=S.wireframe,D===Zn?L.side=S.shadowSide!==null?S.shadowSide:S.side:L.side=S.shadowSide!==null?S.shadowSide:c[S.side],L.alphaMap=S.alphaMap,L.alphaTest=S.alphaTest,L.clipShadows=S.clipShadows,L.clippingPlanes=S.clippingPlanes,L.clipIntersection=S.clipIntersection,L.displacementMap=S.displacementMap,L.displacementScale=S.displacementScale,L.displacementBias=S.displacementBias,L.wireframeLinewidth=S.wireframeLinewidth,L.linewidth=S.linewidth,b.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(b.matrixWorld),L.nearDistance=R,L.farDistance=C),L}function _(x,w,S,b,R){if(x.visible===!1)return;if(x.layers.test(w.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&R===Zn)&&(!x.frustumCulled||r.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld);let D=t.update(x),L=x.material;if(Array.isArray(L)){let j=D.groups;for(let N=0,I=j.length;N<I;N++){let H=j[N],U=L[H.materialIndex];if(U&&U.visible){let O=m(x,D,U,b,S.near,S.far,R);e.renderBufferDirect(S,null,D,O,x,H)}}}else if(L.visible){let j=m(x,D,L,b,S.near,S.far,R);e.renderBufferDirect(S,null,D,j,x,null)}}let C=x.children;for(let D=0,L=C.length;D<L;D++)_(C[D],w,S,b,R)}}function jM(e,t,i){let r=i.isWebGL2;function s(){let P=!1,ue=new We,Y=null,fe=new We(0,0,0,0);return{setMask:function(ge){Y!==ge&&!P&&(e.colorMask(ge,ge,ge,ge),Y=ge)},setLocked:function(ge){P=ge},setClear:function(ge,Ue,wt,_t,er){er===!0&&(ge*=_t,Ue*=_t,wt*=_t),ue.set(ge,Ue,wt,_t),fe.equals(ue)===!1&&(e.clearColor(ge,Ue,wt,_t),fe.copy(ue))},reset:function(){P=!1,Y=null,fe.set(-1,0,0,0)}}}function n(){let P=!1,ue=null,Y=null,fe=null;return{setTest:function(ge){ge?se(2929):ae(2929)},setMask:function(ge){ue!==ge&&!P&&(e.depthMask(ge),ue=ge)},setFunc:function(ge){if(Y!==ge){if(ge)switch(ge){case qy:e.depthFunc(512);break;case Yy:e.depthFunc(519);break;case $y:e.depthFunc(513);break;case Pu:e.depthFunc(515);break;case Zy:e.depthFunc(514);break;case Jy:e.depthFunc(518);break;case Ky:e.depthFunc(516);break;case Qy:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);Y=ge}},setLocked:function(ge){P=ge},setClear:function(ge){fe!==ge&&(e.clearDepth(ge),fe=ge)},reset:function(){P=!1,ue=null,Y=null,fe=null}}}function a(){let P=!1,ue=null,Y=null,fe=null,ge=null,Ue=null,wt=null,_t=null,er=null;return{setTest:function(nt){P||(nt?se(2960):ae(2960))},setMask:function(nt){ue!==nt&&!P&&(e.stencilMask(nt),ue=nt)},setFunc:function(nt,Ti,Ei){(Y!==nt||fe!==Ti||ge!==Ei)&&(e.stencilFunc(nt,Ti,Ei),Y=nt,fe=Ti,ge=Ei)},setOp:function(nt,Ti,Ei){(Ue!==nt||wt!==Ti||_t!==Ei)&&(e.stencilOp(nt,Ti,Ei),Ue=nt,wt=Ti,_t=Ei)},setLocked:function(nt){P=nt},setClear:function(nt){er!==nt&&(e.clearStencil(nt),er=nt)},reset:function(){P=!1,ue=null,Y=null,fe=null,ge=null,Ue=null,wt=null,_t=null,er=null}}}let o=new s,l=new n,h=new a,u={},c=null,d={},p=null,f=!1,v=null,y=null,g=null,m=null,_=null,x=null,w=null,S=!1,b=null,R=null,C=null,D=null,L=null,j=e.getParameter(35661),N=!1,I=0,H=e.getParameter(7938);H.indexOf("WebGL")!==-1?(I=parseFloat(/^WebGL (\d)/.exec(H)[1]),N=I>=1):H.indexOf("OpenGL ES")!==-1&&(I=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),N=I>=2);let U=null,O={},Z=e.getParameter(3088),re=e.getParameter(2978),xe=new We().fromArray(Z),ce=new We().fromArray(re);function q(P,ue,Y){let fe=new Uint8Array(4),ge=e.createTexture();e.bindTexture(P,ge),e.texParameteri(P,10241,9728),e.texParameteri(P,10240,9728);for(let Ue=0;Ue<Y;Ue++)e.texImage2D(ue+Ue,0,6408,1,1,0,6408,5121,fe);return ge}let Q={};Q[3553]=q(3553,3553,1),Q[34067]=q(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),se(2929),l.setFunc(Pu),le(!1),ee(ad),se(2884),J(vi);function se(P){u[P]!==!0&&(e.enable(P),u[P]=!0)}function ae(P){u[P]!==!1&&(e.disable(P),u[P]=!1)}function z(P){P!==c&&(e.bindFramebuffer(36160,P),c=P)}function Ve(P,ue){return ue===null&&c!==null&&(ue=c),d[P]!==ue?(e.bindFramebuffer(P,ue),d[P]=ue,r&&(P===36009&&(d[36160]=ue),P===36160&&(d[36009]=ue)),!0):!1}function we(P){return p!==P?(e.useProgram(P),p=P,!0):!1}let te={[Os]:32774,[Fy]:32778,[Uy]:32779};if(r)te[ud]=32775,te[cd]=32776;else{let P=t.get("EXT_blend_minmax");P!==null&&(te[ud]=P.MIN_EXT,te[cd]=P.MAX_EXT)}let G={[ky]:0,[zy]:1,[By]:768,[bg]:770,[Xy]:776,[Wy]:774,[Gy]:772,[Hy]:769,[wg]:771,[jy]:775,[Vy]:773};function J(P,ue,Y,fe,ge,Ue,wt,_t){if(P===vi){f===!0&&(ae(3042),f=!1);return}if(f===!1&&(se(3042),f=!0),P!==Oy){if(P!==v||_t!==S){if((y!==Os||_!==Os)&&(e.blendEquation(32774),y=Os,_=Os),_t)switch(P){case ra:e.blendFuncSeparate(1,771,1,771);break;case od:e.blendFunc(1,1);break;case ld:e.blendFuncSeparate(0,0,769,771);break;case hd:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",P);break}else switch(P){case ra:e.blendFuncSeparate(770,771,1,771);break;case od:e.blendFunc(770,1);break;case ld:e.blendFunc(0,769);break;case hd:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",P);break}g=null,m=null,x=null,w=null,v=P,S=_t}return}ge=ge||ue,Ue=Ue||Y,wt=wt||fe,(ue!==y||ge!==_)&&(e.blendEquationSeparate(te[ue],te[ge]),y=ue,_=ge),(Y!==g||fe!==m||Ue!==x||wt!==w)&&(e.blendFuncSeparate(G[Y],G[fe],G[Ue],G[wt]),g=Y,m=fe,x=Ue,w=wt),v=P,S=null}function X(P,ue){P.side===xi?ae(2884):se(2884);let Y=P.side===rt;ue&&(Y=!Y),le(Y),P.blending===ra&&P.transparent===!1?J(vi):J(P.blending,P.blendEquation,P.blendSrc,P.blendDst,P.blendEquationAlpha,P.blendSrcAlpha,P.blendDstAlpha,P.premultipliedAlpha),l.setFunc(P.depthFunc),l.setTest(P.depthTest),l.setMask(P.depthWrite),o.setMask(P.colorWrite);let fe=P.stencilWrite;h.setTest(fe),fe&&(h.setMask(P.stencilWriteMask),h.setFunc(P.stencilFunc,P.stencilRef,P.stencilFuncMask),h.setOp(P.stencilFail,P.stencilZFail,P.stencilZPass)),Se(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits),P.alphaToCoverage===!0?se(32926):ae(32926)}function le(P){b!==P&&(P?e.frontFace(2304):e.frontFace(2305),b=P)}function ee(P){P!==Dy?(se(2884),P!==R&&(P===ad?e.cullFace(1029):P===Ny?e.cullFace(1028):e.cullFace(1032))):ae(2884),R=P}function Re(P){P!==C&&(N&&e.lineWidth(P),C=P)}function Se(P,ue,Y){P?(se(32823),(D!==ue||L!==Y)&&(e.polygonOffset(ue,Y),D=ue,L=Y)):ae(32823)}function A(P){P?se(3089):ae(3089)}function T(P){P===void 0&&(P=33984+j-1),U!==P&&(e.activeTexture(P),U=P)}function V(P,ue){U===null&&T();let Y=O[U];Y===void 0&&(Y={type:void 0,texture:void 0},O[U]=Y),(Y.type!==P||Y.texture!==ue)&&(e.bindTexture(P,ue||Q[P]),Y.type=P,Y.texture=ue)}function he(){let P=O[U];P!==void 0&&P.type!==void 0&&(e.bindTexture(P.type,null),P.type=void 0,P.texture=void 0)}function oe(){try{e.compressedTexImage2D.apply(e,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function de(){try{e.texImage2D.apply(e,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function Me(){try{e.texImage3D.apply(e,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function Te(P){xe.equals(P)===!1&&(e.scissor(P.x,P.y,P.z,P.w),xe.copy(P))}function Ee(P){ce.equals(P)===!1&&(e.viewport(P.x,P.y,P.z,P.w),ce.copy(P))}function ye(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},U=null,O={},c=null,d={},p=null,f=!1,v=null,y=null,g=null,m=null,_=null,x=null,w=null,S=!1,b=null,R=null,C=null,D=null,L=null,xe.set(0,0,e.canvas.width,e.canvas.height),ce.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),h.reset()}return{buffers:{color:o,depth:l,stencil:h},enable:se,disable:ae,bindFramebuffer:Ve,bindXRFramebuffer:z,useProgram:we,setBlending:J,setMaterial:X,setFlipSided:le,setCullFace:ee,setLineWidth:Re,setPolygonOffset:Se,setScissorTest:A,activeTexture:T,bindTexture:V,unbindTexture:he,compressedTexImage2D:oe,texImage2D:de,texImage3D:Me,scissor:Te,viewport:Ee,reset:ye}}function XM(e,t,i,r,s,n,a){let o=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,u=s.maxTextureSize,c=s.maxSamples,d=new WeakMap,p,f=!1;try{f=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(A,T){return f?new OffscreenCanvas(A,T):ml("canvas")}function y(A,T,V,he){let oe=1;if((A.width>he||A.height>he)&&(oe=he/Math.max(A.width,A.height)),oe<1||T===!0)if(typeof HTMLImageElement!="undefined"&&A instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&A instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&A instanceof ImageBitmap){let de=T?Ng:Math.floor,Me=de(oe*A.width),Te=de(oe*A.height);p===void 0&&(p=v(Me,Te));let Ee=V?v(Me,Te):p;return Ee.width=Me,Ee.height=Te,Ee.getContext("2d").drawImage(A,0,0,Me,Te),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+A.width+"x"+A.height+") to ("+Me+"x"+Te+")."),Ee}else return"data"in A&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+A.width+"x"+A.height+")."),A;return A}function g(A){return zu(A.width)&&zu(A.height)}function m(A){return o?!1:A.wrapS!==bt||A.wrapT!==bt||A.minFilter!==st&&A.minFilter!==Je}function _(A,T){return A.generateMipmaps&&T&&A.minFilter!==st&&A.minFilter!==Je}function x(A,T,V,he,oe=1){e.generateMipmap(A);let de=r.get(T);de.__maxMipLevel=Math.log2(Math.max(V,he,oe))}function w(A,T,V,he){if(o===!1)return T;if(A!==null){if(e[A]!==void 0)return e[A];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+A+"'")}let oe=T;return T===6403&&(V===5126&&(oe=33326),V===5131&&(oe=33325),V===5121&&(oe=33321)),T===6407&&(V===5126&&(oe=34837),V===5131&&(oe=34843),V===5121&&(oe=32849)),T===6408&&(V===5126&&(oe=34836),V===5131&&(oe=34842),V===5121&&(oe=he===Bt?35907:32856)),(oe===33325||oe===33326||oe===34842||oe===34836)&&t.get("EXT_color_buffer_float"),oe}function S(A){return A===st||A===qo||A===Yo?9728:9729}function b(A){let T=A.target;T.removeEventListener("dispose",b),C(T),T.isVideoTexture&&d.delete(T),a.memory.textures--}function R(A){let T=A.target;T.removeEventListener("dispose",R),D(T)}function C(A){let T=r.get(A);T.__webglInit!==void 0&&(e.deleteTexture(T.__webglTexture),r.remove(A))}function D(A){let T=A.texture,V=r.get(A),he=r.get(T);if(A){if(he.__webglTexture!==void 0&&(e.deleteTexture(he.__webglTexture),a.memory.textures--),A.depthTexture&&A.depthTexture.dispose(),A.isWebGLCubeRenderTarget)for(let oe=0;oe<6;oe++)e.deleteFramebuffer(V.__webglFramebuffer[oe]),V.__webglDepthbuffer&&e.deleteRenderbuffer(V.__webglDepthbuffer[oe]);else e.deleteFramebuffer(V.__webglFramebuffer),V.__webglDepthbuffer&&e.deleteRenderbuffer(V.__webglDepthbuffer),V.__webglMultisampledFramebuffer&&e.deleteFramebuffer(V.__webglMultisampledFramebuffer),V.__webglColorRenderbuffer&&e.deleteRenderbuffer(V.__webglColorRenderbuffer),V.__webglDepthRenderbuffer&&e.deleteRenderbuffer(V.__webglDepthRenderbuffer);if(A.isWebGLMultipleRenderTargets)for(let oe=0,de=T.length;oe<de;oe++){let Me=r.get(T[oe]);Me.__webglTexture&&(e.deleteTexture(Me.__webglTexture),a.memory.textures--),r.remove(T[oe])}r.remove(T),r.remove(A)}}let L=0;function j(){L=0}function N(){let A=L;return A>=l&&console.warn("THREE.WebGLTextures: Trying to use "+A+" texture units while this GPU supports only "+l),L+=1,A}function I(A,T){let V=r.get(A);if(A.isVideoTexture&&X(A),A.version>0&&V.__version!==A.version){let he=A.image;if(he===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(he.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{q(V,A,T);return}}i.activeTexture(33984+T),i.bindTexture(3553,V.__webglTexture)}function H(A,T){let V=r.get(A);if(A.version>0&&V.__version!==A.version){q(V,A,T);return}i.activeTexture(33984+T),i.bindTexture(35866,V.__webglTexture)}function U(A,T){let V=r.get(A);if(A.version>0&&V.__version!==A.version){q(V,A,T);return}i.activeTexture(33984+T),i.bindTexture(32879,V.__webglTexture)}function O(A,T){let V=r.get(A);if(A.version>0&&V.__version!==A.version){Q(V,A,T);return}i.activeTexture(33984+T),i.bindTexture(34067,V.__webglTexture)}let Z={[$i]:10497,[bt]:33071,[fa]:33648},re={[st]:9728,[qo]:9984,[Yo]:9986,[Je]:9729,[gc]:9985,[Qi]:9987};function xe(A,T,V){if(V?(e.texParameteri(A,10242,Z[T.wrapS]),e.texParameteri(A,10243,Z[T.wrapT]),(A===32879||A===35866)&&e.texParameteri(A,32882,Z[T.wrapR]),e.texParameteri(A,10240,re[T.magFilter]),e.texParameteri(A,10241,re[T.minFilter])):(e.texParameteri(A,10242,33071),e.texParameteri(A,10243,33071),(A===32879||A===35866)&&e.texParameteri(A,32882,33071),(T.wrapS!==bt||T.wrapT!==bt)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(A,10240,S(T.magFilter)),e.texParameteri(A,10241,S(T.minFilter)),T.minFilter!==st&&T.minFilter!==Je&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let he=t.get("EXT_texture_filter_anisotropic");if(T.type===Yt&&t.has("OES_texture_float_linear")===!1||o===!1&&T.type===Zt&&t.has("OES_texture_half_float_linear")===!1)return;(T.anisotropy>1||r.get(T).__currentAnisotropy)&&(e.texParameterf(A,he.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T.anisotropy,s.getMaxAnisotropy())),r.get(T).__currentAnisotropy=T.anisotropy)}}function ce(A,T){A.__webglInit===void 0&&(A.__webglInit=!0,T.addEventListener("dispose",b),A.__webglTexture=e.createTexture(),a.memory.textures++)}function q(A,T,V){let he=3553;T.isDataTexture2DArray&&(he=35866),T.isDataTexture3D&&(he=32879),ce(A,T),i.activeTexture(33984+V),i.bindTexture(he,A.__webglTexture),e.pixelStorei(37440,T.flipY),e.pixelStorei(37441,T.premultiplyAlpha),e.pixelStorei(3317,T.unpackAlignment),e.pixelStorei(37443,0);let oe=m(T)&&g(T.image)===!1,de=y(T.image,oe,!1,u),Me=g(de)||o,Te=n.convert(T.format),Ee=n.convert(T.type),ye=w(T.internalFormat,Te,Ee,T.encoding);xe(he,T,Me);let P,ue=T.mipmaps;if(T.isDepthTexture)ye=6402,o?T.type===Yt?ye=36012:T.type===Oo?ye=33190:T.type===sa?ye=35056:ye=33189:T.type===Yt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),T.format===js&&ye===6402&&T.type!==$o&&T.type!==Oo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),T.type=$o,Ee=n.convert(T.type)),T.format===ga&&ye===6402&&(ye=34041,T.type!==sa&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),T.type=sa,Ee=n.convert(T.type))),i.texImage2D(3553,0,ye,de.width,de.height,0,Te,Ee,null);else if(T.isDataTexture)if(ue.length>0&&Me){for(let Y=0,fe=ue.length;Y<fe;Y++)P=ue[Y],i.texImage2D(3553,Y,ye,P.width,P.height,0,Te,Ee,P.data);T.generateMipmaps=!1,A.__maxMipLevel=ue.length-1}else i.texImage2D(3553,0,ye,de.width,de.height,0,Te,Ee,de.data),A.__maxMipLevel=0;else if(T.isCompressedTexture){for(let Y=0,fe=ue.length;Y<fe;Y++)P=ue[Y],T.format!==ot&&T.format!==ci?Te!==null?i.compressedTexImage2D(3553,Y,ye,P.width,P.height,0,P.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,Y,ye,P.width,P.height,0,Te,Ee,P.data);A.__maxMipLevel=ue.length-1}else if(T.isDataTexture2DArray)i.texImage3D(35866,0,ye,de.width,de.height,de.depth,0,Te,Ee,de.data),A.__maxMipLevel=0;else if(T.isDataTexture3D)i.texImage3D(32879,0,ye,de.width,de.height,de.depth,0,Te,Ee,de.data),A.__maxMipLevel=0;else if(ue.length>0&&Me){for(let Y=0,fe=ue.length;Y<fe;Y++)P=ue[Y],i.texImage2D(3553,Y,ye,Te,Ee,P);T.generateMipmaps=!1,A.__maxMipLevel=ue.length-1}else i.texImage2D(3553,0,ye,Te,Ee,de),A.__maxMipLevel=0;_(T,Me)&&x(he,T,de.width,de.height),A.__version=T.version,T.onUpdate&&T.onUpdate(T)}function Q(A,T,V){if(T.image.length!==6)return;ce(A,T),i.activeTexture(33984+V),i.bindTexture(34067,A.__webglTexture),e.pixelStorei(37440,T.flipY),e.pixelStorei(37441,T.premultiplyAlpha),e.pixelStorei(3317,T.unpackAlignment),e.pixelStorei(37443,0);let he=T&&(T.isCompressedTexture||T.image[0].isCompressedTexture),oe=T.image[0]&&T.image[0].isDataTexture,de=[];for(let Y=0;Y<6;Y++)!he&&!oe?de[Y]=y(T.image[Y],!1,!0,h):de[Y]=oe?T.image[Y].image:T.image[Y];let Me=de[0],Te=g(Me)||o,Ee=n.convert(T.format),ye=n.convert(T.type),P=w(T.internalFormat,Ee,ye,T.encoding);xe(34067,T,Te);let ue;if(he){for(let Y=0;Y<6;Y++){ue=de[Y].mipmaps;for(let fe=0;fe<ue.length;fe++){let ge=ue[fe];T.format!==ot&&T.format!==ci?Ee!==null?i.compressedTexImage2D(34069+Y,fe,P,ge.width,ge.height,0,ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+Y,fe,P,ge.width,ge.height,0,Ee,ye,ge.data)}}A.__maxMipLevel=ue.length-1}else{ue=T.mipmaps;for(let Y=0;Y<6;Y++)if(oe){i.texImage2D(34069+Y,0,P,de[Y].width,de[Y].height,0,Ee,ye,de[Y].data);for(let fe=0;fe<ue.length;fe++){let ge=ue[fe].image[Y].image;i.texImage2D(34069+Y,fe+1,P,ge.width,ge.height,0,Ee,ye,ge.data)}}else{i.texImage2D(34069+Y,0,P,Ee,ye,de[Y]);for(let fe=0;fe<ue.length;fe++){let ge=ue[fe];i.texImage2D(34069+Y,fe+1,P,Ee,ye,ge.image[Y])}}A.__maxMipLevel=ue.length}_(T,Te)&&x(34067,T,Me.width,Me.height),A.__version=T.version,T.onUpdate&&T.onUpdate(T)}function se(A,T,V,he,oe){let de=n.convert(V.format),Me=n.convert(V.type),Te=w(V.internalFormat,de,Me,V.encoding);oe===32879||oe===35866?i.texImage3D(oe,0,Te,T.width,T.height,T.depth,0,de,Me,null):i.texImage2D(oe,0,Te,T.width,T.height,0,de,Me,null),i.bindFramebuffer(36160,A),e.framebufferTexture2D(36160,he,oe,r.get(V).__webglTexture,0),i.bindFramebuffer(36160,null)}function ae(A,T,V){if(e.bindRenderbuffer(36161,A),T.depthBuffer&&!T.stencilBuffer){let he=33189;if(V){let oe=T.depthTexture;oe&&oe.isDepthTexture&&(oe.type===Yt?he=36012:oe.type===Oo&&(he=33190));let de=J(T);e.renderbufferStorageMultisample(36161,de,he,T.width,T.height)}else e.renderbufferStorage(36161,he,T.width,T.height);e.framebufferRenderbuffer(36160,36096,36161,A)}else if(T.depthBuffer&&T.stencilBuffer){if(V){let he=J(T);e.renderbufferStorageMultisample(36161,he,35056,T.width,T.height)}else e.renderbufferStorage(36161,34041,T.width,T.height);e.framebufferRenderbuffer(36160,33306,36161,A)}else{let he=T.isWebGLMultipleRenderTargets===!0?T.texture[0]:T.texture,oe=n.convert(he.format),de=n.convert(he.type),Me=w(he.internalFormat,oe,de,he.encoding);if(V){let Te=J(T);e.renderbufferStorageMultisample(36161,Te,Me,T.width,T.height)}else e.renderbufferStorage(36161,Me,T.width,T.height)}e.bindRenderbuffer(36161,null)}function z(A,T){if(T&&T.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,A),!(T.depthTexture&&T.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(T.depthTexture).__webglTexture||T.depthTexture.image.width!==T.width||T.depthTexture.image.height!==T.height)&&(T.depthTexture.image.width=T.width,T.depthTexture.image.height=T.height,T.depthTexture.needsUpdate=!0),I(T.depthTexture,0);let V=r.get(T.depthTexture).__webglTexture;if(T.depthTexture.format===js)e.framebufferTexture2D(36160,36096,3553,V,0);else if(T.depthTexture.format===ga)e.framebufferTexture2D(36160,33306,3553,V,0);else throw new Error("Unknown depthTexture format")}function Ve(A){let T=r.get(A),V=A.isWebGLCubeRenderTarget===!0;if(A.depthTexture){if(V)throw new Error("target.depthTexture not supported in Cube render targets");z(T.__webglFramebuffer,A)}else if(V){T.__webglDepthbuffer=[];for(let he=0;he<6;he++)i.bindFramebuffer(36160,T.__webglFramebuffer[he]),T.__webglDepthbuffer[he]=e.createRenderbuffer(),ae(T.__webglDepthbuffer[he],A,!1)}else i.bindFramebuffer(36160,T.__webglFramebuffer),T.__webglDepthbuffer=e.createRenderbuffer(),ae(T.__webglDepthbuffer,A,!1);i.bindFramebuffer(36160,null)}function we(A){let T=A.texture,V=r.get(A),he=r.get(T);A.addEventListener("dispose",R),A.isWebGLMultipleRenderTargets!==!0&&(he.__webglTexture=e.createTexture(),he.__version=T.version,a.memory.textures++);let oe=A.isWebGLCubeRenderTarget===!0,de=A.isWebGLMultipleRenderTargets===!0,Me=A.isWebGLMultisampleRenderTarget===!0,Te=T.isDataTexture3D||T.isDataTexture2DArray,Ee=g(A)||o;if(o&&T.format===ci&&(T.type===Yt||T.type===Zt)&&(T.format=ot,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),oe){V.__webglFramebuffer=[];for(let ye=0;ye<6;ye++)V.__webglFramebuffer[ye]=e.createFramebuffer()}else if(V.__webglFramebuffer=e.createFramebuffer(),de)if(s.drawBuffers){let ye=A.texture;for(let P=0,ue=ye.length;P<ue;P++){let Y=r.get(ye[P]);Y.__webglTexture===void 0&&(Y.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Me)if(o){V.__webglMultisampledFramebuffer=e.createFramebuffer(),V.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,V.__webglColorRenderbuffer);let ye=n.convert(T.format),P=n.convert(T.type),ue=w(T.internalFormat,ye,P,T.encoding),Y=J(A);e.renderbufferStorageMultisample(36161,Y,ue,A.width,A.height),i.bindFramebuffer(36160,V.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,V.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),A.depthBuffer&&(V.__webglDepthRenderbuffer=e.createRenderbuffer(),ae(V.__webglDepthRenderbuffer,A,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(oe){i.bindTexture(34067,he.__webglTexture),xe(34067,T,Ee);for(let ye=0;ye<6;ye++)se(V.__webglFramebuffer[ye],A,T,36064,34069+ye);_(T,Ee)&&x(34067,T,A.width,A.height),i.unbindTexture()}else if(de){let ye=A.texture;for(let P=0,ue=ye.length;P<ue;P++){let Y=ye[P],fe=r.get(Y);i.bindTexture(3553,fe.__webglTexture),xe(3553,Y,Ee),se(V.__webglFramebuffer,A,Y,36064+P,3553),_(Y,Ee)&&x(3553,Y,A.width,A.height)}i.unbindTexture()}else{let ye=3553;Te&&(o?ye=T.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),i.bindTexture(ye,he.__webglTexture),xe(ye,T,Ee),se(V.__webglFramebuffer,A,T,36064,ye),_(T,Ee)&&x(ye,T,A.width,A.height,A.depth),i.unbindTexture()}A.depthBuffer&&Ve(A)}function te(A){let T=g(A)||o,V=A.isWebGLMultipleRenderTargets===!0?A.texture:[A.texture];for(let he=0,oe=V.length;he<oe;he++){let de=V[he];if(_(de,T)){let Me=A.isWebGLCubeRenderTarget?34067:3553,Te=r.get(de).__webglTexture;i.bindTexture(Me,Te),x(Me,de,A.width,A.height),i.unbindTexture()}}}function G(A){if(A.isWebGLMultisampleRenderTarget)if(o){let T=A.width,V=A.height,he=16384;A.depthBuffer&&(he|=256),A.stencilBuffer&&(he|=1024);let oe=r.get(A);i.bindFramebuffer(36008,oe.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,oe.__webglFramebuffer),e.blitFramebuffer(0,0,T,V,0,0,T,V,he,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,oe.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function J(A){return o&&A.isWebGLMultisampleRenderTarget?Math.min(c,A.samples):0}function X(A){let T=a.render.frame;d.get(A)!==T&&(d.set(A,T),A.update())}let le=!1,ee=!1;function Re(A,T){A&&A.isWebGLRenderTarget&&(le===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),le=!0),A=A.texture),I(A,T)}function Se(A,T){A&&A.isWebGLCubeRenderTarget&&(ee===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ee=!0),A=A.texture),O(A,T)}this.allocateTextureUnit=N,this.resetTextureUnits=j,this.setTexture2D=I,this.setTexture2DArray=H,this.setTexture3D=U,this.setTextureCube=O,this.setupRenderTarget=we,this.updateRenderTargetMipmap=te,this.updateMultisampleRenderTarget=G,this.safeSetTexture2D=Re,this.safeSetTextureCube=Se}function qM(e,t,i){let r=i.isWebGL2;function s(n){let a;if(n===Jt)return 5121;if(n===hx)return 32819;if(n===ux)return 32820;if(n===cx)return 33635;if(n===ax)return 5120;if(n===ox)return 5122;if(n===$o)return 5123;if(n===lx)return 5124;if(n===Oo)return 5125;if(n===Yt)return 5126;if(n===Zt)return r?5131:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(n===dx)return 6406;if(n===ci)return 6407;if(n===ot)return 6408;if(n===px)return 6409;if(n===mx)return 6410;if(n===js)return 6402;if(n===ga)return 34041;if(n===fx)return 6403;if(n===gx)return 36244;if(n===vx)return 33319;if(n===yx)return 33320;if(n===xx)return 36248;if(n===bx)return 36249;if(n===Du||n===dd||n===pd||n===Nu)if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(n===Du)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===dd)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===pd)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Nu)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Ou||n===md||n===Fu||n===fd)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(n===Ou)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===md)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Fu)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===fd)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===Tg)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if((n===Uu||n===ku)&&(a=t.get("WEBGL_compressed_texture_etc"),a!==null)){if(n===Uu)return a.COMPRESSED_RGB8_ETC2;if(n===ku)return a.COMPRESSED_RGBA8_ETC2_EAC}if(n===Eg||n===wx||n===_x||n===Mx||n===Sx||n===Tx||n===Ex||n===Ax||n===Rx||n===Lx||n===Cx||n===Px||n===Ix||n===Dx||n===Nx||n===Ox||n===Fx||n===Ux||n===kx||n===zx||n===Bx||n===Hx||n===Gx||n===Vx||n===Wx||n===jx||n===Xx||n===qx)return a=t.get("WEBGL_compressed_texture_astc"),a!==null?n:null;if(n===Ag)return a=t.get("EXT_texture_compression_bptc"),a!==null?n:null;if(n===sa)return r?34042:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:s}}var tv=class extends ft{constructor(e=[]){super(),this.cameras=e}};tv.prototype.isArrayCamera=!0;var Wi=class extends Fe{constructor(){super(),this.type="Group"}};Wi.prototype.isGroup=!0;var YM={type:"move"},ch=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Wi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Wi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new E,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new E),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Wi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new E,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new E),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,n=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(r=t.getPose(e.targetRaySpace,i),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(YM))),l&&e.hand){n=!0;for(let f of e.hand.values()){let v=t.getJointPose(f,i);if(l.joints[f.jointName]===void 0){let g=new Wi;g.matrixAutoUpdate=!1,g.visible=!1,l.joints[f.jointName]=g,l.add(g)}let y=l.joints[f.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}let h=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],c=h.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&c>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&c<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1));return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=s!==null),l!==null&&(l.visible=n!==null),this}},$M=class extends Ht{constructor(e,t){super();let i=this,r=e.state,s=null,n=1,a=null,o="local-floor",l=null,h=null,u=null,c=null,d=null,p=!1,f=null,v=null,y=null,g=null,m=null,_=null,x=[],w=new Map,S=new ft;S.layers.enable(1),S.viewport=new We;let b=new ft;b.layers.enable(2),b.viewport=new We;let R=[S,b],C=new tv;C.layers.enable(1),C.layers.enable(2);let D=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(q){let Q=x[q];return Q===void 0&&(Q=new ch,x[q]=Q),Q.getTargetRaySpace()},this.getControllerGrip=function(q){let Q=x[q];return Q===void 0&&(Q=new ch,x[q]=Q),Q.getGripSpace()},this.getHand=function(q){let Q=x[q];return Q===void 0&&(Q=new ch,x[q]=Q),Q.getHandSpace()};function j(q){let Q=w.get(q.inputSource);Q&&Q.dispatchEvent({type:q.type,data:q.inputSource})}function N(){w.forEach(function(q,Q){q.disconnect(Q)}),w.clear(),D=null,L=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),u&&t.deleteFramebuffer(u),f&&t.deleteFramebuffer(f),v&&t.deleteRenderbuffer(v),y&&t.deleteRenderbuffer(y),u=null,f=null,v=null,y=null,d=null,c=null,h=null,s=null,ce.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(q){n=q,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(q){o=q,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return c!==null?c:d},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return s},this.setSession=async function(q){if(s=q,s!==null){s.addEventListener("select",j),s.addEventListener("selectstart",j),s.addEventListener("selectend",j),s.addEventListener("squeeze",j),s.addEventListener("squeezestart",j),s.addEventListener("squeezeend",j),s.addEventListener("end",N),s.addEventListener("inputsourceschange",I);let Q=t.getContextAttributes();if(Q.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0){let se={antialias:Q.antialias,alpha:Q.alpha,depth:Q.depth,stencil:Q.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(s,t,se),s.updateRenderState({baseLayer:d})}else if(t instanceof WebGLRenderingContext){let se={antialias:!0,alpha:Q.alpha,depth:Q.depth,stencil:Q.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(s,t,se),s.updateRenderState({layers:[d]})}else{p=Q.antialias;let se=null;Q.depth&&(_=256,Q.stencil&&(_|=1024),m=Q.stencil?33306:36096,se=Q.stencil?35056:33190);let ae={colorFormat:Q.alpha?32856:32849,depthFormat:se,scaleFactor:n};h=new XRWebGLBinding(s,t),c=h.createProjectionLayer(ae),u=t.createFramebuffer(),s.updateRenderState({layers:[c]}),p&&(f=t.createFramebuffer(),v=t.createRenderbuffer(),t.bindRenderbuffer(36161,v),t.renderbufferStorageMultisample(36161,4,32856,c.textureWidth,c.textureHeight),r.bindFramebuffer(36160,f),t.framebufferRenderbuffer(36160,36064,36161,v),t.bindRenderbuffer(36161,null),se!==null&&(y=t.createRenderbuffer(),t.bindRenderbuffer(36161,y),t.renderbufferStorageMultisample(36161,4,se,c.textureWidth,c.textureHeight),t.framebufferRenderbuffer(36160,m,36161,y),t.bindRenderbuffer(36161,null)),r.bindFramebuffer(36160,null))}a=await s.requestReferenceSpace(o),ce.setContext(s),ce.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function I(q){let Q=s.inputSources;for(let se=0;se<x.length;se++)w.set(Q[se],x[se]);for(let se=0;se<q.removed.length;se++){let ae=q.removed[se],z=w.get(ae);z&&(z.dispatchEvent({type:"disconnected",data:ae}),w.delete(ae))}for(let se=0;se<q.added.length;se++){let ae=q.added[se],z=w.get(ae);z&&z.dispatchEvent({type:"connected",data:ae})}}let H=new E,U=new E;function O(q,Q,se){H.setFromMatrixPosition(Q.matrixWorld),U.setFromMatrixPosition(se.matrixWorld);let ae=H.distanceTo(U),z=Q.projectionMatrix.elements,Ve=se.projectionMatrix.elements,we=z[14]/(z[10]-1),te=z[14]/(z[10]+1),G=(z[9]+1)/z[5],J=(z[9]-1)/z[5],X=(z[8]-1)/z[0],le=(Ve[8]+1)/Ve[0],ee=we*X,Re=we*le,Se=ae/(-X+le),A=Se*-X;Q.matrixWorld.decompose(q.position,q.quaternion,q.scale),q.translateX(A),q.translateZ(Se),q.matrixWorld.compose(q.position,q.quaternion,q.scale),q.matrixWorldInverse.copy(q.matrixWorld).invert();let T=we+Se,V=te+Se,he=ee-A,oe=Re+(ae-A),de=G*te/V*T,Me=J*te/V*T;q.projectionMatrix.makePerspective(he,oe,de,Me,T,V)}function Z(q,Q){Q===null?q.matrixWorld.copy(q.matrix):q.matrixWorld.multiplyMatrices(Q.matrixWorld,q.matrix),q.matrixWorldInverse.copy(q.matrixWorld).invert()}this.updateCamera=function(q){if(s===null)return;C.near=b.near=S.near=q.near,C.far=b.far=S.far=q.far,(D!==C.near||L!==C.far)&&(s.updateRenderState({depthNear:C.near,depthFar:C.far}),D=C.near,L=C.far);let Q=q.parent,se=C.cameras;Z(C,Q);for(let z=0;z<se.length;z++)Z(se[z],Q);C.matrixWorld.decompose(C.position,C.quaternion,C.scale),q.position.copy(C.position),q.quaternion.copy(C.quaternion),q.scale.copy(C.scale),q.matrix.copy(C.matrix),q.matrixWorld.copy(C.matrixWorld);let ae=q.children;for(let z=0,Ve=ae.length;z<Ve;z++)ae[z].updateMatrixWorld(!0);se.length===2?O(C,S,b):C.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return C},this.getFoveation=function(){if(c!==null)return c.fixedFoveation;if(d!==null)return d.fixedFoveation},this.setFoveation=function(q){c!==null&&(c.fixedFoveation=q),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=q)};let re=null;function xe(q,Q){if(l=Q.getViewerPose(a),g=Q,l!==null){let ae=l.views;d!==null&&r.bindXRFramebuffer(d.framebuffer);let z=!1;ae.length!==C.cameras.length&&(C.cameras.length=0,z=!0);for(let Ve=0;Ve<ae.length;Ve++){let we=ae[Ve],te=null;if(d!==null)te=d.getViewport(we);else{let J=h.getViewSubImage(c,we);r.bindXRFramebuffer(u),J.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,m,3553,J.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,J.colorTexture,0),te=J.viewport}let G=R[Ve];G.matrix.fromArray(we.transform.matrix),G.projectionMatrix.fromArray(we.projectionMatrix),G.viewport.set(te.x,te.y,te.width,te.height),Ve===0&&C.matrix.copy(G.matrix),z===!0&&C.cameras.push(G)}p&&(r.bindXRFramebuffer(f),_!==null&&t.clear(_))}let se=s.inputSources;for(let ae=0;ae<x.length;ae++){let z=x[ae],Ve=se[ae];z.update(Ve,Q,a)}if(re&&re(q,Q),p){let ae=c.textureWidth,z=c.textureHeight;r.bindFramebuffer(36008,f),r.bindFramebuffer(36009,u),t.invalidateFramebuffer(36008,[m]),t.invalidateFramebuffer(36009,[m]),t.blitFramebuffer(0,0,ae,z,0,0,ae,z,16384,9728),t.invalidateFramebuffer(36008,[36064]),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),r.bindFramebuffer(36160,f)}g=null}let ce=new Hg;ce.setAnimationLoop(xe),this.setAnimationLoop=function(q){re=q},this.dispose=function(){}}};function ZM(e){function t(g,m){g.fogColor.value.copy(m.color),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function i(g,m,_,x,w){m.isMeshBasicMaterial?r(g,m):m.isMeshLambertMaterial?(r(g,m),l(g,m)):m.isMeshToonMaterial?(r(g,m),u(g,m)):m.isMeshPhongMaterial?(r(g,m),h(g,m)):m.isMeshStandardMaterial?(r(g,m),m.isMeshPhysicalMaterial?d(g,m,w):c(g,m)):m.isMeshMatcapMaterial?(r(g,m),p(g,m)):m.isMeshDepthMaterial?(r(g,m),f(g,m)):m.isMeshDistanceMaterial?(r(g,m),v(g,m)):m.isMeshNormalMaterial?(r(g,m),y(g,m)):m.isLineBasicMaterial?(s(g,m),m.isLineDashedMaterial&&n(g,m)):m.isPointsMaterial?a(g,m,_,x):m.isSpriteMaterial?o(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function r(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.specularMap&&(g.specularMap.value=m.specularMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let _=e.get(m).envMap;if(_){g.envMap.value=_,g.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio;let S=e.get(_).__maxMipLevel;S!==void 0&&(g.maxMipLevel.value=S)}m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity);let x;m.map?x=m.map:m.specularMap?x=m.specularMap:m.displacementMap?x=m.displacementMap:m.normalMap?x=m.normalMap:m.bumpMap?x=m.bumpMap:m.roughnessMap?x=m.roughnessMap:m.metalnessMap?x=m.metalnessMap:m.alphaMap?x=m.alphaMap:m.emissiveMap?x=m.emissiveMap:m.clearcoatMap?x=m.clearcoatMap:m.clearcoatNormalMap?x=m.clearcoatNormalMap:m.clearcoatRoughnessMap?x=m.clearcoatRoughnessMap:m.specularIntensityMap?x=m.specularIntensityMap:m.specularTintMap?x=m.specularTintMap:m.transmissionMap?x=m.transmissionMap:m.thicknessMap&&(x=m.thicknessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uvTransform.value.copy(x.matrix));let w;m.aoMap?w=m.aoMap:m.lightMap&&(w=m.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),g.uv2Transform.value.copy(w.matrix))}function s(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity}function n(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function a(g,m,_,x){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*_,g.scale.value=x*.5,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let w;m.map?w=m.map:m.alphaMap&&(w=m.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),g.uvTransform.value.copy(w.matrix))}function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let _;m.map?_=m.map:m.alphaMap&&(_=m.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),g.uvTransform.value.copy(_.matrix))}function l(g,m){m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap)}function h(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===rt&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===rt&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias)}function u(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===rt&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===rt&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias)}function c(g,m){g.roughness.value=m.roughness,g.metalness.value=m.metalness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===rt&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===rt&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),e.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function d(g,m,_){c(g,m),g.ior.value=m.ior,m.sheen>0&&(g.sheenTint.value.copy(m.sheenTint).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),g.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===rt&&g.clearcoatNormalScale.value.negate())),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=_.texture,g.transmissionSamplerSize.value.set(_.width,_.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap),g.attenuationDistance.value=m.attenuationDistance,g.attenuationTint.value.copy(m.attenuationTint)),g.specularIntensity.value=m.specularIntensity,g.specularTint.value.copy(m.specularTint),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap),m.specularTintMap&&(g.specularTintMap.value=m.specularTintMap)}function p(g,m){m.matcap&&(g.matcap.value=m.matcap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===rt&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===rt&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias)}function f(g,m){m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias)}function v(g,m){m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),g.referencePosition.value.copy(m.referencePosition),g.nearDistance.value=m.nearDistance,g.farDistance.value=m.farDistance}function y(g,m){m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===rt&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===rt&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:i}}function JM(){let e=ml("canvas");return e.style.display="block",e}function Ge(e={}){let t=e.canvas!==void 0?e.canvas:JM(),i=e.context!==void 0?e.context:null,r=e.alpha!==void 0?e.alpha:!1,s=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,a=e.antialias!==void 0?e.antialias:!1,o=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,l=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,h=e.powerPreference!==void 0?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,c=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ke,this.physicallyCorrectLights=!1,this.toneMapping=vr,this.toneMappingExposure=1;let v=this,y=!1,g=0,m=0,_=null,x=-1,w=null,S=new We,b=new We,R=null,C=t.width,D=t.height,L=1,j=null,N=null,I=new We(0,0,C,D),H=new We(0,0,C,D),U=!1,O=[],Z=new vl,re=!1,xe=!1,ce=null,q=new me,Q=new E,se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ae(){return _===null?L:1}let z=i;function Ve(M,F){for(let B=0;B<M.length;B++){let k=M[B],W=t.getContext(k,F);if(W!==null)return W}return null}try{let M={alpha:r,depth:s,stencil:n,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",wt,!1),t.addEventListener("webglcontextrestored",_t,!1),z===null){let F=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&F.shift(),z=Ve(F,M),z===null)throw Ve(F)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}z.getShaderPrecisionFormat===void 0&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(M){throw console.error("THREE.WebGLRenderer: "+M.message),M}let we,te,G,J,X,le,ee,Re,Se,A,T,V,he,oe,de,Me,Te,Ee,ye,P,ue,Y,fe;function ge(){we=new b1(z),te=new d1(z,we,e),we.init(te),Y=new qM(z,we,te),G=new jM(z,we,te),O[0]=1029,J=new M1(z),X=new NM,le=new XM(z,we,G,X,te,Y,J),ee=new m1(v),Re=new x1(v),Se=new Fb(z,te),fe=new u1(z,we,Se,te),A=new w1(z,Se,J,fe),T=new A1(z,A,Se,J),ye=new E1(z,te,le),Me=new p1(X),V=new DM(v,ee,Re,we,te,fe,Me),he=new ZM(X),oe=new FM(X),de=new GM(we,te),Ee=new h1(v,ee,G,T,o),Te=new ev(v,T,te),P=new c1(z,we,J,te),ue=new _1(z,we,J,te),J.programs=V.programs,v.capabilities=te,v.extensions=we,v.properties=X,v.renderLists=oe,v.shadowMap=Te,v.state=G,v.info=J}ge();let Ue=new $M(v,z);this.xr=Ue,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){let M=we.get("WEBGL_lose_context");M&&M.loseContext()},this.forceContextRestore=function(){let M=we.get("WEBGL_lose_context");M&&M.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(M){M!==void 0&&(L=M,this.setSize(C,D,!1))},this.getSize=function(M){return M.set(C,D)},this.setSize=function(M,F,B){if(Ue.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}C=M,D=F,t.width=Math.floor(M*L),t.height=Math.floor(F*L),B!==!1&&(t.style.width=M+"px",t.style.height=F+"px"),this.setViewport(0,0,M,F)},this.getDrawingBufferSize=function(M){return M.set(C*L,D*L).floor()},this.setDrawingBufferSize=function(M,F,B){C=M,D=F,L=B,t.width=Math.floor(M*B),t.height=Math.floor(F*B),this.setViewport(0,0,M,F)},this.getCurrentViewport=function(M){return M.copy(S)},this.getViewport=function(M){return M.copy(I)},this.setViewport=function(M,F,B,k){M.isVector4?I.set(M.x,M.y,M.z,M.w):I.set(M,F,B,k),G.viewport(S.copy(I).multiplyScalar(L).floor())},this.getScissor=function(M){return M.copy(H)},this.setScissor=function(M,F,B,k){M.isVector4?H.set(M.x,M.y,M.z,M.w):H.set(M,F,B,k),G.scissor(b.copy(H).multiplyScalar(L).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(M){G.setScissorTest(U=M)},this.setOpaqueSort=function(M){j=M},this.setTransparentSort=function(M){N=M},this.getClearColor=function(M){return M.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(M,F,B){let k=0;(M===void 0||M)&&(k|=16384),(F===void 0||F)&&(k|=256),(B===void 0||B)&&(k|=1024),z.clear(k)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",wt,!1),t.removeEventListener("webglcontextrestored",_t,!1),oe.dispose(),de.dispose(),X.dispose(),ee.dispose(),Re.dispose(),T.dispose(),fe.dispose(),Ue.dispose(),Ue.removeEventListener("sessionstart",Gc),Ue.removeEventListener("sessionend",Vc),ce&&(ce.dispose(),ce=null),Tr.stop()};function wt(M){M.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function _t(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;let M=J.autoReset,F=Te.enabled,B=Te.autoUpdate,k=Te.needsUpdate,W=Te.type;ge(),J.autoReset=M,Te.enabled=F,Te.autoUpdate=B,Te.needsUpdate=k,Te.type=W}function er(M){let F=M.target;F.removeEventListener("dispose",er),nt(F)}function nt(M){Ti(M),X.remove(M)}function Ti(M){let F=X.get(M).programs;F!==void 0&&F.forEach(function(B){V.releaseProgram(B)})}function Ei(M,F){M.render(function(B){v.renderBufferImmediate(B,F)})}this.renderBufferImmediate=function(M,F){fe.initAttributes();let B=X.get(M);M.hasPositions&&!B.position&&(B.position=z.createBuffer()),M.hasNormals&&!B.normal&&(B.normal=z.createBuffer()),M.hasUvs&&!B.uv&&(B.uv=z.createBuffer()),M.hasColors&&!B.color&&(B.color=z.createBuffer());let k=F.getAttributes();M.hasPositions&&(z.bindBuffer(34962,B.position),z.bufferData(34962,M.positionArray,35048),fe.enableAttribute(k.position.location),z.vertexAttribPointer(k.position.location,3,5126,!1,0,0)),M.hasNormals&&(z.bindBuffer(34962,B.normal),z.bufferData(34962,M.normalArray,35048),fe.enableAttribute(k.normal.location),z.vertexAttribPointer(k.normal.location,3,5126,!1,0,0)),M.hasUvs&&(z.bindBuffer(34962,B.uv),z.bufferData(34962,M.uvArray,35048),fe.enableAttribute(k.uv.location),z.vertexAttribPointer(k.uv.location,2,5126,!1,0,0)),M.hasColors&&(z.bindBuffer(34962,B.color),z.bufferData(34962,M.colorArray,35048),fe.enableAttribute(k.color.location),z.vertexAttribPointer(k.color.location,3,5126,!1,0,0)),fe.disableUnusedAttributes(),z.drawArrays(4,0,M.count),M.count=0},this.renderBufferDirect=function(M,F,B,k,W,be){F===null&&(F=se);let ve=W.isMesh&&W.matrixWorld.determinant()<0,Le=qc(M,F,B,k,W);G.setMaterial(k,ve);let Pe=B.index,$e=B.attributes.position;if(Pe===null){if($e===void 0||$e.count===0)return}else if(Pe.count===0)return;let Ie=1;k.wireframe===!0&&(Pe=A.getWireframeAttribute(B),Ie=2),fe.setup(W,k,Le,B,Pe);let Ne,pt=P;Pe!==null&&(Ne=Se.get(Pe),pt=ue,pt.setIndex(Ne));let Er=Pe!==null?Pe.count:$e.count,ke=B.drawRange.start*Ie,hn=B.drawRange.count*Ie,Gt=be!==null?be.start*Ie:0,Ar=be!==null?be.count*Ie:1/0,Rr=Math.max(ke,Gt),Lr=Math.min(Er,ke+hn,Gt+Ar)-1,tr=Math.max(0,Lr-Rr+1);if(tr!==0){if(W.isMesh)k.wireframe===!0?(G.setLineWidth(k.wireframeLinewidth*ae()),pt.setMode(1)):pt.setMode(4);else if(W.isLine){let it=k.linewidth;it===void 0&&(it=1),G.setLineWidth(it*ae()),W.isLineSegments?pt.setMode(1):W.isLineLoop?pt.setMode(2):pt.setMode(3)}else W.isPoints?pt.setMode(0):W.isSprite&&pt.setMode(4);if(W.isInstancedMesh)pt.renderInstances(Rr,tr,W.count);else if(B.isInstancedBufferGeometry){let it=Math.min(B.instanceCount,B._maxInstanceCount);pt.renderInstances(Rr,tr,it)}else pt.render(Rr,tr)}},this.compile=function(M,F){d=de.get(M),d.init(),f.push(d),M.traverseVisible(function(B){B.isLight&&B.layers.test(F.layers)&&(d.pushLight(B),B.castShadow&&d.pushShadow(B))}),d.setupLights(v.physicallyCorrectLights),M.traverse(function(B){let k=B.material;if(k)if(Array.isArray(k))for(let W=0;W<k.length;W++){let be=k[W];Ll(be,M,B)}else Ll(k,M,B)}),f.pop(),d=null};let Rl=null;function E0(M){Rl&&Rl(M)}function Gc(){Tr.stop()}function Vc(){Tr.start()}let Tr=new Hg;Tr.setAnimationLoop(E0),typeof window!="undefined"&&Tr.setContext(window),this.setAnimationLoop=function(M){Rl=M,Ue.setAnimationLoop(M),M===null?Tr.stop():Tr.start()},Ue.addEventListener("sessionstart",Gc),Ue.addEventListener("sessionend",Vc),this.render=function(M,F){if(F!==void 0&&F.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;M.autoUpdate===!0&&M.updateMatrixWorld(),F.parent===null&&F.updateMatrixWorld(),Ue.enabled===!0&&Ue.isPresenting===!0&&(Ue.cameraAutoUpdate===!0&&Ue.updateCamera(F),F=Ue.getCamera()),M.isScene===!0&&M.onBeforeRender(v,M,F,_),d=de.get(M,f.length),d.init(),f.push(d),q.multiplyMatrices(F.projectionMatrix,F.matrixWorldInverse),Z.setFromProjectionMatrix(q),xe=this.localClippingEnabled,re=Me.init(this.clippingPlanes,xe,F),c=oe.get(M,p.length),c.init(),p.push(c),Wc(M,F,0,v.sortObjects),c.finish(),v.sortObjects===!0&&c.sort(j,N),re===!0&&Me.beginShadows();let B=d.state.shadowsArray;if(Te.render(B,M,F),re===!0&&Me.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ee.render(c,M),d.setupLights(v.physicallyCorrectLights),F.isArrayCamera){let k=F.cameras;for(let W=0,be=k.length;W<be;W++){let ve=k[W];jc(c,M,ve,ve.viewport)}}else jc(c,M,F);_!==null&&(le.updateMultisampleRenderTarget(_),le.updateRenderTargetMipmap(_)),M.isScene===!0&&M.onAfterRender(v,M,F),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),fe.resetDefaultState(),x=-1,w=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,p.pop(),p.length>0?c=p[p.length-1]:c=null};function Wc(M,F,B,k){if(M.visible===!1)return;if(M.layers.test(F.layers)){if(M.isGroup)B=M.renderOrder;else if(M.isLOD)M.autoUpdate===!0&&M.update(F);else if(M.isLight)d.pushLight(M),M.castShadow&&d.pushShadow(M);else if(M.isSprite){if(!M.frustumCulled||Z.intersectsSprite(M)){k&&Q.setFromMatrixPosition(M.matrixWorld).applyMatrix4(q);let be=T.update(M),ve=M.material;ve.visible&&c.push(M,be,ve,B,Q.z,null)}}else if(M.isImmediateRenderObject)k&&Q.setFromMatrixPosition(M.matrixWorld).applyMatrix4(q),c.push(M,null,M.material,B,Q.z,null);else if((M.isMesh||M.isLine||M.isPoints)&&(M.isSkinnedMesh&&M.skeleton.frame!==J.render.frame&&(M.skeleton.update(),M.skeleton.frame=J.render.frame),!M.frustumCulled||Z.intersectsObject(M))){k&&Q.setFromMatrixPosition(M.matrixWorld).applyMatrix4(q);let be=T.update(M),ve=M.material;if(Array.isArray(ve)){let Le=be.groups;for(let Pe=0,$e=Le.length;Pe<$e;Pe++){let Ie=Le[Pe],Ne=ve[Ie.materialIndex];Ne&&Ne.visible&&c.push(M,be,Ne,B,Q.z,Ie)}}else ve.visible&&c.push(M,be,ve,B,Q.z,null)}}let W=M.children;for(let be=0,ve=W.length;be<ve;be++)Wc(W[be],F,B,k)}function jc(M,F,B,k){let W=M.opaque,be=M.transmissive,ve=M.transparent;d.setupLightsView(B),be.length>0&&A0(W,F,B),k&&G.viewport(S.copy(k)),W.length>0&&Da(W,F,B),be.length>0&&Da(be,F,B),ve.length>0&&Da(ve,F,B)}function A0(M,F,B){if(ce===null){let be=a===!0&&te.isWebGL2===!0?Fg:Ot;ce=new be(1024,1024,{generateMipmaps:!0,type:Y.convert(Zt)!==null?Zt:Jt,minFilter:Qi,magFilter:st,wrapS:bt,wrapT:bt})}let k=v.getRenderTarget();v.setRenderTarget(ce),v.clear();let W=v.toneMapping;v.toneMapping=vr,Da(M,F,B),v.toneMapping=W,le.updateMultisampleRenderTarget(ce),le.updateRenderTargetMipmap(ce),v.setRenderTarget(k)}function Da(M,F,B){let k=F.isScene===!0?F.overrideMaterial:null;for(let W=0,be=M.length;W<be;W++){let ve=M[W],Le=ve.object,Pe=ve.geometry,$e=k===null?ve.material:k,Ie=ve.group;Le.layers.test(B.layers)&&R0(Le,F,B,Pe,$e,Ie)}}function R0(M,F,B,k,W,be){if(M.onBeforeRender(v,F,B,k,W,be),M.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,M.matrixWorld),M.normalMatrix.getNormalMatrix(M.modelViewMatrix),W.onBeforeRender(v,F,B,k,M,be),M.isImmediateRenderObject){let ve=qc(B,F,k,W,M);G.setMaterial(W),fe.reset(),Ei(M,ve)}else W.transparent===!0&&W.side===xi?(W.side=rt,W.needsUpdate=!0,v.renderBufferDirect(B,F,k,W,M,be),W.side=br,W.needsUpdate=!0,v.renderBufferDirect(B,F,k,W,M,be),W.side=xi):v.renderBufferDirect(B,F,k,W,M,be);M.onAfterRender(v,F,B,k,W,be)}function Ll(M,F,B){F.isScene!==!0&&(F=se);let k=X.get(M),W=d.state.lights,be=d.state.shadowsArray,ve=W.state.version,Le=V.getParameters(M,W.state,be,F,B),Pe=V.getProgramCacheKey(Le),$e=k.programs;k.environment=M.isMeshStandardMaterial?F.environment:null,k.fog=F.fog,k.envMap=(M.isMeshStandardMaterial?Re:ee).get(M.envMap||k.environment),$e===void 0&&(M.addEventListener("dispose",er),$e=new Map,k.programs=$e);let Ie=$e.get(Pe);if(Ie!==void 0){if(k.currentProgram===Ie&&k.lightsStateVersion===ve)return Xc(M,Le),Ie}else Le.uniforms=V.getUniforms(M),M.onBuild(Le,v),M.onBeforeCompile(Le,v),Ie=V.acquireProgram(Le,Pe),$e.set(Pe,Ie),k.uniforms=Le.uniforms;let Ne=k.uniforms;(!M.isShaderMaterial&&!M.isRawShaderMaterial||M.clipping===!0)&&(Ne.clippingPlanes=Me.uniform),Xc(M,Le),k.needsLights=C0(M),k.lightsStateVersion=ve,k.needsLights&&(Ne.ambientLightColor.value=W.state.ambient,Ne.lightProbe.value=W.state.probe,Ne.directionalLights.value=W.state.directional,Ne.directionalLightShadows.value=W.state.directionalShadow,Ne.spotLights.value=W.state.spot,Ne.spotLightShadows.value=W.state.spotShadow,Ne.rectAreaLights.value=W.state.rectArea,Ne.ltc_1.value=W.state.rectAreaLTC1,Ne.ltc_2.value=W.state.rectAreaLTC2,Ne.pointLights.value=W.state.point,Ne.pointLightShadows.value=W.state.pointShadow,Ne.hemisphereLights.value=W.state.hemi,Ne.directionalShadowMap.value=W.state.directionalShadowMap,Ne.directionalShadowMatrix.value=W.state.directionalShadowMatrix,Ne.spotShadowMap.value=W.state.spotShadowMap,Ne.spotShadowMatrix.value=W.state.spotShadowMatrix,Ne.pointShadowMap.value=W.state.pointShadowMap,Ne.pointShadowMatrix.value=W.state.pointShadowMatrix);let pt=Ie.getUniforms(),Er=xr.seqWithValue(pt.seq,Ne);return k.currentProgram=Ie,k.uniformsList=Er,Ie}function Xc(M,F){let B=X.get(M);B.outputEncoding=F.outputEncoding,B.instancing=F.instancing,B.skinning=F.skinning,B.morphTargets=F.morphTargets,B.morphNormals=F.morphNormals,B.morphTargetsCount=F.morphTargetsCount,B.numClippingPlanes=F.numClippingPlanes,B.numIntersection=F.numClipIntersection,B.vertexAlphas=F.vertexAlphas,B.vertexTangents=F.vertexTangents}function qc(M,F,B,k,W){F.isScene!==!0&&(F=se),le.resetTextureUnits();let be=F.fog,ve=k.isMeshStandardMaterial?F.environment:null,Le=_===null?v.outputEncoding:_.texture.encoding,Pe=(k.isMeshStandardMaterial?Re:ee).get(k.envMap||ve),$e=k.vertexColors===!0&&!!B&&!!B.attributes.color&&B.attributes.color.itemSize===4,Ie=!!k.normalMap&&!!B&&!!B.attributes.tangent,Ne=!!B&&!!B.morphAttributes.position,pt=!!B&&!!B.morphAttributes.normal,Er=!!B&&!!B.morphAttributes.position?B.morphAttributes.position.length:0,ke=X.get(k),hn=d.state.lights;if(re===!0&&(xe===!0||M!==w)){let ti=M===w&&k.id===x;Me.setState(k,M,ti)}let Gt=!1;k.version===ke.__version?(ke.needsLights&&ke.lightsStateVersion!==hn.state.version||ke.outputEncoding!==Le||W.isInstancedMesh&&ke.instancing===!1||!W.isInstancedMesh&&ke.instancing===!0||W.isSkinnedMesh&&ke.skinning===!1||!W.isSkinnedMesh&&ke.skinning===!0||ke.envMap!==Pe||k.fog&&ke.fog!==be||ke.numClippingPlanes!==void 0&&(ke.numClippingPlanes!==Me.numPlanes||ke.numIntersection!==Me.numIntersection)||ke.vertexAlphas!==$e||ke.vertexTangents!==Ie||ke.morphTargets!==Ne||ke.morphNormals!==pt||te.isWebGL2===!0&&ke.morphTargetsCount!==Er)&&(Gt=!0):(Gt=!0,ke.__version=k.version);let Ar=ke.currentProgram;Gt===!0&&(Ar=Ll(k,F,W));let Rr=!1,Lr=!1,tr=!1,it=Ar.getUniforms(),un=ke.uniforms;if(G.useProgram(Ar.program)&&(Rr=!0,Lr=!0,tr=!0),k.id!==x&&(x=k.id,Lr=!0),Rr||w!==M){if(it.setValue(z,"projectionMatrix",M.projectionMatrix),te.logarithmicDepthBuffer&&it.setValue(z,"logDepthBufFC",2/(Math.log(M.far+1)/Math.LN2)),w!==M&&(w=M,Lr=!0,tr=!0),k.isShaderMaterial||k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshStandardMaterial||k.envMap){let ti=it.map.cameraPosition;ti!==void 0&&ti.setValue(z,Q.setFromMatrixPosition(M.matrixWorld))}(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial)&&it.setValue(z,"isOrthographic",M.isOrthographicCamera===!0),(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial||k.isShadowMaterial||W.isSkinnedMesh)&&it.setValue(z,"viewMatrix",M.matrixWorldInverse)}if(W.isSkinnedMesh){it.setOptional(z,W,"bindMatrix"),it.setOptional(z,W,"bindMatrixInverse");let ti=W.skeleton;ti&&(te.floatVertexTextures?(ti.boneTexture===null&&ti.computeBoneTexture(),it.setValue(z,"boneTexture",ti.boneTexture,le),it.setValue(z,"boneTextureSize",ti.boneTextureSize)):it.setOptional(z,ti,"boneMatrices"))}return!!B&&(B.morphAttributes.position!==void 0||B.morphAttributes.normal!==void 0)&&ye.update(W,B,k,Ar),(Lr||ke.receiveShadow!==W.receiveShadow)&&(ke.receiveShadow=W.receiveShadow,it.setValue(z,"receiveShadow",W.receiveShadow)),Lr&&(it.setValue(z,"toneMappingExposure",v.toneMappingExposure),ke.needsLights&&L0(un,tr),be&&k.fog&&he.refreshFogUniforms(un,be),he.refreshMaterialUniforms(un,k,L,D,ce),xr.upload(z,ke.uniformsList,un,le)),k.isShaderMaterial&&k.uniformsNeedUpdate===!0&&(xr.upload(z,ke.uniformsList,un,le),k.uniformsNeedUpdate=!1),k.isSpriteMaterial&&it.setValue(z,"center",W.center),it.setValue(z,"modelViewMatrix",W.modelViewMatrix),it.setValue(z,"normalMatrix",W.normalMatrix),it.setValue(z,"modelMatrix",W.matrixWorld),Ar}function L0(M,F){M.ambientLightColor.needsUpdate=F,M.lightProbe.needsUpdate=F,M.directionalLights.needsUpdate=F,M.directionalLightShadows.needsUpdate=F,M.pointLights.needsUpdate=F,M.pointLightShadows.needsUpdate=F,M.spotLights.needsUpdate=F,M.spotLightShadows.needsUpdate=F,M.rectAreaLights.needsUpdate=F,M.hemisphereLights.needsUpdate=F}function C0(M){return M.isMeshLambertMaterial||M.isMeshToonMaterial||M.isMeshPhongMaterial||M.isMeshStandardMaterial||M.isShadowMaterial||M.isShaderMaterial&&M.lights===!0}this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return _},this.setRenderTarget=function(M,F=0,B=0){_=M,g=F,m=B,M&&X.get(M).__webglFramebuffer===void 0&&le.setupRenderTarget(M);let k=null,W=!1,be=!1;if(M){let ve=M.texture;(ve.isDataTexture3D||ve.isDataTexture2DArray)&&(be=!0);let Le=X.get(M).__webglFramebuffer;M.isWebGLCubeRenderTarget?(k=Le[F],W=!0):M.isWebGLMultisampleRenderTarget?k=X.get(M).__webglMultisampledFramebuffer:k=Le,S.copy(M.viewport),b.copy(M.scissor),R=M.scissorTest}else S.copy(I).multiplyScalar(L).floor(),b.copy(H).multiplyScalar(L).floor(),R=U;if(G.bindFramebuffer(36160,k)&&te.drawBuffers){let ve=!1;if(M)if(M.isWebGLMultipleRenderTargets){let Le=M.texture;if(O.length!==Le.length||O[0]!==36064){for(let Pe=0,$e=Le.length;Pe<$e;Pe++)O[Pe]=36064+Pe;O.length=Le.length,ve=!0}}else(O.length!==1||O[0]!==36064)&&(O[0]=36064,O.length=1,ve=!0);else(O.length!==1||O[0]!==1029)&&(O[0]=1029,O.length=1,ve=!0);ve&&(te.isWebGL2?z.drawBuffers(O):we.get("WEBGL_draw_buffers").drawBuffersWEBGL(O))}if(G.viewport(S),G.scissor(b),G.setScissorTest(R),W){let ve=X.get(M.texture);z.framebufferTexture2D(36160,36064,34069+F,ve.__webglTexture,B)}else if(be){let ve=X.get(M.texture),Le=F||0;z.framebufferTextureLayer(36160,36064,ve.__webglTexture,B||0,Le)}x=-1},this.readRenderTargetPixels=function(M,F,B,k,W,be,ve){if(!(M&&M.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Le=X.get(M).__webglFramebuffer;if(M.isWebGLCubeRenderTarget&&ve!==void 0&&(Le=Le[ve]),Le){G.bindFramebuffer(36160,Le);try{let Pe=M.texture,$e=Pe.format,Ie=Pe.type;if($e!==ot&&Y.convert($e)!==z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ne=Ie===Zt&&(we.has("EXT_color_buffer_half_float")||te.isWebGL2&&we.has("EXT_color_buffer_float"));if(Ie!==Jt&&Y.convert(Ie)!==z.getParameter(35738)&&!(Ie===Yt&&(te.isWebGL2||we.has("OES_texture_float")||we.has("WEBGL_color_buffer_float")))&&!Ne){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z.checkFramebufferStatus(36160)===36053?F>=0&&F<=M.width-k&&B>=0&&B<=M.height-W&&z.readPixels(F,B,k,W,Y.convert($e),Y.convert(Ie),be):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let Pe=_!==null?X.get(_).__webglFramebuffer:null;G.bindFramebuffer(36160,Pe)}}},this.copyFramebufferToTexture=function(M,F,B=0){let k=Math.pow(2,-B),W=Math.floor(F.image.width*k),be=Math.floor(F.image.height*k),ve=Y.convert(F.format);te.isWebGL2&&(ve===6407&&(ve=32849),ve===6408&&(ve=32856)),le.setTexture2D(F,0),z.copyTexImage2D(3553,B,ve,M.x,M.y,W,be,0),G.unbindTexture()},this.copyTextureToTexture=function(M,F,B,k=0){let W=F.image.width,be=F.image.height,ve=Y.convert(B.format),Le=Y.convert(B.type);le.setTexture2D(B,0),z.pixelStorei(37440,B.flipY),z.pixelStorei(37441,B.premultiplyAlpha),z.pixelStorei(3317,B.unpackAlignment),F.isDataTexture?z.texSubImage2D(3553,k,M.x,M.y,W,be,ve,Le,F.image.data):F.isCompressedTexture?z.compressedTexSubImage2D(3553,k,M.x,M.y,F.mipmaps[0].width,F.mipmaps[0].height,ve,F.mipmaps[0].data):z.texSubImage2D(3553,k,M.x,M.y,ve,Le,F.image),k===0&&B.generateMipmaps&&z.generateMipmap(3553),G.unbindTexture()},this.copyTextureToTexture3D=function(M,F,B,k,W=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let be=M.max.x-M.min.x+1,ve=M.max.y-M.min.y+1,Le=M.max.z-M.min.z+1,Pe=Y.convert(k.format),$e=Y.convert(k.type),Ie;if(k.isDataTexture3D)le.setTexture3D(k,0),Ie=32879;else if(k.isDataTexture2DArray)le.setTexture2DArray(k,0),Ie=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}z.pixelStorei(37440,k.flipY),z.pixelStorei(37441,k.premultiplyAlpha),z.pixelStorei(3317,k.unpackAlignment);let Ne=z.getParameter(3314),pt=z.getParameter(32878),Er=z.getParameter(3316),ke=z.getParameter(3315),hn=z.getParameter(32877),Gt=B.isCompressedTexture?B.mipmaps[0]:B.image;z.pixelStorei(3314,Gt.width),z.pixelStorei(32878,Gt.height),z.pixelStorei(3316,M.min.x),z.pixelStorei(3315,M.min.y),z.pixelStorei(32877,M.min.z),B.isDataTexture||B.isDataTexture3D?z.texSubImage3D(Ie,W,F.x,F.y,F.z,be,ve,Le,Pe,$e,Gt.data):B.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),z.compressedTexSubImage3D(Ie,W,F.x,F.y,F.z,be,ve,Le,Pe,Gt.data)):z.texSubImage3D(Ie,W,F.x,F.y,F.z,be,ve,Le,Pe,$e,Gt),z.pixelStorei(3314,Ne),z.pixelStorei(32878,pt),z.pixelStorei(3316,Er),z.pixelStorei(3315,ke),z.pixelStorei(32877,hn),W===0&&k.generateMipmaps&&z.generateMipmap(Ie),G.unbindTexture()},this.initTexture=function(M){le.setTexture2D(M,0),G.unbindTexture()},this.resetState=function(){g=0,m=0,_=null,G.reset(),fe.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var KM=class extends Ge{};KM.prototype.isWebGL1Renderer=!0;var bi=class extends Fe{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};bi.prototype.isScene=!0;var rn=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=va,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Kt()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Kt()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Kt()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};rn.prototype.isInterleavedBuffer=!0;var at=new E,ba=class{constructor(e,t,i,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)at.x=this.getX(t),at.y=this.getY(t),at.z=this.getZ(t),at.applyMatrix4(e),this.setXYZ(t,at.x,at.y,at.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)at.x=this.getX(t),at.y=this.getY(t),at.z=this.getZ(t),at.applyNormalMatrix(e),this.setXYZ(t,at.x,at.y,at.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)at.x=this.getX(t),at.y=this.getY(t),at.z=this.getZ(t),at.transformDirection(e),this.setXYZ(t,at.x,at.y,at.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new je(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ba(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};ba.prototype.isInterleavedBufferAttribute=!0;var iv=class extends lt{constructor(e){super(),this.type="SpriteMaterial",this.color=new pe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};iv.prototype.isSpriteMaterial=!0;var bs,gn=new E,ws=new E,_s=new E,Ms=new K,vn=new K,rv=new me,to=new E,yn=new E,io=new E,Zd=new K,dh=new K,Jd=new K,QM=class extends Fe{constructor(e){if(super(),this.type="Sprite",bs===void 0){bs=new Ye;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new rn(t,5);bs.setIndex([0,1,2,0,2,3]),bs.setAttribute("position",new ba(i,3,0,!1)),bs.setAttribute("uv",new ba(i,2,3,!1))}this.geometry=bs,this.material=e!==void 0?e:new iv,this.center=new K(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ws.setFromMatrixScale(this.matrixWorld),rv.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_s.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ws.multiplyScalar(-_s.z);let i=this.material.rotation,r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));let n=this.center;ro(to.set(-.5,-.5,0),_s,n,ws,r,s),ro(yn.set(.5,-.5,0),_s,n,ws,r,s),ro(io.set(.5,.5,0),_s,n,ws,r,s),Zd.set(0,0),dh.set(1,0),Jd.set(1,1);let a=e.ray.intersectTriangle(to,yn,io,!1,gn);if(a===null&&(ro(yn.set(-.5,.5,0),_s,n,ws,r,s),dh.set(0,1),a=e.ray.intersectTriangle(to,io,yn,!1,gn),a===null))return;let o=e.ray.origin.distanceTo(gn);o<e.near||o>e.far||t.push({distance:o,point:gn.clone(),uv:ut.getUV(gn,to,yn,io,Zd,dh,Jd,new K),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};QM.prototype.isSprite=!0;function ro(e,t,i,r,s,n){Ms.subVectors(e,i).addScalar(.5).multiply(r),s!==void 0?(vn.x=n*Ms.x-s*Ms.y,vn.y=s*Ms.x+n*Ms.y):vn.copy(Ms),e.copy(t),e.x+=vn.x,e.y+=vn.y,e.applyMatrix4(rv)}var Kd=new E,Qd=new We,ep=new We,eS=new E,tp=new me,Mc=class extends _e{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new me,this.bindMatrixInverse=new me}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new We,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);let s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let i=this.skeleton,r=this.geometry;Qd.fromBufferAttribute(r.attributes.skinIndex,e),ep.fromBufferAttribute(r.attributes.skinWeight,e),Kd.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){let n=ep.getComponent(s);if(n!==0){let a=Qd.getComponent(s);tp.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(eS.copy(Kd).applyMatrix4(tp),n)}}return t.applyMatrix4(this.bindMatrixInverse)}};Mc.prototype.isSkinnedMesh=!0;var Sc=class extends Fe{constructor(){super(),this.type="Bone"}};Sc.prototype.isBone=!0;var Tc=class extends ht{constructor(e=null,t=1,i=1,r,s,n,a,o,l=st,h=st,u,c){super(null,n,a,o,l,h,r,s,u,c),this.image={data:e,width:t,height:i},this.magFilter=l,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};Tc.prototype.isDataTexture=!0;var ip=new me,tS=new me,sv=class{constructor(e=[],t=[]){this.uuid=Kt(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new me)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new me;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,n=e.length;s<n;s++){let a=e[s]?e[s].matrixWorld:tS;ip.multiplyMatrices(a,t[s]),ip.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new sv(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Dg(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new Tc(t,e,e,ot,Yt);return this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let s=e.bones[i],n=t[s];n===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),n=new Sc),this.bones.push(n),this.boneInverses.push(new me().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){let n=t[r];e.bones.push(n.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},Hu=class extends je{constructor(e,t,i,r=1){typeof i=="number"&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};Hu.prototype.isInstancedBufferAttribute=!0;var rp=new me,sp=new me,so=[],xn=new _e,iS=class extends _e{constructor(e,t,i){super(e,t),this.instanceMatrix=new Hu(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(xn.geometry=this.geometry,xn.material=this.material,xn.material!==void 0)for(let s=0;s<r;s++){this.getMatrixAt(s,rp),sp.multiplyMatrices(i,rp),xn.matrixWorld=sp,xn.raycast(e,so);for(let n=0,a=so.length;n<a;n++){let o=so[n];o.instanceId=s,o.object=this,t.push(o)}so.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Hu(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};iS.prototype.isInstancedMesh=!0;var sn=class extends lt{constructor(e){super(),this.type="LineBasicMaterial",this.color=new pe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}};sn.prototype.isLineBasicMaterial=!0;var np=new E,ap=new E,op=new me,ph=new Qr,no=new Sr,yl=class extends Fe{constructor(e=new Ye,t=new sn){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)np.fromBufferAttribute(t,r-1),ap.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=np.distanceTo(ap);e.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,n=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),no.copy(i.boundingSphere),no.applyMatrix4(r),no.radius+=s,e.ray.intersectsSphere(no)===!1)return;op.copy(r).invert(),ph.copy(e.ray).applyMatrix4(op);let a=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new E,h=new E,u=new E,c=new E,d=this.isLineSegments?2:1;if(i.isBufferGeometry){let p=i.index,f=i.attributes.position;if(p!==null){let v=Math.max(0,n.start),y=Math.min(p.count,n.start+n.count);for(let g=v,m=y-1;g<m;g+=d){let _=p.getX(g),x=p.getX(g+1);if(l.fromBufferAttribute(f,_),h.fromBufferAttribute(f,x),ph.distanceSqToSegment(l,h,c,u)>o)continue;c.applyMatrix4(this.matrixWorld);let w=e.ray.origin.distanceTo(c);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else{let v=Math.max(0,n.start),y=Math.min(f.count,n.start+n.count);for(let g=v,m=y-1;g<m;g+=d){if(l.fromBufferAttribute(f,g),h.fromBufferAttribute(f,g+1),ph.distanceSqToSegment(l,h,c,u)>o)continue;c.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(c);_<e.near||_>e.far||t.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,n=r.length;s<n;s++){let a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};yl.prototype.isLine=!0;var lp=new E,hp=new E,xl=class extends yl{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)lp.fromBufferAttribute(t,r),hp.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+lp.distanceTo(hp);e.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};xl.prototype.isLineSegments=!0;var nv=class extends yl{constructor(e,t){super(e,t),this.type="LineLoop"}};nv.prototype.isLineLoop=!0;var Ec=class extends lt{constructor(e){super(),this.type="PointsMaterial",this.color=new pe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}};Ec.prototype.isPointsMaterial=!0;var up=new me,Gu=new Qr,ao=new Sr,oo=new E,av=class extends Fe{constructor(e=new Ye,t=new Ec){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,n=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),ao.copy(i.boundingSphere),ao.applyMatrix4(r),ao.radius+=s,e.ray.intersectsSphere(ao)===!1)return;up.copy(r).invert(),Gu.copy(e.ray).applyMatrix4(up);let a=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){let l=i.index,h=i.attributes.position;if(l!==null){let u=Math.max(0,n.start),c=Math.min(l.count,n.start+n.count);for(let d=u,p=c;d<p;d++){let f=l.getX(d);oo.fromBufferAttribute(h,f),cp(oo,f,o,r,e,t,this)}}else{let u=Math.max(0,n.start),c=Math.min(h.count,n.start+n.count);for(let d=u,p=c;d<p;d++)oo.fromBufferAttribute(h,d),cp(oo,d,o,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,n=r.length;s<n;s++){let a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};av.prototype.isPoints=!0;function cp(e,t,i,r,s,n,a){let o=Gu.distanceSqToPoint(e);if(o<i){let l=new E;Gu.closestPointToPoint(e,l),l.applyMatrix4(r);let h=s.ray.origin.distanceTo(l);if(h<s.near||h>s.far)return;n.push({distance:h,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}var rS=class extends ht{constructor(e,t,i,r,s,n,a,o,l){super(e,t,i,r,s,n,a,o,l),this.format=a!==void 0?a:ci,this.minFilter=n!==void 0?n:Je,this.magFilter=s!==void 0?s:Je,this.generateMipmaps=!1;let h=this;function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};rS.prototype.isVideoTexture=!0;var Vu=class extends ht{constructor(e,t,i,r,s,n,a,o,l,h,u,c){super(null,n,a,o,l,h,r,s,u,c),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};Vu.prototype.isCompressedTexture=!0;var sS=class extends ht{constructor(e,t,i,r,s,n,a,o,l){super(e,t,i,r,s,n,a,o,l),this.needsUpdate=!0}};sS.prototype.isCanvasTexture=!0;var nS=class extends ht{constructor(e,t,i,r,s,n,a,o,l,h){if(h=h!==void 0?h:js,h!==js&&h!==ga)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===js&&(i=$o),i===void 0&&h===ga&&(i=sa),super(null,r,s,n,a,o,h,i,l),this.image={width:e,height:t},this.magFilter=a!==void 0?a:st,this.minFilter=o!==void 0?o:st,this.flipY=!1,this.generateMipmaps=!1}};nS.prototype.isDepthTexture=!0;new E;new E;new E;new ut;var Qt=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),s=0;t.push(0);for(let n=1;n<=e;n++)i=this.getPoint(n/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,s=i.length,n;t?n=t:n=e*i[s-1];let a=0,o=s-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-n,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===n)return r/(s-1);let h=i[r],u=i[r+1]-h,c=(n-h)/u;return(r+c)/(s-1)}getTangent(e,t){let i=1e-4,r=e-i,s=e+i;r<0&&(r=0),s>1&&(s=1);let n=this.getPoint(r),a=this.getPoint(s),o=t||(n.isVector2?new K:new E);return o.copy(a).sub(n).normalize(),o}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new E,r=[],s=[],n=[],a=new E,o=new me;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new E)}s[0]=new E,n[0]=new E;let l=Number.MAX_VALUE,h=Math.abs(r[0].x),u=Math.abs(r[0].y),c=Math.abs(r[0].z);h<=l&&(l=h,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),c<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),n[0].crossVectors(r[0],s[0]);for(let d=1;d<=e;d++){if(s[d]=s[d-1].clone(),n[d]=n[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(At(r[d-1].dot(r[d]),-1,1));s[d].applyMatrix4(o.makeRotationAxis(a,p))}n[d].crossVectors(r[d],s[d])}if(t===!0){let d=Math.acos(At(s[0].dot(s[e]),-1,1));d/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(d=-d);for(let p=1;p<=e;p++)s[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),n[p].crossVectors(r[p],s[p])}return{tangents:r,normals:s,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},bl=class extends Qt{constructor(e=0,t=0,i=1,r=1,s=0,n=Math.PI*2,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=n,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new K,r=Math.PI*2,s=this.aEndAngle-this.aStartAngle,n=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(n?s=0:s=r),this.aClockwise===!0&&!n&&(s===r?s=-r:s=s-r);let a=this.aStartAngle+e*s,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),c=o-this.aX,d=l-this.aY;o=c*h-d*u+this.aX,l=c*u+d*h+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};bl.prototype.isEllipseCurve=!0;var ov=class extends bl{constructor(e,t,i,r,s,n){super(e,t,i,i,r,s,n),this.type="ArcCurve"}};ov.prototype.isArcCurve=!0;function Ac(){let e=0,t=0,i=0,r=0;function s(n,a,o,l){e=n,t=o,i=-3*n+3*a-2*o-l,r=2*n-2*a+o+l}return{initCatmullRom:function(n,a,o,l,h){s(a,o,h*(o-n),h*(l-a))},initNonuniformCatmullRom:function(n,a,o,l,h,u,c){let d=(a-n)/h-(o-n)/(h+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+c)+(l-o)/c;d*=u,p*=u,s(a,o,d,p)},calc:function(n){let a=n*n,o=a*n;return e+t*n+i*a+r*o}}}var lo=new E,mh=new Ac,fh=new Ac,gh=new Ac,lv=class extends Qt{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new E){let i=t,r=this.points,s=r.length,n=(s-(this.closed?0:1))*e,a=Math.floor(n),o=n-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:o===0&&a===s-1&&(a=s-2,o=1);let l,h;this.closed||a>0?l=r[(a-1)%s]:(lo.subVectors(r[0],r[1]).add(r[0]),l=lo);let u=r[a%s],c=r[(a+1)%s];if(this.closed||a+2<s?h=r[(a+2)%s]:(lo.subVectors(r[s-1],r[s-2]).add(r[s-1]),h=lo),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(c),d),v=Math.pow(c.distanceToSquared(h),d);f<1e-4&&(f=1),p<1e-4&&(p=f),v<1e-4&&(v=f),mh.initNonuniformCatmullRom(l.x,u.x,c.x,h.x,p,f,v),fh.initNonuniformCatmullRom(l.y,u.y,c.y,h.y,p,f,v),gh.initNonuniformCatmullRom(l.z,u.z,c.z,h.z,p,f,v)}else this.curveType==="catmullrom"&&(mh.initCatmullRom(l.x,u.x,c.x,h.x,this.tension),fh.initCatmullRom(l.y,u.y,c.y,h.y,this.tension),gh.initCatmullRom(l.z,u.z,c.z,h.z,this.tension));return i.set(mh.calc(o),fh.calc(o),gh.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new E().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};lv.prototype.isCatmullRomCurve3=!0;function dp(e,t,i,r,s){let n=(r-t)*.5,a=(s-i)*.5,o=e*e,l=e*o;return(2*i-2*r+n+a)*l+(-3*i+3*r-2*n-a)*o+n*e+i}function aS(e,t){let i=1-e;return i*i*t}function oS(e,t){return 2*(1-e)*e*t}function lS(e,t){return e*e*t}function oa(e,t,i,r){return aS(e,t)+oS(e,i)+lS(e,r)}function hS(e,t){let i=1-e;return i*i*i*t}function uS(e,t){let i=1-e;return 3*i*i*e*t}function cS(e,t){return 3*(1-e)*e*e*t}function dS(e,t){return e*e*e*t}function la(e,t,i,r,s){return hS(e,t)+uS(e,i)+cS(e,r)+dS(e,s)}var Rc=class extends Qt{constructor(e=new K,t=new K,i=new K,r=new K){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new K){let i=t,r=this.v0,s=this.v1,n=this.v2,a=this.v3;return i.set(la(e,r.x,s.x,n.x,a.x),la(e,r.y,s.y,n.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};Rc.prototype.isCubicBezierCurve=!0;var hv=class extends Qt{constructor(e=new E,t=new E,i=new E,r=new E){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new E){let i=t,r=this.v0,s=this.v1,n=this.v2,a=this.v3;return i.set(la(e,r.x,s.x,n.x,a.x),la(e,r.y,s.y,n.y,a.y),la(e,r.z,s.z,n.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};hv.prototype.isCubicBezierCurve3=!0;var wl=class extends Qt{constructor(e=new K,t=new K){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new K){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new K;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};wl.prototype.isLineCurve=!0;var pS=class extends Qt{constructor(e=new E,t=new E){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new E){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Lc=class extends Qt{constructor(e=new K,t=new K,i=new K){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new K){let i=t,r=this.v0,s=this.v1,n=this.v2;return i.set(oa(e,r.x,s.x,n.x),oa(e,r.y,s.y,n.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Lc.prototype.isQuadraticBezierCurve=!0;var uv=class extends Qt{constructor(e=new E,t=new E,i=new E){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new E){let i=t,r=this.v0,s=this.v1,n=this.v2;return i.set(oa(e,r.x,s.x,n.x),oa(e,r.y,s.y,n.y),oa(e,r.z,s.z,n.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};uv.prototype.isQuadraticBezierCurve3=!0;var Cc=class extends Qt{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new K){let i=t,r=this.points,s=(r.length-1)*e,n=Math.floor(s),a=s-n,o=r[n===0?n:n-1],l=r[n],h=r[n>r.length-2?r.length-1:n+1],u=r[n>r.length-3?r.length-1:n+2];return i.set(dp(a,o.x,l.x,h.x,u.x),dp(a,o.y,l.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new K().fromArray(r))}return this}};Cc.prototype.isSplineCurve=!0;var cv=Object.freeze({__proto__:null,ArcCurve:ov,CatmullRomCurve3:lv,CubicBezierCurve:Rc,CubicBezierCurve3:hv,EllipseCurve:bl,LineCurve:wl,LineCurve3:pS,QuadraticBezierCurve:Lc,QuadraticBezierCurve3:uv,SplineCurve:Cc}),mS=class extends Qt{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new wl(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=i){let n=r[s]-i,a=this.curves[s],o=a.getLength(),l=o===0?0:1-n/o;return a.getPointAt(l,t)}s++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,s=this.curves;r<s.length;r++){let n=s[r],a=n&&n.isEllipseCurve?e*2:n&&(n.isLineCurve||n.isLineCurve3)?1:n&&n.isSplineCurve?e*n.points.length:e,o=n.getPoints(a);for(let l=0;l<o.length;l++){let h=o[l];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new cv[r.type]().fromJSON(r))}return this}},Wu=class extends mS{constructor(e){super(),this.type="Path",this.currentPoint=new K,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new wl(this.currentPoint.clone(),new K(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let s=new Lc(this.currentPoint.clone(),new K(e,t),new K(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,n){let a=new Rc(this.currentPoint.clone(),new K(e,t),new K(i,r),new K(s,n));return this.curves.push(a),this.currentPoint.set(s,n),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new Cc(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,n){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,s,n),this}absarc(e,t,i,r,s,n){return this.absellipse(e,t,i,i,r,s,n),this}ellipse(e,t,i,r,s,n,a,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,i,r,s,n,a,o),this}absellipse(e,t,i,r,s,n,a,o){let l=new bl(e,t,i,r,s,n,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Ca=class extends Wu{constructor(e){super(e),this.uuid=Kt(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new Wu().fromJSON(r))}return this}},fS={triangulate:function(e,t,i=2){let r=t&&t.length,s=r?t[0]*i:e.length,n=dv(e,0,s,i,!0),a=[];if(!n||n.next===n.prev)return a;let o,l,h,u,c,d,p;if(r&&(n=bS(e,t,n,i)),e.length>80*i){o=h=e[0],l=u=e[1];for(let f=i;f<s;f+=i)c=e[f],d=e[f+1],c<o&&(o=c),d<l&&(l=d),c>h&&(h=c),d>u&&(u=d);p=Math.max(h-o,u-l),p=p!==0?1/p:0}return wa(n,a,i,o,l,p),a}};function dv(e,t,i,r,s){let n,a;if(s===PS(e,t,i,r)>0)for(n=t;n<i;n+=r)a=pp(n,e[n],e[n+1],a);else for(n=i-r;n>=t;n-=r)a=pp(n,e[n],e[n+1],a);return a&&_l(a,a.next)&&(Ma(a),a=a.next),a}function _r(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(_l(i,i.next)||tt(i.prev,i,i.next)===0)){if(Ma(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function wa(e,t,i,r,s,n,a){if(!e)return;!a&&n&&TS(e,r,s,n);let o=e,l,h;for(;e.prev!==e.next;){if(l=e.prev,h=e.next,n?vS(e,r,s,n):gS(e)){t.push(l.i/i),t.push(e.i/i),t.push(h.i/i),Ma(e),e=h.next,o=h.next;continue}if(e=h,e===o){a?a===1?(e=yS(_r(e),t,i),wa(e,t,i,r,s,n,2)):a===2&&xS(e,t,i,r,s,n):wa(_r(e),t,i,r,s,n,1);break}}}function gS(e){let t=e.prev,i=e,r=e.next;if(tt(t,i,r)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(Vs(t.x,t.y,i.x,i.y,r.x,r.y,s.x,s.y)&&tt(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function vS(e,t,i,r){let s=e.prev,n=e,a=e.next;if(tt(s,n,a)>=0)return!1;let o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,h=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,u=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,c=ju(o,l,t,i,r),d=ju(h,u,t,i,r),p=e.prevZ,f=e.nextZ;for(;p&&p.z>=c&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Vs(s.x,s.y,n.x,n.y,a.x,a.y,p.x,p.y)&&tt(p.prev,p,p.next)>=0||(p=p.prevZ,f!==e.prev&&f!==e.next&&Vs(s.x,s.y,n.x,n.y,a.x,a.y,f.x,f.y)&&tt(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&Vs(s.x,s.y,n.x,n.y,a.x,a.y,p.x,p.y)&&tt(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Vs(s.x,s.y,n.x,n.y,a.x,a.y,f.x,f.y)&&tt(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function yS(e,t,i){let r=e;do{let s=r.prev,n=r.next.next;!_l(s,n)&&pv(s,r,r.next,n)&&_a(s,n)&&_a(n,s)&&(t.push(s.i/i),t.push(r.i/i),t.push(n.i/i),Ma(r),Ma(r.next),r=e=n),r=r.next}while(r!==e);return _r(r)}function xS(e,t,i,r,s,n){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&RS(a,o)){let l=mv(a,o);a=_r(a,a.next),l=_r(l,l.next),wa(a,t,i,r,s,n),wa(l,t,i,r,s,n);return}o=o.next}a=a.next}while(a!==e)}function bS(e,t,i,r){let s=[],n,a,o,l,h;for(n=0,a=t.length;n<a;n++)o=t[n]*r,l=n<a-1?t[n+1]*r:e.length,h=dv(e,o,l,r,!1),h===h.next&&(h.steiner=!0),s.push(AS(h));for(s.sort(wS),n=0;n<s.length;n++)_S(s[n],i),i=_r(i,i.next);return i}function wS(e,t){return e.x-t.x}function _S(e,t){if(t=MS(e,t),t){let i=mv(t,e);_r(t,t.next),_r(i,i.next)}}function MS(e,t){let i=t,r=e.x,s=e.y,n=-1/0,a;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){let d=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=r&&d>n){if(n=d,d===r){if(s===i.y)return i;if(s===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!a)return null;if(r===n)return a;let o=a,l=a.x,h=a.y,u=1/0,c;i=a;do r>=i.x&&i.x>=l&&r!==i.x&&Vs(s<h?r:n,s,l,h,s<h?n:r,s,i.x,i.y)&&(c=Math.abs(s-i.y)/(r-i.x),_a(i,e)&&(c<u||c===u&&(i.x>a.x||i.x===a.x&&SS(a,i)))&&(a=i,u=c)),i=i.next;while(i!==o);return a}function SS(e,t){return tt(e.prev,e,t.prev)<0&&tt(t.next,e,e.next)<0}function TS(e,t,i,r){let s=e;do s.z===null&&(s.z=ju(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,ES(s)}function ES(e){let t,i,r,s,n,a,o,l,h=1;do{for(i=e,e=null,n=null,a=0;i;){for(a++,r=i,o=0,t=0;t<h&&(o++,r=r.nextZ,!!r);t++);for(l=h;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,h*=2}while(a>1);return e}function ju(e,t,i,r,s){return e=32767*(e-i)*s,t=32767*(t-r)*s,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function AS(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Vs(e,t,i,r,s,n,a,o){return(s-a)*(t-o)-(e-a)*(n-o)>=0&&(e-a)*(r-o)-(i-a)*(t-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0}function RS(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!LS(e,t)&&(_a(e,t)&&_a(t,e)&&CS(e,t)&&(tt(e.prev,e,t.prev)||tt(e,t.prev,t))||_l(e,t)&&tt(e.prev,e,e.next)>0&&tt(t.prev,t,t.next)>0)}function tt(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _l(e,t){return e.x===t.x&&e.y===t.y}function pv(e,t,i,r){let s=uo(tt(e,t,i)),n=uo(tt(e,t,r)),a=uo(tt(i,r,e)),o=uo(tt(i,r,t));return!!(s!==n&&a!==o||s===0&&ho(e,i,t)||n===0&&ho(e,r,t)||a===0&&ho(i,e,r)||o===0&&ho(i,t,r))}function ho(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function uo(e){return e>0?1:e<0?-1:0}function LS(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&pv(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function _a(e,t){return tt(e.prev,e,e.next)<0?tt(e,t,e.next)>=0&&tt(e,e.prev,t)>=0:tt(e,t,e.prev)<0||tt(e,e.next,t)<0}function CS(e,t){let i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function mv(e,t){let i=new Xu(e.i,e.x,e.y),r=new Xu(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function pp(e,t,i,r){let s=new Xu(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Ma(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Xu(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function PS(e,t,i,r){let s=0;for(let n=t,a=i-r;n<i;n+=r)s+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return s}var Vr=class{static area(e){let t=e.length,i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return Vr.area(e)<0}static triangulateShape(e,t){let i=[],r=[],s=[];mp(e),fp(i,e);let n=e.length;t.forEach(mp);for(let o=0;o<t.length;o++)r.push(n),n+=t[o].length,fp(i,t[o]);let a=fS.triangulate(i,r);for(let o=0;o<a.length;o+=3)s.push(a.slice(o,o+3));return s}};function mp(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function fp(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var Pa=class extends Ye{constructor(e=new Ca([new K(.5,.5),new K(-.5,.5),new K(-.5,-.5),new K(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let i=this,r=[],s=[];for(let a=0,o=e.length;a<o;a++){let l=e[a];n(l)}this.setAttribute("position",new dt(r,3)),this.setAttribute("uv",new dt(s,2)),this.computeVertexNormals();function n(a){let o=[],l=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1,c=t.bevelEnabled!==void 0?t.bevelEnabled:!0,d=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:d-.1,f=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3,y=t.extrudePath,g=t.UVGenerator!==void 0?t.UVGenerator:IS;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=t.amount);let m,_=!1,x,w,S,b;y&&(m=y.getSpacedPoints(h),_=!0,c=!1,x=y.computeFrenetFrames(h,!1),w=new E,S=new E,b=new E),c||(v=0,d=0,p=0,f=0);let R=a.extractPoints(l),C=R.shape,D=R.holes;if(!Vr.isClockWise(C)){C=C.reverse();for(let G=0,J=D.length;G<J;G++){let X=D[G];Vr.isClockWise(X)&&(D[G]=X.reverse())}}let L=Vr.triangulateShape(C,D),j=C;for(let G=0,J=D.length;G<J;G++){let X=D[G];C=C.concat(X)}function N(G,J,X){return J||console.error("THREE.ExtrudeGeometry: vec does not exist"),J.clone().multiplyScalar(X).add(G)}let I=C.length,H=L.length;function U(G,J,X){let le,ee,Re,Se=G.x-J.x,A=G.y-J.y,T=X.x-G.x,V=X.y-G.y,he=Se*Se+A*A,oe=Se*V-A*T;if(Math.abs(oe)>Number.EPSILON){let de=Math.sqrt(he),Me=Math.sqrt(T*T+V*V),Te=J.x-A/de,Ee=J.y+Se/de,ye=X.x-V/Me,P=X.y+T/Me,ue=((ye-Te)*V-(P-Ee)*T)/(Se*V-A*T);le=Te+Se*ue-G.x,ee=Ee+A*ue-G.y;let Y=le*le+ee*ee;if(Y<=2)return new K(le,ee);Re=Math.sqrt(Y/2)}else{let de=!1;Se>Number.EPSILON?T>Number.EPSILON&&(de=!0):Se<-Number.EPSILON?T<-Number.EPSILON&&(de=!0):Math.sign(A)===Math.sign(V)&&(de=!0),de?(le=-A,ee=Se,Re=Math.sqrt(he)):(le=Se,ee=A,Re=Math.sqrt(he/2))}return new K(le/Re,ee/Re)}let O=[];for(let G=0,J=j.length,X=J-1,le=G+1;G<J;G++,X++,le++)X===J&&(X=0),le===J&&(le=0),O[G]=U(j[G],j[X],j[le]);let Z=[],re,xe=O.concat();for(let G=0,J=D.length;G<J;G++){let X=D[G];re=[];for(let le=0,ee=X.length,Re=ee-1,Se=le+1;le<ee;le++,Re++,Se++)Re===ee&&(Re=0),Se===ee&&(Se=0),re[le]=U(X[le],X[Re],X[Se]);Z.push(re),xe=xe.concat(re)}for(let G=0;G<v;G++){let J=G/v,X=d*Math.cos(J*Math.PI/2),le=p*Math.sin(J*Math.PI/2)+f;for(let ee=0,Re=j.length;ee<Re;ee++){let Se=N(j[ee],O[ee],le);ae(Se.x,Se.y,-X)}for(let ee=0,Re=D.length;ee<Re;ee++){let Se=D[ee];re=Z[ee];for(let A=0,T=Se.length;A<T;A++){let V=N(Se[A],re[A],le);ae(V.x,V.y,-X)}}}let ce=p+f;for(let G=0;G<I;G++){let J=c?N(C[G],xe[G],ce):C[G];_?(S.copy(x.normals[0]).multiplyScalar(J.x),w.copy(x.binormals[0]).multiplyScalar(J.y),b.copy(m[0]).add(S).add(w),ae(b.x,b.y,b.z)):ae(J.x,J.y,0)}for(let G=1;G<=h;G++)for(let J=0;J<I;J++){let X=c?N(C[J],xe[J],ce):C[J];_?(S.copy(x.normals[G]).multiplyScalar(X.x),w.copy(x.binormals[G]).multiplyScalar(X.y),b.copy(m[G]).add(S).add(w),ae(b.x,b.y,b.z)):ae(X.x,X.y,u/h*G)}for(let G=v-1;G>=0;G--){let J=G/v,X=d*Math.cos(J*Math.PI/2),le=p*Math.sin(J*Math.PI/2)+f;for(let ee=0,Re=j.length;ee<Re;ee++){let Se=N(j[ee],O[ee],le);ae(Se.x,Se.y,u+X)}for(let ee=0,Re=D.length;ee<Re;ee++){let Se=D[ee];re=Z[ee];for(let A=0,T=Se.length;A<T;A++){let V=N(Se[A],re[A],le);_?ae(V.x,V.y+m[h-1].y,m[h-1].x+X):ae(V.x,V.y,u+X)}}}q(),Q();function q(){let G=r.length/3;if(c){let J=0,X=I*J;for(let le=0;le<H;le++){let ee=L[le];z(ee[2]+X,ee[1]+X,ee[0]+X)}J=h+v*2,X=I*J;for(let le=0;le<H;le++){let ee=L[le];z(ee[0]+X,ee[1]+X,ee[2]+X)}}else{for(let J=0;J<H;J++){let X=L[J];z(X[2],X[1],X[0])}for(let J=0;J<H;J++){let X=L[J];z(X[0]+I*h,X[1]+I*h,X[2]+I*h)}}i.addGroup(G,r.length/3-G,0)}function Q(){let G=r.length/3,J=0;se(j,J),J+=j.length;for(let X=0,le=D.length;X<le;X++){let ee=D[X];se(ee,J),J+=ee.length}i.addGroup(G,r.length/3-G,1)}function se(G,J){let X=G.length;for(;--X>=0;){let le=X,ee=X-1;ee<0&&(ee=G.length-1);for(let Re=0,Se=h+v*2;Re<Se;Re++){let A=I*Re,T=I*(Re+1),V=J+le+A,he=J+ee+A,oe=J+ee+T,de=J+le+T;Ve(V,he,oe,de)}}}function ae(G,J,X){o.push(G),o.push(J),o.push(X)}function z(G,J,X){we(G),we(J),we(X);let le=r.length/3,ee=g.generateTopUV(i,r,le-3,le-2,le-1);te(ee[0]),te(ee[1]),te(ee[2])}function Ve(G,J,X,le){we(G),we(J),we(le),we(J),we(X),we(le);let ee=r.length/3,Re=g.generateSideWallUV(i,r,ee-6,ee-3,ee-2,ee-1);te(Re[0]),te(Re[1]),te(Re[3]),te(Re[1]),te(Re[2]),te(Re[3])}function we(G){r.push(o[G*3+0]),r.push(o[G*3+1]),r.push(o[G*3+2])}function te(G){s.push(G.x),s.push(G.y)}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return DS(t,i,e)}static fromJSON(e,t){let i=[];for(let s=0,n=e.shapes.length;s<n;s++){let a=t[e.shapes[s]];i.push(a)}let r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new cv[r.type]().fromJSON(r)),new Pa(i,e.options)}},IS={generateTopUV:function(e,t,i,r,s){let n=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],h=t[s*3],u=t[s*3+1];return[new K(n,a),new K(o,l),new K(h,u)]},generateSideWallUV:function(e,t,i,r,s,n){let a=t[i*3],o=t[i*3+1],l=t[i*3+2],h=t[r*3],u=t[r*3+1],c=t[r*3+2],d=t[s*3],p=t[s*3+1],f=t[s*3+2],v=t[n*3],y=t[n*3+1],g=t[n*3+2];return Math.abs(o-u)<Math.abs(a-h)?[new K(a,1-l),new K(h,1-c),new K(d,1-f),new K(v,1-g)]:[new K(o,1-l),new K(u,1-c),new K(p,1-f),new K(y,1-g)]}};function DS(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,s=e.length;r<s;r++){let n=e[r];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);return t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}var fv=class extends Ye{constructor(e=new Ca([new K(0,.5),new K(-.5,-.5),new K(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let i=[],r=[],s=[],n=[],a=0,o=0;if(Array.isArray(e)===!1)l(e);else for(let h=0;h<e.length;h++)l(e[h]),this.addGroup(a,o,h),a+=o,o=0;this.setIndex(i),this.setAttribute("position",new dt(r,3)),this.setAttribute("normal",new dt(s,3)),this.setAttribute("uv",new dt(n,2));function l(h){let u=r.length/3,c=h.extractPoints(t),d=c.shape,p=c.holes;Vr.isClockWise(d)===!1&&(d=d.reverse());for(let v=0,y=p.length;v<y;v++){let g=p[v];Vr.isClockWise(g)===!0&&(p[v]=g.reverse())}let f=Vr.triangulateShape(d,p);for(let v=0,y=p.length;v<y;v++){let g=p[v];d=d.concat(g)}for(let v=0,y=d.length;v<y;v++){let g=d[v];r.push(g.x,g.y,0),s.push(0,0,1),n.push(g.x,g.y)}for(let v=0,y=f.length;v<y;v++){let g=f[v],m=g[0]+u,_=g[1]+u,x=g[2]+u;i.push(m,_,x),o+=3}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return NS(t,e)}static fromJSON(e,t){let i=[];for(let r=0,s=e.shapes.length;r<s;r++){let n=t[e.shapes[r]];i.push(n)}return new fv(i,e.curveSegments)}};function NS(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){let s=e[i];t.shapes.push(s.uuid)}else t.shapes.push(e.uuid);return t}var gv=class extends lt{constructor(e){super(),this.type="ShadowMaterial",this.color=new pe(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};gv.prototype.isShadowMaterial=!0;var Ji=class extends lt{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new pe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};Ji.prototype.isMeshStandardMaterial=!0;var nn=class extends Ji{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new K(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return At(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new pe(0),this.sheenRoughness=1,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new pe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new pe(1,1,1),this.specularTintMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenTint.copy(e.sheenTint),this.sheenRoughness=e.sheenRoughness,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}};nn.prototype.isMeshPhysicalMaterial=!0;var OS=class extends lt{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new pe(16777215),this.specular=new pe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};OS.prototype.isMeshPhongMaterial=!0;var FS=class extends lt{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new pe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};FS.prototype.isMeshToonMaterial=!0;var US=class extends lt{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}};US.prototype.isMeshNormalMaterial=!0;var kS=class extends lt{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new pe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};kS.prototype.isMeshLambertMaterial=!0;var zS=class extends lt{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new pe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Kr,this.normalScale=new K(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}};zS.prototype.isMeshMatcapMaterial=!0;var BS=class extends sn{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};BS.prototype.isLineDashedMaterial=!0;var Ze={arraySlice:function(e,t,i){return Ze.isTypedArray(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(s,n){return e[s]-e[n]}let i=e.length,r=new Array(i);for(let s=0;s!==i;++s)r[s]=s;return r.sort(t),r},sortedArray:function(e,t,i){let r=e.length,s=new e.constructor(r);for(let n=0,a=0;a!==r;++n){let o=i[n]*t;for(let l=0;l!==t;++l)s[a++]=e[o+l]}return s},flattenJSON:function(e,t,i,r){let s=1,n=e[0];for(;n!==void 0&&n[r]===void 0;)n=e[s++];if(n===void 0)return;let a=n[r];if(a!==void 0)if(Array.isArray(a))do a=n[r],a!==void 0&&(t.push(n.time),i.push.apply(i,a)),n=e[s++];while(n!==void 0);else if(a.toArray!==void 0)do a=n[r],a!==void 0&&(t.push(n.time),a.toArray(i,i.length)),n=e[s++];while(n!==void 0);else do a=n[r],a!==void 0&&(t.push(n.time),i.push(a)),n=e[s++];while(n!==void 0)},subclip:function(e,t,i,r,s=30){let n=e.clone();n.name=t;let a=[];for(let l=0;l<n.tracks.length;++l){let h=n.tracks[l],u=h.getValueSize(),c=[],d=[];for(let p=0;p<h.times.length;++p){let f=h.times[p]*s;if(!(f<i||f>=r)){c.push(h.times[p]);for(let v=0;v<u;++v)d.push(h.values[p*u+v])}}c.length!==0&&(h.times=Ze.convertArray(c,h.times.constructor),h.values=Ze.convertArray(d,h.values.constructor),a.push(h))}n.tracks=a;let o=1/0;for(let l=0;l<n.tracks.length;++l)o>n.tracks[l].times[0]&&(o=n.tracks[l].times[0]);for(let l=0;l<n.tracks.length;++l)n.tracks[l].shift(-1*o);return n.resetDuration(),n},makeClipAdditive:function(e,t=0,i=e,r=30){r<=0&&(r=30);let s=i.tracks.length,n=t/r;for(let a=0;a<s;++a){let o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;let h=e.tracks.find(function(g){return g.name===o.name&&g.ValueTypeName===l});if(h===void 0)continue;let u=0,c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);let d=0,p=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);let f=o.times.length-1,v;if(n<=o.times[0]){let g=u,m=c-u;v=Ze.arraySlice(o.values,g,m)}else if(n>=o.times[f]){let g=f*c+u,m=g+c-u;v=Ze.arraySlice(o.values,g,m)}else{let g=o.createInterpolant(),m=u,_=c-u;g.evaluate(n),v=Ze.arraySlice(g.resultBuffer,m,_)}l==="quaternion"&&new Ct().fromArray(v).normalize().conjugate().toArray(v);let y=h.times.length;for(let g=0;g<y;++g){let m=g*p+d;if(l==="quaternion")Ct.multiplyQuaternionsFlat(h.values,m,v,0,h.values,m);else{let _=p-d*2;for(let x=0;x<_;++x)h.values[m+x]-=v[x]}}}return e.blendMode=Rg,e}},Ki=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let n;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,s)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}n=t.length;break i}if(!(e>=s)){let a=t[1];e<a&&(i=2,s=a);for(let o=i-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===o)break;if(r=s,s=t[--i-1],e>=s)break t}n=i,i=0;break i}break e}for(;i<n;){let a=i+n>>>1;e<t[a]?n=a:i=a+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(r===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,s,e)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let n=0;n!==r;++n)t[n]=i[s+n];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};Ki.prototype.beforeStart_=Ki.prototype.copySampleValue_;Ki.prototype.afterEnd_=Ki.prototype.copySampleValue_;var HS=class extends Ki{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Hs,endingEnd:Hs}}intervalChanged_(e,t,i){let r=this.parameterPositions,s=e-2,n=e+1,a=r[s],o=r[n];if(a===void 0)switch(this.getSettings_().endingStart){case Gs:s=e,a=2*t-i;break;case Zo:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case Gs:n=e,o=2*i-t;break;case Zo:n=1,o=i+r[1]-r[0];break;default:n=e-1,o=t}let l=(i-t)*.5,h=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=s*h,this._offsetNext=n*h}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,h=this._offsetPrev,u=this._offsetNext,c=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,v=f*p,y=-c*v+2*c*f-c*p,g=(1+c)*v+(-1.5-2*c)*f+(-.5+c)*p+1,m=(-1-d)*v+(1.5+d)*f+.5*p,_=d*v-d*f;for(let x=0;x!==a;++x)s[x]=y*n[h+x]+g*n[l+x]+m*n[o+x]+_*n[u+x];return s}},vv=class extends Ki{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,h=(i-t)/(r-t),u=1-h;for(let c=0;c!==a;++c)s[c]=n[l+c]*u+n[o+c]*h;return s}},GS=class extends Ki{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Si=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ze.convertArray(t,this.TimeBufferType),this.values=Ze.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Ze.convertArray(e.times,Array),values:Ze.convertArray(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new GS(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new vv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new HS(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ys:t=this.InterpolantFactoryMethodDiscrete;break;case Xr:t=this.InterpolantFactoryMethodLinear;break;case Ul:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ys;case this.InterpolantFactoryMethodLinear:return Xr;case this.InterpolantFactoryMethodSmooth:return Ul}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,s=0,n=r-1;for(;s!==r&&i[s]<e;)++s;for(;n!==-1&&i[n]>t;)--n;if(++n,s!==0||n!==r){s>=n&&(n=Math.max(n,1),s=n-1);let a=this.getValueSize();this.times=Ze.arraySlice(i,s,n),this.values=Ze.arraySlice(this.values,s*a,n*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let n=null;for(let a=0;a!==s;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(n!==null&&n>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,n),e=!1;break}n=o}if(r!==void 0&&Ze.isTypedArray(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Ze.arraySlice(this.times),t=Ze.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===Ul,s=e.length-1,n=1;for(let a=1;a<s;++a){let o=!1,l=e[a],h=e[a+1];if(l!==h&&(a!==1||l!==e[0]))if(r)o=!0;else{let u=a*i,c=u-i,d=u+i;for(let p=0;p!==i;++p){let f=t[u+p];if(f!==t[c+p]||f!==t[d+p]){o=!0;break}}}if(o){if(a!==n){e[n]=e[a];let u=a*i,c=n*i;for(let d=0;d!==i;++d)t[c+d]=t[u+d]}++n}}if(s>0){e[n]=e[s];for(let a=s*i,o=n*i,l=0;l!==i;++l)t[o+l]=t[a+l];++n}return n!==e.length?(this.times=Ze.arraySlice(e,0,n),this.values=Ze.arraySlice(t,0,n*i)):(this.times=e,this.values=t),this}clone(){let e=Ze.arraySlice(this.times,0),t=Ze.arraySlice(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Si.prototype.TimeBufferType=Float32Array;Si.prototype.ValueBufferType=Float32Array;Si.prototype.DefaultInterpolation=Xr;var an=class extends Si{};an.prototype.ValueTypeName="bool";an.prototype.ValueBufferType=Array;an.prototype.DefaultInterpolation=Ys;an.prototype.InterpolantFactoryMethodLinear=void 0;an.prototype.InterpolantFactoryMethodSmooth=void 0;var yv=class extends Si{};yv.prototype.ValueTypeName="color";var Sa=class extends Si{};Sa.prototype.ValueTypeName="number";var VS=class extends Ki{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let h=l+a;l!==h;l+=4)Ct.slerpFlat(s,0,n,l-a,n,l,o);return s}},qr=class extends Si{InterpolantFactoryMethodLinear(e){return new VS(this.times,this.values,this.getValueSize(),e)}};qr.prototype.ValueTypeName="quaternion";qr.prototype.DefaultInterpolation=Xr;qr.prototype.InterpolantFactoryMethodSmooth=void 0;var on=class extends Si{};on.prototype.ValueTypeName="string";on.prototype.ValueBufferType=Array;on.prototype.DefaultInterpolation=Ys;on.prototype.InterpolantFactoryMethodLinear=void 0;on.prototype.InterpolantFactoryMethodSmooth=void 0;var Ta=class extends Si{};Ta.prototype.ValueTypeName="vector";var qu=class{constructor(e,t=-1,i,r=vc){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Kt(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let n=0,a=i.length;n!==a;++n)t.push(jS(i[n]).scale(r));let s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,n=i.length;s!==n;++s)t.push(Si.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let s=t.length,n=[];for(let a=0;a<s;a++){let o=[],l=[];o.push((a+s-1)%s,a,(a+1)%s),l.push(0,1,0);let h=Ze.getKeyframeOrder(o);o=Ze.sortedArray(o,1,h),l=Ze.sortedArray(l,1,h),!r&&o[0]===0&&(o.push(s),l.push(l[0])),n.push(new Sa(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,n)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],h=l.name.match(s);if(h&&h.length>1){let u=h[1],c=r[u];c||(r[u]=c=[]),c.push(l)}}let n=[];for(let a in r)n.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return n}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(h,u,c,d,p){if(c.length!==0){let f=[],v=[];Ze.flattenJSON(c,f,v,d),f.length!==0&&p.push(new h(u,f,v))}},r=[],s=e.name||"default",n=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let h=0;h<l.length;h++){let u=l[h].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let c={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)c[u[d].morphTargets[p]]=-1;for(let p in c){let f=[],v=[];for(let y=0;y!==u[d].morphTargets.length;++y){let g=u[d];f.push(g.time),v.push(g.morphTarget===p?1:0)}r.push(new Sa(".morphTargetInfluence["+p+"]",f,v))}o=c.length*(n||1)}else{let c=".bones["+t[h].name+"]";i(Ta,c+".position",u,"pos",r),i(qr,c+".quaternion",u,"rot",r),i(Ta,c+".scale",u,"scl",r)}}return r.length===0?null:new this(s,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function WS(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sa;case"vector":case"vector2":case"vector3":case"vector4":return Ta;case"color":return yv;case"quaternion":return qr;case"bool":case"boolean":return an;case"string":return on}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function jS(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=WS(e.type);if(e.times===void 0){let i=[],r=[];Ze.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Zs={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},XS=class{constructor(e,t,i){let r=this,s=!1,n=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,s===!1&&r.onStart!==void 0&&r.onStart(h,n,a),s=!0},this.itemEnd=function(h){n++,r.onProgress!==void 0&&r.onProgress(h,n,a),n===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return o?o(h):h},this.setURLModifier=function(h){return o=h,this},this.addHandler=function(h,u){return l.push(h,u),this},this.removeHandler=function(h){let u=l.indexOf(h);return u!==-1&&l.splice(u,2),this},this.getHandler=function(h){for(let u=0,c=l.length;u<c;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(h))return p}return null}}},qS=new XS,ei=class{constructor(e){this.manager=e!==void 0?e:qS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},ni={},qi=class extends ei{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,n=Zs.get(e);if(n!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(n),s.manager.itemEnd(e)},0),n;if(ni[e]!==void 0){ni[e].push({onLoad:t,onProgress:i,onError:r});return}let a=/^data:(.*?)(;base64)?,(.*)$/,o=e.match(a),l;if(o){let h=o[1],u=!!o[2],c=o[3];c=decodeURIComponent(c),u&&(c=atob(c));try{let d,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":let f=new Uint8Array(c.length);for(let v=0;v<c.length;v++)f[v]=c.charCodeAt(v);p==="blob"?d=new Blob([f.buffer],{type:h}):d=f.buffer;break;case"document":d=new DOMParser().parseFromString(c,h);break;case"json":d=JSON.parse(c);break;default:d=c;break}setTimeout(function(){t&&t(d),s.manager.itemEnd(e)},0)}catch(d){setTimeout(function(){r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)},0)}}else{ni[e]=[],ni[e].push({onLoad:t,onProgress:i,onError:r}),l=new XMLHttpRequest,l.open("GET",e,!0),l.addEventListener("load",function(h){let u=this.response,c=ni[e];if(delete ni[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Zs.add(e,u);for(let d=0,p=c.length;d<p;d++){let f=c[d];f.onLoad&&f.onLoad(u)}s.manager.itemEnd(e)}else{for(let d=0,p=c.length;d<p;d++){let f=c[d];f.onError&&f.onError(h)}s.manager.itemError(e),s.manager.itemEnd(e)}},!1),l.addEventListener("progress",function(h){let u=ni[e];for(let c=0,d=u.length;c<d;c++){let p=u[c];p.onProgress&&p.onProgress(h)}},!1),l.addEventListener("error",function(h){let u=ni[e];delete ni[e];for(let c=0,d=u.length;c<d;c++){let p=u[c];p.onError&&p.onError(h)}s.manager.itemError(e),s.manager.itemEnd(e)},!1),l.addEventListener("abort",function(h){let u=ni[e];delete ni[e];for(let c=0,d=u.length;c<d;c++){let p=u[c];p.onError&&p.onError(h)}s.manager.itemError(e),s.manager.itemEnd(e)},!1),this.responseType!==void 0&&(l.responseType=this.responseType),this.withCredentials!==void 0&&(l.withCredentials=this.withCredentials),l.overrideMimeType&&l.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(let h in this.requestHeader)l.setRequestHeader(h,this.requestHeader[h]);l.send(null)}return s.manager.itemStart(e),l}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Pc=class extends ei{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,n=Zs.get(e);if(n!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(n),s.manager.itemEnd(e)},0),n;let a=ml("img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),Zs.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(h){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}},YS=class extends ei{constructor(e){super(e)}load(e,t,i,r){let s=new fl,n=new Pc(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);let a=0;function o(l){n.load(e[l],function(h){s.images[l]=h,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let l=0;l<e.length;++l)o(l);return s}},$S=class extends ei{constructor(e){super(e)}load(e,t,i,r){let s=this,n=new Tc,a=new qi(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(o){let l=s.parse(o);!l||(l.image!==void 0?n.image=l.image:l.data!==void 0&&(n.image.width=l.width,n.image.height=l.height,n.image.data=l.data),n.wrapS=l.wrapS!==void 0?l.wrapS:bt,n.wrapT=l.wrapT!==void 0?l.wrapT:bt,n.magFilter=l.magFilter!==void 0?l.magFilter:Je,n.minFilter=l.minFilter!==void 0?l.minFilter:Je,n.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.encoding!==void 0&&(n.encoding=l.encoding),l.flipY!==void 0&&(n.flipY=l.flipY),l.format!==void 0&&(n.format=l.format),l.type!==void 0&&(n.type=l.type),l.mipmaps!==void 0&&(n.mipmaps=l.mipmaps,n.minFilter=Qi),l.mipmapCount===1&&(n.minFilter=Je),l.generateMipmaps!==void 0&&(n.generateMipmaps=l.generateMipmaps),n.needsUpdate=!0,t&&t(n,l))},i,r),n}},Ml=class extends ei{constructor(e){super(e)}load(e,t,i,r){let s=new ht,n=new Pc(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}},wi=class extends Fe{constructor(e,t=1){super(),this.type="Light",this.color=new pe(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};wi.prototype.isLight=!0;var ZS=class extends wi{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Fe.DefaultUp),this.updateMatrix(),this.groundColor=new pe(t)}copy(e){return wi.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};ZS.prototype.isHemisphereLight=!0;var gp=new me,vp=new E,yp=new E,Ic=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new K(512,512),this.map=null,this.mapPass=null,this.matrix=new me,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vl,this._frameExtents=new K(1,1),this._viewportCount=1,this._viewports=[new We(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;vp.setFromMatrixPosition(e.matrixWorld),t.position.copy(vp),yp.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(yp),t.updateMatrixWorld(),gp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gp),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},xv=class extends Ic{constructor(){super(new ft(50,1,.5,500)),this.focus=1}updateMatrices(e){let t=this.camera,i=ya*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};xv.prototype.isSpotLightShadow=!0;var bv=class extends wi{constructor(e,t,i=0,r=Math.PI/3,s=0,n=1){super(e,t),this.type="SpotLight",this.position.copy(Fe.DefaultUp),this.updateMatrix(),this.target=new Fe,this.distance=i,this.angle=r,this.penumbra=s,this.decay=n,this.shadow=new xv}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};bv.prototype.isSpotLight=!0;var xp=new me,bn=new E,vh=new E,wv=class extends Ic{constructor(){super(new ft(90,1,.5,500)),this._frameExtents=new K(4,2),this._viewportCount=6,this._viewports=[new We(2,1,1,1),new We(0,1,1,1),new We(3,1,1,1),new We(1,1,1,1),new We(3,0,1,1),new We(1,0,1,1)],this._cubeDirections=[new E(1,0,0),new E(-1,0,0),new E(0,0,1),new E(0,0,-1),new E(0,1,0),new E(0,-1,0)],this._cubeUps=[new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,0,1),new E(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),bn.setFromMatrixPosition(e.matrixWorld),i.position.copy(bn),vh.copy(i.position),vh.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(vh),i.updateMatrixWorld(),r.makeTranslation(-bn.x,-bn.y,-bn.z),xp.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xp)}};wv.prototype.isPointLightShadow=!0;var Sl=class extends wi{constructor(e,t,i=0,r=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new wv}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};Sl.prototype.isPointLight=!0;var _v=class extends Ic{constructor(){super(new rs(-5,5,5,-5,.5,500))}};_v.prototype.isDirectionalLightShadow=!0;var Tl=class extends wi{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Fe.DefaultUp),this.updateMatrix(),this.target=new Fe,this.shadow=new _v}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};Tl.prototype.isDirectionalLight=!0;var JS=class extends wi{constructor(e,t){super(e,t),this.type="AmbientLight"}};JS.prototype.isAmbientLight=!0;var KS=class extends wi{constructor(e,t,i=10,r=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};KS.prototype.isRectAreaLight=!0;var Mv=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new E)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let i=e.x,r=e.y,s=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*r),t.addScaledVector(n[2],.488603*s),t.addScaledVector(n[3],.488603*i),t.addScaledVector(n[4],1.092548*(i*r)),t.addScaledVector(n[5],1.092548*(r*s)),t.addScaledVector(n[6],.315392*(3*s*s-1)),t.addScaledVector(n[7],1.092548*(i*s)),t.addScaledVector(n[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){let i=e.x,r=e.y,s=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],2*.511664*r),t.addScaledVector(n[2],2*.511664*s),t.addScaledVector(n[3],2*.511664*i),t.addScaledVector(n[4],2*.429043*i*r),t.addScaledVector(n[5],2*.429043*r*s),t.addScaledVector(n[6],.743125*s*s-.247708),t.addScaledVector(n[7],2*.429043*i*s),t.addScaledVector(n[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){let i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){let i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}};Mv.prototype.isSphericalHarmonics3=!0;var El=class extends wi{constructor(e=new Mv,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};El.prototype.isLightProbe=!0;var qs=class{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}},QS=class extends Ye{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};QS.prototype.isInstancedBufferGeometry=!0;var Sv=class extends ei{constructor(e){super(e),typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,n=Zs.get(e);if(n!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(n),s.manager.itemEnd(e)},0),n;let a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(o){return o.blob()}).then(function(o){return createImageBitmap(o,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(o){Zs.add(e,o),t&&t(o),s.manager.itemEnd(e)}).catch(function(o){r&&r(o),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}};Sv.prototype.isImageBitmapLoader=!0;var co,eT={getContext:function(){return co===void 0&&(co=new(window.AudioContext||window.webkitAudioContext)),co},setContext:function(e){co=e}},tT=class extends ei{constructor(e){super(e)}load(e,t,i,r){let s=this,n=new qi(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(a){try{let o=a.slice(0);eT.getContext().decodeAudioData(o,function(l){t(l)})}catch(o){r?r(o):console.error(o),s.manager.itemError(e)}},i,r)}},iT=class extends El{constructor(e,t,i=1){super(void 0,i);let r=new pe().set(e),s=new pe().set(t),n=new E(r.r,r.g,r.b),a=new E(s.r,s.g,s.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(n).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(n).sub(a).multiplyScalar(l)}};iT.prototype.isHemisphereLightProbe=!0;var rT=class extends El{constructor(e,t=1){super(void 0,t);let i=new pe().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}};rT.prototype.isAmbientLightProbe=!0;var sT=class extends Fe{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},nT=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,n;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,s=e*r+r,n=this.cumulativeWeight;if(n===0){for(let a=0;a!==r;++a)i[s+a]=i[a];n=t}else{n+=t;let a=t/n;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=n}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,n=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-s,t)}n>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,n=r;s!==n;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let n=0;n!==s;++n)e[t+n]=e[i+n]}_slerp(e,t,i,r){Ct.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){let n=this._workIndex*s;Ct.multiplyQuaternionsFlat(e,n,e,t,e,i),Ct.slerpFlat(e,t,e,t,e,n,r)}_lerp(e,t,i,r,s){let n=1-r;for(let a=0;a!==s;++a){let o=t+a;e[o]=e[o]*n+e[i+a]*r}}_lerpAdditive(e,t,i,r,s){for(let n=0;n!==s;++n){let a=t+n;e[a]=e[a]+e[i+n]*r}}},Dc="\\[\\]\\.:\\/",aT=new RegExp("["+Dc+"]","g"),Nc="[^"+Dc+"]",oT="[^"+Dc.replace("\\.","")+"]",lT=/((?:WC+[\/:])*)/.source.replace("WC",Nc),hT=/(WCOD+)?/.source.replace("WCOD",oT),uT=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Nc),cT=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Nc),dT=new RegExp("^"+lT+hT+uT+cT+"$"),pT=["material","materials","bones"],mT=class{constructor(e,t,i){let r=i||Oe.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Oe=class{constructor(e,t,i){this.path=t,this.parsedPath=i||Oe.parseTrackName(t),this.node=Oe.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Oe.Composite(e,t,i):new Oe(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(aT,"")}static parseTrackName(e){let t=dT.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let s=i.nodeName.substring(r+1);pT.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(s){for(let n=0;n<s.length;n++){let a=s[n];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,s=t.propertyIndex;if(e||(e=Oe.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===l){l=h;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let n=e[r];if(n===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}o=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=s}else n.fromArray!==void 0&&n.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(o=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Oe.Composite=mT;Oe.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Oe.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Oe.prototype.GetterByBindingType=[Oe.prototype._getValue_direct,Oe.prototype._getValue_array,Oe.prototype._getValue_arrayElement,Oe.prototype._getValue_toArray];Oe.prototype.SetterByBindingTypeAndVersioning=[[Oe.prototype._setValue_direct,Oe.prototype._setValue_direct_setNeedsUpdate,Oe.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Oe.prototype._setValue_array,Oe.prototype._setValue_array_setNeedsUpdate,Oe.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Oe.prototype._setValue_arrayElement,Oe.prototype._setValue_arrayElement_setNeedsUpdate,Oe.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Oe.prototype._setValue_fromArray,Oe.prototype._setValue_fromArray_setNeedsUpdate,Oe.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var fT=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let s=t.tracks,n=s.length,a=new Array(n),o={endingStart:Hs,endingEnd:Hs};for(let l=0;l!==n;++l){let h=s[l].createInterpolant(null);a[l]=h,h.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=$x,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,s=e._clip.duration,n=s/r,a=r/s;e.warp(1,n,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,s=r.time,n=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=s,o[1]=s+i,l[0]=e/n,l[1]=t/n,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let s=this._startTime;if(s!==null){let o=(e-s)*i;if(o<0||i===0)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);let n=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Rg:for(let h=0,u=o.length;h!==u;++h)o[h].evaluate(n),l[h].accumulateAdditive(a);break;case vc:default:for(let h=0,u=o.length;h!==u;++h)o[h].evaluate(n),l[h].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;i!==null&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,s=this._loopCount,n=i===Zx;if(e===0)return s===-1?r:n&&(s&1)==1?t-r:r;if(i===Yx){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);let o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,n)}else this._setEndings(!1,!1,n);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(n&&(s&1)==1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=Gs,r.endingEnd=Gs):(e?r.endingStart=this.zeroSlopeAtStart?Gs:Hs:r.endingStart=Zo,t?r.endingEnd=this.zeroSlopeAtEnd?Gs:Hs:r.endingEnd=Zo)}_scheduleFading(e,t,i){let r=this._mixer,s=r.time,n=this._weightInterpolant;n===null&&(n=r._lendControlInterpolant(),this._weightInterpolant=n);let a=n.parameterPositions,o=n.sampleValues;return a[0]=s,o[0]=t,a[1]=s+e,o[1]=i,this}},Tv=class extends Ht{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,n=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,h=l[o];h===void 0&&(h={},l[o]=h);for(let u=0;u!==s;++u){let c=r[u],d=c.name,p=h[d];if(p!==void 0)n[u]=p;else{if(p=n[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let f=t&&t._propertyBindings[u].binding.parsedPath;p=new nT(Oe.create(i,d,f),c.ValueTypeName,c.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),n[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let s=t[i];s.useCount++==0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let s=t[i];--s.useCount==0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,s=this._actionsByClip,n=s[t];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=n;else{let a=n.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),n.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let s=e._clip.uuid,n=this._actionsByClip,a=n[s],o=a.knownActions,l=o[o.length-1],h=e._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,c=(e._localRoot||this._root).uuid;delete u[c],o.length===0&&delete n[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let s=t[i];--s.referenceCount==0&&this._removeInactiveBinding(s)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,s=this._bindings,n=r[t];n===void 0&&(n={},r[t]=n),n[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,n=this._bindingsByRootAndName,a=n[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[s],Object.keys(a).length===0&&delete n[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new vv(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){let r=t||this._root,s=r.uuid,n=typeof e=="string"?qu.findByName(r,e):e,a=n!==null?n.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(n!==null?i=n.blendMode:i=vc),o!==void 0){let u=o.actionByRoot[s];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],n===null&&(n=l._clip)}if(n===null)return null;let h=new fT(this,n,t,i);return this._bindAction(h,l),this._addInactiveAction(h,a,s),h}existingAction(e,t){let i=t||this._root,r=i.uuid,s=typeof e=="string"?qu.findByName(i,e):e,n=s?s.uuid:e,a=this._actionsByClip[n];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),n=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,s,n);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(n);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){let n=s.knownActions;for(let a=0,o=n.length;a!==o;++a){let l=n[a];this._deactivateAction(l);let h=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=h,t[h]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let n in i){let a=i[n].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(let n in s){let a=s[n];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}};Tv.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var gT=class extends rn{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};gT.prototype.isInstancedInterleavedBuffer=!0;var vT=class{constructor(e,t,i=0,r=1/0){this.ray=new Qr(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Ug,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Yu(e,this,i,t),i.sort(bp),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)Yu(e[r],this,i,t);return i.sort(bp),i}};function bp(e,t){return e.distance-t.distance}function Yu(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let s=e.children;for(let n=0,a=s.length;n<a;n++)Yu(s[n],t,i,!0)}}var Fo=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){let e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(At(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},yT=class extends Fe{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}};yT.prototype.isImmediateRenderObject=!0;var hr=new E,po=new me,yh=new me,xT=class extends xl{constructor(e){let t=Ev(e),i=new Ye,r=[],s=[],n=new pe(0,0,1),a=new pe(0,1,0);for(let l=0;l<t.length;l++){let h=t[l];h.parent&&h.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(n.r,n.g,n.b),s.push(a.r,a.g,a.b))}i.setAttribute("position",new dt(r,3)),i.setAttribute("color",new dt(s,3));let o=new sn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,o),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,i=this.geometry,r=i.getAttribute("position");yh.copy(this.root.matrixWorld).invert();for(let s=0,n=0;s<t.length;s++){let a=t[s];a.parent&&a.parent.isBone&&(po.multiplyMatrices(yh,a.matrixWorld),hr.setFromMatrixPosition(po),r.setXYZ(n,hr.x,hr.y,hr.z),po.multiplyMatrices(yh,a.parent.matrixWorld),hr.setFromMatrixPosition(po),r.setXYZ(n+1,hr.x,hr.y,hr.z),n+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function Ev(e){let t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,Ev(e.children[i]));return t}var bT=class extends xl{constructor(e=10,t=10,i=4473924,r=8947848){i=new pe(i),r=new pe(r);let s=t/2,n=e/t,a=e/2,o=[],l=[];for(let c=0,d=0,p=-a;c<=t;c++,p+=n){o.push(-a,0,p,a,0,p),o.push(p,0,-a,p,0,a);let f=c===s?i:r;f.toArray(l,d),d+=3,f.toArray(l,d),d+=3,f.toArray(l,d),d+=3,f.toArray(l,d),d+=3}let h=new Ye;h.setAttribute("position",new dt(o,3)),h.setAttribute("color",new dt(l,3));let u=new sn({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}},Av=new Float32Array(1),wT=new Int32Array(Av.buffer),xh=class{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),Av[0]=e;let t=wT[0],i=t>>16&32768,r=t>>12&2047,s=t>>23&255;return s<103?i:s>142?(i|=31744,i|=(s==255?0:1)&&t&8388607,i):s<113?(r|=2048,i|=(r>>114-s)+(r>>113-s&1),i):(i|=s-112<<10|r>>1,i+=r&1,i)}};Qt.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Qt.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e};Wu.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)};bT.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};xT.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};ei.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),qs.extractUrlBase(e)};ei.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};It.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)};It.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};It.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)};It.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)};It.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)};Sr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};vl.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)};ct.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)};ct.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)};ct.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};ct.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)};ct.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};ct.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()};me.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)};me.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)};me.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new E().setFromMatrixColumn(this,3)};me.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)};me.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};me.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)};me.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)};me.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};me.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)};me.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)};me.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};me.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};me.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};me.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};me.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};me.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)};me.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};me.prototype.makeFrustum=function(e,t,i,r,s,n){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,s,n)};me.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()};Gi.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)};Ct.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)};Ct.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Qr.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)};Qr.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)};Qr.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)};ut.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};ut.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)};ut.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)};ut.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)};ut.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)};ut.barycoordFromPoint=function(e,t,i,r,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ut.getBarycoord(e,t,i,r,s)};ut.normal=function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ut.getNormal(e,t,i,r)};Ca.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)};Ca.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Pa(this,e)};Ca.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new fv(this,e)};K.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)};K.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)};K.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};E.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};E.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};E.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)};E.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)};E.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)};E.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)};E.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)};E.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)};E.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};We.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)};We.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Fe.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)};Fe.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Fe.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)};Fe.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Fe.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)};Object.defineProperties(Fe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});_e.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(_e.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Jx},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Mc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};ft.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)};Object.defineProperties(wi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}});Object.defineProperties(je.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Jo},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Jo)}}});je.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?Jo:va),this};je.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},je.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ye.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)};Ye.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new je(arguments[1],arguments[2]))):e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t)};Ye.prototype.addDrawCall=function(e,t,i){i!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)};Ye.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Ye.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Ye.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)};Ye.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)};Object.defineProperties(Ye.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});rn.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?Jo:va),this};rn.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Pa.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Pa.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Pa.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};bi.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(lt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new pe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===xg}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Zi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}});Ge.prototype.clearTarget=function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)};Ge.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)};Ge.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Ge.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Ge.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Ge.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Ge.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Ge.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Ge.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Ge.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Ge.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Ge.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Ge.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Ge.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Ge.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)};Ge.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Ge.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Ge.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Ge.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Ge.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Ge.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Ge.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Ge.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Ge.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Ge.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Ge.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?Bt:Ke}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(ev.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Ot.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}});sT.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let t=this;return new tT().load(e,function(i){t.setBuffer(i)}),this};xa.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};xa.prototype.clear=function(e,t,i,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,r)};en.crossOrigin=void 0;en.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let s=new Ml;s.setCrossOrigin(this.crossOrigin);let n=s.load(e,i,void 0,r);return t&&(n.mapping=t),n};en.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let s=new YS;s.setCrossOrigin(this.crossOrigin);let n=s.load(e,i,void 0,r);return t&&(n.mapping=t),n};en.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};en.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gg}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=gg);var bh=new WeakMap,_T=class extends ei{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let s=new qi(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,n=>{let a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(n,a).then(t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(let o in t.attributeTypes){let l=t.attributeTypes[o];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[o]=l.name)}let i=JSON.stringify(t);if(bh.has(e)){let o=bh.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,s=this.workerNextTaskID++,n=e.byteLength,a=this._getWorker(s,n).then(o=>(r=o,new Promise((l,h)=>{r._callbacks[s]={resolve:l,reject:h},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),bh.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new Ye;e.index&&t.setIndex(new je(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],s=r.name,n=r.array,a=r.itemSize;t.setAttribute(s,new je(n,a))}return t}_loadLibrary(e,t){let i=new qi(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,s)=>{i.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let s=MT.toString(),n=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){let n=s.data;switch(n.type){case"decode":r._callbacks[n.id].resolve(n);break;case"error":r._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}};function MT(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(c){u({draco:c})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,h=o.taskConfig;t.then(u=>{let c=u.draco,d=new c.Decoder,p=new c.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(c,d,p,h),v=f.attributes.map(y=>y.array.buffer);f.index&&v.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},v)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{c.destroy(p),c.destroy(d)}});break}};function i(a,o,l,h){let u=h.attributeIDs,c=h.attributeTypes,d,p,f=o.GetEncodedGeometryType(l);if(f===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(f===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let v={index:null,attributes:[]};for(let y in u){let g=self[c[y]],m,_;if(h.useUniqueIDs)_=u[y],m=o.GetAttributeByUniqueId(d,_);else{if(_=o.GetAttributeId(d,a[u[y]]),_===-1)continue;m=o.GetAttribute(d,_)}v.attributes.push(s(a,o,d,y,g,m))}return f===a.TRIANGULAR_MESH&&(v.index=r(a,o,d)),a.destroy(d),v}function r(a,o,l){let h=l.num_faces()*3,u=h*4,c=a._malloc(u);o.GetTrianglesUInt32Array(l,u,c);let d=new Uint32Array(a.HEAPF32.buffer,c,h).slice();return a._free(c),{array:d,itemSize:1}}function s(a,o,l,h,u,c){let d=c.num_components(),p=l.num_points()*d,f=p*u.BYTES_PER_ELEMENT,v=n(a,u),y=a._malloc(f);o.GetAttributeDataArrayForAllPoints(l,c,v,f,y);let g=new u(a.HEAPF32.buffer,y,p).slice();return a._free(y),{name:h,array:g,itemSize:d}}function n(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var ST=class extends ei{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new RT(t)}),this.register(function(t){return new DT(t)}),this.register(function(t){return new NT(t)}),this.register(function(t){return new LT(t)}),this.register(function(t){return new CT(t)}),this.register(function(t){return new PT(t)}),this.register(function(t){return new IT(t)}),this.register(function(t){return new ET(t)}),this.register(function(t){return new OT(t)})}load(e,t,i,r){let s=this,n;this.resourcePath!==""?n=this.resourcePath:this.path!==""?n=this.path:n=qs.extractUrlBase(e),this.manager.itemStart(e);let a=function(l){r?r(l):console.error(l),s.manager.itemError(e),s.manager.itemEnd(e)},o=new qi(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{s.parse(l,n,function(h){t(h),s.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s,n={},a={};if(typeof e=="string")s=e;else if(qs.decodeText(new Uint8Array(e,0,4))===Rv){try{n[De.KHR_BINARY_GLTF]=new FT(e)}catch(h){r&&r(h);return}s=n[De.KHR_BINARY_GLTF].content}else s=qs.decodeText(new Uint8Array(e));let o=JSON.parse(s);if(o.asset===void 0||o.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let l=new YT(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){let u=this.pluginCallbacks[h](l);a[u.name]=u,n[u.name]=!0}if(o.extensionsUsed)for(let h=0;h<o.extensionsUsed.length;++h){let u=o.extensionsUsed[h],c=o.extensionsRequired||[];switch(u){case De.KHR_MATERIALS_UNLIT:n[u]=new AT;break;case De.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:n[u]=new zT;break;case De.KHR_DRACO_MESH_COMPRESSION:n[u]=new UT(o,this.dracoLoader);break;case De.KHR_TEXTURE_TRANSFORM:n[u]=new kT;break;case De.KHR_MESH_QUANTIZATION:n[u]=new BT;break;default:c.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(n),l.setPlugins(a),l.parse(i,r)}};function TT(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var De={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},ET=class{constructor(e){this.parser=e,this.name=De.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){let s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){let t=this.parser,i="light:"+e,r=t.cache.get(i);if(r)return r;let s=t.json,n=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e],a,o=new pe(16777215);n.color!==void 0&&o.fromArray(n.color);let l=n.range!==void 0?n.range:0;switch(n.type){case"directional":a=new Tl(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Sl(o),a.distance=l;break;case"spot":a=new bv(o),a.distance=l,n.spot=n.spot||{},n.spot.innerConeAngle=n.spot.innerConeAngle!==void 0?n.spot.innerConeAngle:0,n.spot.outerConeAngle=n.spot.outerConeAngle!==void 0?n.spot.outerConeAngle:Math.PI/4,a.angle=n.spot.outerConeAngle,a.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return a.position.set(0,0,0),a.decay=2,n.intensity!==void 0&&(a.intensity=n.intensity),a.name=t.createUniqueName(n.name||"light_"+e),r=Promise.resolve(a),t.cache.add(i,r),r}createNodeAttachment(e){let t=this,i=this.parser,r=i.json.nodes[e],s=(r.extensions&&r.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(n){return i._getNodeRef(t.cache,s,n)})}},AT=class{constructor(){this.name=De.KHR_MATERIALS_UNLIT}getMaterialType(){return hi}extendParams(e,t,i){let r=[];e.color=new pe(1,1,1),e.opacity=1;let s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){let n=s.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture))}return Promise.all(r)}},RT=class{constructor(e){this.parser=e,this.name=De.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:nn}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],n=r.extensions[this.name];if(n.clearcoatFactor!==void 0&&(t.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){let a=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new K(a,a)}return Promise.all(s)}},LT=class{constructor(e){this.parser=e,this.name=De.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:nn}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],n=r.extensions[this.name];return n.transmissionFactor!==void 0&&(t.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(s)}},CT=class{constructor(e){this.parser=e,this.name=De.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:nn}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],n=r.extensions[this.name];t.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||0;let a=n.attenuationColor||[1,1,1];return t.attenuationTint=new pe(a[0],a[1],a[2]),Promise.all(s)}},PT=class{constructor(e){this.parser=e,this.name=De.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:nn}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},IT=class{constructor(e){this.parser=e,this.name=De.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:nn}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],n=r.extensions[this.name];t.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",n.specularTexture));let a=n.specularColorFactor||[1,1,1];return t.specularTint=new pe(a[0],a[1],a[2]),n.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularTintMap",n.specularColorTexture).then(function(o){o.encoding=Bt})),Promise.all(s)}},DT=class{constructor(e){this.parser=e,this.name=De.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let s=r.extensions[this.name],n=i.images[s.source],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n,a)}},NT=class{constructor(e){this.parser=e,this.name=De.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;let n=s.extensions[t],a=r.images[n.source],o=i.textureLoader;if(a.uri){let l=i.options.manager.getHandler(a.uri);l!==null&&(o=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,a,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},OT=class{constructor(e){this.name=De.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){let r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,n.ready]).then(function(a){let o=r.byteOffset||0,l=r.byteLength||0,h=r.count,u=r.byteStride,c=new ArrayBuffer(h*u),d=new Uint8Array(a[0],o,l);return n.decodeGltfBuffer(new Uint8Array(c),h,u,d,r.mode,r.filter),c})}else return null}},Rv="glTF",wn=12,wp={JSON:1313821514,BIN:5130562},FT=class{constructor(e){this.name=De.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,wn);if(this.header={magic:qs.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Rv)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let i=this.header.length-wn,r=new DataView(e,wn),s=0;for(;s<i;){let n=r.getUint32(s,!0);s+=4;let a=r.getUint32(s,!0);if(s+=4,a===wp.JSON){let o=new Uint8Array(e,wn+s,n);this.content=qs.decodeText(o)}else if(a===wp.BIN){let o=wn+s;this.body=e.slice(o,o+n)}s+=n}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},UT=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=De.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,a={},o={},l={};for(let h in n){let u=Zu[h]||h.toLowerCase();a[u]=n[h]}for(let h in e.attributes){let u=Zu[h]||h.toLowerCase();if(n[h]!==void 0){let c=i.accessors[e.attributes[h]],d=Ea[c.componentType];l[u]=d,o[u]=c.normalized===!0}}return t.getDependency("bufferView",s).then(function(h){return new Promise(function(u){r.decodeDracoFile(h,function(c){for(let d in c.attributes){let p=c.attributes[d],f=o[d];f!==void 0&&(p.normalized=f)}u(c)},a,l)})})}},kT=class{constructor(){this.name=De.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},$u=class extends Ji{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;let t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),n=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new pe().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(o){for(let l in a)o.uniforms[l]=a[l];o.fragmentShader=o.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",n)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(o){a.specular.value=o}},specularMap:{get:function(){return a.specularMap.value},set:function(o){a.specularMap.value=o,o?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(o){a.glossiness.value=o}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(o){a.glossinessMap.value=o,o?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},zT=class{constructor(){this.name=De.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return $u}extendParams(e,t,i){let r=t.extensions[this.name];e.color=new pe(1,1,1),e.opacity=1;let s=[];if(Array.isArray(r.diffuseFactor)){let n=r.diffuseFactor;e.color.fromArray(n),e.opacity=n[3]}if(r.diffuseTexture!==void 0&&s.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new pe(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new pe(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){let n=r.specularGlossinessTexture;s.push(i.assignTexture(e,"glossinessMap",n)),s.push(i.assignTexture(e,"specularMap",n))}return Promise.all(s)}createMaterial(e){let t=new $u(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Kr,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}},BT=class{constructor(){this.name=De.KHR_MESH_QUANTIZATION}},Yr=class extends Ki{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let n=0;n!==r;n++)t[n]=i[s+n];return t}};Yr.prototype.beforeStart_=Yr.prototype.copySampleValue_;Yr.prototype.afterEnd_=Yr.prototype.copySampleValue_;Yr.prototype.interpolate_=function(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=a*2,l=a*3,h=r-t,u=(i-t)/h,c=u*u,d=c*u,p=e*l,f=p-l,v=-2*d+3*c,y=d-c,g=1-v,m=y-c+u;for(let _=0;_!==a;_++){let x=n[f+_+a],w=n[f+_+o]*h,S=n[p+_+a],b=n[p+_]*h;s[_]=g*x+m*w+v*S+y*b}return s};var HT=new Ct,GT=class extends Yr{interpolate_(e,t,i,r){let s=super.interpolate_(e,t,i,r);return HT.fromArray(s).normalize().toArray(s),s}},Ii={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ea={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_p={9728:st,9729:Je,9984:qo,9985:gc,9986:Yo,9987:Qi},Mp={33071:bt,33648:fa,10497:$i},Sp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zu={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ur={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},VT={CUBICSPLINE:void 0,LINEAR:Xr,STEP:Ys},wh={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Tp(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function WT(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new Ji({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:br})),e.DefaultMaterial}function _n(e,t,i){for(let r in i.extensions)e[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function zr(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function jT(e,t,i){let r=!1,s=!1;for(let o=0,l=t.length;o<l;o++){let h=t[o];if(h.POSITION!==void 0&&(r=!0),h.NORMAL!==void 0&&(s=!0),r&&s)break}if(!r&&!s)return Promise.resolve(e);let n=[],a=[];for(let o=0,l=t.length;o<l;o++){let h=t[o];if(r){let u=h.POSITION!==void 0?i.getDependency("accessor",h.POSITION):e.attributes.position;n.push(u)}if(s){let u=h.NORMAL!==void 0?i.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(u)}}return Promise.all([Promise.all(n),Promise.all(a)]).then(function(o){let l=o[0],h=o[1];return r&&(e.morphAttributes.position=l),s&&(e.morphAttributes.normal=h),e.morphTargetsRelative=!0,e})}function XT(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){let i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function qT(e){let t=e.extensions&&e.extensions[De.KHR_DRACO_MESH_COMPRESSION],i;return t?i="draco:"+t.bufferView+":"+t.indices+":"+Ep(t.attributes):i=e.indices+":"+Ep(e.attributes)+":"+e.mode,i}function Ep(e){let t="",i=Object.keys(e).sort();for(let r=0,s=i.length;r<s;r++)t+=i[r]+":"+e[i[r]]+";";return t}function Ju(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var YT=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new TT,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new Sv(this.options.manager):this.textureLoader=new Ml(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new qi(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(n){let a={scene:n[0][r.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:r.asset,parser:i,userData:{}};_n(s,a,r),zr(a,r),Promise.all(i._invokeAll(function(o){return o.afterRoot&&o.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){let n=t[r].joints;for(let a=0,o=n.length;a<o;a++)e[n[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){let n=e[r];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(i[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let r=i.clone(),s=(n,a)=>{let o=this.associations.get(n);o!=null&&this.associations.set(a,o);for(let[l,h]of n.children.entries())s(h,a.children[l])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let r=e(t[i]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let r=0;r<t.length;r++){let s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){let i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,n){return i.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[De.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(s,n){i.load(Tp(t.uri,r.path),s,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){let r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){let t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);let s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(n){let a=n[0],o=Sp[r.type],l=Ea[r.componentType],h=l.BYTES_PER_ELEMENT,u=h*o,c=r.byteOffset||0,d=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0,f,v;if(d&&d!==u){let y=Math.floor(c/d),g="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+y+":"+r.count,m=t.cache.get(g);m||(f=new l(a,y*d,r.count*d/h),m=new rn(f,d/h),t.cache.add(g,m)),v=new ba(m,o,c%d/h,p)}else a===null?f=new l(r.count*o):f=new l(a,c,r.count*o),v=new je(f,o,p);if(r.sparse!==void 0){let y=Sp.SCALAR,g=Ea[r.sparse.indices.componentType],m=r.sparse.indices.byteOffset||0,_=r.sparse.values.byteOffset||0,x=new g(n[1],m,r.sparse.count*y),w=new l(n[2],_,r.sparse.count*o);a!==null&&(v=new je(v.array.slice(),v.itemSize,v.normalized));for(let S=0,b=x.length;S<b;S++){let R=x[S];if(v.setX(R,w[S*o]),o>=2&&v.setY(R,w[S*o+1]),o>=3&&v.setZ(R,w[S*o+2]),o>=4&&v.setW(R,w[S*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){let t=this.json,i=this.options,r=t.textures[e],s=t.images[r.source],n=this.textureLoader;if(s.uri){let a=i.manager.getHandler(s.uri);a!==null&&(n=a)}return this.loadTextureImage(e,s,n)}loadTextureImage(e,t,i){let r=this,s=this.json,n=this.options,a=s.textures[e],o=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];let l=self.URL||self.webkitURL,h=t.uri||"",u=!1;if(t.bufferView!==void 0)h=r.getDependency("bufferView",t.bufferView).then(function(d){u=!0;let p=new Blob([d],{type:t.mimeType});return h=l.createObjectURL(p),h});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let c=Promise.resolve(h).then(function(d){return new Promise(function(p,f){let v=p;i.isImageBitmapLoader===!0&&(v=function(y){let g=new ht(y);g.needsUpdate=!0,p(g)}),i.load(Tp(d,n.path),v,void 0,f)})}).then(function(d){u===!0&&l.revokeObjectURL(h),d.flipY=!1,a.name&&(d.name=a.name);let p=(s.samplers||{})[a.sampler]||{};return d.magFilter=_p[p.magFilter]||Je,d.minFilter=_p[p.minFilter]||Qi,d.wrapS=Mp[p.wrapS]||$i,d.wrapT=Mp[p.wrapT]||$i,r.associations.set(d,{textures:e}),d}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[o]=c,c}assignTexture(e,t,i){let r=this;return this.getDependency("texture",i.index).then(function(s){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),r.extensions[De.KHR_TEXTURE_TRANSFORM]){let n=i.extensions!==void 0?i.extensions[De.KHR_TEXTURE_TRANSFORM]:void 0;if(n){let a=r.associations.get(s);s=r.extensions[De.KHR_TEXTURE_TRANSFORM].extendTexture(s,n),r.associations.set(s,a)}}return e[t]=s,s})}assignFinalMaterial(e){let t=e.geometry,i=e.material,r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,n=t.attributes.normal===void 0;if(e.isPoints){let a="PointsMaterial:"+i.uuid,o=this.cache.get(a);o||(o=new Ec,lt.prototype.copy.call(o,i),o.color.copy(i.color),o.map=i.map,o.sizeAttenuation=!1,this.cache.add(a,o)),i=o}else if(e.isLine){let a="LineBasicMaterial:"+i.uuid,o=this.cache.get(a);o||(o=new sn,lt.prototype.copy.call(o,i),o.color.copy(i.color),this.cache.add(a,o)),i=o}if(r||s||n){let a="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),n&&(a+="flat-shading:");let o=this.cache.get(a);o||(o=i.clone(),s&&(o.vertexColors=!0),n&&(o.flatShading=!0),r&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(i))),i=o}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return Ji}loadMaterial(e){let t=this,i=this.json,r=this.extensions,s=i.materials[e],n,a={},o=s.extensions||{},l=[];if(o[De.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let u=r[De.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];n=u.getMaterialType(),l.push(u.extendParams(a,s,t))}else if(o[De.KHR_MATERIALS_UNLIT]){let u=r[De.KHR_MATERIALS_UNLIT];n=u.getMaterialType(),l.push(u.extendParams(a,s,t))}else{let u=s.pbrMetallicRoughness||{};if(a.color=new pe(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){let c=u.baseColorFactor;a.color.fromArray(c),a.opacity=c[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),n=this._invokeOne(function(c){return c.getMaterialType&&c.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(c){return c.extendMaterialParams&&c.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=xi);let h=s.alphaMode||wh.OPAQUE;if(h===wh.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.format=ci,a.transparent=!1,h===wh.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&n!==hi&&(l.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new K(1,1),s.normalTexture.scale!==void 0)){let u=s.normalTexture.scale;a.normalScale.set(u,u)}return s.occlusionTexture!==void 0&&n!==hi&&(l.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&n!==hi&&(a.emissive=new pe().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&n!==hi&&l.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then(function(){let u;return n===$u?u=r[De.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new n(a),s.name&&(u.name=s.name),u.map&&(u.map.encoding=Bt),u.emissiveMap&&(u.emissiveMap.encoding=Bt),zr(u,s),t.associations.set(u,{materials:e}),s.extensions&&_n(r,u,s),u})}createUniqueName(e){let t=Oe.sanitizeNodeName(e||""),i=t;for(let r=1;this.nodeNamesUsed[i];++r)i=t+"_"+r;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){let t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[De.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(o){return Ap(o,a,t)})}let n=[];for(let a=0,o=e.length;a<o;a++){let l=e[a],h=qT(l),u=r[h];if(u)n.push(u.promise);else{let c;l.extensions&&l.extensions[De.KHR_DRACO_MESH_COMPRESSION]?c=s(l):c=Ap(new Ye,l,t),r[h]={primitive:l,promise:c},n.push(c)}}return Promise.all(n)}loadMesh(e){let t=this,i=this.json,r=this.extensions,s=i.meshes[e],n=s.primitives,a=[];for(let o=0,l=n.length;o<l;o++){let h=n[o].material===void 0?WT(this.cache):this.getDependency("material",n[o].material);a.push(h)}return a.push(t.loadGeometries(n)),Promise.all(a).then(function(o){let l=o.slice(0,o.length-1),h=o[o.length-1],u=[];for(let d=0,p=h.length;d<p;d++){let f=h[d],v=n[d],y,g=l[d];if(v.mode===Ii.TRIANGLES||v.mode===Ii.TRIANGLE_STRIP||v.mode===Ii.TRIANGLE_FAN||v.mode===void 0)y=s.isSkinnedMesh===!0?new Mc(f,g):new _e(f,g),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),v.mode===Ii.TRIANGLE_STRIP?y.geometry=Rp(y.geometry,Kx):v.mode===Ii.TRIANGLE_FAN&&(y.geometry=Rp(y.geometry,Lg));else if(v.mode===Ii.LINES)y=new xl(f,g);else if(v.mode===Ii.LINE_STRIP)y=new yl(f,g);else if(v.mode===Ii.LINE_LOOP)y=new nv(f,g);else if(v.mode===Ii.POINTS)y=new av(f,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&XT(y,s),y.name=t.createUniqueName(s.name||"mesh_"+e),zr(y,s),v.extensions&&_n(r,y,v),t.assignFinalMaterial(y),u.push(y)}for(let d=0,p=u.length;d<p;d++)t.associations.set(u[d],{meshes:e,primitives:d});if(u.length===1)return u[0];let c=new Wi;t.associations.set(c,{meshes:e});for(let d=0,p=u.length;d<p;d++)c.add(u[d]);return c})}loadCamera(e){let t,i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new ft(Ko.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new rs(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),zr(t,i),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return i.inverseBindMatrices=r,i})}loadAnimation(e){let t=this.json.animations[e],i=[],r=[],s=[],n=[],a=[];for(let o=0,l=t.channels.length;o<l;o++){let h=t.channels[o],u=t.samplers[h.sampler],c=h.target,d=c.node!==void 0?c.node:c.id,p=t.parameters!==void 0?t.parameters[u.input]:u.input,f=t.parameters!==void 0?t.parameters[u.output]:u.output;i.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",p)),s.push(this.getDependency("accessor",f)),n.push(u),a.push(c)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(n),Promise.all(a)]).then(function(o){let l=o[0],h=o[1],u=o[2],c=o[3],d=o[4],p=[];for(let v=0,y=l.length;v<y;v++){let g=l[v],m=h[v],_=u[v],x=c[v],w=d[v];if(g===void 0)continue;g.updateMatrix(),g.matrixAutoUpdate=!0;let S;switch(ur[w.path]){case ur.weights:S=Sa;break;case ur.rotation:S=qr;break;case ur.position:case ur.scale:default:S=Ta;break}let b=g.name?g.name:g.uuid,R=x.interpolation!==void 0?VT[x.interpolation]:Xr,C=[];ur[w.path]===ur.weights?g.traverse(function(L){L.isMesh===!0&&L.morphTargetInfluences&&C.push(L.name?L.name:L.uuid)}):C.push(b);let D=_.array;if(_.normalized){let L=Ju(D.constructor),j=new Float32Array(D.length);for(let N=0,I=D.length;N<I;N++)j[N]=D[N]*L;D=j}for(let L=0,j=C.length;L<j;L++){let N=new S(C[L]+"."+ur[w.path],m.array,D,R);x.interpolation==="CUBICSPLINE"&&(N.createInterpolant=function(I){let H=this instanceof qr?GT:Yr;return new H(this.times,this.values,this.getValueSize()/3,I)},N.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),p.push(N)}}let f=t.name?t.name:"animation_"+e;return new qu(f,void 0,p)})}createNodeMesh(e){let t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){let n=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&n.traverse(function(a){if(a.isMesh)for(let o=0,l=r.weights.length;o<l;o++)a.morphTargetInfluences[o]=r.weights[o]}),n})}loadNode(e){let t=this.json,i=this.extensions,r=this,s=t.nodes[e],n=s.name?r.createUniqueName(s.name):"";return function(){let a=[],o=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return o&&a.push(o),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(l){return r._getNodeRef(r.cameraCache,s.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let o;if(s.isBone===!0?o=new Sc:a.length>1?o=new Wi:a.length===1?o=a[0]:o=new Fe,o!==a[0])for(let l=0,h=a.length;l<h;l++)o.add(a[l]);if(s.name&&(o.userData.name=s.name,o.name=n),zr(o,s),s.extensions&&_n(i,o,s),s.matrix!==void 0){let l=new me;l.fromArray(s.matrix),o.applyMatrix4(l)}else s.translation!==void 0&&o.position.fromArray(s.translation),s.rotation!==void 0&&o.quaternion.fromArray(s.rotation),s.scale!==void 0&&o.scale.fromArray(s.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o})}loadScene(e){let t=this.json,i=this.extensions,r=this.json.scenes[e],s=this,n=new Wi;r.name&&(n.name=s.createUniqueName(r.name)),zr(n,r),r.extensions&&_n(i,n,r);let a=r.nodes||[],o=[];for(let l=0,h=a.length;l<h;l++)o.push(Lv(a[l],n,t,s));return Promise.all(o).then(function(){let l=h=>{let u=new Map;for(let[c,d]of s.associations)(c instanceof lt||c instanceof ht)&&u.set(c,d);return h.traverse(c=>{let d=s.associations.get(c);d!=null&&u.set(c,d)}),u};return s.associations=l(n),n})}};function Lv(e,t,i,r){let s=i.nodes[e];return r.getDependency("node",e).then(function(n){if(s.skin===void 0)return n;let a;return r.getDependency("skin",s.skin).then(function(o){a=o;let l=[];for(let h=0,u=a.joints.length;h<u;h++)l.push(r.getDependency("node",a.joints[h]));return Promise.all(l)}).then(function(o){return n.traverse(function(l){if(!l.isMesh)return;let h=[],u=[];for(let c=0,d=o.length;c<d;c++){let p=o[c];if(p){h.push(p);let f=new me;a.inverseBindMatrices!==void 0&&f.fromArray(a.inverseBindMatrices.array,c*16),u.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[c])}l.bind(new sv(h,u),l.matrixWorld)}),n})}).then(function(n){t.add(n);let a=[];if(s.children){let o=s.children;for(let l=0,h=o.length;l<h;l++){let u=o[l];a.push(Lv(u,n,i,r))}}return Promise.all(a)})}function $T(e,t,i){let r=t.attributes,s=new It;if(r.POSITION!==void 0){let o=i.json.accessors[r.POSITION],l=o.min,h=o.max;if(l!==void 0&&h!==void 0){if(s.set(new E(l[0],l[1],l[2]),new E(h[0],h[1],h[2])),o.normalized){let u=Ju(Ea[o.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let n=t.targets;if(n!==void 0){let o=new E,l=new E;for(let h=0,u=n.length;h<u;h++){let c=n[h];if(c.POSITION!==void 0){let d=i.json.accessors[c.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){let v=Ju(Ea[d.componentType]);l.multiplyScalar(v)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}e.boundingBox=s;let a=new Sr;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}function Ap(e,t,i){let r=t.attributes,s=[];function n(a,o){return i.getDependency("accessor",a).then(function(l){e.setAttribute(o,l)})}for(let a in r){let o=Zu[a]||a.toLowerCase();o in e.attributes||s.push(n(r[a],o))}if(t.indices!==void 0&&!e.index){let a=i.getDependency("accessor",t.indices).then(function(o){e.setIndex(o)});s.push(a)}return zr(e,t),$T(e,t,i),Promise.all(s).then(function(){return t.targets!==void 0?jT(e,t.targets,i):e})}function Rp(e,t){let i=e.getIndex();if(i===null){let a=[],o=e.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);e.setIndex(a),i=e.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}let r=i.count-2,s=[];if(t===Lg)for(let a=1;a<=r;a++)s.push(i.getX(0)),s.push(i.getX(a)),s.push(i.getX(a+1));else for(let a=0;a<r;a++)a%2==0?(s.push(i.getX(a)),s.push(i.getX(a+1)),s.push(i.getX(a+2))):(s.push(i.getX(a+2)),s.push(i.getX(a+1)),s.push(i.getX(a)));s.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let n=e.clone();return n.setIndex(s),n}var ZT=class{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){let i=this.workersResolve[e];if(i&&i(t),this.queue.length){let{resolve:r,msg:s,transfer:n}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,n)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{let r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=i,this.workers[r].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}},JT=2,KT=1,_h=new WeakMap,ji=class extends ei{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new ZT,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}init(){if(!this.transcoderPending){let e=new qi(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=e.loadAsync("basis_transcoder.js"),i=new qi(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);let r=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([s,n])=>{let a=ji.BasisWorker.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(ji.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ji.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ji.BasisFormat),"/* basis_transcoder.js */",s,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o])),this.transcoderBinary=n,this.workerPool.setWorkerCreator(()=>{let l=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),l})})}return this.transcoderPending}load(e,t,i,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let s=new qi(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);let n=new Vu;return s.load(e,a=>{if(_h.has(a))return _h.get(a).promise.then(t).catch(r);this._createTexture([a]).then(function(o){n.copy(o),n.needsUpdate=!0,t&&t(n)}).catch(r)},i,r),n}_createTextureFrom(e){let{mipmaps:t,width:i,height:r,format:s,type:n,error:a,dfdTransferFn:o,dfdFlags:l}=e;if(n==="error")return Promise.reject(a);let h=new Vu(t,i,r,s,Jt);return h.minFilter=t.length===1?Je:Qi,h.magFilter=Je,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=o===JT?Bt:Ke,h.premultiplyAlpha=!!(l&KT),h}_createTexture(e,t={}){let i=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:i},e)).then(s=>this._createTextureFrom(s.data));return _h.set(e[0],{promise:r}),r}dispose(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),this}};ji.BasisFormat={ETC1S:0,UASTC_4x4:1};ji.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};ji.EngineFormat={RGBAFormat:ot,RGBA_ASTC_4x4_Format:Eg,RGBA_BPTC_Format:Ag,RGBA_ETC2_EAC_Format:ku,RGBA_PVRTC_4BPPV1_Format:Fu,RGBA_S3TC_DXT5_Format:Nu,RGB_ETC1_Format:Tg,RGB_ETC2_Format:Uu,RGB_PVRTC_4BPPV1_Format:Ou,RGB_S3TC_DXT1_Format:Du};ji.BasisWorker=function(){let e,t,i,r=_EngineFormat,s=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",function(p){let f=p.data;switch(f.type){case"init":e=f.config,a(f.transcoderBinary);break;case"transcode":t.then(()=>{try{let{width:v,height:y,hasAlpha:g,mipmaps:m,format:_,dfdTransferFn:x,dfdFlags:w}=o(f.buffers[0]),S=[];for(let b=0;b<m.length;++b)S.push(m[b].data.buffer);self.postMessage({type:"transcode",id:f.id,width:v,height:y,hasAlpha:g,mipmaps:m,format:_,dfdTransferFn:x,dfdFlags:w},S)}catch(v){console.error(v),self.postMessage({type:"error",id:f.id,error:v.message})}});break}});function a(p){t=new Promise(f=>{i={wasmBinary:p,onRuntimeInitialized:f},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function o(p){let f=new i.KTX2File(new Uint8Array(p));function v(){f.close(),f.delete()}if(!f.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let y=f.isUASTC()?n.UASTC_4x4:n.ETC1S,g=f.getWidth(),m=f.getHeight(),_=f.getLevels(),x=f.getHasAlpha(),w=f.getDFDTransferFunc(),S=f.getDFDFlags(),{transcoderFormat:b,engineFormat:R}=c(y,g,m,x);if(!g||!m||!_)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!f.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");let C=[];for(let D=0;D<_;D++){let L=f.getImageLevelInfo(D,0,0),j=L.origWidth,N=L.origHeight,I=new Uint8Array(f.getImageTranscodedSizeInBytes(D,0,0,b));if(!f.transcodeImage(I,D,0,0,b,0,-1,-1))throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");C.push({data:I,width:j,height:N})}return v(),{width:g,height:m,hasAlpha:x,mipmaps:C,format:R,dfdTransferFn:w,dfdFlags:S}}let l=[{if:"astcSupported",basisFormat:[n.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC1],engineFormat:[r.RGB_ETC1_Format,r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=l.sort(function(p,f){return p.priorityETC1S-f.priorityETC1S}),u=l.sort(function(p,f){return p.priorityUASTC-f.priorityUASTC});function c(p,f,v,y){let g,m,_=p===n.ETC1S?h:u;for(let x=0;x<_.length;x++){let w=_[x];if(!!e[w.if]&&!!w.basisFormat.includes(p)&&!(w.needsPowerOfTwo&&!(d(f)&&d(v))))return g=w.transcoderFormat[y?1:0],m=w.engineFormat[y?1:0],{transcoderFormat:g,engineFormat:m}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),g=s.RGBA32,m=r.RGBAFormat,{transcoderFormat:g,engineFormat:m}}function d(p){return p<=2?!0:(p&p-1)==0&&p!==0}};var Lp,Cp,ai=Symbol("retainerCount"),Di=Symbol("recentlyUsed"),mo=Symbol("evict"),Mn=Symbol("evictionThreshold"),Mh=Symbol("cache"),QT=class{constructor(e,t=5){this[Lp]=new Map,this[Cp]=[],this[Mh]=e,this[Mn]=t}set evictionThreshold(e){this[Mn]=e,this[mo]()}get evictionThreshold(){return this[Mn]}get cache(){return this[Mh]}retainerCount(e){return this[ai].get(e)||0}reset(){this[ai].clear(),this[Di]=[]}retain(e){this[ai].has(e)||this[ai].set(e,0),this[ai].set(e,this[ai].get(e)+1);let t=this[Di].indexOf(e);t!==-1&&this[Di].splice(t,1),this[Di].unshift(e),this[mo]()}release(e){this[ai].has(e)&&this[ai].set(e,Math.max(this[ai].get(e)-1,0)),this[mo]()}[(Lp=ai,Cp=Di,mo)](){if(!(this[Di].length<this[Mn]))for(let e=this[Di].length-1;e>=this[Mn];--e){let t=this[Di][e];this[ai].get(t)===0&&(this[Mh].delete(t),this[Di].splice(e,1))}}},eE=e=>{let t=[],i=new Set;for(let r of e){let s=r,n=0;for(;i.has(s);)s=r+"."+ ++n;i.add(s),t.push(s)}return t},tE=(e,t)=>{let i=new Map;for(let r of e.mappings)for(let s of r.variants)i.set(t[s],{material:null,gltfMaterialIndex:r.material});return i},iE=class{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){let t=this.parser,i=t.json;if(i.extensions===void 0||i.extensions[this.name]===void 0)return null;let r=i.extensions[this.name].variants||[],s=eE(r.map(n=>n.name));for(let n of e.scenes)n.traverse(a=>{let o=t.associations.get(a);if(o==null||o.meshes==null)return;let l=o.meshes,h=i.meshes[l].primitives,u="isMesh"in a?[a]:a.children;for(let c=0;c<h.length;c++){let d=h[c].extensions;!d||!d[this.name]||(u[c].userData.variantMaterials=tE(d[this.name],s))}});return e.userData.variants=s,Promise.resolve()}},Cv,Pp,rE=(e,t,i=()=>{})=>{let r=s=>{let n=s.loaded/s.total;i(Math.max(0,Math.min(1,isFinite(n)?n:1)))};return new Promise((s,n)=>{t.load(e,s,r,n)})},sE=e=>new Promise((t,i)=>{let r=document.createElement("script");document.body.appendChild(r),r.onload=t,r.onerror=i,r.async=!0,r.src=e}),Ni=new Map,Sh=new Map,Ip,Dp=new _T,Np,Th=new ji,Eh,Ah,Fs=Symbol("loader"),mr=Symbol("evictionPolicy"),Op=Symbol("GLTFInstance"),Et=class extends Ht{constructor(e){super(),this[Pp]=new ST().register(t=>new iE(t)),this[Op]=e,this[Fs].setDRACOLoader(Dp),this[Fs].setKTX2Loader(Th)}static setDRACODecoderLocation(e){Ip=e,Dp.setDecoderPath(e)}static getDRACODecoderLocation(){return Ip}static setKTX2TranscoderLocation(e){Np=e,Th.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return Np}static setMeshoptDecoderLocation(e){Eh!==e&&(Eh=e,Ah=sE(e).then(()=>MeshoptDecoder.ready).then(()=>MeshoptDecoder))}static getMeshoptDecoderLocation(){return Eh}static initializeKTX2Loader(e){Th.detectSupport(e)}static get cache(){return Ni}static clearCache(){Ni.forEach((e,t)=>{this.delete(t)}),this[mr].reset()}static has(e){return Ni.has(e)}static async delete(e){if(!this.has(e))return;let t=Ni.get(e);Sh.delete(e),Ni.delete(e),(await t).dispose()}static hasFinishedLoading(e){return!!Sh.get(e)}get[(Cv=mr,Pp=Fs,mr)](){return this.constructor[mr]}async preload(e,t,i=()=>{}){if(this.dispatchEvent({type:"preload",element:t,src:e}),!Ni.has(e)){Ah!=null&&this[Fs].setMeshoptDecoder(await Ah);let r=rE(e,this[Fs],a=>{i(a*.8)}),s=this[Op],n=r.then(a=>s.prepare(a)).then(a=>(i(.9),new s(a)));Ni.set(e,n)}await Ni.get(e),Sh.set(e,!0),i&&i(1)}async load(e,t,i=()=>{}){await this.preload(e,t,i);let r=await(await Ni.get(e)).clone();return this[mr].retain(e),r.dispose=(()=>{let s=r.dispose,n=!1;return()=>{n||(n=!0,s.apply(r),this[mr].release(e))}})(),r}};Et[Cv]=new QT(Et);var Pv=class extends Fe{constructor(e){super(),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}};Pv.prototype.isCSS2DObject=!0;var cr=new E,Fp=new me,Up=new me,kp=new E,zp=new E,nE=class{constructor(){let e=this,t,i,r,s,n={objects:new WeakMap},a=document.createElement("div");a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:t,height:i}},this.render=function(c,d){c.autoUpdate===!0&&c.updateMatrixWorld(),d.parent===null&&d.updateMatrixWorld(),Fp.copy(d.matrixWorldInverse),Up.multiplyMatrices(d.projectionMatrix,Fp),o(c,c,d),u(c)},this.setSize=function(c,d){t=c,i=d,r=t/2,s=i/2,a.style.width=c+"px",a.style.height=d+"px"};function o(c,d,p){if(c.isCSS2DObject){c.onBeforeRender(e,d,p),cr.setFromMatrixPosition(c.matrixWorld),cr.applyMatrix4(Up);let f=c.element;/apple/i.test(navigator.vendor)?f.style.transform="translate(-50%,-50%) translate("+Math.round(cr.x*r+r)+"px,"+Math.round(-cr.y*s+s)+"px)":f.style.transform="translate(-50%,-50%) translate("+(cr.x*r+r)+"px,"+(-cr.y*s+s)+"px)",f.style.display=c.visible&&cr.z>=-1&&cr.z<=1?"":"none";let v={distanceToCameraSquared:l(p,c)};n.objects.set(c,v),f.parentNode!==a&&a.appendChild(f),c.onAfterRender(e,d,p)}for(let f=0,v=c.children.length;f<v;f++)o(c.children[f],d,p)}function l(c,d){return kp.setFromMatrixPosition(c.matrixWorld),zp.setFromMatrixPosition(d.matrixWorld),kp.distanceToSquared(zp)}function h(c){let d=[];return c.traverse(function(p){p.isCSS2DObject&&d.push(p)}),d}function u(c){let d=h(c).sort(function(f,v){let y=n.objects.get(f).distanceToCameraSquared,g=n.objects.get(v).distanceToCameraSquared;return y-g}),p=d.length;for(let f=0,v=d.length;f<v;f++)d[f].element.style.zIndex=p-f}}},Iv=e=>!!e&&e!=="null"?aE(e):null,Bp=()=>{if(fg)return;let e=[];throw pg||e.push("WebXR Device API"),mg||e.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${e.join(", ")}`)},aE=e=>new URL(e,window.location.toString()).toString(),oE=(e,t)=>{let i=null,r=(...s)=>{i==null&&(e(...s),i=self.setTimeout(()=>i=null,t))};return r.flush=()=>{i!=null&&(self.clearTimeout(i),i=null)},r},Ku=(e,t)=>{let i=null;return(...r)=>{i!=null&&self.clearTimeout(i),i=self.setTimeout(()=>{i=null,e(...r)},t)}},Hr=(e,t,i)=>Math.max(t,Math.min(i,e)),lE=1,Qu=(()=>{let e=(()=>{let t=document.head!=null?Array.from(document.head.querySelectorAll("meta")):[];for(let i of t)if(i.name==="viewport")return!0;return!1})();return e||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),()=>e?window.devicePixelRatio:lE})(),Dv=(()=>{let e="model-viewer-debug-mode",t=new RegExp(`[?&]${e}(&|$)`);return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(t)})(),hE=e=>{if(e.keys!=null)return e.keys().next().value||null;let t=null;try{e.forEach((i,r,s)=>{throw t=r,new Error})}catch{}return t},Nv=(e=0)=>new Promise(t=>setTimeout(t,e)),uE=(e,t,i=null)=>new Promise(r=>{function s(n){(!i||i(n))&&(r(n),e.removeEventListener(t,s))}e.addEventListener(t,s)}),Ov=1e4,cE=.001,Fv=50,kt=class{constructor(e=Fv){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(cE,e)}update(e,t,i,r){let s=2e-4*this.naturalFrequency;if(e==null||r===0||e===t&&this.velocity===0)return t;if(i<0)return e;let n=e-t,a=this.velocity+this.naturalFrequency*n,o=n+i*a,l=Math.exp(-this.naturalFrequency*i),h=(a-this.naturalFrequency*o)*l,u=-this.naturalFrequency*(h+a*l);return Math.abs(h)<s*Math.abs(r)&&u*n>=0?(this.velocity=0,t):(this.velocity=h,t+o*l)}},gt=(e,t)=>({type:"number",number:e,unit:t}),$r=(()=>{let e={},t=1e3;return i=>{let r=i;if(r in e)return e[r];let s=[],n=0;for(;i;){if(++n>t){i="";break}let a=Uv(i),o=a.nodes[0];if(o==null||o.terms.length===0)break;s.push(o),i=a.remainingInput}return e[r]=s}})(),Uv=(()=>{let e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/,r="(",s="#";return n=>{let a=[];for(;n.length&&(n=n.trim(),!i.test(n));)if(n[0]===r){let{nodes:o,remainingInput:l}=Hp(n);n=l,a.push({type:"function",name:{type:"ident",value:"calc"},arguments:o})}else if(e.test(n)){let o=dE(n),l=o.nodes[0];if(n=o.remainingInput,n[0]===r){let{nodes:h,remainingInput:u}=Hp(n);a.push({type:"function",name:l,arguments:h}),n=u}else a.push(l)}else if(t.test(n))a.push({type:"operator",value:n[0]}),n=n.slice(1);else{let{nodes:o,remainingInput:l}=n[0]===s?mE(n):pE(n);if(o.length===0)break;a.push(o[0]),n=l}return{nodes:[{type:"expression",terms:a}],remainingInput:n}}})(),dE=(()=>{let e=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{let i=t.match(e),r=i==null?t:t.substr(0,i.index),s=i==null?"":t.substr(i.index);return{nodes:[{type:"ident",value:r}],remainingInput:s}}})(),pE=(()=>{let e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return r=>{let s=r.match(e),n=s==null?"0":s[0];r=n==null?r:r.slice(n.length);let a=r.match(t),o=a!=null&&a[0]!==""?a[0]:null,l=a==null?r:r.slice(o.length);return o!=null&&!i.test(o)&&(o=null),{nodes:[{type:"number",number:parseFloat(n)||0,unit:o}],remainingInput:l}}})(),mE=(()=>{let e=/^[a-f0-9]*/i;return t=>{t=t.slice(1).trim();let i=t.match(e);return{nodes:i==null?[]:[{type:"hex",value:i[0]}],remainingInput:i==null?t:t.slice(i[0].length)}}})(),Hp=e=>{let t=[];for(e=e.slice(1).trim();e.length;){let i=Uv(e);if(t.push(i.nodes[0]),e=i.remainingInput.trim(),e[0]===",")e=e.slice(1).trim();else if(e[0]===")"){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},Gp=Symbol("visitedTypes"),fE=class{constructor(e){this[Gp]=e}walk(e,t){let i=e.slice();for(;i.length;){let r=i.shift();switch(this[Gp].indexOf(r.type)>-1&&t(r),r.type){case"expression":i.unshift(...r.terms);break;case"function":i.unshift(r.name,...r.arguments);break}}}},Mr=Object.freeze({type:"number",number:0,unit:null}),Al=(e,t=0)=>{let{number:i,unit:r}=e;if(!isFinite(i))i=t,r="rad";else if(e.unit==="rad"||e.unit==null)return e;let s=(r==="deg"&&i!=null?i:0)*Math.PI/180;return{type:"number",number:s,unit:"rad"}},Vp=(e,t=0)=>{let{number:i,unit:r}=e;if(!isFinite(i))i=t,r="m";else if(e.unit==="m")return e;let s;switch(r){default:s=1;break;case"cm":s=1/100;break;case"mm":s=1/1e3;break}let n=s*i;return{type:"number",number:n,unit:"m"}},yi=(()=>{let e=i=>i,t={rad:e,deg:Al,m:e,mm:Vp,cm:Vp};return(i,r=Mr)=>{isFinite(i.number)||(i.number=r.number,i.unit=r.unit);let{unit:s}=i;if(s==null)return i;let n=t[s];return n==null?r:n(i)}})(),kv=class extends Pv{constructor(e){super(document.createElement("div")),this.normal=new E(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal)}get facingCamera(){return!this.element.classList.contains("hide")}show(){(!this.facingCamera||!this.initialized)&&this.updateVisibility(!0)}hide(){(this.facingCamera||!this.initialized)&&this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,this.referenceCount===0}updatePosition(e){if(e==null)return;let t=$r(e)[0].terms;for(let i=0;i<3;++i)this.position.setComponent(i,yi(t[i]).number);this.updateMatrixWorld()}updateNormal(e){if(e==null)return;let t=$r(e)[0].terms;for(let i=0;i<3;++i)this.normal.setComponent(i,yi(t[i]).number)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){e?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach(t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;let i=t,r=i.dataset.visibilityAttribute;if(r!=null){let s=`data-${r}`;e?i.setAttribute(s,""):i.removeAttribute(s)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))}),this.initialized=!0}},gE=e=>{if(!e.normalized)return 1;let t=e.array;return t instanceof Int8Array?1/127:t instanceof Uint8Array?1/255:t instanceof Int16Array?1/32767:t instanceof Uint16Array?1/65535:1},Rh=(e,t,i)=>{let r=i,s=new E;return e.traverse(n=>{let a,o;n.updateWorldMatrix(!1,!1);let l=n.geometry;if(l!==void 0){if(l.isGeometry){let h=l.vertices;for(a=0,o=h.length;a<o;a++)s.copy(h[a]),s.applyMatrix4(n.matrixWorld),r=t(r,s)}else if(l.isBufferGeometry){let{position:h}=l.attributes;if(h!==void 0){let u=gE(h);for(a=0,o=h.count;a<o;a++)s.fromBufferAttribute(h,a),s.multiplyScalar(u),s.applyMatrix4(n.matrixWorld),r=t(r,s)}}}}),r},Wp=.002,jp=9,vE=6,Xp=2,yE=class extends Tl{constructor(e,t,i){super(),this.shadowMaterial=new gv,this.boundingBox=new It,this.size=new E,this.shadowScale=1,this.isAnimated=!1,this.side="bottom",this.needsUpdate=!1,this.intensity=0,this.castShadow=!0,this.frustumCulled=!1,this.floor=new _e(new is,this.shadowMaterial),this.floor.rotateX(-Math.PI/2),this.floor.receiveShadow=!0,this.floor.castShadow=!1,this.floor.frustumCulled=!1,this.add(this.floor),e.target.add(this),this.target=e.target,this.setScene(e,t,i)}setScene(e,t,i){if(this.side=i,this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.side==="back"){let{min:a,max:o}=this.boundingBox;[a.y,a.z]=[a.z,a.y],[o.y,o.z]=[o.z,o.y],[this.size.y,this.size.z]=[this.size.z,this.size.y],this.rotation.x=Math.PI/2,this.rotation.y=Math.PI}else this.rotation.x=0,this.rotation.y=0;let{boundingBox:r,size:s}=this;if(this.isAnimated){let a=Math.max(s.x,s.y,s.z)*Xp;s.y=a,r.expandByVector(s.subScalar(a).multiplyScalar(-.5)),r.max.y=r.min.y+a,s.set(a,a,a)}r.getCenter(this.floor.position);let n=r.max.y+s.y*Wp;i==="bottom"?(this.position.y=n,this.position.z=0):(this.position.y=0,this.position.z=n),this.setSoftness(t)}setSoftness(e){let t=Math.pow(2,jp-e*(jp-vE));this.setMapSize(t)}setMapSize(e){let{camera:t,mapSize:i,map:r}=this.shadow,{size:s,boundingBox:n}=this;r!=null&&(r.dispose(),this.shadow.map=null),this.isAnimated&&(e*=Xp);let a=Math.floor(s.x>s.z?e:e*s.x/s.z),o=Math.floor(s.x>s.z?e*s.z/s.x:e);i.set(a,o);let l=2.5*s.x/a,h=2.5*s.z/o;t.left=-n.max.x-l,t.right=-n.min.x+l,t.bottom=n.min.z-h,t.top=n.max.z+h,this.setScaleAndOffset(this.shadowScale,0),this.floor.scale.set(s.x+2*l,s.z+2*h,1),this.needsUpdate=!0,this.shadow.needsUpdate=!0}setIntensity(e){this.shadowMaterial.opacity=e,e>0?(this.visible=!0,this.floor.visible=!0):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.shadowMaterial.opacity}setRotation(e){if(this.side!=="bottom"){this.shadow.camera.up.set(0,1,0),this.shadow.updateMatrices(this);return}this.shadow.camera.up.set(Math.sin(e),0,Math.cos(e)),this.shadow.updateMatrices(this)}setScaleAndOffset(e,t){let i=this.size.y,{camera:r}=this.shadow;this.shadowScale=e,r.near=0,r.far=i-t/e,r.updateProjectionMatrix(),r.scale.setScalar(e);let s=i*Wp;this.floor.position.y=2*s-r.far}},zv=45,Bv=zv/2*Math.PI/180,ec=Math.sin(Bv),qp=Math.tan(Bv),Lh=new E,Yp=new E,$p=new E,xE=new vT,bE=new E,Sn=new K,wE=class extends bi{constructor({canvas:e,element:t,width:i,height:r}){super(),this.context=null,this.annotationRenderer=new nE,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.renderCount=0,this.externalRenderer=null,this.camera=new ft(45,1,.1,100),this.xrCamera=null,this.url=null,this.target=new Fe,this.modelContainer=new Fe,this.animationNames=[],this.boundingBox=new It,this.size=new E,this.idealCameraDistance=0,this.fieldOfViewAspect=0,this.framedFieldOfView=zv,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this.canScale=!0,this.tightBounds=!1,this.isDirty=!1,this.goalTarget=new E,this.targetDamperX=new kt,this.targetDamperY=new kt,this.targetDamperZ=new kt,this._currentGLTF=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.name="ModelScene",this.element=t,this.canvas=e,this.camera=new ft(45,1,.1,100),this.camera.name="MainCamera",this.add(this.target),this.setSize(i,r),this.target.name="Target",this.modelContainer.name="ModelContainer",this.target.add(this.modelContainer),this.mixer=new Tv(this.modelContainer);let{domElement:s}=this.annotationRenderer,{style:n}=s;n.display="none",n.pointerEvents="none",n.position="absolute",n.top="0",this.element.shadowRoot.querySelector(".default").appendChild(s),this.schemaElement.setAttribute("type","application/ld+json")}createContext(){this.context=this.canvas.getContext("2d")}getCamera(){return this.xrCamera!=null?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}async setObject(e){this.reset(),this.modelContainer.add(e),await this.setupScene()}async setSource(e,t=()=>{}){if(!e||e===this.url){t(1);return}if(this.reset(),this.url=e,this.externalRenderer!=null){let a=await this.externalRenderer.load(t);this.idealCameraDistance=a.framedRadius/ec,this.fieldOfViewAspect=a.fieldOfViewAspect,this.frameModel(),this.dispatchEvent({type:"model-load",url:this.url});return}this.cancelPendingSourceChange!=null&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);let i;try{i=await new Promise(async(a,o)=>{this.cancelPendingSourceChange=()=>o();try{let l=await this.element[Be].loader.load(e,this.element,t);a(l)}catch(l){o(l)}})}catch(a){if(a==null)return;throw a}this.reset(),this.url=e,this._currentGLTF=i,i!=null&&this.modelContainer.add(i.scene);let{animations:r}=i,s=new Map,n=[];for(let a of r)s.set(a.name,a),n.push(a.name);this.animations=r,this.animationsByName=s,this.animationNames=n,await this.setupScene()}async setupScene(){this.updateBoundingBox();let e=null;this.tightBounds===!0&&(await this.element.requestUpdate("cameraTarget"),e=this.getTarget()),this.updateFraming(e),this.frameModel(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.dispatchEvent({type:"model-load",url:this.url})}reset(){this.url=null,this.queueRender(),this.shadow!=null&&this.shadow.setIntensity(0);let e=this._currentGLTF;if(e!=null){for(let t of this.modelContainer.children)this.modelContainer.remove(t);e.dispose(),this._currentGLTF=null}this.currentAnimationAction!=null&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(!(this.width===e&&this.height===t)){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,this.frameModel(),this.externalRenderer!=null){let i=Qu();this.externalRenderer.resize(e*i,t*i)}this.queueRender()}}updateBoundingBox(){if(this.target.remove(this.modelContainer),this.tightBounds===!0){let e=(t,i)=>t.expandByPoint(i);this.boundingBox=Rh(this.modelContainer,e,new It)}else this.boundingBox.setFromObject(this.modelContainer);this.boundingBox.getSize(this.size),this.target.add(this.modelContainer)}updateFraming(e=null){this.target.remove(this.modelContainer),e==null&&(e=this.boundingBox.getCenter(new E));let t=(s,n)=>Math.max(s,e.distanceToSquared(n)),i=Math.sqrt(Rh(this.modelContainer,t,0));this.idealCameraDistance=i/ec;let r=(s,n)=>{n.sub(e);let a=Math.sqrt(n.x*n.x+n.z*n.z);return Math.max(s,a/(this.idealCameraDistance-Math.abs(n.y)))};this.fieldOfViewAspect=Rh(this.modelContainer,r,0)/qp,this.target.add(this.modelContainer)}frameModel(){let e=qp*Math.max(1,this.fieldOfViewAspect/this.aspect);this.framedFieldOfView=2*Math.atan(e)*180/Math.PI}getNDC(e,t){if(this.xrCamera!=null)Sn.set(e/window.screen.width,t/window.screen.height);else{let i=this.element.getBoundingClientRect();Sn.set((e-i.x)/this.width,(t-i.y)/this.height)}return Sn.multiplyScalar(2).subScalar(1),Sn.y*=-1,Sn}getSize(){return{width:this.width,height:this.height}}setTarget(e,t,i){this.goalTarget.set(-e,-t,-i)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return bE.copy(this.goalTarget).multiplyScalar(-1)}jumpToGoal(){this.updateTarget(Ov)}updateTarget(e){let t=this.goalTarget,i=this.target.position;if(!t.equals(i)){let r=this.idealCameraDistance,{x:s,y:n,z:a}=i;s=this.targetDamperX.update(s,t.x,e,r),n=this.targetDamperY.update(n,t.y,e,r),a=this.targetDamperZ.update(a,t.z,e,r),this.target.position.set(s,n,a),this.target.updateMatrixWorld(),this.setShadowRotation(this.yaw),this.queueRender()}}pointTowards(e,t){let{x:i,z:r}=this.position;this.yaw=Math.atan2(e-i,t-r)}set yaw(e){this.rotation.y=e,this.updateMatrixWorld(!0),this.setShadowRotation(e),this.queueRender()}get yaw(){return this.rotation.y}set animationTime(e){this.mixer.setTime(e)}get animationTime(){return this.currentAnimationAction!=null?this.currentAnimationAction.time:0}get duration(){return this.currentAnimationAction!=null&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return this.currentAnimationAction!=null}playAnimation(e=null,t=0){if(this._currentGLTF==null)return;let{animations:i}=this;if(i==null||i.length===0){console.warn("Cannot play animation (model does not have any animations)");return}let r=null;e!=null&&(r=this.animationsByName.get(e)),r==null&&(r=i[0]);try{let{currentAnimationAction:s}=this,n=this.mixer.clipAction(r,this);this.currentAnimationAction=n,this.element.paused?this.mixer.stopAllAction():s!=null&&n!==s&&n.crossFadeFrom(s,t,!1),n.enabled=!0,n.play()}catch(s){console.error(s)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e)}updateShadow(){let e=this.shadow;if(e!=null){let t=this.element.arPlacement==="wall"?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.setRotation(this.yaw)}}setShadowIntensity(e){if(this.shadowIntensity=e,this._currentGLTF!=null&&!(e<=0&&this.shadow==null)){if(this.shadow==null){let t=this.element.arPlacement==="wall"?"back":"bottom";this.shadow=new yE(this,this.shadowSoftness,t),this.shadow.setRotation(this.yaw)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;let t=this.shadow;t!=null&&t.setSoftness(e)}setShadowRotation(e){let t=this.shadow;t!=null&&t.setRotation(e)}isShadowDirty(){let e=this.shadow;if(e==null)return!1;{let{needsUpdate:t}=e;return e.needsUpdate=!1,t}}setShadowScaleAndOffset(e,t){let i=this.shadow;i!=null&&i.setScaleAndOffset(e,t)}get raycaster(){return xE}positionAndNormalFromPoint(e,t=this){this.raycaster.setFromCamera(e,this.getCamera());let i=this.raycaster.intersectObject(t,!0);if(i.length===0)return null;let r=i[0];return r.face==null?null:(r.face.normal.applyNormalMatrix(new ct().getNormalMatrix(r.object.matrixWorld)),{position:r.point,normal:r.face.normal})}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element)}removeHotspot(e){this.target.remove(e)}forHotspots(e){let{children:t}=this.target;for(let i=0,r=t.length;i<r;i++){let s=t[i];s instanceof kv&&e(s)}}updateHotspots(e){this.forHotspots(t=>{Lh.copy(e),Yp.setFromMatrixPosition(t.matrixWorld),Lh.sub(Yp),$p.copy(t.normal).transformDirection(this.target.matrixWorld),Lh.dot($p)<0?t.hide():t.show()})}orientHotspots(e){this.forHotspots(t=>{t.orient(e)})}setHotspotsVisibility(e){this.forHotspots(t=>{t.visible=e})}updateSchema(e){var t;let{schemaElement:i,element:r}=this,{alt:s,poster:n,iosSrc:a}=r;if(e!=null){let o=[{"@type":"MediaObject",contentUrl:e,encodingFormat:((t=e.split(".").pop())===null||t===void 0?void 0:t.toLowerCase())==="gltf"?"model/gltf+json":"model/gltf-binary"}];a&&o.push({"@type":"MediaObject",contentUrl:a,encodingFormat:"model/vnd.usdz+zip"});let l={"@context":"http://schema.org/","@type":"3DModel",image:n!=null?n:void 0,name:s!=null?s:void 0,encoding:o};i.textContent=JSON.stringify(l),document.head.appendChild(i)}else i.parentElement!=null&&i.parentElement.removeChild(i)}},Us=_E(),Ch=new _e(new is(2,2),Us),Zp=new rs(0,1,0,1,0,1),Wt=null,oi=null,Jp=class{constructor(e){oi=e,oi.compile(Ch,Zp)}generateMipmaps(e){if(!("roughnessMap"in e))return;let{roughnessMap:t,normalMap:i}=e;if(t===null||i===null||!t.generateMipmaps||e.userData.roughnessUpdated)return;e.userData.roughnessUpdated=!0;let r=Math.max(t.image.width,i.image.width),s=Math.max(t.image.height,i.image.height);if(!Ko.isPowerOfTwo(r)||!Ko.isPowerOfTwo(s))return;let n=oi.getRenderTarget(),a=oi.autoClear;if(oi.autoClear=!1,(Wt===null||Wt.width!==r||Wt.height!==s)&&(Wt!==null&&Wt.dispose(),Wt=new Ot(r,s,{depthBuffer:!1}),Wt.scissorTest=!0),r!==t.image.width||s!==t.image.height){let h={wrapS:t.wrapS,wrapT:t.wrapT,magFilter:t.magFilter,minFilter:t.minFilter,depthBuffer:!1},u=new Ot(r,s,h);u.texture.generateMipmaps=!0,oi.setRenderTarget(u),e.roughnessMap=u.texture,e.metalnessMap==t&&(e.metalnessMap=e.roughnessMap),e.aoMap==t&&(e.aoMap=e.roughnessMap),e.roughnessMap.offset.copy(t.offset),e.roughnessMap.repeat.copy(t.repeat),e.roughnessMap.center.copy(t.center),e.roughnessMap.rotation=t.rotation,e.roughnessMap.matrixAutoUpdate=t.matrixAutoUpdate,e.roughnessMap.matrix.copy(t.matrix)}Us.uniforms.roughnessMap.value=t,Us.uniforms.normalMap.value=i;let o=new K(0,0),l=Us.uniforms.texelSize.value;for(let h=0;r>=1&&s>=1;++h,r/=2,s/=2)l.set(1/r,1/s),h==0&&l.set(0,0),Wt.viewport.set(o.x,o.y,r,s),Wt.scissor.set(o.x,o.y,r,s),oi.setRenderTarget(Wt),oi.render(Ch,Zp),oi.copyFramebufferToTexture(o,e.roughnessMap,h),Us.uniforms.roughnessMap.value=e.roughnessMap;t!==e.roughnessMap&&t.dispose(),oi.setRenderTarget(n),oi.autoClear=a}dispose(){Us.dispose(),Ch.geometry.dispose(),Wt!=null&&Wt.dispose()}};function _E(){let e=new La({uniforms:{roughnessMap:{value:null},normalMap:{value:null},texelSize:{value:new K(1,1)}},vertexShader:`
			precision mediump float;
			precision mediump int;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {

				vUv = uv;

				gl_Position = vec4( position, 1.0 );

			}
		`,fragmentShader:`
			precision mediump float;
			precision mediump int;

			varying vec2 vUv;

			uniform sampler2D roughnessMap;
			uniform sampler2D normalMap;
			uniform vec2 texelSize;

			#define ENVMAP_TYPE_CUBE_UV

			vec4 envMapTexelToLinear( vec4 a ) { return a; }

			#include <cube_uv_reflection_fragment>

			float roughnessToVariance( float roughness ) {

				float variance = 0.0;

				if ( roughness >= r1 ) {

					variance = ( r0 - roughness ) * ( v1 - v0 ) / ( r0 - r1 ) + v0;

				} else if ( roughness >= r4 ) {

					variance = ( r1 - roughness ) * ( v4 - v1 ) / ( r1 - r4 ) + v1;

				} else if ( roughness >= r5 ) {

					variance = ( r4 - roughness ) * ( v5 - v4 ) / ( r4 - r5 ) + v4;

				} else {

					float roughness2 = roughness * roughness;

					variance = 1.79 * roughness2 * roughness2;

				}

				return variance;

			}

			float varianceToRoughness( float variance ) {

				float roughness = 0.0;

				if ( variance >= v1 ) {

					roughness = ( v0 - variance ) * ( r1 - r0 ) / ( v0 - v1 ) + r0;

				} else if ( variance >= v4 ) {

					roughness = ( v1 - variance ) * ( r4 - r1 ) / ( v1 - v4 ) + r1;

				} else if ( variance >= v5 ) {

					roughness = ( v4 - variance ) * ( r5 - r4 ) / ( v4 - v5 ) + r4;

				} else {

					roughness = pow( 0.559 * variance, 0.25 ); // 0.559 = 1.0 / 1.79

				}

				return roughness;

			}

			void main() {

				gl_FragColor = texture2D( roughnessMap, vUv, - 1.0 );

				if ( texelSize.x == 0.0 ) return;

				float roughness = gl_FragColor.g;

				float variance = roughnessToVariance( roughness );

				vec3 avgNormal;

				for ( float x = - 1.0; x < 2.0; x += 2.0 ) {

					for ( float y = - 1.0; y < 2.0; y += 2.0 ) {

						vec2 uv = vUv + vec2( x, y ) * 0.25 * texelSize;

						avgNormal += normalize( texture2D( normalMap, uv, - 1.0 ).xyz - 0.5 );

					}

				}

				variance += 1.0 - 0.25 * length( avgNormal );

				gl_FragColor.g = varianceToRoughness( variance );

			}
		`,blending:vi,depthTest:!1,depthWrite:!1});return e.type="RoughnessMipmapper",e}var Tn=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},ME=.1,SE=0,TE=1,EE=1,En=Symbol("currentEnvironmentMap"),fo=Symbol("applyEnvironmentMap"),Uo=Symbol("updateEnvironment"),An=Symbol("cancelEnvironmentUpdate"),Ph=Symbol("onPreload"),AE=e=>{var t,i,r;class s extends e{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=SE,this.shadowSoftness=TE,this.exposure=EE,this[t]=null,this[i]=null,this[r]=a=>{a.element===this&&this[Uo]()}}connectedCallback(){super.connectedCallback(),this[Be].loader.addEventListener("preload",this[Ph])}disconnectedCallback(){super.disconnectedCallback(),this[Be].loader.removeEventListener("preload",this[Ph])}updated(a){super.updated(a),a.has("shadowIntensity")&&(this[ie].setShadowIntensity(this.shadowIntensity*ME),this[Rt]()),a.has("shadowSoftness")&&(this[ie].setShadowSoftness(this.shadowSoftness),this[Rt]()),a.has("exposure")&&(this[ie].exposure=this.exposure,this[Rt]()),(a.has("environmentImage")||a.has("skyboxImage"))&&this[Zr]()&&this[Uo]()}[(t=En,i=An,r=Ph,Mi)](){super[Mi](),this[En]!=null&&this[fo](this[En])}async[Uo](){let{skyboxImage:a,environmentImage:o}=this;this[An]!=null&&(this[An](),this[An]=null);let{textureUtils:l}=this[Be];if(l!=null)try{let{environmentMap:h,skybox:u}=await new Promise(async(c,d)=>{let p=l.generateEnvironmentMapAndSkybox(Iv(a),o,{progressTracker:this[Js]});this[An]=()=>d(p),c(await p)});u!=null?this[ie].background=u.name===h.name?h:u:this[ie].background=null,this[fo](h),this[ie].dispatchEvent({type:"envmap-update"})}catch(h){if(h instanceof Error)throw this[fo](null),h}}[fo](a){this[ie].environment!==a&&(this[En]=a,this[ie].environment=this[En],this.dispatchEvent(new CustomEvent("environment-change")),this[Rt]())}}return Tn([Ae({type:String,attribute:"environment-image"})],s.prototype,"environmentImage",void 0),Tn([Ae({type:String,attribute:"skybox-image"})],s.prototype,"skyboxImage",void 0),Tn([Ae({type:Number,attribute:"shadow-intensity"})],s.prototype,"shadowIntensity",void 0),Tn([Ae({type:Number,attribute:"shadow-softness"})],s.prototype,"shadowSoftness",void 0),Tn([Ae({type:Number})],s.prototype,"exposure",void 0),s},RE=class{constructor(e,t,i,r,s){this.xrLight=e,this.renderer=t,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=s,this.frameCallback=this.onXRFrame.bind(this);let n=t.xr.getSession();if(r&&"XRWebGLBinding"in window){let a=new gl(16);e.environment=a.texture;let o=t.getContext();switch(n.preferredReflectionFormat){case"srgba8":o.getExtension("EXT_sRGB");break;case"rgba16f":o.getExtension("OES_texture_half_float");break}this.xrWebGLBinding=new XRWebGLBinding(n,o),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}n.requestAnimationFrame(this.frameCallback)}updateReflection(){let e=this.renderer.properties.get(this.xrLight.environment);if(e){let t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);let i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;let r=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/r,i.primaryLightIntensity.y/r,i.primaryLightIntensity.z/r),this.xrLight.directionalLight.intensity=r,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}},LE=class extends Wi{constructor(e,t=!0){super(),this.lightProbe=new El,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new Tl,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,r=!1;e.xr.addEventListener("sessionstart",()=>{let s=e.xr.getSession();"requestLightProbe"in s&&s.requestLightProbe({reflectionFormat:s.preferredReflectionFormat}).then(n=>{i=new RE(this,e,n,t,()=>{r=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{i&&(i.dispose(),i=null),r&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}},Ws=.2,Kp=.03,CE=.75,Hv=12,PE=Math.PI/(2*Hv),Qp=new K,go=(e,t,i)=>{let r=t>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let s=0;s<=Hv;++s)e.push(t+(Ws-Kp)*Math.cos(r),i+(Ws-Kp)*Math.sin(r),0,t+Ws*Math.cos(r),i+Ws*Math.sin(r),0),r+=PE},em=class extends _e{constructor(e,t){let i=new Ye,r=[],s=[],{size:n,boundingBox:a}=e,o=n.x/2,l=(t==="back"?n.y:n.z)/2;go(s,o,l),go(s,-o,l),go(s,-o,-l),go(s,o,-l);let h=s.length/3;for(let d=0;d<h-2;d+=2)r.push(d,d+1,d+3,d,d+3,d+2);let u=h-2;r.push(u,u+1,1,u,1,0),i.setAttribute("position",new dt(s,3)),i.setIndex(r),super(i),this.side=t;let c=this.material;switch(c.side=xi,c.transparent=!0,c.opacity=0,this.goalOpacity=0,this.opacityDamper=new kt,this.hitPlane=new _e(new is(2*(o+Ws),2*(l+Ws))),this.hitPlane.visible=!1,this.add(this.hitPlane),a.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=a.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=a.min.z,this.position.z=this.shadowHeight}e.target.add(this)}getHit(e,t,i){Qp.set(t,-i),this.hitPlane.visible=!0;let r=e.positionAndNormalFromPoint(Qp,this.hitPlane);return this.hitPlane.visible=!1,r==null?null:r.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3);let r=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),r}set offsetHeight(e){this.side==="back"?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this.side==="back"?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?CE:0}updateOpacity(e){let t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){var e;let{geometry:t,material:i}=this.hitPlane;t.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}},IE=30,DE=.3,tm=1.5,NE=20,Gv=1.3,OE=1/Gv,FE=.25,UE=10,gr={NOT_PRESENTING:"not-presenting",SESSION_STARTED:"session-started",OBJECT_PLACED:"object-placed",FAILED:"failed"},tc={TRACKING:"tracking",NOT_TRACKING:"not-tracking"},vo=new E,kE=new me,zE=new E,BE=new ft(45,1,.1,100),HE=class extends Ht{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.oldBackground=null,this.oldEnvironment=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new E,this.oldFramedFieldOfView=45,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new E,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new E,this.goalYaw=0,this.goalScale=1,this.xDamper=new kt,this.yDamper=new kt,this.zDamper=new kt,this.yawDamper=new kt,this.scaleDamper=new kt,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onUpdateScene=()=>{this.placementBox!=null&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new em(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=t=>{let i=this.transientHitTestSource;if(i==null)return;let r=this.frame.getHitTestResultsForTransientInput(i),s=this.presentedScene,n=this.placementBox;if(r.length===1){this.inputSource=t.inputSource;let{axes:a}=this.inputSource.gamepad,o=n.getHit(this.presentedScene,a[0],a[1]);n.show=!0,o!=null?(this.isTranslating=!0,this.lastDragPosition.copy(o)):this.placeOnWall===!1&&(this.isRotating=!0,this.lastAngle=a[0]*tm)}else if(r.length===2){n.show=!0,this.isTwoFingering=!0;let{separation:a}=this.fingerPolar(r);this.firstRatio=a/s.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){Bp();let e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:{root:this.overlay}});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return Bp(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e,t=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise((l,h)=>{requestAnimationFrame(()=>l())});e.setHotspotsVisibility(!1),e.queueRender(),await i,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),t===!0&&(this.xrLight=new LE(this.threeRenderer),this.xrLight.addEventListener("estimationstart",()=>{if(!this.isPresenting||this.xrLight==null)return;let l=this.presentedScene;l.add(this.xrLight),this.oldEnvironment=l.environment,l.environment=this.xrLight.environment}));let r=await this.resolveARSession();r.addEventListener("end",()=>{this.postSessionCleanup()},{once:!0});let s=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");s.classList.add("enabled"),s.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=s;let n=await r.requestReferenceSpace("viewer");this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,this.oldBackground=e.background,e.background=null,this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(0),this.oldTarget.copy(e.getTarget()),this.oldFramedFieldOfView=e.framedFieldOfView,e.addEventListener("model-load",this.onUpdateScene);let a=NE*Math.PI/180,o=this.placeOnWall===!0?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});r.requestHitTestSource({space:n,offsetRay:o}).then(l=>{this.initialHitSource=l}),this.currentSession=r,this.placementBox=new em(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:gr.SESSION_STARTED})}async stopPresenting(){if(!this.isPresenting)return;let e=new Promise(t=>{this.resolveCleanup=t});try{await this.currentSession.end(),await e}catch(t){console.warn("Error while trying to end WebXR AR session"),console.warn(t),this.postSessionCleanup()}}get isPresenting(){return this.presentedScene!=null}get target(){return this.oldTarget}updateTarget(){let e=this.presentedScene;if(e!=null){let t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){let e=this.currentSession;e!=null&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);let t=this.presentedScene;if(t!=null){let{element:n}=t;this.xrLight!=null&&(t.remove(this.xrLight),this.oldEnvironment!=null&&(t.environment=this.oldEnvironment,this.oldEnvironment=null),this.xrLight.dispose(),this.xrLight=null),t.position.set(0,0,0),t.scale.set(1,1,1),t.setShadowScaleAndOffset(1,0);let a=this.turntableRotation;a!=null&&(t.yaw=a);let o=this.oldShadowIntensity;o!=null&&t.setShadowIntensity(o);let l=this.oldBackground;l!=null&&(t.background=l);let h=this.oldTarget;t.setTarget(h.x,h.y,h.z),t.framedFieldOfView=this.oldFramedFieldOfView,t.xrCamera=null,t.removeEventListener("model-load",this.onUpdateScene),t.orientHotspots(0),n.requestUpdate("cameraTarget"),n.requestUpdate("maxCameraOrbit"),n[Aa](n.getBoundingClientRect())}this.renderer.height=0;let i=this.exitWebXRButtonContainer;i!=null&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);let r=this.transientHitTestSource;r!=null&&(r.cancel(),this.transientHitTestSource=null);let s=this.initialHitSource;s!=null&&(s.cancel(),this.initialHitSource=null),this.placementBox!=null&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.oldBackground=null,this._presentedScene=null,this.frame=null,this.inputSource=null,this.overlay=null,this.resolveCleanup!=null&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:gr.NOT_PRESENTING})}updateView(e){let t=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(BE),t.xrCamera=i.getCamera();let{elements:r}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(r[1],r[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){let n=e.recommendedViewportScale;e.requestViewportScale(Math.max(n,FE))}let s=this.currentSession.renderState.baseLayer.getViewport(e);this.threeRenderer.setViewport(s.x,s.y,s.width,s.height)}placeInitially(){let e=this.presentedScene,{position:t,element:i}=e,r=e.getCamera(),{width:s,height:n}=this.overlay.getBoundingClientRect();e.setSize(s,n),r.projectionMatrixInverse.copy(r.projectionMatrix).invert();let{theta:a,radius:o}=i.getCameraOrbit(),l=r.getWorldDirection(vo);e.yaw=Math.atan2(-l.x,-l.z)-a,this.goalYaw=e.yaw,t.copy(r.position).add(l.multiplyScalar(o)),this.updateTarget();let h=e.getTarget();t.add(h).sub(this.oldTarget),this.goalPosition.copy(t),e.setHotspotsVisibility(!0);let{session:u}=this.frame;u.addEventListener("selectstart",this.onSelectStart),u.addEventListener("selectend",this.onSelectEnd),u.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(c=>{this.transientHitTestSource=c})}getTouchLocation(){let{axes:e}=this.inputSource.gamepad,t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return t!=null&&(vo.copy(t).sub(this.presentedScene.getCamera().position),vo.length()>UE)?null:t}getHitPoint(e){let t=this.threeRenderer.xr.getReferenceSpace(),i=e.getPose(t);if(i==null)return null;let r=kE.fromArray(i.transform.matrix);return this.placeOnWall===!0&&(this.goalYaw=Math.atan2(r.elements[4],r.elements[6])),r.elements[5]>.75!==this.placeOnWall?zE.setFromMatrixPosition(r):null}moveToFloor(e){let t=this.initialHitSource;if(t==null)return;let i=e.getHitTestResults(t);if(i.length==0)return;let r=i[0],s=this.getHitPoint(r);s!=null&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(s):this.goalPosition.y=s.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:gr.OBJECT_PLACED}))}fingerPolar(e){let t=e[0].inputSource.gamepad.axes,i=e[1].inputSource.gamepad.axes,r=i[0]-t[0],s=i[1]-t[1],n=Math.atan2(s,r),a=this.lastAngle-n;return a>Math.PI?a-=2*Math.PI:a<-Math.PI&&(a+=2*Math.PI),this.lastAngle=n,{separation:Math.sqrt(r*r+s*s),deltaYaw:a}}processInput(e){let t=this.transientHitTestSource;if(t==null||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;let i=e.getHitTestResultsForTransientInput(t),r=this.presentedScene,s=r.scale.x;if(this.isTwoFingering){if(i.length<2)this.isTwoFingering=!1;else{let{separation:n,deltaYaw:a}=this.fingerPolar(i);if(this.placeOnWall===!1&&(this.goalYaw+=a),r.canScale){let o=n/this.firstRatio;this.goalScale=o<Gv&&o>OE?1:o}}return}else if(i.length===2){this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;let{separation:n}=this.fingerPolar(i);this.firstRatio=n/s;return}if(this.isRotating){let n=this.inputSource.gamepad.axes[0]*tm;this.goalYaw+=n-this.lastAngle,this.lastAngle=n}else this.isTranslating&&i.forEach(n=>{if(n.inputSource!==this.inputSource)return;let a=null;if(n.results.length>0&&(a=this.getHitPoint(n.results[0])),a==null&&(a=this.getTouchLocation()),a!=null){if(this.goalPosition.sub(this.lastDragPosition),this.placeOnWall===!1){let o=a.y-this.lastDragPosition.y;if(o<0){this.placementBox.offsetHeight=o/s,this.presentedScene.setShadowScaleAndOffset(s,o);let l=vo.copy(r.getCamera().position),h=-o/(l.y-a.y);l.multiplyScalar(h),a.multiplyScalar(1-h).add(l)}}this.goalPosition.add(a),this.lastDragPosition.copy(a)}})}moveScene(e){let t=this.presentedScene,{position:i,yaw:r,idealCameraDistance:s}=t,n=this.goalPosition,a=t.scale.x,o=this.placementBox;if(!n.equals(i)||this.goalScale!==a){let{x:l,y:h,z:u}=i;l=this.xDamper.update(l,n.x,e,s),h=this.yDamper.update(h,n.y,e,s),u=this.zDamper.update(u,n.z,e,s),i.set(l,h,u);let c=this.scaleDamper.update(a,this.goalScale,e,1);if(t.scale.set(c,c,c),!this.isTranslating){let d=n.y-h;this.placementComplete&&this.placeOnWall===!1?(o.offsetHeight=d/c,t.setShadowScaleAndOffset(c,d)):d===0&&(this.placementComplete=!0,o.show=!1,t.setShadowIntensity(DE))}}o.updateOpacity(e),t.updateTarget(e),t.yaw=this.yawDamper.update(r,this.goalYaw,e,Math.PI)}onWebXRFrame(e,t){this.frame=t,++this.frames;let i=this.threeRenderer.xr.getReferenceSpace(),r=t.getViewerPose(i);r==null&&this.tracking===!0&&this.frames>IE&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:tc.NOT_TRACKING}));let s=this.presentedScene;if(r==null||s==null||!s.element[Gr]()){this.threeRenderer.clear();return}this.tracking===!1&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:tc.TRACKING}));let n=!0;for(let a of r.views){if(this.updateView(a),n){this.moveToFloor(t),this.processInput(t);let l=e-this.lastTick;this.moveScene(l),this.renderer.preRender(s,e,l),this.lastTick=e}let o=this.threeRenderer.getContext();o.depthMask(!1),o.clear(o.DEPTH_BUFFER_BIT),o.depthMask(!0),this.threeRenderer.render(s,s.getCamera()),n=!1}}},GE=class{constructor(e){e.threeRenderer.debug={checkShaderErrors:!0},Promise.resolve().then(()=>{self.dispatchEvent(new CustomEvent("model-viewer-renderer-debug",{detail:{renderer:e,THREE:{ShaderMaterial:Zi,Texture:ht,Mesh:_e,Scene:bi,PlaneBufferGeometry:is,OrthographicCamera:rs,WebGLRenderTarget:Ot}}}))})}addScene(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-added-debug",{detail:{scene:e}}))}removeScene(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-removed-debug",{detail:{scene:e}}))}};function VE(e){let t=new Map,i=new Map,r=e.clone();return Vv(e,r,function(s,n){t.set(n,s),i.set(s,n)}),r.traverse(function(s){if(!s.isSkinnedMesh)return;let n=s,a=t.get(s),o=a.skeleton.bones;n.skeleton=a.skeleton.clone(),n.bindMatrix.copy(a.bindMatrix),n.skeleton.bones=o.map(function(l){return i.get(l)}),n.bind(n.skeleton,n.bindMatrix)}),r}function Vv(e,t,i){i(e,t);for(let r=0;r<e.children.length;r++)Vv(e.children[r],t.children[r],i)}var im=Symbol("prepared"),Qo=Symbol("prepare"),pi=Symbol("preparedGLTF"),el=Symbol("clone"),WE=class{constructor(e){this[pi]=e}static prepare(e){if(e.scene==null)throw new Error("Model does not have a scene");if(e[im])return e;let t=this[Qo](e);return t[im]=!0,t}static[Qo](e){let{scene:t}=e,i=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:i})}get parser(){return this[pi].parser}get animations(){return this[pi].animations}get scene(){return this[pi].scene}get scenes(){return this[pi].scenes}get cameras(){return this[pi].cameras}get asset(){return this[pi].asset}get userData(){return this[pi].userData}clone(){let e=this.constructor,t=this[el]();return new e(t)}dispose(){this.scenes.forEach(e=>{e.traverse(t=>{if(!t.isMesh)return;let i=t;(Array.isArray(i.material)?i.material:[i.material]).forEach(r=>{for(let s in r){let n=r[s];n instanceof ht&&n.dispose()}r.dispose()}),i.geometry.dispose()})})}[el](){let e=this[pi],t=VE(this.scene);jE(t,this.scene);let i=[t],r=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:i,userData:r})}},jE=(e,t)=>{Wv(e,t,(i,r)=>{r.userData.variantMaterials!==void 0&&(i.userData.variantMaterials=new Map(r.userData.variantMaterials)),r.userData.originalMaterial!==void 0&&(i.userData.originalMaterial=r.userData.originalMaterial)})},Wv=(e,t,i)=>{i(e,t);for(let r=0;r<e.children.length;r++)Wv(e.children[r],t.children[r],i)},rm=Symbol("threeGLTF"),sm=Symbol("gltf"),nm=Symbol("gltfElementMap"),am=Symbol("threeObjectMap"),om=Symbol("parallelTraverseThreeScene"),lm=Symbol("correlateOriginalThreeGLTF"),hm=Symbol("correlateCloneThreeGLTF"),tl=class{constructor(e,t,i,r){this[rm]=e,this[sm]=t,this[nm]=r,this[am]=i}static from(e,t){return t!=null?this[hm](e,t):this[lm](e)}static[lm](e){let t=e.parser.json,i=e.parser.associations,r=new Map,s={name:"Default"},n={type:"materials",index:-1};for(let a of i.keys())a instanceof lt&&i.get(a)==null&&(n.index<0&&(t.materials==null&&(t.materials=[]),n.index=t.materials.length,t.materials.push(s)),a.name=s.name,i.set(a,{materials:n.index}));for(let[a,o]of i){if(o){let l=a;l.userData=l.userData||{},l.userData.associations=o}for(let l in o)if(l!=null&&l!=="primitives"){let h=l,u=(t[h]||[])[o[h]];if(u==null)continue;let c=r.get(u);c==null&&(c=new Set,r.set(u,c)),c.add(a)}}return new tl(e,t,i,r)}static[hm](e,t){let i=t.threeGLTF,r=t.gltf,s=JSON.parse(JSON.stringify(r)),n=new Map,a=new Map;for(let o=0;o<i.scenes.length;o++)this[om](i.scenes[o],e.scenes[o],(l,h)=>{let u=t.threeObjectMap.get(l);if(u!=null){for(let c in u)if(c!=null&&c!=="primitives"){let d=c,p=u[d],f=s[d][p],v=n.get(h)||{};v[d]=p,n.set(h,v);let y=a.get(f)||new Set;y.add(h),a.set(f,y)}}});return new tl(e,s,n,a)}static[om](e,t,i){let r=n=>n.isMesh,s=(n,a)=>{if(i(n,a),n.isObject3D){if(r(n))if(Array.isArray(n.material))for(let o=0;o<n.material.length;++o)s(n.material[o],a.material[o]);else s(n.material,a.material);for(let o=0;o<n.children.length;++o)s(n.children[o],a.children[o])}};s(e,t)}get threeGLTF(){return this[rm]}get gltf(){return this[sm]}get gltfElementMap(){return this[nm]}get threeObjectMap(){return this[am]}},Ih=Symbol("cloneAndPatchMaterial"),yo=Symbol("correlatedSceneGraph"),XE=class extends WE{static[Qo](e){let t=super[Qo](e);t[yo]==null&&(t[yo]=tl.from(t));let{scene:i}=t,r=new Sr(void 0,1/0);return i.traverse(s=>{s.renderOrder=1e3,s.frustumCulled=!1,s.name||(s.name=s.uuid);let n=s;n.isMesh&&(n.castShadow=!0,n.isSkinnedMesh&&(n.geometry.boundingSphere=r,n.geometry.boundingBox=null))}),t}get correlatedSceneGraph(){return this[pi][yo]}[el](){let e=super[el](),t=new Map;return e.scene.traverse(i=>{if(i.isMesh){let r=i;Array.isArray(r.material)?r.material=r.material.map(s=>this[Ih](s,t)):r.material!=null&&(r.material=this[Ih](r.material,t))}}),e[yo]=tl.from(e,this.correlatedSceneGraph),e}[Ih](e,t){if(t.has(e.uuid))return t.get(e.uuid);let i=e.clone();e.map!=null&&(i.map=e.map.clone(),i.map.needsUpdate=!0),e.normalMap!=null&&(i.normalMap=e.normalMap.clone(),i.normalMap.needsUpdate=!0),e.emissiveMap!=null&&(i.emissiveMap=e.emissiveMap.clone(),i.emissiveMap.needsUpdate=!0);let r=null;if(e.roughnessMap!=null&&(r=e.roughnessMap.clone()),r!=null){r.needsUpdate=!0,i.roughnessMap=r;let{threeRenderer:s,roughnessMipmapper:n}=Yi.singleton,{enabled:a}=s.xr;s.xr.enabled=!1;let{image:o}=i.roughnessMap;n.generateMipmaps(i),i.roughnessMap.image=o,s.xr.enabled=a}return e.roughnessMap===e.metalnessMap?i.metalnessMap=r:e.metalnessMap!=null&&(i.metalnessMap=e.metalnessMap.clone(),i.metalnessMap.needsUpdate=!0),e.roughnessMap===e.aoMap?i.aoMap=r:e.aoMap!=null&&(i.aoMap=e.aoMap.clone(),i.aoMap.needsUpdate=!0),i.shadowSide=br,t.set(e.uuid,i),i}},qE=class extends $S{constructor(e){super(e),this.type=Zt}parse(e){let t=-1,i=1,r=2,s=3,n=4,a=function(m,_){switch(m){case i:console.error("THREE.RGBELoader Read Error: "+(_||""));break;case r:console.error("THREE.RGBELoader Write Error: "+(_||""));break;case s:console.error("THREE.RGBELoader Bad File Format: "+(_||""));break;default:case n:console.error("THREE.RGBELoader: Error: "+(_||""))}return t},o=1,l=2,h=4,u=`
`,c=function(m,_,x){let w=128;_=_||1024;let S=m.pos,b=-1,R=0,C="",D=String.fromCharCode.apply(null,new Uint16Array(m.subarray(S,S+w)));for(;0>(b=D.indexOf(u))&&R<_&&S<m.byteLength;)C+=D,R+=D.length,S+=w,D+=String.fromCharCode.apply(null,new Uint16Array(m.subarray(S,S+w)));return-1<b?(x!==!1&&(m.pos+=R+b+1),C+D.slice(0,b)):!1},d=function(m){let _=/^#\?(\S+)/,x=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,b=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,R={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0},C,D;if(m.pos>=m.byteLength||!(C=c(m)))return a(i,"no header found");if(!(D=C.match(_)))return a(s,"bad initial token");for(R.valid|=o,R.programtype=D[1],R.string+=C+`
`;C=c(m),C!==!1;){if(R.string+=C+`
`,C.charAt(0)==="#"){R.comments+=C+`
`;continue}if((D=C.match(x))&&(R.gamma=parseFloat(D[1],10)),(D=C.match(w))&&(R.exposure=parseFloat(D[1],10)),(D=C.match(S))&&(R.valid|=l,R.format=D[1]),(D=C.match(b))&&(R.valid|=h,R.height=parseInt(D[1],10),R.width=parseInt(D[2],10)),R.valid&l&&R.valid&h)break}return R.valid&l?R.valid&h?R:a(s,"missing image size specifier"):a(s,"missing format specifier")},p=function(m,_,x){let w=_;if(w<8||w>32767||m[0]!==2||m[1]!==2||m[2]&128)return new Uint8Array(m);if(w!==(m[2]<<8|m[3]))return a(s,"wrong scanline width");let S=new Uint8Array(4*_*x);if(!S.length)return a(n,"unable to allocate buffer space");let b=0,R=0,C=4*w,D=new Uint8Array(4),L=new Uint8Array(C),j=x;for(;j>0&&R<m.byteLength;){if(R+4>m.byteLength)return a(i);if(D[0]=m[R++],D[1]=m[R++],D[2]=m[R++],D[3]=m[R++],D[0]!=2||D[1]!=2||(D[2]<<8|D[3])!=w)return a(s,"bad rgbe scanline format");let N=0,I;for(;N<C&&R<m.byteLength;){I=m[R++];let U=I>128;if(U&&(I-=128),I===0||N+I>C)return a(s,"bad scanline data");if(U){let O=m[R++];for(let Z=0;Z<I;Z++)L[N++]=O}else L.set(m.subarray(R,R+I),N),N+=I,R+=I}let H=w;for(let U=0;U<H;U++){let O=0;S[b]=L[U+O],O+=w,S[b+1]=L[U+O],O+=w,S[b+2]=L[U+O],O+=w,S[b+3]=L[U+O],b+=4}j--}return S},f=function(m,_,x,w){let S=m[_+3],b=Math.pow(2,S-128)/255;x[w+0]=m[_+0]*b,x[w+1]=m[_+1]*b,x[w+2]=m[_+2]*b},v=function(m,_,x,w){let S=m[_+3],b=Math.pow(2,S-128)/255;x[w+0]=xh.toHalfFloat(Math.min(m[_+0]*b,65504)),x[w+1]=xh.toHalfFloat(Math.min(m[_+1]*b,65504)),x[w+2]=xh.toHalfFloat(Math.min(m[_+2]*b,65504))},y=new Uint8Array(e);y.pos=0;let g=d(y);if(t!==g){let m=g.width,_=g.height,x=p(y.subarray(y.pos),m,_);if(t!==x){let w,S,b,R;switch(this.type){case Jt:w=x,S=Sg,b=Jt;break;case Yt:R=x.length/4;let C=new Float32Array(R*3);for(let L=0;L<R;L++)f(x,L*4,C,L*3);w=C,S=ci,b=Yt;break;case Zt:R=x.length/4;let D=new Uint16Array(R*3);for(let L=0;L<R;L++)v(x,L*4,D,L*3);w=D,S=ci,b=Zt;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:m,height:_,data:w,header:g.string,gamma:g.gamma,exposure:g.exposure,format:S,type:b}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(n,a){switch(n.type){case Jt:n.encoding=pl,n.minFilter=st,n.magFilter=st,n.generateMipmaps=!1,n.flipY=!0;break;case Yt:n.encoding=Ke,n.minFilter=Je,n.magFilter=Je,n.generateMipmaps=!1,n.flipY=!0;break;case Zt:n.encoding=Ke,n.minFilter=Je,n.magFilter=Je,n.generateMipmaps=!1,n.flipY=!0;break}t&&t(n,a)}return super.load(e,s,i,r)}},YE=class extends bi{constructor(){super(),this.position.y=-3.5;let e=new ts;e.deleteAttribute("uv");let t=new Ji({metalness:0,side:rt}),i=new Ji({metalness:0}),r=new Sl(16777215,500,28,2);r.position.set(.418,16.199,.3),this.add(r);let s=new _e(e,t);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),this.add(s);let n=new _e(e,i);n.position.set(-10.906,2.009,1.846),n.rotation.set(0,-.195,0),n.scale.set(2.328,7.905,4.651),this.add(n);let a=new _e(e,i);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);let o=new _e(e,i);o.position.set(6.167,.857,7.803),o.rotation.set(0,.561,0),o.scale.set(3.927,6.285,3.687),this.add(o);let l=new _e(e,i);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);let h=new _e(e,i);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),this.add(h);let u=new _e(e,i);u.position.set(-2.193,-.369,-5.547),u.rotation.set(0,.516,0),u.scale.set(3.875,3.487,2.986),this.add(u);let c=new _e(e,this.createAreaLightMaterial(50));c.position.set(-16.116,14.37,8.208),c.scale.set(.1,2.428,2.739),this.add(c);let d=new _e(e,this.createAreaLightMaterial(50));d.position.set(-16.109,18.021,-8.207),d.scale.set(.1,2.425,2.751),this.add(d);let p=new _e(e,this.createAreaLightMaterial(17));p.position.set(14.904,12.198,-1.832),p.scale.set(.15,4.265,6.331),this.add(p);let f=new _e(e,this.createAreaLightMaterial(43));f.position.set(-.462,8.89,14.52),f.scale.set(4.38,5.441,.088),this.add(f);let v=new _e(e,this.createAreaLightMaterial(20));v.position.set(3.235,11.486,-12.541),v.scale.set(2.5,2,.1),this.add(v);let y=new _e(e,this.createAreaLightMaterial(100));y.position.set(0,20,0),y.scale.set(1,.1,1),this.add(y)}createAreaLightMaterial(e){let t=new hi;return t.color.setScalar(e),t}},$E=class extends bi{constructor(){super(),this.position.y=-3.5;let e=new ts;e.deleteAttribute("uv");let t=new Ji({metalness:0,side:rt}),i=new Ji({metalness:0}),r=new Sl(16777215,400,28,2);r.position.set(.5,14,.5),this.add(r);let s=new _e(e,t);s.position.set(0,13.2,0),s.scale.set(31.5,28.5,31.5),this.add(s);let n=new _e(e,i);n.position.set(-10.906,-1,1.846),n.rotation.set(0,-.195,0),n.scale.set(2.328,7.905,4.651),this.add(n);let a=new _e(e,i);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);let o=new _e(e,i);o.position.set(6.167,-.16,7.803),o.rotation.set(0,.561,0),o.scale.set(3.927,6.285,3.687),this.add(o);let l=new _e(e,i);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);let h=new _e(e,i);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),this.add(h);let u=new _e(e,i);u.position.set(-2.193,-.369,-5.547),u.rotation.set(0,.516,0),u.scale.set(3.875,3.487,2.986),this.add(u);let c=new _e(e,this.createAreaLightMaterial(80));c.position.set(-14,10,8),c.scale.set(.1,2.5,2.5),this.add(c);let d=new _e(e,this.createAreaLightMaterial(80));d.position.set(-14,14,-4),d.scale.set(.1,2.5,2.5),this.add(d);let p=new _e(e,this.createAreaLightMaterial(23));p.position.set(14,12,0),p.scale.set(.1,5,5),this.add(p);let f=new _e(e,this.createAreaLightMaterial(16));f.position.set(0,9,14),f.scale.set(5,5,.1),this.add(f);let v=new _e(e,this.createAreaLightMaterial(80));v.position.set(7,8,-14),v.scale.set(2.5,2.5,.1),this.add(v);let y=new _e(e,this.createAreaLightMaterial(80));y.position.set(-7,16,-14),y.scale.set(2.5,2.5,.1),this.add(y);let g=new _e(e,this.createAreaLightMaterial(1));g.position.set(0,20,0),g.scale.set(.1,.1,.1),this.add(g)}createAreaLightMaterial(e){let t=new hi;return t.color.setScalar(e),t}},ZE=.04,Ss=20,JE=/\.hdr(\.js)?$/,KE=new Ml,jv=new qE;jv.setDataType(Zt);var um=class extends Ht{constructor(e){super(),this.threeRenderer=e,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}async load(e,t=()=>{}){try{let i=JE.test(e),r=i?jv:KE,s=await new Promise((n,a)=>r.load(e,n,o=>{t(o.loaded/o.total*.9)},a));return t(1),s.name=e,s.mapping=Xo,i||(s.encoding=Ra),s}finally{t&&t(1)}}async generateEnvironmentMapAndSkybox(e=null,t=null,i={}){let{progressTracker:r}=i,s=r!=null?r.beginActivity():()=>{},n=t==="neutral";n===!0&&(t=null);let a=Iv(t);try{let o=Promise.resolve(null),l;e&&(o=this.loadEquirectFromUrl(e,r)),a?l=this.loadEquirectFromUrl(a,r):e?l=this.loadEquirectFromUrl(e,r):l=n===!0?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();let[h,u]=await Promise.all([l,o]);if(h==null)throw new Error("Failed to load environment map.");return{environmentMap:h,skybox:u}}finally{s(1)}}async loadEquirectFromUrl(e,t){if(!this.skyboxCache.has(e)){let i=t?t.beginActivity():()=>{},r=this.load(e,i);this.skyboxCache.set(e,r)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,t){await Nv();let i=this.threeRenderer,r=new gl(256,{generateMipmaps:!1,type:Zt,format:ot,encoding:Ke,depthBuffer:!0}),s=new xa(.1,100,r),n=s.renderTarget.texture;n.name=t,n.isRenderTargetTexture=!1,n.images=[1,1,1,1,1,1],e.scale.setComponent(0,-1);let a=i.outputEncoding,o=i.toneMapping;return i.toneMapping=vr,i.outputEncoding=Ke,s.update(i,e),await this.blurCubemap(r,ZE),i.toneMapping=o,i.outputEncoding=a,n}async loadGeneratedEnvironmentMap(){return this.generatedEnvironmentMap==null&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new YE,"default")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return this.generatedEnvironmentMapAlt==null&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new $E,"neutral")),this.generatedEnvironmentMapAlt}async blurCubemap(e,t){if(this.blurMaterial==null){this.blurMaterial=this.getBlurShader(Ss);let r=new ts,s=new _e(r,this.blurMaterial);this.blurScene=new bi,this.blurScene.add(s)}let i=e.clone();this.halfblur(e,i,t,"latitudinal"),this.halfblur(i,e,t,"longitudinal")}async halfblur(e,t,i,r){let s=3,n=e.width,a=isFinite(i)?Math.PI/(2*n):2*Math.PI/(2*Ss-1),o=i/a,l=isFinite(i)?1+Math.floor(s*o):Ss;l>Ss&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${l} samples when the maximum is set to ${Ss}`);let h=[],u=0;for(let d=0;d<Ss;++d){let p=d/o,f=Math.exp(-p*p/2);h.push(f),d==0?u+=f:d<l&&(u+=2*f)}for(let d=0;d<h.length;d++)h[d]=h[d]/u;let c=this.blurMaterial.uniforms;c.envMap.value=e.texture,c.samples.value=l,c.weights.value=h,c.latitudinal.value=r==="latitudinal",c.dTheta.value=a,new xa(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){let t=new Float32Array(e),i=new E(0,1,0);return new Zi({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:i}},vertexShader:`
      
      varying vec3 vOutputDirection;
  
      void main() {
  
        vOutputDirection = vec3( position );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  
      }
    `,fragmentShader:`
        varying vec3 vOutputDirection;
  
        uniform samplerCube envMap;
        uniform int samples;
        uniform float weights[ n ];
        uniform bool latitudinal;
        uniform float dTheta;
        uniform vec3 poleAxis;
  
        vec3 getSample( float theta, vec3 axis ) {
  
          float cosTheta = cos( theta );
          // Rodrigues' axis-angle rotation
          vec3 sampleDirection = vOutputDirection * cosTheta
            + cross( axis, vOutputDirection ) * sin( theta )
            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );
  
          return vec3( textureCube( envMap, sampleDirection ) );
  
        }
  
        void main() {
  
          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );
  
          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {
  
            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );
  
          }
  
          axis = normalize( axis );
  
          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );
  
          for ( int i = 1; i < n; i++ ) {
  
            if ( i >= samples ) {
  
              break;
  
            }
  
            float theta = dTheta * float( i );
            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );
  
          }
        }
      `,blending:vi,depthTest:!1,depthWrite:!1,side:rt})}async dispose(){for(let[,e]of this.skyboxCache)(await e).dispose();this.generatedEnvironmentMap!=null&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),this.generatedEnvironmentMapAlt!=null&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),this.blurMaterial!=null&&this.blurMaterial.dispose()}},QE=.2,Dh=18,Nh=26,cm=2,Oh=[1,.79,.62,.5,.4,.31,.25],e2=3,Xv="high-performance",Yi=class extends Ht{constructor(e){super(),this.loader=new Et(XE),this.width=0,this.height=0,this.dpr=1,this.debugger=null,this.scenes=new Set,this.multipleScenesVisible=!1,this.scaleStep=0,this.lastStep=e2,this.avgFrameDuration=(Nh+Dh)/2,this.onWebGLContextLost=t=>{this.dispatchEvent({type:"contextlost",sourceEvent:t})},this.onWebGLContextRestored=()=>{var t;(t=this.textureUtils)===null||t===void 0||t.dispose(),this.textureUtils=new um(this.threeRenderer),this.roughnessMipmapper=new Jp(this.threeRenderer);for(let i of this.scenes)i.element[Uo]();this.threeRenderer.shadowMap.needsUpdate=!0},this.dpr=Qu(),this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas";try{this.threeRenderer=new Ge({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.outputEncoding=Ra,this.threeRenderer.physicallyCorrectLights=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.shadowMap.enabled=!0,this.threeRenderer.shadowMap.type=yg,this.threeRenderer.shadowMap.autoUpdate=!1,this.debugger=e.debug?new GE(this):null,this.threeRenderer.debug={checkShaderErrors:!!this.debugger},this.threeRenderer.toneMapping=_g}catch(t){console.warn(t)}this.arRenderer=new HE(this),this.textureUtils=this.canRender?new um(this.threeRenderer):null,this.roughnessMipmapper=new Jp(this.threeRenderer),Et.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize(),this.lastTick=performance.now(),this.avgFrameDuration=0}static get singleton(){return this._singleton}static resetSingleton(){let e=this._singleton.dispose();for(let t of e)t.disconnectedCallback();this._singleton=new Yi({powerPreference:(self.ModelViewerElement||{}).powerPreference||Xv,debug:Dv()});for(let t of e)t.connectedCallback()}get canRender(){return this.threeRenderer!=null}get scaleFactor(){return Oh[this.scaleStep]}set minScale(e){let t=1;for(;t<Oh.length&&!(Oh[t]<e);)++t;this.lastStep=t-1}updateRendererSize(){let e=Qu();if(e!==this.dpr)for(let a of this.scenes){let{element:o}=a;o[ks](o.getBoundingClientRect())}let t=0,i=0;for(let a of this.scenes)t=Math.max(t,a.width),i=Math.max(i,a.height);if(t===this.width&&i===this.height&&e===this.dpr)return;this.width=t,this.height=i,this.dpr=e,this.canRender&&this.threeRenderer.setSize(t*e,i*e,!1);let r=this.scaleFactor,s=t/r,n=i/r;this.canvas3D.style.width=`${s}px`,this.canvas3D.style.height=`${n}px`;for(let a of this.scenes){let{canvas:o}=a;o.width=Math.round(t*e),o.height=Math.round(i*e),o.style.width=`${s}px`,o.style.height=`${n}px`,a.queueRender()}}updateRendererScale(){let e=this.scaleStep;if(this.avgFrameDuration>Nh?++this.scaleStep:this.avgFrameDuration<Dh&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),e==this.scaleStep)return;let t=this.scaleFactor;this.avgFrameDuration=(Nh+Dh)/2;let i=this.width/t,r=this.height/t;this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${r}px`;for(let s of this.scenes){let{style:n}=s.canvas;n.width=`${i}px`,n.height=`${r}px`,s.queueRender()}}registerScene(e){this.scenes.add(e);let{canvas:t}=e,i=this.scaleFactor;t.width=Math.round(this.width*this.dpr),t.height=Math.round(this.height*this.dpr),t.style.width=`${this.width/i}px`,t.style.height=`${this.height/i}px`,this.multipleScenesVisible&&t.classList.add("show"),e.queueRender(),this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop((r,s)=>this.render(r,s)),this.debugger!=null&&this.debugger.addScene(e)}unregisterScene(e){this.scenes.delete(e),this.canRender&&this.scenes.size===0&&this.threeRenderer.setAnimationLoop(null),this.debugger!=null&&this.debugger.removeScene(e)}displayCanvas(e){return this.multipleScenesVisible?e.element[rl]:this.canvas3D}selectCanvas(){let e=0,t=null;for(let s of this.scenes){let{element:n}=s;n.modelIsVisible&&s.externalRenderer==null&&(++e,t=s.canvas)}if(t==null)return;let i=e>1,{canvas3D:r}=this;if(!(i===this.multipleScenesVisible&&(i||r.parentElement===t.parentElement))){this.multipleScenesVisible=i,i&&r.classList.remove("show");for(let s of this.scenes){if(s.externalRenderer!=null)continue;let n=s.element[rl];i?(n.classList.add("show"),s.queueRender()):s.canvas===t&&(s.canvas.parentElement.appendChild(r),r.classList.add("show"),n.classList.remove("show"),s.queueRender())}}}orderedScenes(){let e=[];for(let t of[!1,!0])for(let i of this.scenes)i.element.modelIsVisible===t&&e.push(i);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,i){let{element:r,exposure:s}=e;r[_i](t,i);let n=typeof s=="number"&&!self.isNaN(s);this.threeRenderer.toneMappingExposure=n?s:1,e.isShadowDirty()&&(this.threeRenderer.shadowMap.needsUpdate=!0)}render(e,t){if(t!=null){this.arRenderer.onWebXRFrame(e,t);return}let i=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.avgFrameDuration+=Hr(QE*(i-this.avgFrameDuration),-cm,cm),this.selectCanvas(),this.updateRendererSize(),this.updateRendererScale();let{dpr:r,scaleFactor:s}=this;for(let n of this.orderedScenes()){let{element:a}=n;if(!a.modelIsVisible&&n.renderCount>0||(this.preRender(n,e,i),!n.shouldRender()))continue;if(n.externalRenderer!=null){let h=n.getCamera();h.updateMatrix();let{matrix:u,projectionMatrix:c}=h,d=u.elements.slice(),p=n.getTarget();d[12]+=p.x,d[13]+=p.y,d[14]+=p.z,n.externalRenderer.render({viewMatrix:d,projectionMatrix:c.elements});continue}if(!a.modelIsVisible&&!this.multipleScenesVisible)for(let h of this.scenes)h.element.modelIsVisible&&h.queueRender();let o=Math.min(Math.ceil(n.width*s*r),this.canvas3D.width),l=Math.min(Math.ceil(n.height*s*r),this.canvas3D.height);if(this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.floor(this.height*r)-l,o,l),this.threeRenderer.render(n,n.camera),this.multipleScenesVisible){n.context==null&&n.createContext();let h=n.context;h.clearRect(0,0,o,l),h.drawImage(this.canvas3D,0,0,o,l,0,0,o,l)}n.hasRendered(),a.loaded&&++n.renderCount}}dispose(){this.textureUtils!=null&&this.textureUtils.dispose(),this.roughnessMipmapper!=null&&this.roughnessMipmapper.dispose(),this.threeRenderer!=null&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;let e=[];for(let t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}};Yi._singleton=new Yi({powerPreference:(self.ModelViewerElement||{}).powerPreference||Xv,debug:Dv()});var t2=async e=>new Promise((t,i)=>{let r=512,s=e.match(/data:(.*);/);if(!s)return i(new Error(`${e} is not a valid data Url`));let n=s[1],a=e.replace(/data:image\/\w+;base64,/,""),o=atob(a),l=[];for(let h=0;h<o.length;h+=r){let u=o.slice(h,h+r),c=new Array(u.length);for(let p=0;p<u.length;p++)c[p]=u.charCodeAt(p);let d=new Uint8Array(c);l.push(d)}t(new Blob(l,{type:n}))}),dm,pm,Rn=Symbol("ongoingActivities"),Fh=Symbol("announceTotalProgress"),xo=Symbol("eventDelegate"),i2=.5,r2=class{constructor(){this[dm]=document.createDocumentFragment(),this.addEventListener=(...e)=>this[xo].addEventListener(...e),this.removeEventListener=(...e)=>this[xo].removeEventListener(...e),this.dispatchEvent=(...e)=>this[xo].dispatchEvent(...e),this[pm]=new Set}get ongoingActivityCount(){return this[Rn].size}beginActivity(){let e={progress:0};return this[Rn].add(e),this.ongoingActivityCount===1&&this[Fh](),t=>{let i;return i=Math.max(Hr(t,0,1),e.progress),i!==e.progress&&(e.progress=i,this[Fh]()),e.progress}}[(dm=xo,pm=Rn,Fh)](){let e=0,t=0,i=0;for(let r of this[Rn]){let{progress:s}=r,n=i2/Math.pow(2,t++);e+=s*n,s===1&&i++}i===this.ongoingActivityCount&&(e=1,this[Rn].clear()),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:e}}))}},qv=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},mm,fm,gm,vm,ym,xm,bm,wm,_m,Mm,s2=1e3,n2=50,a2=0,o2=300,l2=150,Xt=document.createElement("canvas"),Uh=Symbol("fallbackResizeHandler"),kh=Symbol("defaultAriaLabel"),bo=Symbol("resizeObserver"),Ln=Symbol("clearModelTimeout"),zh=Symbol("onContextLost"),Ir=Symbol("loaded"),ks=Symbol("updateSize"),wo=Symbol("intersectionObserver"),Br=Symbol("isElementInViewport"),il=Symbol("announceModelVisibility"),Oc=Symbol("ariaLabel"),Kn=Symbol("loadedTime"),gi=Symbol("updateSource"),Sm=Symbol("markLoaded"),ha=Symbol("container"),Vi=Symbol("input"),rl=Symbol("canvas"),ie=Symbol("scene"),Rt=Symbol("needsRender"),_i=Symbol("tick"),Mi=Symbol("onModelLoad"),Aa=Symbol("onResize"),Be=Symbol("renderer"),Js=Symbol("progressTracker"),Tm=Symbol("getLoaded"),sl=Symbol("getModelIsVisible"),Zr=Symbol("shouldAttemptPreload"),Gr=Symbol("sceneIsReady"),Ks=Symbol("hasTransitioned"),nl=e=>({x:e.x,y:e.y,z:e.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),Fc=class extends pc{constructor(){super(),this.alt=null,this.src=null,this[mm]=!1,this[fm]=!1,this[gm]=0,this[vm]=null,this[ym]=Ku(()=>{let r=this.getBoundingClientRect();this[ks](r)},n2),this[xm]=Ku(r=>{let s=this.modelIsVisible;s!==r&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:s}}))},a2),this[bm]=null,this[wm]=null,this[_m]=new r2,this[Mm]=r=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:r.sourceEvent}}))},this.attachShadow({mode:"open"});let e=this.shadowRoot;Iy(e),this[ha]=e.querySelector(".container"),this[Vi]=e.querySelector(".userInput"),this[rl]=e.querySelector("canvas"),this[kh]=this[Vi].getAttribute("aria-label");let t,i;if(this.isConnected){let r=this.getBoundingClientRect();t=r.width,i=r.height}else t=o2,i=l2;this[ie]=new wE({canvas:this[rl],element:this,width:t,height:i}),this[ie].addEventListener("model-load",async r=>{this[Sm](),this[Mi](),await Nv(),this.dispatchEvent(new CustomEvent("load",{detail:{url:r.url}}))}),Promise.resolve().then(()=>{this[ks](this.getBoundingClientRect())}),Ol&&(this[bo]=new ResizeObserver(r=>{if(!this[Be].isPresenting)for(let s of r)s.target===this&&this[ks](s.contentRect)})),Fl?this[wo]=new IntersectionObserver(r=>{for(let s of r)if(s.target===this){let n=this.modelIsVisible;this[Br]=s.isIntersecting,this[il](n),this[Br]&&!this[Gr]()&&this[gi]()}},{root:null,rootMargin:"0px",threshold:0}):this[Br]=!0}static get is(){return"model-viewer"}static set modelCacheSize(e){Et[mr].evictionThreshold=e}static get modelCacheSize(){return Et[mr].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Yi.singleton.minScale=e}static get minimumRenderScale(){return Yi.singleton.minScale}get loaded(){return this[Tm]()}get[(mm=Br,fm=Ir,gm=Kn,vm=Ln,ym=Uh,xm=il,bm=bo,wm=wo,_m=Js,Be)](){return Yi.singleton}get modelIsVisible(){return this[sl]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Ol?this[bo].observe(this):self.addEventListener("resize",this[Uh]),Fl&&this[wo].observe(this);let e=this[Be];e.addEventListener("contextlost",this[zh]),e.registerScene(this[ie]),this[Ln]!=null&&(self.clearTimeout(this[Ln]),this[Ln]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),Ol?this[bo].unobserve(this):self.removeEventListener("resize",this[Uh]),Fl&&this[wo].unobserve(this);let e=this[Be];e.removeEventListener("contextlost",this[zh]),e.unregisterScene(this[ie]),this[Ln]=self.setTimeout(()=>{this[ie].reset()},s2)}updated(e){if(super.updated(e),e.has("src")&&(this.src==null?(this[Ir]=!1,this[Kn]=0,this[ie].reset()):this.src!==this[ie].url&&(this[Ir]=!1,this[Kn]=0,this[gi]())),e.has("alt")){let t=this.alt==null?this[kh]:this.alt;this[Vi].setAttribute("aria-label",t)}}toDataURL(e,t){return this[Be].displayCanvas(this[ie]).toDataURL(e,t)}async toBlob(e){let t=e?e.mimeType:void 0,i=e?e.qualityArgument:void 0,r=e?e.idealAspect:void 0,{width:s,height:n,fieldOfViewAspect:a,aspect:o}=this[ie],{dpr:l,scaleFactor:h}=this[Be],u=s*h*l,c=n*h*l,d=0,p=0;if(r===!0)if(a>o){let f=c;c=Math.round(u/a),p=(f-c)/2}else{let f=u;u=Math.round(c*a),d=(f-u)/2}Xt.width=u,Xt.height=c;try{return new Promise(async(f,v)=>{if(Xt.getContext("2d").drawImage(this[Be].displayCanvas(this[ie]),d,p,u,c,0,0,u,c),Xt.msToBlob&&(!t||t==="image/png"))return f(Xt.msToBlob());if(!Xt.toBlob)return f(await t2(Xt.toDataURL(t,i)));Xt.toBlob(y=>{if(!y)return v(new Error("Unable to retrieve canvas blob"));f(y)},t,i)})}finally{this[ks]({width:s,height:n})}}registerRenderer(e){this[ie].externalRenderer=e}unregisterRenderer(){this[ie].externalRenderer=null}get[Oc](){return this.alt==null||this.alt==="null"?this[kh]:this.alt}[Tm](){return this[Ir]}[sl](){return this.loaded&&this[Br]}[Ks](){return this.modelIsVisible}[Zr](){return!!this.src&&this[Br]}[Gr](){return this[Ir]}[ks]({width:e,height:t}){this[ha].style.width=`${e}px`,this[ha].style.height=`${t}px`,this[Aa]({width:parseFloat(e),height:parseFloat(t)})}[_i](e,t){}[Sm](){this[Ir]||(this[Ir]=!0,this[Kn]=performance.now())}[Rt](){this[ie].queueRender()}[Mi](){}[Aa](e){this[ie].setSize(e.width,e.height)}async[(Mm=zh,gi)](){if(this.loaded||!this[Zr]())return;let e=this[Js].beginActivity(),t=this.src;try{await this[ie].setSource(t,r=>e(r*.8));let i={url:t};this.dispatchEvent(new CustomEvent("preload",{detail:i}))}catch(i){this.dispatchEvent(new CustomEvent("error",{detail:i}))}finally{e(.9),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e(1)})})}}};qv([Ae({type:String})],Fc.prototype,"alt",void 0);qv([Ae({type:String})],Fc.prototype,"src",void 0);var Bh=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},Em=1e3,_o=Symbol("changeAnimation"),Oi=Symbol("paused"),h2=e=>{var t;class i extends e{constructor(){super(...arguments),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[t]=!0}get availableAnimations(){return this.loaded?this[ie].animationNames:[]}get duration(){return this[ie].duration}get paused(){return this[Oi]}get currentTime(){return this[ie].animationTime}set currentTime(s){this[ie].animationTime=s,this[Be].threeRenderer.shadowMap.needsUpdate=!0,this[Rt]()}pause(){this[Oi]||(this[Oi]=!0,this[Be].threeRenderer.shadowMap.autoUpdate=!1,this.dispatchEvent(new CustomEvent("pause")))}play(){this[Oi]&&this.availableAnimations.length>0&&(this[Oi]=!1,this[Be].threeRenderer.shadowMap.autoUpdate=!0,this[ie].hasActiveAnimation||this[_o](),this.dispatchEvent(new CustomEvent("play")))}[(t=Oi,Mi)](){super[Mi](),this[Oi]=!0,this.autoplay&&(this[_o](),this.play())}[_i](s,n){super[_i](s,n),!(this[Oi]||!this[Ks]()&&!this[Be].isPresenting)&&(this[ie].updateAnimation(n/Em),this[Rt]())}updated(s){super.updated(s),s.has("autoplay")&&this.autoplay&&this.play(),s.has("animationName")&&this[_o]()}async[gi](){return this[ie].stopAnimation(),super[gi]()}[_o](){this[ie].playAnimation(this.animationName,this.animationCrossfadeDuration/Em),this[Oi]&&(this[ie].updateAnimation(0),this[Rt]())}}return Bh([Ae({type:Boolean})],i.prototype,"autoplay",void 0),Bh([Ae({type:String,attribute:"animation-name"})],i.prototype,"animationName",void 0),Bh([Ae({type:Number,attribute:"animation-crossfade-duration"})],i.prototype,"animationCrossfadeDuration",void 0),i},Ts=Symbol("hotspotMap"),Hh=Symbol("mutationCallback"),Cn=Symbol("observer"),Gh=Symbol("addHotspot"),Am=Symbol("removeHotspot"),Vh=new me,Rm=new ct,u2=e=>{var t,i,r;class s extends e{constructor(){super(...arguments),this[t]=new Map,this[i]=a=>{a.forEach(o=>{(!(o instanceof MutationRecord)||o.type==="childList")&&(o.addedNodes.forEach(l=>{this[Gh](l)}),o.removedNodes.forEach(l=>{this[Am](l)}),this[Rt]())})},this[r]=new MutationObserver(this[Hh])}connectedCallback(){super.connectedCallback();for(let o=0;o<this.children.length;++o)this[Gh](this.children[o]);let{ShadyDOM:a}=self;a==null?this[Cn].observe(this,{childList:!0}):this[Cn]=a.observeChildren(this,this[Hh])}disconnectedCallback(){super.disconnectedCallback();let{ShadyDOM:a}=self;a==null?this[Cn].disconnect():a.unobserveChildren(this[Cn])}[(t=Ts,i=Hh,r=Cn,_i)](a,o){super[_i](a,o);let l=this[ie],{annotationRenderer:h}=l,u=l.getCamera();l.shouldRender()&&(l.updateHotspots(u.position),h.domElement.style.display="",h.render(l,u))}updateHotspot(a){let o=this[Ts].get(a.name);o!=null&&(o.updatePosition(a.position),o.updateNormal(a.normal),this[Rt]())}positionAndNormalFromPoint(a,o){let l=this[ie],h=l.getNDC(a,o),u=l.positionAndNormalFromPoint(h);if(u==null)return null;Vh.copy(l.target.matrixWorld).invert();let c=nl(u.position.applyMatrix4(Vh));Rm.getNormalMatrix(Vh);let d=nl(u.normal.applyNormalMatrix(Rm));return{position:c,normal:d}}[Gh](a){if(!(a instanceof HTMLElement&&a.slot.indexOf("hotspot")===0))return;let o=this[Ts].get(a.slot);o!=null?o.increment():(o=new kv({name:a.slot,position:a.dataset.position,normal:a.dataset.normal}),this[Ts].set(a.slot,o),this[ie].addHotspot(o)),this[ie].queueRender()}[Am](a){if(!(a instanceof HTMLElement))return;let o=this[Ts].get(a.slot);!o||(o.decrement()&&(this[ie].removeHotspot(o),this[Ts].delete(a.slot)),this[ie].queueRender())}}return s},Lm=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(Lm(""))}catch{Lm=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Pt=Uint8Array,Lt=Uint16Array,Qs=Uint32Array,Uc=new Pt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kc=new Pt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Cm=new Pt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yv=function(e,t){for(var i=new Lt(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];for(var s=new Qs(i[30]),r=1;r<30;++r)for(var n=i[r];n<i[r+1];++n)s[n]=n-i[r]<<5|r;return[i,s]},$v=Yv(Uc,2),c2=$v[0],ic=$v[1];c2[28]=258,ic[258]=28;var d2=Yv(kc,0),Pm=d2[1],rc=new Lt(32768);for(ze=0;ze<32768;++ze)Fi=(ze&43690)>>>1|(ze&21845)<<1,Fi=(Fi&52428)>>>2|(Fi&13107)<<2,Fi=(Fi&61680)>>>4|(Fi&3855)<<4,rc[ze]=((Fi&65280)>>>8|(Fi&255)<<8)>>>1;var Fi,ze,ua=function(e,t,i){for(var r=e.length,s=0,n=new Lt(t);s<r;++s)++n[e[s]-1];var a=new Lt(t);for(s=0;s<t;++s)a[s]=a[s-1]+n[s-1]<<1;var o;if(i){o=new Lt(1<<t);var l=15-t;for(s=0;s<r;++s)if(e[s])for(var h=s<<4|e[s],u=t-e[s],c=a[e[s]-1]++<<u,d=c|(1<<u)-1;c<=d;++c)o[rc[c]>>>l]=h}else for(o=new Lt(r),s=0;s<r;++s)e[s]&&(o[s]=rc[a[e[s]-1]++]>>>15-e[s]);return o},Jr=new Pt(288);for(ze=0;ze<144;++ze)Jr[ze]=8;var ze;for(ze=144;ze<256;++ze)Jr[ze]=9;var ze;for(ze=256;ze<280;++ze)Jr[ze]=7;var ze;for(ze=280;ze<288;++ze)Jr[ze]=8;var ze,al=new Pt(32);for(ze=0;ze<32;++ze)al[ze]=5;var ze,p2=ua(Jr,9,0),m2=ua(al,5,0),Zv=function(e){return(e/8|0)+(e&7&&1)},Jv=function(e,t,i){(t==null||t<0)&&(t=0),(i==null||i>e.length)&&(i=e.length);var r=new(e instanceof Lt?Lt:e instanceof Qs?Qs:Pt)(i-t);return r.set(e.subarray(t,i)),r},Ui=function(e,t,i){i<<=t&7;var r=t/8|0;e[r]|=i,e[r+1]|=i>>>8},Pn=function(e,t,i){i<<=t&7;var r=t/8|0;e[r]|=i,e[r+1]|=i>>>8,e[r+2]|=i>>>16},Wh=function(e,t){for(var i=[],r=0;r<e.length;++r)e[r]&&i.push({s:r,f:e[r]});var s=i.length,n=i.slice();if(!s)return[zc,0];if(s==1){var a=new Pt(i[0].s+1);return a[i[0].s]=1,[a,1]}i.sort(function(w,S){return w.f-S.f}),i.push({s:-1,f:25001});var o=i[0],l=i[1],h=0,u=1,c=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=s-1;)o=i[i[h].f<i[c].f?h++:c++],l=i[h!=u&&i[h].f<i[c].f?h++:c++],i[u++]={s:-1,f:o.f+l.f,l:o,r:l};for(var d=n[0].s,r=1;r<s;++r)n[r].s>d&&(d=n[r].s);var p=new Lt(d+1),f=sc(i[u-1],p,0);if(f>t){var r=0,v=0,y=f-t,g=1<<y;for(n.sort(function(S,b){return p[b.s]-p[S.s]||S.f-b.f});r<s;++r){var m=n[r].s;if(p[m]>t)v+=g-(1<<f-p[m]),p[m]=t;else break}for(v>>>=y;v>0;){var _=n[r].s;p[_]<t?v-=1<<t-p[_]++-1:++r}for(;r>=0&&v;--r){var x=n[r].s;p[x]==t&&(--p[x],++v)}f=t}return[new Pt(p),f]},sc=function(e,t,i){return e.s==-1?Math.max(sc(e.l,t,i+1),sc(e.r,t,i+1)):t[e.s]=i},Im=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new Lt(++t),r=0,s=e[0],n=1,a=function(l){i[r++]=l},o=1;o<=t;++o)if(e[o]==s&&o!=t)++n;else{if(!s&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(s),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(s);n=1,s=e[o]}return[i.subarray(0,r),t]},In=function(e,t){for(var i=0,r=0;r<t.length;++r)i+=e[r]*t[r];return i},ko=function(e,t,i){var r=i.length,s=Zv(t+2);e[s]=r&255,e[s+1]=r>>>8,e[s+2]=e[s]^255,e[s+3]=e[s+1]^255;for(var n=0;n<r;++n)e[s+n+4]=i[n];return(s+4+r)*8},Dm=function(e,t,i,r,s,n,a,o,l,h,u){Ui(t,u++,i),++s[256];for(var c=Wh(s,15),d=c[0],p=c[1],f=Wh(n,15),v=f[0],y=f[1],g=Im(d),m=g[0],_=g[1],x=Im(v),w=x[0],S=x[1],b=new Lt(19),R=0;R<m.length;++R)b[m[R]&31]++;for(var R=0;R<w.length;++R)b[w[R]&31]++;for(var C=Wh(b,7),D=C[0],L=C[1],j=19;j>4&&!D[Cm[j-1]];--j);var N=h+5<<3,I=In(s,Jr)+In(n,al)+a,H=In(s,d)+In(n,v)+a+14+3*j+In(b,D)+(2*b[16]+3*b[17]+7*b[18]);if(N<=I&&N<=H)return ko(t,u,e.subarray(l,l+h));var U,O,Z,re;if(Ui(t,u,1+(H<I)),u+=2,H<I){U=ua(d,p,0),O=d,Z=ua(v,y,0),re=v;var xe=ua(D,L,0);Ui(t,u,_-257),Ui(t,u+5,S-1),Ui(t,u+10,j-4),u+=14;for(var R=0;R<j;++R)Ui(t,u+3*R,D[Cm[R]]);u+=3*j;for(var ce=[m,w],q=0;q<2;++q)for(var Q=ce[q],R=0;R<Q.length;++R){var se=Q[R]&31;Ui(t,u,xe[se]),u+=D[se],se>15&&(Ui(t,u,Q[R]>>>5&127),u+=Q[R]>>>12)}}else U=p2,O=Jr,Z=m2,re=al;for(var R=0;R<o;++R)if(r[R]>255){var se=r[R]>>>18&31;Pn(t,u,U[se+257]),u+=O[se+257],se>7&&(Ui(t,u,r[R]>>>23&31),u+=Uc[se]);var ae=r[R]&31;Pn(t,u,Z[ae]),u+=re[ae],ae>3&&(Pn(t,u,r[R]>>>5&8191),u+=kc[ae])}else Pn(t,u,U[r[R]]),u+=O[r[R]];return Pn(t,u,U[256]),u+O[256]},f2=new Qs([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zc=new Pt(0),g2=function(e,t,i,r,s,n){var a=e.length,o=new Pt(r+a+5*(1+Math.ceil(a/7e3))+s),l=o.subarray(r,o.length-s),h=0;if(!t||a<8)for(var u=0;u<=a;u+=65535){var c=u+65535;c<a?h=ko(l,h,e.subarray(u,c)):(l[u]=n,h=ko(l,h,e.subarray(u,a)))}else{for(var d=f2[t-1],p=d>>>13,f=d&8191,v=(1<<i)-1,y=new Lt(32768),g=new Lt(v+1),m=Math.ceil(i/3),_=2*m,x=function(ee){return(e[ee]^e[ee+1]<<m^e[ee+2]<<_)&v},w=new Qs(25e3),S=new Lt(288),b=new Lt(32),R=0,C=0,u=0,D=0,L=0,j=0;u<a;++u){var N=x(u),I=u&32767,H=g[N];if(y[I]=H,g[N]=I,L<=u){var U=a-u;if((R>7e3||D>24576)&&U>423){h=Dm(e,l,0,w,S,b,C,D,j,u-j,h),D=R=C=0,j=u;for(var O=0;O<286;++O)S[O]=0;for(var O=0;O<30;++O)b[O]=0}var Z=2,re=0,xe=f,ce=I-H&32767;if(U>2&&N==x(u-ce))for(var q=Math.min(p,U)-1,Q=Math.min(32767,u),se=Math.min(258,U);ce<=Q&&--xe&&I!=H;){if(e[u+Z]==e[u+Z-ce]){for(var ae=0;ae<se&&e[u+ae]==e[u+ae-ce];++ae);if(ae>Z){if(Z=ae,re=ce,ae>q)break;for(var z=Math.min(ce,ae-2),Ve=0,O=0;O<z;++O){var we=u-ce+O+32768&32767,te=y[we],G=we-te+32768&32767;G>Ve&&(Ve=G,H=we)}}}I=H,H=y[I],ce+=I-H+32768&32767}if(re){w[D++]=268435456|ic[Z]<<18|Pm[re];var J=ic[Z]&31,X=Pm[re]&31;C+=Uc[J]+kc[X],++S[257+J],++b[X],L=u+Z,++R}else w[D++]=e[u],++S[e[u]]}}h=Dm(e,l,n,w,S,b,C,D,j,u-j,h),!n&&h&7&&(h=ko(l,h+1,zc))}return Jv(o,0,r+Zv(h)+s)},v2=function(){for(var e=new Qs(256),t=0;t<256;++t){for(var i=t,r=9;--r;)i=(i&1&&3988292384)^i>>>1;e[t]=i}return e}(),y2=function(){var e=-1;return{p:function(t){for(var i=e,r=0;r<t.length;++r)i=v2[i&255^t[r]]^i>>>8;e=i},d:function(){return~e}}},x2=function(e,t,i,r,s){return g2(e,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):12+t.mem,i,r,!s)},Kv=function(e,t){var i={};for(var r in e)i[r]=e[r];for(var r in t)i[r]=t[r];return i},xt=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function b2(e,t){return x2(e,t||{},0,0)}var Qv=function(e,t,i,r){for(var s in e){var n=e[s],a=t+s;n instanceof Pt?i[a]=[n,r]:Array.isArray(n)?i[a]=[n[0],Kv(r,n[1])]:Qv(n,a+"/",i,r)}},Nm=typeof TextEncoder!="undefined"&&new TextEncoder,w2=typeof TextDecoder!="undefined"&&new TextDecoder,_2=0;try{w2.decode(zc,{stream:!0}),_2=1}catch{}function ol(e,t){if(t){for(var i=new Pt(e.length),r=0;r<e.length;++r)i[r]=e.charCodeAt(r);return i}if(Nm)return Nm.encode(e);for(var s=e.length,n=new Pt(e.length+(e.length>>1)),a=0,o=function(c){n[a++]=c},r=0;r<s;++r){if(a+5>n.length){var l=new Pt(a+8+(s-r<<1));l.set(n),n=l}var h=e.charCodeAt(r);h<128||t?o(h):h<2048?(o(192|h>>6),o(128|h&63)):h>55295&&h<57344?(h=65536+(h&1023<<10)|e.charCodeAt(++r)&1023,o(240|h>>18),o(128|h>>12&63),o(128|h>>6&63),o(128|h&63)):(o(224|h>>12),o(128|h>>6&63),o(128|h&63))}return Jv(n,0,a)}var nc=function(e){var t=0;if(e)for(var i in e){var r=e[i].length;if(r>65535)throw"extra field too long";t+=r+4}return t},Om=function(e,t,i,r,s,n,a,o){var l=r.length,h=i.extra,u=o&&o.length,c=nc(h);xt(e,t,a!=null?33639248:67324752),t+=4,a!=null&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(n==null&&8),e[t++]=s&&8,e[t++]=i.compression&255,e[t++]=i.compression>>8;var d=new Date(i.mtime==null?Date.now():i.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(xt(e,t,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,n!=null&&(xt(e,t,i.crc),xt(e,t+4,n),xt(e,t+8,i.size)),xt(e,t+12,l),xt(e,t+14,c),t+=16,a!=null&&(xt(e,t,u),xt(e,t+6,i.attrs),xt(e,t+10,a),t+=14),e.set(r,t),t+=l,c)for(var f in h){var v=h[f],y=v.length;xt(e,t,+f),xt(e,t+2,y),e.set(v,t+4),t+=4+y}return u&&(e.set(o,t),t+=u),t},M2=function(e,t,i,r,s){xt(e,t,101010256),xt(e,t+8,i),xt(e,t+10,i),xt(e,t+12,r),xt(e,t+16,s)};function S2(e,t){t||(t={});var i={},r=[];Qv(e,"",i,t);var s=0,n=0;for(var a in i){var o=i[a],l=o[0],h=o[1],u=h.level==0?0:8,c=ol(a),d=c.length,p=h.comment,f=p&&ol(p),v=f&&f.length,y=nc(h.extra);if(d>65535)throw"filename too long";var g=u?b2(l,h):l,m=g.length,_=y2();_.p(l),r.push(Kv(h,{size:l.length,crc:_.d(),c:g,f:c,m:f,u:d!=a.length||f&&p.length!=v,o:s,compression:u})),s+=30+d+y+m,n+=76+2*(d+y)+(v||0)+m}for(var x=new Pt(n+22),w=s,S=n-s,b=0;b<r.length;++b){var c=r[b];Om(x,c.o,c,c.f,c.u,c.c.length);var R=30+c.f.length+nc(c.extra);x.set(c.c,c.o+R),Om(x,s,c,c.f,c.u,c.c.length,c.o,c.m),s+=16+R+(c.m?c.m.length:0)}return M2(x,s,r.length,S,w),x}var T2=class{async parse(e){let t={},i="model.usda";t[i]=null;let r=e0(),s={},n={};e.traverseVisible(o=>{if(o.isMesh&&o.material.isMeshStandardMaterial){let l=o.geometry,h=o.material,u="geometries/Geometry_"+l.id+".usd";if(!(u in t)){let c=C2(l);t[u]=A2(c)}h.uuid in s||(s[h.uuid]=h),r+=R2(o,l,h)}}),r+=O2(s,n),t[i]=ol(r),r=null;for(let o in n){let l=n[o],h=o.split("_")[1],u=l.format===1023,c=E2(l.image,h),d=await new Promise(p=>c.toBlob(p,u?"image/png":"image/jpeg",1));t[`textures/Texture_${o}.${u?"png":"jpg"}`]=new Uint8Array(await d.arrayBuffer())}let a=0;for(let o in t){let l=t[o];a+=34+o.length;let h=a&63;if(h!==4){let u=64-h,c=new Uint8Array(u);t[o]=[l,{extra:{12345:c}}]}a=l.length}return S2(t,{level:0})}};function E2(e,t){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){let i=1024/Math.max(e.width,e.height),r=document.createElement("canvas");r.width=e.width*Math.min(1,i),r.height=e.height*Math.min(1,i);let s=r.getContext("2d");if(s.drawImage(e,0,0,r.width,r.height),t!==void 0){let n=parseInt(t,16),a=(n>>16&255)/255,o=(n>>8&255)/255,l=(n&255)/255,h=s.getImageData(0,0,r.width,r.height),u=h.data;for(let c=0;c<u.length;c+=4)u[c+0]=u[c+0]*a,u[c+1]=u[c+1]*o,u[c+2]=u[c+2]*l;s.putImageData(h,0,0)}return r}}var ca=7;function e0(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Three.js USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)

`}function A2(e){let t=e0();return t+=e,ol(t)}function R2(e,t,i){let r="Object_"+e.id,s=L2(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),`def Xform "${r}" (
    prepend references = @./geometries/Geometry_${t.id}.usd@</Geometry>
)
{
    matrix4d xformOp:transform = ${s}
    uniform token[] xformOpOrder = ["xformOp:transform"]

    rel material:binding = </Materials/Material_${i.id}>
}

`}function L2(e){let t=e.elements;return`( ${Mo(t,0)}, ${Mo(t,4)}, ${Mo(t,8)}, ${Mo(t,12)} )`}function Mo(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function C2(e){return`
def "Geometry"
{
  ${P2(e)}
}
`}function P2(e){let t="Geometry",i=e.attributes,r=i.position.count;return`
    def Mesh "${t}"
    {
        int[] faceVertexCounts = [${I2(e)}]
        int[] faceVertexIndices = [${D2(e)}]
        normal3f[] normals = [${Fm(i.normal,r)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${Fm(i.position,r)}]
        float2[] primvars:st = [${N2(i.uv,r)}] (
            interpolation = "vertex"
        )
        uniform token subdivisionScheme = "none"
    }
`}function I2(e){let t=e.index!==null?e.index.array.length:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}function D2(e){if(e.index!==null)return e.index.array.join(", ");let t=[],i=e.attributes.position.count;for(let r=0;r<i;r++)t.push(r);return t.join(", ")}function Fm(e,t){if(e===void 0)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");let i=[],r=e.array;for(let s=0;s<r.length;s+=3)i.push(`(${r[s+0].toPrecision(ca)}, ${r[s+1].toPrecision(ca)}, ${r[s+2].toPrecision(ca)})`);return i.join(", ")}function N2(e,t){if(e===void 0)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");let i=[],r=e.array;for(let s=0;s<r.length;s+=2)i.push(`(${r[s+0].toPrecision(ca)}, ${1-r[s+1].toPrecision(ca)})`);return i.join(", ")}function O2(e,t){let i=[];for(let r in e){let s=e[r];i.push(F2(s,t))}return`def "Materials"
{
${i.join("")}
}

`}function F2(e,t){let i="            ",r=[],s=[];function n(a,o,l){let h=a.id+(l?"_"+l.getHexString():""),u=a.format===1023;return t[h]=a,`
        def Shader "Transform2d_${o}" (
            sdrMetadata = {
                string role = "math"
            }
        )
        {
            uniform token info:id = "UsdTransform2d"
            float2 inputs:in.connect = </Materials/Material_${e.id}/uvReader_st.outputs:result>
            float2 inputs:scale = ${km(a.repeat)}
            float2 inputs:translation = ${km(a.offset)}
            float2 outputs:result
        }

        def Shader "Texture_${a.id}_${o}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/Texture_${h}.${u?"png":"jpg"}@
            float2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${o}.outputs:result>
            token inputs:wrapS = "repeat"
            token inputs:wrapT = "repeat"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
        }`}return e.map!==null?(r.push(`${i}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),s.push(n(e.map,"diffuse",e.color))):r.push(`${i}color3f inputs:diffuseColor = ${Um(e.color)}`),e.emissiveMap!==null?(r.push(`${i}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),s.push(n(e.emissiveMap,"emissive"))):e.emissive.getHex()>0&&r.push(`${i}color3f inputs:emissiveColor = ${Um(e.emissive)}`),e.normalMap!==null&&(r.push(`${i}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),s.push(n(e.normalMap,"normal"))),e.aoMap!==null&&(r.push(`${i}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),s.push(n(e.aoMap,"occlusion"))),e.roughnessMap!==null&&e.roughness===1?(r.push(`${i}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),s.push(n(e.roughnessMap,"roughness"))):r.push(`${i}float inputs:roughness = ${e.roughness}`),e.metalnessMap!==null&&e.metalness===1?(r.push(`${i}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),s.push(n(e.metalnessMap,"metallic"))):r.push(`${i}float inputs:metallic = ${e.metalness}`),e.alphaMap!==null?(r.push(`${i}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.alphaMap.id}_opacity.outputs:r>`),r.push(`${i}float inputs:opacityThreshold = 0.0001`),s.push(n(e.alphaMap,"opacity"))):r.push(`${i}float inputs:opacity = ${e.opacity}`),e.isMeshPhysicalMaterial&&(r.push(`${i}float inputs:clearcoat = ${e.clearcoat}`),r.push(`${i}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),r.push(`${i}float inputs:ior = ${e.ior}`)),`
    def Material "Material_${e.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${r.join(`
`)}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }

        token outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>
        token inputs:frame:stPrimvarName = "st"

        def Shader "uvReader_st"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            token inputs:varname.connect = </Materials/Material_${e.id}.inputs:frame:stPrimvarName>
            float2 inputs:fallback = (0.0, 0.0)
            float2 outputs:result
        }

${s.join(`
`)}

    }
`}function Um(e){return`(${e.r}, ${e.g}, ${e.b})`}function km(e){return`(${e.x}, ${e.y})`}var U2=e=>t=>{try{let i=$r(t),r=(i.length?i[0].terms:[]).filter(n=>n&&n.type==="ident").map(n=>n.value).filter(n=>e.indexOf(n)>-1),s=new Set;for(let n of r)s.add(n);return s}catch{}return new Set},Es=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},zm=!1,Bm=!1,Hm="#model-viewer-no-ar-fallback",k2=U2(["quick-look","scene-viewer","webxr","none"]),z2="webxr scene-viewer",di={QUICK_LOOK:"quick-look",SCENE_VIEWER:"scene-viewer",WEBXR:"webxr",NONE:"none"},ki=Symbol("arButtonContainer"),Gm=Symbol("enterARWithWebXR"),Vm=Symbol("openSceneViewer"),Wm=Symbol("openIOSARQuickLook"),B2=Symbol("canActivateAR"),dr=Symbol("arMode"),jh=Symbol("arModes"),As=Symbol("arAnchor"),So=Symbol("preload"),To=Symbol("onARButtonContainerClick"),Xh=Symbol("onARStatus"),qh=Symbol("onARTracking"),Yh=Symbol("onARTap"),Dn=Symbol("selectARMode"),$h=Symbol("triggerLoad"),H2=e=>{var t,i,r,s,n,a,o,l,h,u;class c extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes=z2,this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".ar-button"),this[r]=document.createElement("a"),this[s]=new Set,this[n]=di.NONE,this[a]=!1,this[o]=p=>{p.preventDefault(),this.activateAR()},this[l]=({status:p})=>{(p===gr.NOT_PRESENTING||this[Be].arRenderer.presentedScene===this[ie])&&(this.setAttribute("ar-status",p),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:p}})),p===gr.NOT_PRESENTING?this.removeAttribute("ar-tracking"):p===gr.SESSION_STARTED&&this.setAttribute("ar-tracking",tc.TRACKING))},this[h]=({status:p})=>{this.setAttribute("ar-tracking",p),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:p}}))},this[u]=p=>{p.data=="_apple_ar_quicklook_button_tapped"&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[dr]!==di.NONE}connectedCallback(){super.connectedCallback(),this[Be].arRenderer.addEventListener("status",this[Xh]),this.setAttribute("ar-status",gr.NOT_PRESENTING),this[Be].arRenderer.addEventListener("tracking",this[qh]),this[As].addEventListener("message",this[Yh])}disconnectedCallback(){super.disconnectedCallback(),this[Be].arRenderer.removeEventListener("status",this[Xh]),this[Be].arRenderer.removeEventListener("tracking",this[qh]),this[As].removeEventListener("message",this[Yh])}async update(p){super.update(p),p.has("arScale")&&(this[ie].canScale=this.arScale!=="fixed"),p.has("arPlacement")&&(this[ie].updateShadow(),this[Rt]()),!(!p.has("ar")&&!p.has("arModes")&&!p.has("iosSrc"))&&(p.has("arModes")&&(this[jh]=k2(this.arModes)),this[Dn]())}async activateAR(){switch(this[dr]){case di.QUICK_LOOK:this[Wm]();break;case di.WEBXR:await this[Gm]();break;case di.SCENE_VIEWER:this[Vm]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities");break}}async[(t=B2,i=ki,r=As,s=jh,n=dr,a=So,o=To,l=Xh,h=qh,u=Yh,Dn)](){if(this[dr]=di.NONE,this.ar){if(this.src!=null)for(let p of this[jh]){if(p==="webxr"&&fg&&!zm&&await this[Be].arRenderer.supportsPresentation()){this[dr]=di.WEBXR;break}if(p==="scene-viewer"&&Ay&&!Bm){this[dr]=di.SCENE_VIEWER;break}if(p==="quick-look"&&nd){this[dr]=di.QUICK_LOOK;break}}!this.canActivateAR&&this.iosSrc!=null&&nd&&(this[dr]=di.QUICK_LOOK)}if(this.canActivateAR)this[ki].classList.add("enabled"),this[ki].addEventListener("click",this[To]);else if(this[ki].classList.contains("enabled")){this[ki].removeEventListener("click",this[To]),this[ki].classList.remove("enabled");let p=gr.FAILED;this.setAttribute("ar-status",p),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:p}}))}}async[Gm](){console.log("Attempting to present in AR with WebXR..."),await this[$h]();try{this[ki].removeEventListener("click",this[To]);let{arRenderer:p}=this[Be];p.placeOnWall=this.arPlacement==="wall",await p.present(this[ie],this.xrEnvironment)}catch(p){console.warn("Error while trying to present in AR with WebXR"),console.error(p),await this[Be].arRenderer.stopPresenting(),zm=!0,console.warn("Falling back to next ar-mode"),await this[Dn](),this.activateAR()}finally{this[Dn]()}}async[$h](){this.loaded||(this[So]=!0,this[gi](),await uE(this,"load"),this[So]=!1)}[Zr](){return super[Zr]()||this[So]}[Vm](){let p=self.location.toString(),f=new URL(p),v=new URL(this.src,p),y=new URLSearchParams(v.search);if(f.hash=Hm,y.set("mode","ar_preferred"),y.has("disable_occlusion")||y.set("disable_occlusion","true"),this.arScale==="fixed"&&y.set("resizable","false"),this.arPlacement==="wall"&&y.set("enable_vertical_placement","true"),y.has("sound")){let _=new URL(y.get("sound"),p);y.set("sound",_.toString())}if(y.has("link")){let _=new URL(y.get("link"),p);y.set("link",_.toString())}let g=`intent://arvr.google.com/scene-viewer/1.0?${y.toString()+"&file="+encodeURIComponent(v.toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(f.toString())};end;`,m=()=>{self.location.hash===Hm&&(Bm=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Dn]())};self.addEventListener("hashchange",m,{once:!0}),this[As].setAttribute("href",g),console.log("Attempting to present in AR with Scene Viewer..."),this[As].click()}async[Wm](){let p=!this.iosSrc;this[ki].classList.remove("enabled");let f=p?await this.prepareUSDZ():this.iosSrc,v=new URL(f,self.location.toString());this.arScale==="fixed"&&(v.hash&&(v.hash+="&"),v.hash+="allowsContentScaling=0");let y=this[As];y.setAttribute("rel","ar");let g=document.createElement("img");y.appendChild(g),y.setAttribute("href",v.toString()),p&&y.setAttribute("download","model.usdz"),console.log("Attempting to present in AR with Quick Look..."),y.click(),y.removeChild(g),p&&URL.revokeObjectURL(f),this[ki].classList.add("enabled")}async prepareUSDZ(){let p=this[Js].beginActivity();await this[$h]();let f=this[ie],v=f.shadow,y=!1;v!=null&&(y=v.visible,v.visible=!1),p(.2);let g=await new T2().parse(f.modelContainer),m=new Blob([g],{type:"model/vnd.usdz+zip"}),_=URL.createObjectURL(m);return p(1),v!=null&&(v.visible=y),_}}return Es([Ae({type:Boolean,attribute:"ar"})],c.prototype,"ar",void 0),Es([Ae({type:String,attribute:"ar-scale"})],c.prototype,"arScale",void 0),Es([Ae({type:String,attribute:"ar-placement"})],c.prototype,"arPlacement",void 0),Es([Ae({type:String,attribute:"ar-modes"})],c.prototype,"arModes",void 0),Es([Ae({type:String,attribute:"ios-src"})],c.prototype,"iosSrc",void 0),Es([Ae({type:Boolean,attribute:"xr-environment"})],c.prototype,"xrEnvironment",void 0),c},t0,jm,Xm,ln=Symbol("evaluate"),zo=Symbol("lastValue"),et=class{constructor(){this[t0]=null}static evaluatableFor(e,t=Mr){if(e instanceof et)return e;if(e.type==="number")return e.unit==="%"?new G2(e,t):e;switch(e.name.value){case"calc":return new j2(e,t);case"env":return new V2(e)}return Mr}static evaluate(e){return e instanceof et?e.evaluate():e}static isConstant(e){return e instanceof et?e.isConstant:!0}static applyIntrinsics(e,t){let{basis:i,keywords:r}=t,{auto:s}=r;return i.map((n,a)=>{let o=s[a]==null?n:s[a],l=e[a]?e[a]:o;if(l.type==="ident"){let h=l.value;h in r&&(l=r[h][a])}return(l==null||l.type==="ident")&&(l=o),l.unit==="%"?gt(l.number/100*n.number,n.unit):(l=yi(l,n),l.unit!==n.unit?n:l)})}get isConstant(){return!1}evaluate(){return(!this.isConstant||this[zo]==null)&&(this[zo]=this[ln]()),this[zo]}};t0=zo;var qm=Symbol("percentage"),Zh=Symbol("basis"),G2=class extends et{constructor(e,t){super(),this[qm]=e,this[Zh]=t}get isConstant(){return!0}[ln](){return gt(this[qm].number/100*this[Zh].number,this[Zh].unit)}},Eo=Symbol("identNode"),V2=class extends et{constructor(e){super(),this[jm]=null;let t=e.arguments.length?e.arguments[0].terms[0]:null;t!=null&&t.type==="ident"&&(this[Eo]=t)}get isConstant(){return!1}[(jm=Eo,ln)](){if(this[Eo]!=null)switch(this[Eo].value){case"window-scroll-y":let e=window.pageYOffset,t=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),i=e/(t-window.innerHeight)||0;return{type:"number",number:i,unit:null}}return Mr}},W2=/[\*\/]/,Rs=Symbol("evalutor"),j2=class extends et{constructor(e,t=Mr){if(super(),this[Xm]=null,e.arguments.length!==1)return;let i=e.arguments[0].terms.slice(),r=[];for(;i.length;){let s=i.shift();if(r.length>0){let n=r[r.length-1];if(n.type==="operator"&&W2.test(n.value)){let a=r.pop(),o=r.pop();if(o==null)return;r.push(new $m(a,et.evaluatableFor(o,t),et.evaluatableFor(s,t)));continue}}r.push(s.type==="operator"?s:et.evaluatableFor(s,t))}for(;r.length>2;){let[s,n,a]=r.splice(0,3);if(n.type!=="operator")return;r.unshift(new $m(n,et.evaluatableFor(s,t),et.evaluatableFor(a,t)))}r.length===1&&(this[Rs]=r[0])}get isConstant(){return this[Rs]==null||et.isConstant(this[Rs])}[(Xm=Rs,ln)](){return this[Rs]!=null?et.evaluate(this[Rs]):Mr}},Ym=Symbol("operator"),Jh=Symbol("left"),Kh=Symbol("right"),$m=class extends et{constructor(e,t,i){super(),this[Ym]=e,this[Jh]=t,this[Kh]=i}get isConstant(){return et.isConstant(this[Jh])&&et.isConstant(this[Kh])}[ln](){let e=yi(et.evaluate(this[Jh])),t=yi(et.evaluate(this[Kh])),{number:i,unit:r}=e,{number:s,unit:n}=t;if(n!=null&&r!=null&&n!=r)return Mr;let a=r||n,o;switch(this[Ym].value){case"+":o=i+s;break;case"-":o=i-s;break;case"/":o=i/s;break;case"*":o=i*s;break;default:return Mr}return{type:"number",number:o,unit:a}}},Qh=Symbol("evaluatables"),Zm=Symbol("intrinsics"),i0=class extends et{constructor(e,t){super(),this[Zm]=t;let i=e[0],r=i!=null?i.terms:[];this[Qh]=t.basis.map((s,n)=>{let a=r[n];return a==null?{type:"ident",value:"auto"}:a.type==="ident"?a:et.evaluatableFor(a,s)})}get isConstant(){for(let e of this[Qh])if(!et.isConstant(e))return!1;return!0}[ln](){let e=this[Qh].map(t=>et.evaluate(t));return et.applyIntrinsics(e,this[Zm]).map(t=>t.number)}},r0,s0,n0,a0,Ls=Symbol("instances"),Jm=Symbol("activateListener"),Km=Symbol("deactivateListener"),eu=Symbol("notifyInstances"),Qm=Symbol("notify"),ef=Symbol("callback"),Hi=class{constructor(e){this[ef]=e}static[eu](){for(let e of Hi[Ls])e[Qm]()}static[(r0=Ls,Jm)](){window.addEventListener("scroll",this[eu],{passive:!0})}static[Km](){window.removeEventListener("scroll",this[eu])}observe(){Hi[Ls].size===0&&Hi[Jm](),Hi[Ls].add(this)}disconnect(){Hi[Ls].delete(this),Hi[Ls].size===0&&Hi[Km]()}[Qm](){this[ef]()}};Hi[r0]=new Set;var tf=Symbol("computeStyleCallback"),o0=Symbol("astWalker"),Qn=Symbol("dependencies"),l0=Symbol("onScroll"),X2=class{constructor(e){this[s0]={},this[n0]=new fE(["function"]),this[a0]=()=>{this[tf]({relatedState:"window-scroll"})},this[tf]=e}observeEffectsFor(e){let t={},i=this[Qn];this[o0].walk(e,r=>{let{name:s}=r,n=r.arguments[0].terms[0];if(!(s.value!=="env"||n==null||n.type!=="ident"))switch(n.value){case"window-scroll-y":if(t["window-scroll"]==null){let a="window-scroll"in i?i["window-scroll"]:new Hi(this[l0]);a.observe(),delete i["window-scroll"],t["window-scroll"]=a}break}});for(let r in i)i[r].disconnect();this[Qn]=t}dispose(){for(let e in this[Qn])this[Qn][e].disconnect()}};s0=Qn,n0=o0,a0=l0;var pr=e=>{let t=e.observeEffects||!1,i=e.intrinsics instanceof Function?e.intrinsics:()=>e.intrinsics;return(r,s)=>{let n=r.updated,a=r.connectedCallback,o=r.disconnectedCallback,l=Symbol(`${s}StyleEffector`),h=Symbol(`${s}StyleEvaluator`),u=Symbol(`${s}UpdateEvaluator`),c=Symbol(`${s}EvaluateAndSync`);Object.defineProperties(r,{[l]:{value:null,writable:!0},[h]:{value:null,writable:!0},[u]:{value:function(){let d=$r(this[s]);this[h]=new i0(d,i(this)),this[l]==null&&t&&(this[l]=new X2(()=>this[c]())),this[l]!=null&&this[l].observeEffectsFor(d)}},[c]:{value:function(){if(this[h]==null)return;let d=this[h].evaluate();this[e.updateHandler](d)}},updated:{value:function(d){d.has(s)&&(this[u](),this[c]()),n.call(this,d)}},connectedCallback:{value:function(){a.call(this),this.requestUpdate(s,this[s])}},disconnectedCallback:{value:function(){o.call(this),this[l]!=null&&(this[l].dispose(),this[l]=null)}}})}},rf=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,interactionPolicy:"always-allow",touchAction:"pan-y"}),Ao=Math.PI/8,Ro=.04,Cs={PAGE_UP:33,PAGE_DOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40},Bo={USER_INTERACTION:"user-interaction",NONE:"none"},q2=class extends Ht{constructor(e,t){super(),this.camera=e,this.element=t,this.sensitivity=1,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserChange=!1,this.isUserPointing=!1,this.spherical=new Fo,this.goalSpherical=new Fo,this.thetaDamper=new kt,this.phiDamper=new kt,this.radiusDamper=new kt,this.logFov=Math.log(rf.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new kt,this.touchMode=null,this.lastPointerPosition={clientX:0,clientY:0},this.touchDecided=!1,this.onMouseMove=i=>{this.handleSinglePointerMove(i),i.cancelable&&i.preventDefault()},this.onTouchMove=i=>{this.touchMode!==null&&(this.touchMode(i),this.touchMode!==null&&i.cancelable&&i.preventDefault())},this.touchModeZoom=i=>{let{targetTouches:r}=i;if(this.lastTouches.length>1&&r.length>1){let s=this.twoTouchDistance(this.lastTouches[0],this.lastTouches[1]),n=this.twoTouchDistance(r[0],r[1]),a=Ro*(s-n)/10;this.userAdjustOrbit(0,0,a),this.lastTouches=r}},this.touchModeRotate=i=>{let{targetTouches:r}=i,{touchAction:s}=this._options;if(!this.touchDecided&&s!=="none"){this.touchDecided=!0;let{clientX:n,clientY:a}=r[0],o=Math.abs(n-this.lastPointerPosition.clientX),l=Math.abs(a-this.lastPointerPosition.clientY);if(s==="pan-y"&&l>o||s==="pan-x"&&o>l){this.touchMode=null;return}}this.handleSinglePointerMove(r[0]),this.lastTouches=r},this.onMouseDown=i=>{this.onPointerDown(()=>{self.addEventListener("mousemove",this.onMouseMove),self.addEventListener("mouseup",this.onMouseUp,{once:!0}),this.handleSinglePointerDown(i)})},this.onTouchStart=i=>{this.onPointerDown(()=>{let{targetTouches:r,changedTouches:s,touches:n}=i;r.length===s.length&&(this.touchMode=null,this.touchDecided=!1),r.length===n.length&&this.onTouchChange(i)})},this.onMouseUp=i=>{self.removeEventListener("mousemove",this.onMouseMove),this.onPointerUp()},this.onTouchEnd=i=>{i.targetTouches.length>0&&this.touchMode!==null&&this.onTouchChange(i),this.onPointerUp()},this.onWheel=i=>{if(!this.canInteract)return;let r=i.deltaY*(i.deltaMode==1?18:1)*Ro/30;this.userAdjustOrbit(0,0,r),i.cancelable&&i.preventDefault()},this.onKeyDown=i=>{let r=!1;switch(i.keyCode){case Cs.PAGE_UP:r=!0,this.userAdjustOrbit(0,0,Ro);break;case Cs.PAGE_DOWN:r=!0,this.userAdjustOrbit(0,0,-1*Ro);break;case Cs.UP:r=!0,this.userAdjustOrbit(0,-Ao,0);break;case Cs.DOWN:r=!0,this.userAdjustOrbit(0,Ao,0);break;case Cs.LEFT:r=!0,this.userAdjustOrbit(-Ao,0,0);break;case Cs.RIGHT:r=!0,this.userAdjustOrbit(Ao,0,0);break}r&&i.cancelable&&i.preventDefault()},this._options=Object.assign({},rf),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(this._interactionEnabled===!1){let{element:e}=this;e.addEventListener("mousedown",this.onMouseDown),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchmove",this.onTouchMove,{passive:!1}),e.addEventListener("touchend",this.onTouchEnd),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(this._interactionEnabled===!0){let{element:e}=this;self.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mousedown",this.onMouseDown),this._disableZoom||e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchmove",this.onTouchMove),self.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("touchend",this.onTouchEnd),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,e===!0?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new Fo){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.near=Math.max(e,t/1e3),this.camera.far=t,this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,i=this.goalSpherical.radius){let{minimumAzimuthalAngle:r,maximumAzimuthalAngle:s,minimumPolarAngle:n,maximumPolarAngle:a,minimumRadius:o,maximumRadius:l}=this._options,{theta:h,phi:u,radius:c}=this.goalSpherical,d=Hr(e,r,s);!isFinite(r)&&!isFinite(s)&&(this.spherical.theta=this.wrapAngle(this.spherical.theta-d)+d);let p=Hr(t,n,a),f=Hr(i,o,l);return d===h&&p===u&&f===c?!1:(this.goalSpherical.theta=d,this.goalSpherical.phi=p,this.goalSpherical.radius=f,this.goalSpherical.makeSafe(),this.isUserChange=!1,!0)}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){let{minimumFieldOfView:t,maximumFieldOfView:i}=this._options;e=Hr(e,t,i),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,i){let{theta:r,phi:s,radius:n}=this.goalSpherical,{minimumRadius:a,maximumRadius:o,minimumFieldOfView:l,maximumFieldOfView:h}=this._options,u=this.spherical.theta-r,c=Math.PI-.001,d=r-Hr(e,-c-u,c-u),p=s-t,f=i===0?0:((i>0?o:a)-n)/(Math.log(i>0?h:l)-this.goalLogFov),v=n+i*Math.min(isFinite(f)?f:1/0,o-a);if(this.setOrbit(d,p,v),i!==0){let y=this.goalLogFov+i;this.setFieldOfView(Math.exp(y))}}jumpToGoal(){this.update(0,Ov)}update(e,t){if(this.isStationary())return;let{maximumPolarAngle:i,maximumRadius:r}=this._options,s=this.spherical.theta-this.goalSpherical.theta;Math.abs(s)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=Math.sign(s)*2*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,r),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera()}updateTouchActionStyle(){let{style:e}=this.element;if(this._interactionEnabled){let{touchAction:t}=this._options;this._disableZoom&&t!=="none"?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new es(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix());let e=this.isUserChange?Bo.USER_INTERACTION:Bo.NONE;this.dispatchEvent({type:"change",source:e})}get canInteract(){return this._options.interactionPolicy=="allow-when-focused"?this.element.getRootNode().activeElement===this.element:this._options.interactionPolicy==="always-allow"}userAdjustOrbit(e,t,i){this.adjustOrbit(e*this.sensitivity,t*this.sensitivity,i),this.isUserChange=!0,this.dispatchEvent({type:"change",source:Bo.USER_INTERACTION})}wrapAngle(e){let t=(e+Math.PI)/(2*Math.PI);return(t-Math.floor(t))*2*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.element.clientHeight}twoTouchDistance(e,t){let{clientX:i,clientY:r}=e,{clientX:s,clientY:n}=t,a=s-i,o=n-r;return Math.sqrt(a*a+o*o)}handleSinglePointerMove(e){let{clientX:t,clientY:i}=e,r=this.pixelLengthToSphericalAngle(t-this.lastPointerPosition.clientX),s=this.pixelLengthToSphericalAngle(i-this.lastPointerPosition.clientY);this.lastPointerPosition.clientX=t,this.lastPointerPosition.clientY=i,this.isUserPointing===!1&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start",pointer:Object.assign({},e)})),this.userAdjustOrbit(r,s,0)}onPointerDown(e){!this.canInteract||(this.isUserPointing=!1,e())}onTouchChange(e){let{targetTouches:t}=e;switch(t.length){default:case 1:this.touchMode=this.touchModeRotate,this.handleSinglePointerDown(t[0]);break;case 2:this.touchMode=this._disableZoom||this.touchDecided&&this.touchMode===null?null:this.touchModeZoom,this.touchDecided=!0;break}this.lastTouches=t}handleSinglePointerDown(e){this.lastPointerPosition.clientX=e.clientX,this.lastPointerPosition.clientY=e.clientY,this.element.style.cursor="grabbing"}onPointerUp(){this.element.style.cursor="grab",this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end",pointer:Object.assign({},this.lastPointerPosition)})}},h0=e=>e<.5?2*e*e:-1+(4-2*e)*e,Y2=(e,t,i=h0)=>r=>e+(t-e)*i(r),$2=(e,t)=>{let i=t.reduce((s,n)=>s+n,0),r=t.map(s=>s/i);return s=>{let n=0,a=1/0,o=()=>0;for(let l=0;l<r.length&&(a=r[l],o=e[l],!(s<=n+a));++l)n+=a;return o((s-n)/a)}},u0=(e,t)=>{let i=[],r=[],s=e;for(let n=0;n<t.length;++n){let a=t[n],{value:o,frames:l}=a,h=a.ease||h0,u=Y2(s,o,h);i.push(u),r.push(l),s=o}return $2(i,r)},vt=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},Z2=5e3,J2=u0(0,[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]),K2=u0(0,[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]),c0="0deg 75deg 105%",Q2="auto auto auto",eA="auto",tA=1.1*ec,iA=["front","right","back","left"],rA=["upper-","","lower-"],sA=3e3,nA="Use mouse, touch or arrow keys to control the camera!",Dr={AUTO:"auto",WHEN_FOCUSED:"when-focused",NONE:"none"},tu={BASIC:"basic",WIGGLE:"wiggle"},aA={ALWAYS_ALLOW:"always-allow",WHEN_FOCUSED:"allow-when-focused"},oA={PAN_Y:"pan-y",PAN_X:"pan-x",NONE:"none"},lA=e=>({basis:[gt(e[ea]*Math.PI/180,"rad")],keywords:{auto:[null]}}),hA={basis:[Al(gt(25,"deg"))],keywords:{auto:[null]}},uA=e=>{let t=e[ie];return{basis:[Al(gt(45,"deg"))],keywords:{auto:[gt(t.framedFieldOfView,"deg")]}}},d0=(()=>{let e=$r(c0)[0].terms,t=yi(e[0]),i=yi(e[1]);return r=>{let s=r[ie].idealCameraDistance;return{basis:[t,i,gt(s,"m")],keywords:{auto:[null,null,gt(105,"%")]}}}})(),cA=e=>{let t=tA*e[ie].idealCameraDistance;return{basis:[gt(-1/0,"rad"),gt(Math.PI/8,"rad"),gt(t,"m")],keywords:{auto:[null,null,null]}}},dA=e=>{let t=d0(e),i=new i0([],t).evaluate()[2];return{basis:[gt(1/0,"rad"),gt(Math.PI-Math.PI/8,"rad"),gt(i,"m")],keywords:{auto:[null,null,null]}}},pA=e=>{let t=e[ie].boundingBox.getCenter(new E);return{basis:[gt(t.x,"m"),gt(t.y,"m"),gt(t.z,"m")],keywords:{auto:[null,null,null]}}},ac=Math.PI/2,sf=Math.PI/3,nf=ac/2,af=2*Math.PI,Qe=Symbol("controls"),Nn=Symbol("promptElement"),iu=Symbol("promptAnimatedContainer"),Lo=Symbol("deferInteractionPrompt"),of=Symbol("updateAria"),lf=Symbol("updateCameraForRadius"),ru=Symbol("onBlur"),su=Symbol("onFocus"),nu=Symbol("onChange"),On=Symbol("onPointerChange"),zi=Symbol("waitingToPromptUser"),Fn=Symbol("userHasInteracted"),Nr=Symbol("promptElementVisibleTime"),Un=Symbol("lastPromptOffset"),kn=Symbol("focusedTime"),ea=Symbol("zoomAdjustedFieldOfView"),Co=Symbol("lastSpherical"),zn=Symbol("jumpCamera"),au=Symbol("initialized"),Bn=Symbol("maintainThetaPhi"),hf=Symbol("syncCameraOrbit"),uf=Symbol("syncFieldOfView"),cf=Symbol("syncCameraTarget"),df=Symbol("syncMinCameraOrbit"),pf=Symbol("syncMaxCameraOrbit"),mf=Symbol("syncMinFieldOfView"),ff=Symbol("syncMaxFieldOfView"),mA=e=>{var t,i,r,s,n,a,o,l,h,u,c,d,p,f,v,y,g;class m extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=c0,this.cameraTarget=Q2,this.fieldOfView=eA,this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=sA,this.interactionPromptStyle=tu.WIGGLE,this.interactionPrompt=Dr.AUTO,this.interactionPolicy=aA.ALWAYS_ALLOW,this.orbitSensitivity=1,this.touchAction=oA.PAN_Y,this.disableZoom=!1,this.interpolationDecay=Fv,this.bounds="legacy",this[t]=this.shadowRoot.querySelector(".interaction-prompt"),this[i]=this.shadowRoot.querySelector(".interaction-prompt > .animated-container"),this[r]=1/0,this[s]=0,this[n]=1/0,this[a]=!1,this[o]=!1,this[l]=new q2(this[ie].camera,this[Vi]),this[h]=0,this[u]=new Fo,this[c]=!1,this[d]=!1,this[p]=!1,this[f]=()=>{let x=this[Vi];isFinite(this[kn])||(this[kn]=performance.now());let w=this[Oc];x.getAttribute("aria-label")!==w&&x.setAttribute("aria-label",w),this.interactionPrompt===Dr.WHEN_FOCUSED&&!this[Fn]&&(this[zi]=!0)},this[v]=()=>{this.interactionPrompt===Dr.WHEN_FOCUSED&&(this[zi]=!1,this[Nn].classList.remove("visible"),this[Nr]=1/0,this[kn]=1/0)},this[y]=({source:x})=>{this[of](),this[Rt](),x===Bo.USER_INTERACTION&&(this[Fn]=!0,this[Lo]()),this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:x}}))},this[g]=x=>{x.type==="pointer-change-start"?this[ha].classList.add("pointer-tumbling"):this[ha].classList.remove("pointer-tumbling")}}getCameraOrbit(){let{theta:x,phi:w,radius:S}=this[Co];return{theta:x,phi:w,radius:S,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return nl(this[Be].isPresenting?this[Be].arRenderer.target:this[ie].getTarget())}getFieldOfView(){return this[Qe].getFieldOfView()}getMinimumFieldOfView(){return this[Qe].options.minimumFieldOfView}getMaximumFieldOfView(){return this[Qe].options.maximumFieldOfView}jumpCameraToGoal(){this[zn]=!0,this.requestUpdate(zn,!1)}resetInteractionPrompt(){this[Un]=0,this[Nr]=1/0,this[Fn]=!1,this[zi]=this.interactionPrompt===Dr.AUTO&&this.cameraControls}connectedCallback(){super.connectedCallback(),this[Qe].addEventListener("change",this[nu]),this[Qe].addEventListener("pointer-change-start",this[On]),this[Qe].addEventListener("pointer-change-end",this[On])}disconnectedCallback(){super.disconnectedCallback(),this[Qe].removeEventListener("change",this[nu]),this[Qe].removeEventListener("pointer-change-start",this[On]),this[Qe].removeEventListener("pointer-change-end",this[On])}updated(x){super.updated(x);let w=this[Qe],S=this[Vi];if(x.has("cameraControls")&&(this.cameraControls?(w.enableInteraction(),this.interactionPrompt===Dr.AUTO&&(this[zi]=!0),S.addEventListener("focus",this[su]),S.addEventListener("blur",this[ru])):(S.removeEventListener("focus",this[su]),S.removeEventListener("blur",this[ru]),w.disableInteraction(),this[Lo]())),x.has("disableZoom")&&(w.disableZoom=this.disableZoom),x.has("bounds")&&(this[ie].tightBounds=this.bounds==="tight"),(x.has("interactionPrompt")||x.has("cameraControls")||x.has("src"))&&(this.interactionPrompt===Dr.AUTO&&this.cameraControls&&!this[Fn]?this[zi]=!0:this[Lo]()),x.has("interactionPromptStyle")&&this[Nn].classList.toggle("wiggle",this.interactionPromptStyle===tu.WIGGLE),x.has("interactionPolicy")){let b=this.interactionPolicy;w.applyOptions({interactionPolicy:b})}if(x.has("touchAction")){let b=this.touchAction;w.applyOptions({touchAction:b}),w.updateTouchActionStyle()}x.has("orbitSensitivity")&&(w.sensitivity=this.orbitSensitivity),x.has("interpolationDecay")&&(w.setDamperDecayTime(this.interpolationDecay),this[ie].setTargetDamperDecayTime(this.interpolationDecay)),this[zn]===!0&&Promise.resolve().then(()=>{w.jumpToGoal(),this[ie].jumpToGoal(),this[zn]=!1})}async updateFraming(){let x=this[ie],w=x.framedFieldOfView;await this.requestUpdate("cameraTarget"),x.updateFraming(this.bounds==="tight"?x.getTarget():void 0),x.frameModel();let S=x.framedFieldOfView,b=this[Qe].getFieldOfView()/w;this[ea]=S*b,this[Bn]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),await this.requestUpdate("cameraOrbit")}[(t=Nn,i=iu,r=kn,s=Un,n=Nr,a=Fn,o=zi,l=Qe,h=ea,u=Co,c=zn,d=au,p=Bn,uf)](x){this[Qe].setFieldOfView(x[0]*180/Math.PI)}[hf](x){if(this[Bn]){let{theta:w,phi:S}=this.getCameraOrbit();x[0]=w,x[1]=S,this[Bn]=!1}this[Qe].setOrbit(x[0],x[1],x[2])}[df](x){this[Qe].applyOptions({minimumAzimuthalAngle:x[0],minimumPolarAngle:x[1],minimumRadius:x[2]}),this.jumpCameraToGoal()}[pf](x){this[Qe].applyOptions({maximumAzimuthalAngle:x[0],maximumPolarAngle:x[1],maximumRadius:x[2]}),this[lf](x[2]),this.jumpCameraToGoal()}[mf](x){this[Qe].applyOptions({minimumFieldOfView:x[0]*180/Math.PI}),this.jumpCameraToGoal()}[ff](x){this[Qe].applyOptions({maximumFieldOfView:x[0]*180/Math.PI}),this.jumpCameraToGoal()}[cf](x){let[w,S,b]=x;this[ie].setTarget(w,S,b),this[Be].arRenderer.updateTarget()}[_i](x,w){if(super[_i](x,w),this[Be].isPresenting||!this[Ks]())return;let S=performance.now();if(this[zi]){let b=this.interactionPrompt===Dr.AUTO?this[Kn]:this[kn];this.loaded&&S>b+this.interactionPromptThreshold&&(this[Vi].setAttribute("aria-label",nA),this[zi]=!1,this[Nr]=S,this[Nn].classList.add("visible"))}if(isFinite(this[Nr])&&this.interactionPromptStyle===tu.WIGGLE){let b=this[ie],R=(S-this[Nr])/Z2%1,C=J2(R),D=K2(R);if(this[iu].style.opacity=`${D}`,C!==this[Un]){let L=C*b.width*.05,j=(C-this[Un])*Math.PI/16;this[iu].style.transform=`translateX(${L}px)`,this[Qe].adjustOrbit(j,0,0),this[Un]=C}}this[Qe].update(x,w),this[ie].updateTarget(w)}[Lo](){this[zi]=!1,this[Nn].classList.remove("visible"),this[Nr]=1/0}[lf](x){let{idealCameraDistance:w}=this[ie],S=Math.max(w,x),b=0,R=2*S;this[Qe].updateNearFar(b,R)}[of](){let{theta:x,phi:w}=this[Co],{theta:S,phi:b}=this[Qe].getCameraSpherical(this[Co]),R=this.getRootNode();if(R!=null&&R.activeElement===this){let C=(4+Math.floor((x%af+nf)/ac))%4,D=(4+Math.floor((S%af+nf)/ac))%4,L=Math.floor(w/sf),j=Math.floor(b/sf);if(D!==C||j!==L){let N=iA[D],I=`View from stage ${rA[j]}${N}`;this[Vi].setAttribute("aria-label",I)}}}[Aa](x){let w=this[Qe],S=this[ie].framedFieldOfView;super[Aa](x);let b=this[ie].framedFieldOfView,R=w.getFieldOfView()/S;this[ea]=b*R,w.updateAspect(this[ie].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.jumpCameraToGoal()}[Mi](){super[Mi]();let{framedFieldOfView:x}=this[ie];this[ea]=x,this[au]?this[Bn]=!0:this[au]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}return f=su,v=ru,y=nu,g=On,vt([Ae({type:Boolean,attribute:"camera-controls"})],m.prototype,"cameraControls",void 0),vt([pr({intrinsics:d0,observeEffects:!0,updateHandler:hf}),Ae({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],m.prototype,"cameraOrbit",void 0),vt([pr({intrinsics:pA,observeEffects:!0,updateHandler:cf}),Ae({type:String,attribute:"camera-target",hasChanged:()=>!0})],m.prototype,"cameraTarget",void 0),vt([pr({intrinsics:lA,observeEffects:!0,updateHandler:uf}),Ae({type:String,attribute:"field-of-view",hasChanged:()=>!0})],m.prototype,"fieldOfView",void 0),vt([pr({intrinsics:cA,updateHandler:df}),Ae({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],m.prototype,"minCameraOrbit",void 0),vt([pr({intrinsics:dA,updateHandler:pf}),Ae({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],m.prototype,"maxCameraOrbit",void 0),vt([pr({intrinsics:hA,updateHandler:mf}),Ae({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],m.prototype,"minFieldOfView",void 0),vt([pr({intrinsics:uA,updateHandler:ff}),Ae({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],m.prototype,"maxFieldOfView",void 0),vt([Ae({type:Number,attribute:"interaction-prompt-threshold"})],m.prototype,"interactionPromptThreshold",void 0),vt([Ae({type:String,attribute:"interaction-prompt-style"})],m.prototype,"interactionPromptStyle",void 0),vt([Ae({type:String,attribute:"interaction-prompt"})],m.prototype,"interactionPrompt",void 0),vt([Ae({type:String,attribute:"interaction-policy"})],m.prototype,"interactionPolicy",void 0),vt([Ae({type:Number,attribute:"orbit-sensitivity"})],m.prototype,"orbitSensitivity",void 0),vt([Ae({type:String,attribute:"touch-action"})],m.prototype,"touchAction",void 0),vt([Ae({type:Boolean,attribute:"disable-zoom"})],m.prototype,"disableZoom",void 0),vt([Ae({type:Number,attribute:"interpolation-decay"})],m.prototype,"interpolationDecay",void 0),vt([Ae({type:String,attribute:"bounds"})],m.prototype,"bounds",void 0),m},p0,m0,fA="This page includes one or more 3D models that are loading",gA="All 3D models in the page have loaded",vA=100,Ho=Symbol("modelViewerStatusInstance"),f0=Symbol("updateStatus"),yA=class extends Ht{constructor(){super(),this[p0]=null,this.registeredInstanceStatuses=new Map,this.loadingPromises=[],this.statusElement=document.createElement("p"),this.statusUpdateInProgress=!1,this[m0]=Ku(()=>this.updateStatus(),vA);let{statusElement:e}=this,{style:t}=e;e.setAttribute("role","status"),e.classList.add("screen-reader-only"),t.top=t.left="0",t.pointerEvents="none"}registerInstance(e){if(this.registeredInstanceStatuses.has(e))return;let t=()=>{},i=e.loaded===!1&&!!e.src,r=new Promise(s=>{if(!i){s();return}let n=()=>{s(),e.removeEventListener("load",n),e.removeEventListener("error",n)};e.addEventListener("load",n),e.addEventListener("error",n),t=n});this.registeredInstanceStatuses.set(e,{onUnregistered:t}),this.loadingPromises.push(r),this.modelViewerStatusInstance==null&&(this.modelViewerStatusInstance=e)}unregisterInstance(e){if(!this.registeredInstanceStatuses.has(e))return;let t=this.registeredInstanceStatuses,i=t.get(e);t.delete(e),i.onUnregistered(),this.modelViewerStatusInstance===e&&(this.modelViewerStatusInstance=t.size>0?hE(t):null)}get modelViewerStatusInstance(){return this[Ho]}set modelViewerStatusInstance(e){if(this[Ho]===e)return;let{statusElement:t}=this;e!=null&&e.shadowRoot!=null?e.shadowRoot.appendChild(t):t.parentNode!=null&&t.parentNode.removeChild(t),this[Ho]=e,this[f0]()}async updateStatus(){if(!(this.statusUpdateInProgress||this.loadingPromises.length===0)){for(this.statusElement.textContent=fA,this.statusUpdateInProgress=!0,this.dispatchEvent({type:"initial-status-announced"});this.loadingPromises.length;){let{loadingPromises:e}=this;this.loadingPromises=[],await Promise.all(e)}this.statusElement.textContent=gA,this.statusUpdateInProgress=!1,this.dispatchEvent({type:"finished-loading-announced"})}}};p0=Ho,m0=f0;var Hn=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},xA=100,bA=.2,wA="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",_A="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/",MA=32,SA=13,Gn={AUTO:"auto",INTERACTION:"interaction",MANUAL:"manual"},gf={AUTO:"auto",LAZY:"lazy",EAGER:"eager"},TA={INTERACTION:"interaction"},vf=new yA,Or=Symbol("defaultProgressBarElement"),yf=Symbol("defaultProgressMaskElement"),Bi=Symbol("posterContainerElement"),Ps=Symbol("defaultPosterElement"),Vn=Symbol("posterDismissalSource"),ou=Symbol("hidePoster"),Po=Symbol("modelIsRevealed"),lu=Symbol("updateProgressBar"),Wn=Symbol("lastReportedProgress"),jn=Symbol("transitioned"),hu=Symbol("onTransitionEnd"),xf=Symbol("ariaLabelCallToAction"),uu=Symbol("onClick"),cu=Symbol("onKeydown"),du=Symbol("onProgress"),EA=e=>{var t,i,r,s,n,a,o,l,h,u,c,d,p,f;class v extends e{constructor(...g){super(...g),this.poster=null,this.reveal=Gn.AUTO,this.loading=gf.AUTO,this.generateSchema=!1,this.seamlessPoster=!1,this[t]=!1,this[i]=!1,this[r]=0,this[s]=null,this[n]=this.shadowRoot.querySelector(".slot.poster"),this[a]=this.shadowRoot.querySelector("#default-poster"),this[o]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[l]=this.shadowRoot.querySelector("#default-progress-bar > .mask"),this[h]=this[Ps].getAttribute("aria-label"),this[u]=oE(w=>{let S=this[Or].parentNode;requestAnimationFrame(()=>{this[yf].style.opacity=`${(1-w)*bA}`,this[Or].style.transform=`scaleX(${w})`,w===0&&(S.removeChild(this[Or]),S.appendChild(this[Or])),w===1?this[Or].classList.add("hide"):this[Or].classList.remove("hide")})},xA),this[c]=()=>{this.reveal!==Gn.MANUAL&&this.dismissPoster()},this[d]=w=>{if(this.reveal!==Gn.MANUAL)switch(w.keyCode){case MA:case SA:this.dismissPoster();break}},this[p]=w=>{let S=w.detail.totalProgress;this[Wn]=Math.max(S,this[Wn]),S===1&&(this[lu].flush(),this[Gr]()&&(this[Vn]!=null||this.reveal===Gn.AUTO)&&this[ou]()),this[lu](S),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:S}}))},this[f]=()=>{this[jn]=!0;let w=this.getRootNode();w&&w.activeElement===this&&this[Vi].focus();let S=this[Ps];S.setAttribute("aria-hidden","true"),S.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))};let m=self.ModelViewerElement||{},_=m.dracoDecoderLocation||wA;Et.setDRACODecoderLocation(_);let x=m.ktx2TranscoderLocation||_A;Et.setKTX2TranscoderLocation(x),m.meshoptDecoderLocation&&Et.setMeshoptDecoderLocation(m.meshoptDecoderLocation)}static set dracoDecoderLocation(g){Et.setDRACODecoderLocation(g)}static get dracoDecoderLocation(){return Et.getDRACODecoderLocation()}static set ktx2TranscoderLocation(g){Et.setKTX2TranscoderLocation(g)}static get ktx2TranscoderLocation(){return Et.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(g){Et.setMeshoptDecoderLocation(g)}static get meshoptDecoderLocation(){return Et.getMeshoptDecoderLocation()}static mapURLs(g){Yi.singleton.loader[Fs].manager.setURLModifier(g)}dismissPoster(){this[Gr]()?this[ou]():(this[Vn]=TA.INTERACTION,this[gi]())}showPoster(){let g=this[Bi],m=this[Ps];m.removeAttribute("tabindex"),m.removeAttribute("aria-hidden"),g.classList.add("show");let _=this.modelIsVisible;this[Po]=!1,this[il](_),this[jn]=!1}getDimensions(){return nl(this[ie].size)}connectedCallback(){super.connectedCallback(),this[Bi].addEventListener("click",this[uu]),this[Bi].addEventListener("keydown",this[cu]),this[Js].addEventListener("progress",this[du]),vf.registerInstance(this)}disconnectedCallback(){super.disconnectedCallback(),this[Bi].removeEventListener("click",this[uu]),this[Bi].removeEventListener("keydown",this[cu]),this[Js].removeEventListener("progress",this[du]),vf.unregisterInstance(this)}async updated(g){super.updated(g),g.has("poster")&&this.poster!=null&&(this[Ps].style.backgroundImage=`url(${this.poster})`),g.has("alt")&&this[Ps].setAttribute("aria-label",`${this[Oc]}. ${this[xf]}`),(g.has("reveal")||g.has("loading"))&&this[gi](),g.has("generateSchema")&&(this.generateSchema===!0?this[ie].updateSchema(this.src):this[ie].updateSchema(null)),g.has("seamlessPoster")&&(this.seamlessPoster===!0?this[Bi].classList.add("quick"):this[Bi].classList.remove("quick"))}[(t=Po,i=jn,r=Wn,s=Vn,n=Bi,a=Ps,o=Or,l=yf,h=xf,u=lu,c=uu,d=cu,p=du,Zr)](){return!!this.src&&(this[Vn]!=null||this.loading===gf.EAGER||this.reveal===Gn.AUTO&&this[Br])}[Gr](){let{src:g}=this;return!!g&&super[Gr]()&&this[Wn]===1}[(f=hu,ou)](){this[Vn]=null;let g=this[Bi];if(g.classList.contains("show")){let m=this.modelIsVisible;this[Po]=!0,this[il](m),requestAnimationFrame(()=>{g.classList.remove("show"),this.seamlessPoster===!0?this[hu]():g.addEventListener("transitionend",this[hu],{once:!0})})}else this[jn]=!0}[sl](){return super[sl]()&&this[Po]}[Ks](){return super[Ks]()&&this[jn]}async[gi](){this[Wn]=0,this.generateSchema===!0&&this[ie].updateSchema(this.src),(this[ie].currentGLTF==null||this.src==null||!this[Zr]())&&this.showPoster(),await super[gi]()}}return Hn([Ae({type:String})],v.prototype,"poster",void 0),Hn([Ae({type:String})],v.prototype,"reveal",void 0),Hn([Ae({type:String})],v.prototype,"loading",void 0),Hn([Ae({type:Boolean,attribute:"generate-schema"})],v.prototype,"generateSchema",void 0),Hn([Ae({type:Boolean,attribute:"seamless-poster"})],v.prototype,"seamlessPoster",void 0),v},Bc=class{constructor(){this.pluginCallbacks=[],this.register(function(e){return new OA(e)}),this.register(function(e){return new FA(e)}),this.register(function(e){return new UA(e)}),this.register(function(e){return new kA(e)}),this.register(function(e){return new zA(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i){let r=new NA,s=[];for(let n=0,a=this.pluginCallbacks.length;n<a;n++)s.push(this.pluginCallbacks[n](r));r.setPlugins(s),r.write(e,t,i)}},He={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},zt={};zt[st]=He.NEAREST;zt[qo]=He.NEAREST_MIPMAP_NEAREST;zt[Yo]=He.NEAREST_MIPMAP_LINEAR;zt[Je]=He.LINEAR;zt[gc]=He.LINEAR_MIPMAP_NEAREST;zt[Qi]=He.LINEAR_MIPMAP_LINEAR;zt[bt]=He.CLAMP_TO_EDGE;zt[$i]=He.REPEAT;zt[fa]=He.MIRRORED_REPEAT;var bf={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},wf=12,AA=1179937895,RA=2,_f=8,LA=1313821514,CA=5130562;function ta(e,t){return e.length===t.length&&e.every(function(i,r){return i===t[r]})}function PA(e){if(window.TextEncoder!==void 0)return new TextEncoder().encode(e).buffer;let t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0,r=e.length;i<r;i++){let s=e.charCodeAt(i);t[i]=s>255?32:s}return t.buffer}function IA(e){return ta(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function DA(e,t,i){let r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+i;s++)for(let n=0;n<e.itemSize;n++){let a;e.itemSize>4?a=e.array[s*e.itemSize+n]:n===0?a=e.getX(s):n===1?a=e.getY(s):n===2?a=e.getZ(s):n===3&&(a=e.getW(s)),r.min[n]=Math.min(r.min[n],a),r.max[n]=Math.max(r.max[n],a)}return r}function g0(e){return Math.ceil(e/4)*4}function pu(e,t=0){let i=g0(e.byteLength);if(i!==e.byteLength){let r=new Uint8Array(i);if(r.set(new Uint8Array(e)),t!==0)for(let s=e.byteLength;s<i;s++)r[s]=t;return r.buffer}return e}var Mf=null,NA=class{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}write(e,t,i){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e);let r=this;Promise.all(this.pending).then(function(){let s=r.buffers,n=r.json,a=r.options,o=r.extensionsUsed,l=new Blob(s,{type:"application/octet-stream"}),h=Object.keys(o);if(h.length>0&&(n.extensionsUsed=h),n.buffers&&n.buffers.length>0&&(n.buffers[0].byteLength=l.size),a.binary===!0){let u=new window.FileReader;u.readAsArrayBuffer(l),u.onloadend=function(){let c=pu(u.result),d=new DataView(new ArrayBuffer(_f));d.setUint32(0,c.byteLength,!0),d.setUint32(4,CA,!0);let p=pu(PA(JSON.stringify(n)),32),f=new DataView(new ArrayBuffer(_f));f.setUint32(0,p.byteLength,!0),f.setUint32(4,LA,!0);let v=new ArrayBuffer(wf),y=new DataView(v);y.setUint32(0,AA,!0),y.setUint32(4,RA,!0);let g=wf+f.byteLength+p.byteLength+d.byteLength+c.byteLength;y.setUint32(8,g,!0);let m=new Blob([v,f,p,d,c],{type:"application/octet-stream"}),_=new window.FileReader;_.readAsArrayBuffer(m),_.onloadend=function(){t(_.result)}}}else if(n.buffers&&n.buffers.length>0){let u=new window.FileReader;u.readAsDataURL(l),u.onloadend=function(){let c=u.result;n.buffers[0].uri=c,t(n)}}else t(n)})}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;let i=this.options,r=this.extensionsUsed;try{let s=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(let n in s.gltfExtensions)t.extensions[n]=s.gltfExtensions[n],r[n]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}getUID(e){return this.uids.has(e)||this.uids.set(e,this.uid++),this.uids.get(e)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;let t=new E;for(let i=0,r=e.count;i<r;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let i=e.clone(),r=new E;for(let s=0,n=i.count;s<n;s++)r.fromBufferAttribute(i,s),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),i.setXYZ(s,r.x,r.y,r.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1,r={};(t.offset.x!==0||t.offset.y!==0)&&(r.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(r.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}processBuffer(e){let t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,r,s){let n=this.json;n.bufferViews||(n.bufferViews=[]);let a;t===He.UNSIGNED_BYTE?a=1:t===He.UNSIGNED_SHORT?a=2:a=4;let o=g0(r*e.itemSize*a),l=new DataView(new ArrayBuffer(o)),h=0;for(let c=i;c<i+r;c++)for(let d=0;d<e.itemSize;d++){let p;e.itemSize>4?p=e.array[c*e.itemSize+d]:d===0?p=e.getX(c):d===1?p=e.getY(c):d===2?p=e.getZ(c):d===3&&(p=e.getW(c)),t===He.FLOAT?l.setFloat32(h,p,!0):t===He.UNSIGNED_INT?l.setUint32(h,p,!0):t===He.UNSIGNED_SHORT?l.setUint16(h,p,!0):t===He.UNSIGNED_BYTE&&l.setUint8(h,p),h+=a}let u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:o};return s!==void 0&&(u.target=s),s===He.ARRAY_BUFFER&&(u.byteStride=e.itemSize*a),this.byteOffset+=o,n.bufferViews.push(u),{id:n.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){let t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(r){let s=new window.FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){let n=pu(s.result),a={buffer:t.processBuffer(n),byteOffset:t.byteOffset,byteLength:n.byteLength};t.byteOffset+=n.byteLength,r(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,r){let s=this.options,n=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"},o;if(e.array.constructor===Float32Array)o=He.FLOAT;else if(e.array.constructor===Uint32Array)o=He.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=He.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)o=He.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(i===void 0&&(i=0),r===void 0&&(r=e.count),s.truncateDrawRange&&t!==void 0&&t.index===null){let d=i+r,p=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;i=Math.max(i,t.drawRange.start),r=Math.min(d,p)-i,r<0&&(r=0)}if(r===0)return null;let l=DA(e,i,r),h;t!==void 0&&(h=e===t.index?He.ELEMENT_ARRAY_BUFFER:He.ARRAY_BUFFER);let u=this.processBufferView(e,o,i,r,h),c={bufferView:u.id,byteOffset:u.byteOffset,componentType:o,count:r,max:l.max,min:l.min,type:a[e.itemSize]};return e.normalized===!0&&(c.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(c)-1}processImage(e,t,i){let r=this,s=r.cache,n=r.json,a=r.options,o=r.pending;s.images.has(e)||s.images.set(e,{});let l=s.images.get(e),h=t===ot?"image/png":"image/jpeg",u=h+":flipY/"+i.toString();if(l[u]!==void 0)return l[u];n.images||(n.images=[]);let c={mimeType:h};if(a.embedImages){let p=Mf=Mf||document.createElement("canvas");p.width=Math.min(e.width,a.maxTextureSize),p.height=Math.min(e.height,a.maxTextureSize);let f=p.getContext("2d");if(i===!0&&(f.translate(0,p.height),f.scale(1,-1)),typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap)f.drawImage(e,0,0,p.width,p.height);else{t!==ot&&t!==ci&&console.error("GLTFExporter: Only RGB and RGBA formats are supported."),(e.width>a.maxTextureSize||e.height>a.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let v=new Uint8ClampedArray(e.height*e.width*4);if(t===ot)for(let y=0;y<v.length;y+=4)v[y+0]=e.data[y+0],v[y+1]=e.data[y+1],v[y+2]=e.data[y+2],v[y+3]=e.data[y+3];else for(let y=0,g=0;y<v.length;y+=4,g+=3)v[y+0]=e.data[g+0],v[y+1]=e.data[g+1],v[y+2]=e.data[g+2],v[y+3]=255;f.putImageData(new ImageData(v,e.width,e.height),0,0)}a.binary===!0?o.push(new Promise(function(v){p.toBlob(function(y){r.processBufferViewImage(y).then(function(g){c.bufferView=g,v()})},h)})):c.uri=p.toDataURL(h)}else c.uri=e.src;let d=n.images.push(c)-1;return l[u]=d,d}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let i={magFilter:zt[e.magFilter],minFilter:zt[e.minFilter],wrapS:zt[e.wrapS],wrapT:zt[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){let t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY)};e.name&&(r.name=e.name),this._invokeAll(function(n){n.writeTexture&&n.writeTexture(e,r)});let s=i.textures.push(r)-1;return t.textures.set(e,s),s}processMaterial(e){let t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);let r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let s=e.color.toArray().concat([e.opacity]);if(ta(s,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){let a={index:this.processTexture(e.metalnessMap)};this.applyTextureTransform(a,e.metalnessMap),r.pbrMetallicRoughness.metallicRoughnessTexture=a}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){let a={index:this.processTexture(e.map)};this.applyTextureTransform(a,e.map),r.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){let a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),o=Math.max(a.r,a.g,a.b);if(o>1&&(a.multiplyScalar(1/o),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),o>0&&(r.emissiveFactor=a.toArray()),e.emissiveMap){let l={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(l,e.emissiveMap),r.emissiveTexture=l}}if(e.normalMap){let a={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),r.normalTexture=a}if(e.aoMap){let a={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),r.occlusionTexture=a}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===xi&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,r)});let n=i.materials.push(r)-1;return t.materials.set(e,n),n}processMesh(e){let t=this.cache,i=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let m=0,_=e.material.length;m<_;m++)r.push(e.material[m].uuid);else r.push(e.material.uuid);let s=r.join(":");if(t.meshes.has(s))return t.meshes.get(s);let n=e.geometry,a;if(e.isLineSegments?a=He.LINES:e.isLineLoop?a=He.LINE_LOOP:e.isLine?a=He.LINE_STRIP:e.isPoints?a=He.POINTS:a=e.material.wireframe?He.LINES:He.TRIANGLES,n.isBufferGeometry!==!0)throw new Error("THREE.GLTFExporter: Geometry is not of type THREE.BufferGeometry.");let o={},l={},h=[],u=[],c={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=n.getAttribute("normal");d!==void 0&&!this.isNormalizedNormalAttribute(d)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),n.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let m in n.attributes){if(m.substr(0,5)==="morph")continue;let _=n.attributes[m];if(m=c[m]||m.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(m)||(m="_"+m),t.attributes.has(this.getUID(_))){l[m]=t.attributes.get(this.getUID(_));continue}p=null;let x=_.array;m==="JOINTS_0"&&!(x instanceof Uint16Array)&&!(x instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new je(new Uint16Array(x),_.itemSize,_.normalized));let w=this.processAccessor(p||_,n);w!==null&&(l[m]=w,t.attributes.set(this.getUID(_),w))}if(d!==void 0&&n.setAttribute("normal",d),Object.keys(l).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){let m=[],_=[],x={};if(e.morphTargetDictionary!==void 0)for(let w in e.morphTargetDictionary)x[e.morphTargetDictionary[w]]=w;for(let w=0;w<e.morphTargetInfluences.length;++w){let S={},b=!1;for(let R in n.morphAttributes){if(R!=="position"&&R!=="normal"){b||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),b=!0);continue}let C=n.morphAttributes[R][w],D=R.toUpperCase(),L=n.attributes[R];if(t.attributes.has(this.getUID(C))){S[D]=t.attributes.get(this.getUID(C));continue}let j=C.clone();if(!n.morphTargetsRelative)for(let N=0,I=C.count;N<I;N++)j.setXYZ(N,C.getX(N)-L.getX(N),C.getY(N)-L.getY(N),C.getZ(N)-L.getZ(N));S[D]=this.processAccessor(j,n),t.attributes.set(this.getUID(L),S[D])}u.push(S),m.push(e.morphTargetInfluences[w]),e.morphTargetDictionary!==void 0&&_.push(x[w])}o.weights=m,_.length>0&&(o.extras={},o.extras.targetNames=_)}let f=Array.isArray(e.material);if(f&&n.groups.length===0)return null;let v=f?e.material:[e.material],y=f?n.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let m=0,_=y.length;m<_;m++){let x={mode:a,attributes:l};if(this.serializeUserData(n,x),u.length>0&&(x.targets=u),n.index!==null){let S=this.getUID(n.index);(y[m].start!==void 0||y[m].count!==void 0)&&(S+=":"+y[m].start+":"+y[m].count),t.attributes.has(S)?x.indices=t.attributes.get(S):(x.indices=this.processAccessor(n.index,n,y[m].start,y[m].count),t.attributes.set(S,x.indices)),x.indices===null&&delete x.indices}let w=this.processMaterial(v[y[m].materialIndex]);w!==null&&(x.material=w),h.push(x)}o.primitives=h,i.meshes||(i.meshes=[]),this._invokeAll(function(m){m.writeMesh&&m.writeMesh(e,o)});let g=i.meshes.push(o)-1;return t.meshes.set(s,g),g}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let i=e.isOrthographicCamera,r={type:i?"orthographic":"perspective"};return i?r.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:Ko.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){let i=this.json,r=this.nodeMap;i.animations||(i.animations=[]),e=Bc.Utils.mergeMorphTargetTracks(e.clone(),t);let s=e.tracks,n=[],a=[];for(let o=0;o<s.length;++o){let l=s[o],h=Oe.parseTrackName(l.name),u=Oe.findNode(t,h.nodeName),c=bf[h.propertyName];if(h.objectName==="bones"&&(u.isSkinnedMesh===!0?u=u.skeleton.getBoneByName(h.objectIndex):u=void 0),!u||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;let d=1,p=l.values.length/l.times.length;c===bf.morphTargetInfluences&&(p/=u.morphTargetInfluences.length);let f;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(f="CUBICSPLINE",p/=3):l.getInterpolation()===Ys?f="STEP":f="LINEAR",a.push({input:this.processAccessor(new je(l.times,d)),output:this.processAccessor(new je(l.values,p)),interpolation:f}),n.push({sampler:a.length-1,target:{node:r.get(u),path:c}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:n}),i.animations.length-1}processSkin(e){let t=this.json,i=this.nodeMap,r=t.nodes[i.get(e)],s=e.skeleton;if(s===void 0)return null;let n=e.skeleton.bones[0];if(n===void 0)return null;let a=[],o=new Float32Array(s.bones.length*16),l=new me;for(let h=0;h<s.bones.length;++h)a.push(i.get(s.bones[h])),l.copy(s.boneInverses[h]),l.multiply(e.bindMatrix).toArray(o,h*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new je(o,16)),joints:a,skeleton:i.get(n)}),r.skin=t.skins.length-1}processNode(e){let t=this.json,i=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);let s={};if(i.trs){let a=e.quaternion.toArray(),o=e.position.toArray(),l=e.scale.toArray();ta(a,[0,0,0,1])||(s.rotation=a),ta(o,[0,0,0])||(s.translation=o),ta(l,[1,1,1])||(s.scale=l)}else e.matrixAutoUpdate&&e.updateMatrix(),IA(e.matrix)===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){let a=this.processMesh(e);a!==null&&(s.mesh=a)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let a=[];for(let o=0,l=e.children.length;o<l;o++){let h=e.children[o];if(h.visible||i.onlyVisible===!1){let u=this.processNode(h);u!==null&&a.push(u)}}a.length>0&&(s.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,s)});let n=t.nodes.push(s)-1;return r.set(e,n),n}processScene(e){let t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);let r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);let s=[];for(let n=0,a=e.children.length;n<a;n++){let o=e.children[n];if(o.visible||i.onlyVisible===!1){let l=this.processNode(o);l!==null&&s.push(l)}}s.length>0&&(r.nodes=s),this.serializeUserData(e,r)}processObjects(e){let t=new bi;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});let i=[];for(let r=0;r<e.length;r++)e[r]instanceof bi?this.processScene(e[r]):i.push(e[r]);i.length>0&&this.processObjects(i);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}},OA=class{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let i=this.writer,r=i.json,s=i.extensionsUsed,n={};e.name&&(n.name=e.name),n.color=e.color.toArray(),n.intensity=e.intensity,e.isDirectionalLight?n.type="directional":e.isPointLight?(n.type="point",e.distance>0&&(n.range=e.distance)):e.isSpotLight&&(n.type="spot",e.distance>0&&(n.range=e.distance),n.spot={},n.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,n.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},s[this.name]=!0);let a=r.extensions[this.name].lights;a.push(n),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}},FA=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},UA=class{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;let i=this.writer,r=i.extensionsUsed,s={};t.pbrMetallicRoughness.baseColorFactor&&(s.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);let n=[1,1,1];if(e.specular.toArray(n,0),s.specularFactor=n,s.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(s.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){let a={index:i.processTexture(e.specularMap)};i.applyTextureTransform(a,e.specularMap),s.specularGlossinessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},kA=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;let i=this.writer,r=i.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){let n={index:i.processTexture(e.transmissionMap)};i.applyTextureTransform(n,e.transmissionMap),s.transmissionTexture=n}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}},zA=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.thickness===0)return;let i=this.writer,r=i.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){let n={index:i.processTexture(e.thicknessMap)};i.applyTextureTransform(n,e.thicknessMap),s.thicknessTexture=n}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationTint.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}};Bc.Utils={insertKeyframe:function(e,t){let i=.001,r=e.getValueSize(),s=new e.TimeBufferType(e.times.length+1),n=new e.ValueBufferType(e.values.length+r),a=e.createInterpolant(new e.ValueBufferType(r)),o;if(e.times.length===0){s[0]=t;for(let l=0;l<r;l++)n[l]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;s[0]=t,s.set(e.times,1),n.set(a.evaluate(t),0),n.set(e.values,r),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;s[s.length-1]=t,s.set(e.times,0),n.set(e.values,0),n.set(a.evaluate(t),e.values.length),o=s.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<i)return l;if(e.times[l]<t&&e.times[l+1]>t){s.set(e.times.slice(0,l+1),0),s[l+1]=t,s.set(e.times.slice(l+1),l+2),n.set(e.values.slice(0,(l+1)*r),0),n.set(a.evaluate(t),(l+1)*r),n.set(e.values.slice((l+1)*r),(l+2)*r),o=l+1;break}}return e.times=s,e.values=n,o},mergeMorphTargetTracks:function(e,t){let i=[],r={},s=e.tracks;for(let n=0;n<s.length;++n){let a=s[n],o=Oe.parseTrackName(a.name),l=Oe.findNode(t,o.nodeName);if(o.propertyName!=="morphTargetInfluences"||o.propertyIndex===void 0){i.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(Xr)}let h=l.morphTargetInfluences.length,u=l.morphTargetDictionary[o.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let c;if(r[l.uuid]===void 0){c=a.clone();let p=new c.ValueBufferType(h*c.times.length);for(let f=0;f<c.times.length;f++)p[f*h+u]=c.values[f];c.name=(o.nodeName||"")+".morphTargetInfluences",c.values=p,r[l.uuid]=c,i.push(c);continue}let d=a.createInterpolant(new a.ValueBufferType(1));c=r[l.uuid];for(let p=0;p<c.times.length;p++)c.values[p*h+u]=d.evaluate(c.times[p]);for(let p=0;p<a.times.length;p++){let f=this.insertKeyframe(c,a.times[p]);c.values[f*h+u]=a.values[p]}}return e.tracks=i,e}};var Sf=e=>e.material!==void 0&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter(t=>Go(t.material)),Go=e=>e&&e.isMaterial&&!Array.isArray(e),BA=class{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){let t=new Set;for(let i of e)i.traverse(r=>{if(!Sf(r))return;let s=r.userData.variantMaterials;for(let n of s.keys()){let a=s.get(n);Go(a.material)&&t.add(n)}});t.forEach(i=>this.variantNames.push(i))}writeMesh(e,t){if(!Sf(e))return;let i=e.userData,r=i.variantMaterials,s=new Map;for(let o of r.keys()){let l=r.get(o).material;if(!Go(l))continue;let h=this.variantNames.indexOf(o),u=this.writer.processMaterial(l);s.has(u)||s.set(u,{material:u,variants:[]}),s.get(u).variants.push(h)}let n=Array.from(s.values()).map(o=>o.variants.sort((l,h)=>l-h)&&o).sort((o,l)=>o.material-l.material);if(n.length===0)return;let a=Go(i.originalMaterial)?this.writer.processMaterial(i.originalMaterial):-1;for(let o of t.primitives)a>=0&&(o.material=a),o.extensions=o.extensions||{},o.extensions[this.name]={mappings:n}}afterParse(){if(this.variantNames.length===0)return;let e=this.writer.json;e.extensions=e.extensions||{};let t=this.variantNames.map(i=>({name:i}));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}},St=Symbol("correlatedObjects"),qe=Symbol("sourceObject"),li=Symbol("onUpdate"),Ia=class{constructor(e,t,i=null){this[li]=e,this[qe]=t,this[St]=i}},HA=new Pc,Tf=new hi,GA=new is(2,2),Vo=Symbol("threeTexture"),VA=class extends Ia{get[Vo](){var e;return console.assert(this[St]!=null&&this[St].size>0,"Image correlated object is undefined"),(e=this[St])===null||e===void 0?void 0:e.values().next().value}constructor(e,t,i){i=i!=null?i:{name:"adhoc_image",uri:t&&t.image?t.image.src:"adhoc_image"},super(e,i,new Set(t?[t]:[]))}get name(){return this[qe].name||""}get uri(){return this[qe].uri}get bufferView(){return this[qe].bufferView}get type(){return this.uri!=null?"external":"embedded"}async setURI(e){this[qe].uri=e;let t=await new Promise((r,s)=>{HA.load(e,r,void 0,s)}),i=this[Vo];i.image=t,i.needsUpdate=!0,this[li]()}async createThumbnail(e,t){let i=new bi;Tf.map=this[Vo];let r=new _e(GA,Tf);i.add(r);let s=new rs(-1,1,1,-1,0,1),{threeRenderer:n}=Yi.singleton,a=new Ot(e,t);n.setRenderTarget(a),n.render(i,s),n.setRenderTarget(null);let o=new Uint8Array(e*t*4);n.readRenderTargetPixels(a,0,0,e,t,o),Xt.width=e,Xt.height=t;let l=Xt.getContext("2d"),h=l.createImageData(e,t);return h.data.set(o),l.putImageData(h,0,0),new Promise(async(u,c)=>{Xt.toBlob(d=>{if(!d)return c("Failed to capture thumbnail.");u(URL.createObjectURL(d))},"image/png")})}},qt;(function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"})(qt||(qt={}));var Wr;(function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"})(Wr||(Wr={}));var WA=(()=>{let e=[qt.Nearest,qt.Linear,qt.NearestMipmapNearest,qt.LinearMipmapLinear,qt.NearestMipmapLinear,qt.LinearMipmapLinear];return t=>e.indexOf(t)>-1})(),jA=(()=>{let e=[qt.Nearest,qt.Linear];return t=>e.indexOf(t)>-1})(),XA=(()=>{let e=[Wr.ClampToEdge,Wr.MirroredRepeat,Wr.Repeat];return t=>e.indexOf(t)>-1})(),qA=(e,t)=>{switch(e){case"minFilter":return WA(t);case"magFilter":return jA(t);case"wrapS":case"wrapT":return XA(t);default:throw new Error(`Cannot configure property "${e}" on Sampler`)}},Ef=Symbol("threeTextures"),Xn=Symbol("setProperty"),Is=Symbol("sourceSampler"),YA=class extends Ia{get[Ef](){return console.assert(this[St]!=null&&this[St].size>0,"Sampler correlated object is undefined"),this[St]}get[Is](){return console.assert(this[qe]!=null,"Sampler source is undefined"),this[qe]}constructor(e,t,i){i=i!=null?i:{},i.minFilter==null&&(i.minFilter=t?t.minFilter:qt.LinearMipmapLinear),i.magFilter==null&&(i.magFilter=t?t.magFilter:qt.Linear),i.wrapS==null&&(i.wrapS=t?t.wrapS:Wr.Repeat),i.wrapT==null&&(i.wrapT=t?t.wrapT:Wr.Repeat),super(e,i,new Set(t?[t]:[]))}get name(){return this[qe].name||""}get minFilter(){return this[Is].minFilter}get magFilter(){return this[Is].magFilter}get wrapS(){return this[Is].wrapS}get wrapT(){return this[Is].wrapT}setMinFilter(e){this[Xn]("minFilter",e)}setMagFilter(e){this[Xn]("magFilter",e)}setWrapS(e){this[Xn]("wrapS",e)}setWrapT(e){this[Xn]("wrapT",e)}[Xn](e,t){let i=this[Is];if(i!=null){if(qA(e,t)){i[e]=t;for(let r of this[Ef])r[e]=t,r.needsUpdate=!0}this[li]()}}},Af=Symbol("image"),Rf=Symbol("sampler"),v0=class extends Ia{constructor(e,t,i=null,r=null,s=null){super(e,i||{},new Set(t?[t]:[])),this[Rf]=new YA(e,t,r),this[Af]=new VA(e,t,s)}get name(){return this[qe].name||""}get sampler(){return this[Rf]}get source(){return this[Af]}},y0,Wo=Symbol("texture"),mu=Symbol("materials"),Lf=Symbol("usage"),$t;(function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive"})($t||($t={}));var da=class{constructor(e,t,i,r,s,n){if(this[y0]=null,n){let a=s.textures?s.textures[n.index]:null,o=a&&s.samplers?s.samplers[a.sampler]:null,l=a&&s.images?s.images[a.source]:null;this[Wo]=new v0(e,i,a,o,l)}this.onUpdate=e,this[mu]=r,this[Lf]=t}get texture(){return this[Wo]}setTexture(e){let t=e!=null?e.source[Vo]:null,i=Bt;if(this[Wo]=e,this[mu])for(let r of this[mu]){switch(this[Lf]){case $t.Base:r.map=t;break;case $t.MetallicRoughness:i=Ke,r.metalnessMap=t,r.roughnessMap=t;break;case $t.Normal:i=Ke,r.normalMap=t;break;case $t.Occlusion:i=Ke,r.aoMap=t;break;case $t.Emissive:r.emissiveMap=t;break}r.needsUpdate=!0}t&&(t.encoding=i),this.onUpdate()}};y0=Wo;var Io=Symbol("threeMaterials"),Cf=Symbol("baseColorTexture"),Pf=Symbol("metallicRoughnessTexture"),$A=class extends Ia{constructor(e,t,i,r){super(e,i,r),i.baseColorFactor==null&&(i.baseColorFactor=[1,1,1,1]),i.roughnessFactor==null&&(i.roughnessFactor=1),i.metallicFactor==null&&(i.metallicFactor=1);let{baseColorTexture:s,metallicRoughnessTexture:n}=i,{map:a,metalnessMap:o}=r.values().next().value;this[Cf]=new da(e,$t.Base,a,r,t,s||null),this[Pf]=new da(e,$t.MetallicRoughness,o,r,t,n||null)}get[Io](){return this[St]}get baseColorFactor(){return this[qe].baseColorFactor}get metallicFactor(){return this[qe].metallicFactor}get roughnessFactor(){return this[qe].roughnessFactor}get baseColorTexture(){return this[Cf]}get metallicRoughnessTexture(){return this[Pf]}setBaseColorFactor(e){for(let i of this[Io])i.color.fromArray(e),i.opacity=e[3];let t=this[qe];t.baseColorFactor=e,this[li]()}setMetallicFactor(e){for(let i of this[Io])i.metalness=e;let t=this[qe];t.metallicFactor=e,this[li]()}setRoughnessFactor(e){for(let i of this[Io])i.roughness=e;let t=this[qe];t.roughnessFactor=e,this[li]()}},If=Symbol("pbrMetallicRoughness"),Df=Symbol("normalTexture"),Nf=Symbol("occlusionTexture"),Of=Symbol("emissiveTexture"),ZA=Symbol("backingThreeMaterial"),fu=Symbol("applyAlphaCutoff"),Fr=Symbol("lazyLoadGLTFInfo"),gu=Symbol("initialize"),oc=Symbol("getLoadedMaterial"),Nt=Symbol("ensureMaterialIsLoaded"),Ff=class extends Ia{constructor(e,t,i,r,s=void 0){super(e,i,r),s==null?this[gu](t):this[Fr]=s}get[ZA](){return this[St].values().next().value}[gu](e){let t=this[li],i=this[qe],r=this[St];i.extensions&&i.extensions.KHR_materials_pbrSpecularGlossiness&&console.warn(`Material ${i.name} uses a deprecated extension
          "KHR_materials_pbrSpecularGlossiness", please use
          "pbrMetallicRoughness" instead. Specular Glossiness materials are
          currently supported for rendering, but not for our scene-graph API,
          nor for auto-generation of USDZ for Quick Look.`),i.pbrMetallicRoughness==null&&(i.pbrMetallicRoughness={}),this[If]=new $A(t,e,i.pbrMetallicRoughness,r),i.emissiveFactor==null&&(i.emissiveFactor=[0,0,0]),i.doubleSided==null&&(i.doubleSided=!1),i.alphaMode==null&&(i.alphaMode="OPAQUE"),i.alphaCutoff==null&&(i.alphaCutoff=.5);let{normalTexture:s,occlusionTexture:n,emissiveTexture:a}=i,{normalMap:o,aoMap:l,emissiveMap:h}=r.values().next().value;this[Df]=new da(t,$t.Normal,o,r,e,s||null),this[Nf]=new da(t,$t.Occlusion,l,r,e,n||null),this[Of]=new da(t,$t.Emissive,h,r,e,a||null)}async[oc](){if(this[Fr]!=null){let{set:e,material:t}=await this[Fr].doLazyLoad();return this[St]=e,this[gu](this[Fr].gltf),this[Fr]=void 0,this.ensureLoaded=async()=>{},t}return this[St].values().next().value}[Nt](){if(this[Fr]!=null)throw new Error(`Material "${this.name}" has not been loaded, call 'await
    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[oc]()}get isLoaded(){return this[Fr]==null}get name(){return this[qe].name||""}get pbrMetallicRoughness(){return this[Nt](),this[If]}get normalTexture(){return this[Nt](),this[Df]}get occlusionTexture(){return this[Nt](),this[Nf]}get emissiveTexture(){return this[Nt](),this[Of]}get emissiveFactor(){return this[Nt](),this[qe].emissiveFactor}setEmissiveFactor(e){this[Nt]();for(let t of this[St])t.emissive.fromArray(e);this[qe].emissiveFactor=e,this[li]()}[fu](){this[Nt]();let e=this[qe];for(let t of this[St])t.alphaTest=e.alphaCutoff,t.needsUpdate=!0}setAlphaCutoff(e){this[Nt](),this[qe].alphaCutoff=e,this[fu](),this[li]()}getAlphaCutoff(){return this[Nt](),this[qe].alphaCutoff}setDoubleSided(e){this[Nt]();for(let t of this[St])t.side=e?xi:br,t.needsUpdate=!0;this[qe].doubleSided=e,this[li]()}getDoubleSided(){return this[Nt](),this[qe].doubleSided}setAlphaMode(e){this[Nt]();let t=(i,r)=>{i.transparent=r,i.depthWrite=!r};this[qe].alphaMode=e;for(let i of this[St])t(i,e!=="OPAQUE"),this[fu](),i.needsUpdate=!0;this[li]()}getAlphaMode(){return this[Nt](),this[qe].alphaMode}},x0,b0,zs=Symbol("materials"),Ur=Symbol("variantInfo"),Uf=Symbol("mesh"),w0=Symbol("children"),kf=Symbol("initialMaterialIdx"),vu=Symbol("activeMaterialIdx"),_0=class{constructor(e){this.name="",this[x0]=new Array,this.name=e}};x0=w0;var zf=class extends _0{constructor(e,t,i){super(e.name),this[b0]=new Map,this[Uf]=e;let{gltf:r,threeGLTF:s,threeObjectMap:n}=i,a=n.get(e.material);a.materials!=null?this[kf]=this[vu]=a.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);let o=n.get(e).meshes,l=(r.meshes||[])[o].primitives||[];for(let h of l){if(h.material!=null)this[zs].set(h.material,t[h.material]);else{let u=t.findIndex(c=>c.name==="Default");u>=0?this[zs].set(u,t[u]):console.warn("Primitive has no material!")}if(h.extensions&&h.extensions.KHR_materials_variants){let u=h.extensions.KHR_materials_variants,c=s.parser.json.extensions.KHR_materials_variants.variants;this[Ur]=new Map;for(let d of u.mappings){this[zs].set(d.material,t[d.material]);for(let p of d.variants){let{name:f}=c[p];this[Ur].set(f,{material:t[d.material],index:d.material})}}}}}get mesh(){return this[Uf]}async setActiveMaterial(e){let t=this[zs].get(e);return t!=null&&(this.mesh.material=await t[oc](),this[vu]=e),this.mesh.material}getActiveMaterial(){return this[zs].get(this[vu])}async enableVariant(e){if(e==null)return this.setActiveMaterial(this[kf]);if(this[Ur]!=null){let t=this[Ur].get(e);if(t!=null)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(this[Ur]!=null)for(let e of this[Ur].keys()){if(this.mesh.userData.variantMaterials.get(e).material!=null)continue;let t=await this.enableVariant(e);t!=null&&(this.mesh.userData.variantMaterials.get(e).material=t)}}get variantInfo(){return this[Ur]}};b0=zs;var Bf,Hf,Gf,Vf,qn=Symbol("materials"),yu=Symbol("hierarchy"),Wf=Symbol("roots"),Do=Symbol("primitives"),M0=Symbol("prepareVariantsForExport"),S0=Symbol("switchVariant"),jf=Symbol("threeScene"),Xf=Symbol("materialsFromPoint"),T0=Symbol("materialFromPoint"),JA=class{constructor(e,t,i,r){this.gltf=e,this.gltfElementMap=t,this.mapKey=i,this.doLazyLoad=r}},KA=class{constructor(e,t=()=>{}){this[Bf]=new Array,this[Hf]=new Array,this[Gf]=new Array,this[Vf]=new Array;let{gltf:i,threeGLTF:r,gltfElementMap:s}=e;this[jf]=r.scene;for(let[o,l]of i.materials.entries()){let h=s.get(l);if(h!=null)this[qn].push(new Ff(t,i,l,h));else{let u=(i.materials||[])[o],c=o,d=async()=>{let p=await r.parser.getDependency("material",c),f=new Set;return s.set(u,f),f.add(p),{set:f,material:p}};this[qn].push(new Ff(t,i,u,h,new JA(i,s,u,d)))}}let n=new Map,a=new Array;for(let o of r.scene.children)a.push(o);for(;a.length>0;){let o=a.pop(),l=null;o instanceof _e?(l=new zf(o,this.materials,e),this[Do].push(l)):l=new _0(o.name);let h=n.get(o);h!=null?h[w0].push(l):this[Wf].push(l),this[yu].push(l);for(let u of o.children)a.push(u),n.set(o,l)}}get materials(){return this[qn]}getMaterialByName(e){let t=this[qn].filter(i=>i.name===e);return t.length>0?t[0]:null}[(Bf=qn,Hf=yu,Gf=Wf,Vf=Do,Xf)](e){return e.intersectObject(this[jf],!0).map(t=>{let i=this[yu].find(r=>r instanceof zf&&r.mesh===t.object);return i!=null?i.getActiveMaterial():null})}[T0](e){let t=this[Xf](e);return t.length>0?t[0]:null}async[S0](e){let t=new Array;for(let i of this[Do])t.push(i.enableVariant(e));await Promise.all(t)}async[M0](){let e=new Array;for(let t of this[Do])e.push(t.instantiateVariants());await Promise.all(e)}},xu=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},Yn=Symbol("currentGLTF"),Ds=Symbol("model"),No=Symbol("variants"),bu=Symbol("getOnUpdateMethod"),qf=Symbol("textureLoader"),wu=Symbol("originalGltfJson"),QA=e=>{var t,i,r,s,n;class a extends e{constructor(){super(...arguments),this[t]=void 0,this[i]=null,this[r]=[],this[s]=new Ml,this[n]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Ds]}get availableVariants(){return this[No]}get originalGltfJson(){return this[wu]}[(t=Ds,i=Yn,r=No,s=qf,n=wu,bu)](){return()=>{this[Rt]()}}async createTexture(l,h="image/png"){let u=this[Yn],c=await new Promise(d=>this[qf].load(l,d));return!u||!c?null:(c.encoding=Bt,c.wrapS=$i,c.wrapT=$i,c.flipY=!1,h==="image/jpeg"&&(c.format=ci),new v0(this[bu](),c))}async updated(l){if(super.updated(l),l.has("variantName")){let h=this[Yn],{variantName:u}=this;h!=null&&(await this[Ds][S0](u),this[Rt](),this.dispatchEvent(new CustomEvent("variant-applied")))}if(l.has("orientation")||l.has("scale")){let{modelContainer:h}=this[ie],u=$r(this.orientation)[0].terms,c=yi(u[0]).number,d=yi(u[1]).number,p=yi(u[2]).number;h.quaternion.setFromEuler(new es(d,p,c,"YXZ"));let f=$r(this.scale)[0].terms;h.scale.set(f[0].number,f[1].number,f[2].number),this[ie].updateBoundingBox(),this[ie].updateShadow(),this[Be].arRenderer.onUpdateScene(),this[Rt]()}}[Mi](){super[Mi](),this[No]=[];let{currentGLTF:l}=this[ie];if(l!=null){let{correlatedSceneGraph:h}=l;h!=null&&l!==this[Yn]&&(this[Ds]=new KA(h,this[bu]()),this[wu]=JSON.parse(JSON.stringify(h.gltf))),"variants"in l.userData&&(this[No]=l.userData.variants.slice(),this.requestUpdate("variantName"))}this[Yn]=l,this.dispatchEvent(new CustomEvent("scene-graph-ready"))}async exportScene(l){let h=this[ie];return new Promise(async u=>{let c={binary:!0,onlyVisible:!0,maxTextureSize:1/0,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1,embedImages:!0};Object.assign(c,l),c.animations=h.animations,c.truncateDrawRange=!0;let d=h.shadow,p=!1;d!=null&&(p=d.visible,d.visible=!1),await this[Ds][M0](),new Bc().register(f=>new BA(f)).parse(h.modelContainer.children[0],f=>u(new Blob([c.binary?f:JSON.stringify(f)],{type:c.binary?"application/octet-stream":"application/json"})),c),d!=null&&(d.visible=p)})}materialFromPoint(l,h){let u=this[ie],c=u.getNDC(l,h);return u.raycaster.setFromCamera(c,u.getCamera()),this[Ds][T0](u.raycaster)}}return xu([Ae({type:String,attribute:"variant-name"})],a.prototype,"variantName",void 0),xu([Ae({type:String,attribute:"orientation"})],a.prototype,"orientation",void 0),xu([Ae({type:String,attribute:"scale"})],a.prototype,"scale",void 0),a},_u=function(e,t,i,r){for(var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,a,o=e.length-1;o>=0;o--)(a=e[o])&&(n=(s<3?a(n):s>3?a(t,i,n):a(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},e3=Math.PI/32,t3=3e3,i3={basis:[Al(gt(e3,"rad"))],keywords:{auto:[null]}},Ns=Symbol("autoRotateStartTime"),Mu=Symbol("radiansPerSecond"),Yf=Symbol("syncRotationRate"),Su=Symbol("onCameraChange"),r3=e=>{var t,i,r;class s extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=t3,this.rotationPerSecond="auto",this[t]=performance.now(),this[i]=0,this[r]=a=>{!this.autoRotate||a.detail.source==="user-interaction"&&(this[Ns]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[Su]),this[Ns]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[Su]),this[Ns]=performance.now()}updated(a){super.updated(a),a.has("autoRotate")&&(this[Ns]=performance.now())}[(t=Ns,i=Mu,Yf)](a){this[Mu]=a[0]}[_i](a,o){if(super[_i](a,o),!this.autoRotate||!this[Ks]()||this[Be].isPresenting)return;let l=Math.min(o,a-this[Ns]-this.autoRotateDelay);l>0&&(this[ie].yaw=this.turntableRotation+this[Mu]*l*.001)}get turntableRotation(){return this[ie].yaw}resetTurntableRotation(a=0){this[ie].yaw=a}}return r=Su,_u([Ae({type:Boolean,attribute:"auto-rotate"})],s.prototype,"autoRotate",void 0),_u([Ae({type:Number,attribute:"auto-rotate-delay"})],s.prototype,"autoRotateDelay",void 0),_u([pr({intrinsics:i3,updateHandler:Yf}),Ae({type:String,attribute:"rotation-per-second"})],s.prototype,"rotationPerSecond",void 0),s},s3=e=>{var t;let i=n=>{if(n.shadowRoot==null||n.hasAttribute("data-js-focus-visible"))return()=>{};if(self.applyFocusVisiblePolyfill)self.applyFocusVisiblePolyfill(n.shadowRoot);else{let a=()=>{self.applyFocusVisiblePolyfill(n.shadowRoot)};return self.addEventListener("focus-visible-polyfill-ready",a,{once:!0}),()=>{self.removeEventListener("focus-visible-polyfill-ready",a)}}return()=>{}},r=Symbol("endPolyfillCoordination");class s extends e{constructor(){super(...arguments),this[t]=null}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this[r]==null&&(this[r]=i(this))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this[r]!=null&&(this[r](),this[r]=null)}}return t=r,s},n3=u2(QA(r3(AE(mA(H2(EA(h2(s3(Fc)))))))));customElements.define("model-viewer",n3);var lc=class{},jr=lc;jr.namespace="modelviewerExtension.",jr.CAMERA_CHANGE=lc.namespace+"cameraChange",jr.DOUBLECLICK=lc.namespace+"doubleClick";var Hc=class{constructor(e,t,i){this.t=e,this.p=t,this.r=i}toString(){return`${this.t},${this.p},${this.r}`}toAttributeString(){return`${this.t}rad ${this.p}rad ${this.r}m`}static fromString(e){e=e.replace("orbit=","");let t=e.split(",");return new Hc(t[0],t[1],t[2])}},$f=N0(),a3=class extends Y0{constructor(e){super(e),this.isLoaded=!1}create(){this.setConfig("modelViewerCenterPanel"),super.create();let e=this;this.extensionHost.subscribe(jt.OPEN_EXTERNAL_RESOURCE,i=>{e.openMedia(i)}),this.extensionHost.subscribe(jt.SET_TARGET,i=>{this.whenLoaded(()=>{e.$modelviewer[0].cameraOrbit=i.toAttributeString()})}),this.extensionHost.subscribe(jt.ANNOTATIONS,i=>{this.overlayAnnotations()}),this.title=this.extension.helper.getLabel(),this.$spinner=$f('<div class="spinner"></div>'),this.$content.prepend(this.$spinner),this.$modelviewer=$f(`<model-viewer 
        ${this.config.options.autoRotateEnabled?"auto-rotate":""} 
        ${this.config.options.interactionPromptEnabled?'interaction-prompt="auto"':'interaction-prompt="none"'}
        camera-controls 
        style="background-color: unset;"></model-viewer>`),this.$content.prepend(this.$modelviewer),this.$modelviewer[0].addEventListener("model-visibility",()=>{this.isLoaded=!0,this.$content.removeClass("loading"),this.$spinner.hide(),this.extensionHost.publish(Jc.LOAD),this.extensionHost.publish(jr.CAMERA_CHANGE,this.getCameraOrbit())});let t=F0(i=>{this.isLoaded&&this.extensionHost.publish(jr.CAMERA_CHANGE,this.getCameraOrbit())},this.config.options.cameraChangeDelay);this.$modelviewer[0].addEventListener("camera-change",t),this.$modelviewer[0].addEventListener("dblclick",i=>{if(this.config.options.doubleClickAnnotationEnabled){let r=this.$modelviewer[0].positionAndNormalFromPoint(i.clientX,i.clientY),s=e.extension.helper.getCurrentCanvas();this.extensionHost.publish(jr.DOUBLECLICK,{target:`${s.id}#xyz=${r.position.x},${r.position.y},${r.position.z}&nxyz=${r.normal.x},${r.normal.y},${r.normal.z}`})}})}whenLoaded(e){U0.waitFor(()=>this.isLoaded,e)}overlayAnnotations(){this.clearAnnotations(),this.extension.annotations.forEach(e=>{e.points3D.forEach((t,i)=>{let r=document.createElement("DIV");r.id="annotation-"+t.canvasIndex+"-"+i,r.title=Kc(t.bodyValue),r.className="annotationPin",r.setAttribute("slot",`hotspot-${i}`),r.setAttribute("data-position",`${t.x} ${t.y} ${t.z}`),r.setAttribute("data-normal",`${t.nx} ${t.ny} ${t.nz}`),r.onclick=n=>{n.preventDefault(),this.extensionHost.publish(jt.PINPOINT_ANNOTATION_CLICKED,i)};let s=document.createElement("SPAN");s.innerText=String(i+1),r.appendChild(s),this.$modelviewer[0].appendChild(r)})})}clearAnnotations(){let e=this.$modelviewer[0].querySelectorAll(".annotationPin");[].forEach.call(e,t=>{t.parentNode.removeChild(t)})}getCameraOrbit(){if(this.$modelviewer){let e=this.$modelviewer[0].getCameraOrbit();return new Hc(e.theta,e.phi,e.radius)}return null}async openMedia(e){this.$spinner.show(),await this.extension.getExternalResources(e);let t=null,i=this.extension.helper.getCurrentCanvas(),r=this.extension.getMediaFormats(i);r&&r.length?t=r[0].id:t=i.id,this.$modelviewer.attr("src",t),this.extensionHost.publish(Jc.EXTERNAL_RESOURCE_OPENED)}resize(){super.resize(),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2),this.title&&this.$title.text(Kc(this.title)),this.$modelviewer&&(this.$modelviewer.width(this.$content.width()),this.$modelviewer.height(this.$content.height()))}},o3=Jf($0()),l3=Jf(Z0()),h3={authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,leftPanelEnabled:!1,limitLocales:!1,doubleClickAnnotationEnabled:!1,metrics:[{type:"sm",minWidth:0},{type:"md",minWidth:768},{type:"lg",minWidth:1024},{type:"xl",minWidth:1280}],openTemplate:"http://universalviewer.io?manifest={0}",rightPanelEnabled:!0,theme:"uv-en-GB-theme"},u3={shareDialogue:{options:{embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>',shareManifestsEnabled:!0},content:{customSize:"custom",embed:"Embed",embedInstructions:"To embed this item in your own website, copy and paste the code below.",height:"Height",iiif:"IIIF Manifest",share:"Share",shareInstructions:"To share this item, copy the URL below.",size:"Size:",width:"Width"}},footerPanel:{options:{downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,shareEnabled:!0},content:{bookmark:"Add to bookmarks",download:"Download",embed:"Embed",exitFullScreen:"Exit Full Screen",fullScreen:"Full Screen",moreInfo:"More Information",open:"Open",share:"Share"}},genericDialogue:{content:{ok:"OK"}},headerPanel:{content:{close:"Close",help:"Help",settings:"Settings"}},helpDialogue:{content:{text:"placeholder text",title:"Help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines"},content:{attribution:"Attribution",collapse:"Collapse Information",collapseFull:"Collapse Gallery",description:"Description",expand:"Expand Information",expandFull:"Expand Gallery",holdingText:"Your module goes here!",less:"less",license:"License",logo:"Logo",more:"more",noData:"No data to display",page:"Page",title:"More Information",manifestHeader:"About the item",canvasHeader:"About the image",copyToClipboard:"Copy to clipboard",copiedToClipboard:"Copied to clipboard"}},contentLeftPanel:{options:{elideCount:40,galleryThumbHeight:320,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90}},modelViewerCenterPanel:{options:{autoRotateEnabled:!1,cameraChangeDelay:500,interactionPromptEnabled:!1},content:{attribution:"Attribution",zoomIn:"Zoom In",zoomOut:"Zoom Out",vr:"VR"}},dialogue:{content:{close:"Close"}},downloadDialogue:{content:{download:"Download",entireFileAsOriginal:"Entire file",noneAvailable:"No download options are available.",preview:"Preview",title:"Download"}},loginDialogue:{content:{login:"Login",cancel:"Cancel"}},mediaelementCenterPanel:{content:{}},settingsDialogue:{content:{locale:"Locale",pagingEnabled:"Two Page View",reducedMotion:"Reduce motion (disables animations)",preserveViewport:"Preserve Zoom",title:"Settings",website:"<a href='https://github.com/universalviewer/universalviewer'>more info</a>"}}},c3={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xE7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},d3={authCORSError:"Your browser does not support CORS, please upgrade to view this content.",authorisationFailedMessage:"Your log-in attempt did not appear to be successful. Please try again.",degradedResourceMessage:"Please log in to view at full quality.",degradedResourceLogin:"log in",forbiddenResourceMessage:"Your current access rights are insufficient to view this image",mediaViewer:"Media Viewer",skipToDownload:"Skip to downloads and alternative formats"},Zf={options:h3,modules:u3,localisation:c3,content:d3},M3=class extends V0{constructor(){super(...arguments),this.defaultConfig=Zf,this.locales={"en-GB":Zf,"cy-GB":()=>Na(()=>import("./cy-GB-BGXBT7C3-0f349dfd.mjs"),["cy-GB-BGXBT7C3-0f349dfd.mjs","entry-cf55a5cd.mjs","entry.9d77b723.css"]),"fr-FR":()=>Na(()=>import("./fr-FR-WNWKAXBT-b4110b74.mjs"),["fr-FR-WNWKAXBT-b4110b74.mjs","entry-cf55a5cd.mjs","entry.9d77b723.css"]),"pl-PL":()=>Na(()=>import("./pl-PL-WVUPDYLM-648e5c5e.mjs"),["pl-PL-WVUPDYLM-648e5c5e.mjs","entry-cf55a5cd.mjs","entry.9d77b723.css"]),"sv-SE":()=>Na(()=>import("./sv-SE-N27HYQH5-eaa24460.mjs"),["sv-SE-N27HYQH5-eaa24460.mjs","entry-cf55a5cd.mjs","entry.9d77b723.css"])}}create(){super.create(),this.extensionHost.subscribe(jt.CANVAS_INDEX_CHANGE,e=>{this.viewCanvas(e)}),this.extensionHost.subscribe(jt.THUMB_SELECTED,e=>{this.extensionHost.publish(jt.CANVAS_INDEX_CHANGE,e)}),this.extensionHost.subscribe(jr.CAMERA_CHANGE,e=>{let t=this.helper.getCurrentCanvas();t&&(this.data.target=t.id+`#orbit=${e.toString()}`,this.fire(jt.TARGET_CHANGE,this.data.target))})}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new W0(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new H0(this.shell.$leftPanel)),this.centerPanel=new a3(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new j0(this.shell.$rightPanel)),this.isFooterPanelEnabled()?(this.footerPanel=new Kf(this.shell.$footerPanel),this.mobileFooterPanel=new Q0(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new z0(this.$moreInfoDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new K0(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ty(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new ey(this.$settingsDialogue),this.isLeftPanelEnabled()?this.leftPanel.init():this.shell.$leftPanel.hide(),this.isRightPanelEnabled()?this.rightPanel.init():this.shell.$rightPanel.hide()}render(){super.render(),this.checkForTarget(),this.checkForAnnotations()}checkForTarget(){if(this.data.target){let e=this.data.target.split("#"),t=e[0],i=this.helper.getCanvasIndexById(t);i!==null&&this.helper.canvasIndex!==i&&this.extensionHost.publish(jt.CANVAS_INDEX_CHANGE,i);let r=e[1];this.extensionHost.publish(jt.SET_TARGET,Hc.fromString(r))}}checkForAnnotations(){if(this.data.annotations){let e=[],t=this.data.annotations;Array.isArray(t)&&(e=this.groupWebAnnotationsByTarget(this.data.annotations)),this.annotate(e)}}annotate(e,t){this.annotations=e,this.annotations=e.sort((r,s)=>r.canvasIndex-s.canvasIndex);let i=new k0;i.terms=t,i.annotations=this.annotations,this.extensionHost.publish(jt.ANNOTATIONS,i)}groupWebAnnotationsByTarget(e){let t=[];for(let i=0;i<e.length;i++){let r=e[i],s=r.target.match(/(.*)#/)[1],n=this.helper.getCanvasIndexById(s),a=new J0(s);a.canvasIndex=n;let o=t.filter(l=>l.canvasId===a.canvasId)[0];o?o.addPoint3D(r):(a.addPoint3D(r),t.push(a))}return t}isLeftPanelEnabled(){return!1}bookmark(){super.bookmark();let e=this.helper.getCurrentCanvas(),t=new B0;t.index=this.helper.canvasIndex,t.label=l3.LanguageMap.getValue(e.getLabel()),t.thumb=e.getProperty("thumbnail"),t.title=this.helper.getLabel(),t.trackingLabel=window.trackingLabel,t.type=o3.ExternalResourceType.PHYSICAL_OBJECT,this.fire(jt.BOOKMARK,t)}getEmbedScript(e,t,i){let r=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}`;return O0.format(e,r,t.toString(),i.toString())}};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*//* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//* @license
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*//**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 *//**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 *//**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 *//**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/export{M3 as default};
