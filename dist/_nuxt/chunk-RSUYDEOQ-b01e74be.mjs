import{k as m}from"./chunk-P2U3GQ3L-ae62dc84.mjs";import{G as c}from"./IIIFContentHandler-2D2CUZM6-df4ed86b.mjs";import{G as f,I,O as p,W as E,P as R,S as _}from"./entry-5e54c123.mjs";var d;(function(e){e.CANVAS_RENDERINGS="canvasRenderings",e.CURRENT_VIEW="currentView",e.ENTIRE_DOCUMENT_AS_PDF="entireDocumentAsPdf",e.ENTIRE_DOCUMENT_AS_TEXT="entireDocumentAsText",e.ENTIRE_FILE_AS_ORIGINAL="entireFileAsOriginal",e.IMAGE_RENDERINGS="imageRenderings",e.MANIFEST_RENDERINGS="manifestRenderings",e.RANGE_RENDERINGS="rangeRenderings",e.SELECTION="selection",e.UNKNOWN="unknown",e.WHOLE_IMAGE_HIGH_RES="wholeImageHighRes",e.WHOLE_IMAGE_LOW_RES="wholeImageLowRes",e.WHOLE_IMAGES_HIGH_RES="wholeImagesHighRes"})(d||(d={}));var u=f(c()),r=I(),b=class extends m{constructor(e){super(e)}create(){this.setConfig("downloadDialogue"),super.create(),this.$element.attr("role","region"),this.$element.attr("aria-label",this.content.title),this.openCommand=p.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=p.HIDE_DOWNLOAD_DIALOGUE;let e;this.extensionHost.subscribe(this.openCommand,t=>{e=t,this.open(t)}),this.extensionHost.subscribe(this.closeCommand,()=>{e&&e.focus(),this.close()}),this.$title=r(`<div role="heading" class="heading">${this.content.title}</div>`),this.$content.append(this.$title),this.$noneAvailable=r('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=r('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$footer=r('<div class="footer"></div>'),this.$content.append(this.$footer),this.$termsOfUseButton=r('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$termsOfUseButton.onPressed(()=>{this.extensionHost.publish(p.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.updateTermsOfUseButton()}addEntireFileDownloadOptions(){if(this.isDownloadOptionAvailable(d.ENTIRE_FILE_AS_ORIGINAL)){this.$downloadOptions.empty();let e=this.extension.helper.getCurrentCanvas(),t=!1,l=e.getRenderings();for(let i=0;i<l.length;i++){let a=l[i],o=a.getFormat(),n="";o&&(n=o.toString()),this.addEntireFileDownloadOption(a.id,u.LanguageMap.getValue(a.getLabel()),n),t=!0}if(!t){let i=!1,a=e.getContent();for(let o=0;o<a.length;o++){let n=a[o].getBody();if(n.length){let s=n[0].getFormat();s&&(this.addEntireFileDownloadOption(n[0].id,"",s.toString()),i=!0)}}i||this.addEntireFileDownloadOption(e.id,"","")}}}addEntireFileDownloadOption(e,t,l){let i;l?i=E.simplifyMimeType(l):i=this.getFileExtension(e),t||(t=this.content.entireFileAsOriginal),i&&(t+=" ("+i+")"),this.$downloadOptions.append('<li><a href="'+e+'" target="_blank" download tabindex="0">'+t+"</li>")}resetDynamicDownloadOptions(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()}getDownloadOptionsForRenderings(e,t,l){let i=e.getRenderings(),a=[];for(let o=0;o<i.length;o++){let n=i[o];if(n){let s=u.LanguageMap.getValue(n.getLabel(),this.extension.getLocale()),h="downloadOption"+ ++this.renderingUrlsCount;s?s+=" ({0})":s=t;let g=E.simplifyMimeType(n.getFormat().toString());s=R.format(s,g),this.renderingUrls[h]=n.id;let O=r('<li class="option dynamic"><input id="'+h+'" data-mime="'+g+'" title="'+s+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+h+'">'+s+"</label></li>");a.push({type:l,button:O})}}return a}getSelectedOption(){return this.$downloadOptions.find("li.option input:checked")}getCurrentResourceId(){return this.extension.helper.getCurrentCanvas().externalResource.data.id}getCurrentResourceFormat(){let e=this.getCurrentResourceId();return e.substr(e.lastIndexOf(".")+1).toLowerCase()}updateNoneAvailable(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()}updateTermsOfUseButton(){let e=this.extension.helper.getRequiredStatement();_.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&e&&e.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}getFileExtension(e){let t=e.split(".").pop();return t.length>5||t.indexOf("/")!==-1?null:t}isMediaDownloadEnabled(){return this.extension.helper.isUIEnabled("mediaDownload")}isDownloadOptionAvailable(e){switch(e){case d.ENTIRE_FILE_AS_ORIGINAL:return this.isMediaDownloadEnabled()}return!0}close(){super.close()}resize(){this.setDockedPosition()}};export{b as _,d as h};
